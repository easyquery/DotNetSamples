{"version":3,"file":"adhoc-reporting.min.js","sources":["../../node_modules/@easydata/core/dist/easydata.core.esm.js","../../node_modules/@easyquery/core/dist/easyquery.core.esm.js","../../node_modules/@easydata/ui/dist/easydata.ui.esm.js","../../node_modules/@easyquery/ui/dist/easyquery.ui.esm.js","../../node_modules/@easyquery/enterprise/dist/easyquery.enterprise.esm.js","../../ts/adhoc-reporting.ts"],"sourcesContent":["\n/*\n * EasyData.JS Core v1.5.10\n * Build time: 1/5/2026, 9:15:41 PM\n * Copyright 2020-2026 Korzh.com\n * Licensed under MIT\n */\n\n/** Represents the common types of the data. */\nvar DataType;\n(function (DataType) {\n    /** Unknown type value*/\n    DataType[DataType[\"Unknown\"] = 0] = \"Unknown\";\n    /** String value*/\n    DataType[DataType[\"String\"] = 1] = \"String\";\n    /** 8-bit integer value */\n    DataType[DataType[\"Byte\"] = 2] = \"Byte\";\n    /** 16-bit integer value */\n    DataType[DataType[\"Word\"] = 3] = \"Word\";\n    /** 32-bit integer value */\n    DataType[DataType[\"Int32\"] = 4] = \"Int32\";\n    /** 64-bit integer value */\n    DataType[DataType[\"Int64\"] = 5] = \"Int64\";\n    /** Boolean value */\n    DataType[DataType[\"Bool\"] = 6] = \"Bool\";\n    /** Floating-point numeric value */\n    DataType[DataType[\"Float\"] = 7] = \"Float\";\n    /** Money value */\n    DataType[DataType[\"Currency\"] = 8] = \"Currency\";\n    /** Binary-coded decimal value */\n    DataType[DataType[\"BCD\"] = 9] = \"BCD\";\n    /** Date value */\n    DataType[DataType[\"Date\"] = 10] = \"Date\";\n    /** Time value */\n    DataType[DataType[\"Time\"] = 11] = \"Time\";\n    /** Date and time value */\n    DataType[DataType[\"DateTime\"] = 12] = \"DateTime\";\n    /** Autoincrement 32-bit integer value */\n    DataType[DataType[\"Autoinc\"] = 13] = \"Autoinc\";\n    /** MEMO value (text with unlimited length) */\n    DataType[DataType[\"Memo\"] = 14] = \"Memo\";\n    /** BLOB value (any data with unlimited length) */\n    DataType[DataType[\"Blob\"] = 15] = \"Blob\";\n    /** Fixed character value */\n    DataType[DataType[\"FixedChar\"] = 16] = \"FixedChar\";\n    /** The unique identifier */\n    DataType[DataType[\"Guid\"] = 17] = \"Guid\";\n    /*-------- Spatial data types ----------*/\n    /** Any geometry data */\n    DataType[DataType[\"Geometry\"] = 18] = \"Geometry\";\n    /** Any data that represents some geography objects</summary> */\n    DataType[DataType[\"Geography\"] = 19] = \"Geography\";\n})(DataType || (DataType = {}));\n\nvar EntityAttrKind;\n(function (EntityAttrKind) {\n    EntityAttrKind[EntityAttrKind[\"Data\"] = 0] = \"Data\";\n    EntityAttrKind[EntityAttrKind[\"Virtual\"] = 1] = \"Virtual\";\n    EntityAttrKind[EntityAttrKind[\"Lookup\"] = 2] = \"Lookup\";\n})(EntityAttrKind || (EntityAttrKind = {}));\n\nconst EditorTag = {\n    /** Unknown tag value */\n    Unknown: \"Unknown\",\n    /** Edit tag value */\n    Edit: \"EDIT\",\n    /** DateTime tag value  */\n    DateTime: \"DATETIME\",\n    /** List tag value */\n    List: \"LIST\",\n    /** CustomList tag value */\n    CustomList: \"CUSTOMLIST\",\n    /** File tag value */\n    File: \"FILE\"\n};\n\n/**\n * Represents a date/time value that can return either a date itself or a special date name\n */\nclass TimeValue {\n    constructor(dt) {\n        if (dt instanceof Date) {\n            this.date = dt;\n        }\n        else {\n            this._name = dt;\n        }\n    }\n    asTime(settings) {\n        if (this.date) {\n            return this.date;\n        }\n        else {\n            specialDatesResolver.getDateByName(this._name);\n        }\n    }\n    get name() {\n        return this.name;\n    }\n}\nclass SpecialDatesResolver {\n    getDateByName(name, settings) {\n        if (this[name]) {\n            return this[name](settings);\n        }\n        else {\n            return undefined;\n        }\n    }\n    Today(settings) {\n        return new Date();\n    }\n    Yesterday(settings) {\n        let d = new Date();\n        d.setDate(d.getDate() - 1);\n        return d;\n    }\n    Tomorrow(settings) {\n        let d = new Date();\n        d.setDate(d.getDate() + 1);\n        return d;\n    }\n    FirstDayOfMonth(settings) {\n        let d = new Date();\n        d.setDate(1);\n        return d;\n    }\n    LastDayOfMonth(settings) {\n        let d = new Date();\n        d.setMonth(d.getMonth() + 1, 0);\n        return d;\n    }\n    FirstDayOfNextMonth(settings) {\n        let d = new Date();\n        d.setMonth(d.getMonth() + 1, 1);\n        return d;\n    }\n    FirstDayOfPrevMonth(settings) {\n        let d = new Date();\n        d.setMonth(d.getMonth() - 1, 1);\n        return d;\n    }\n    FirstDayOfYear(settings) {\n        const d = new Date();\n        d.setMonth(0, 1);\n        return d;\n    }\n    FirstDayOfPrevYear(settings) {\n        let d = new Date();\n        d.setFullYear(d.getFullYear() - 1, 0, 1);\n        return d;\n    }\n    FirstDayOfNextYear(settings) {\n        let d = new Date();\n        d.setFullYear(d.getFullYear() + 1, 0, 1);\n        return d;\n    }\n    FirstDayOfWeek(settings) {\n        const d = new Date();\n        let day = d.getDay();\n        day = (day == 0) ? 6 : day - 1; //We start week from Monday, but js - from Sunday\n        d.setDate(d.getDate() - day);\n        return d;\n    }\n    FirstDayOfPrevWeek(settings) {\n        let d = new Date();\n        let day = d.getDay();\n        day = (day == 0) ? 1 : 8 - day; //We start week from Monday, but js - from Sunday\n        d.setDate(d.getDate() - day);\n        return d;\n    }\n    FirstDayOfNextWeek(settings) {\n        let d = new Date();\n        var day = d.getDay();\n        day = (day == 0) ? 1 : 8 - day; //We start week from Monday, but js - from Sunday\n        d.setDate(d.getDate() + day);\n        return d;\n    }\n}\nvar specialDatesResolver = new SpecialDatesResolver();\nfunction registerSpecialDatesResolver(resolver) {\n    specialDatesResolver = resolver;\n}\n\nvar HttpMethod;\n(function (HttpMethod) {\n    HttpMethod[\"Trace\"] = \"TRACE\";\n    HttpMethod[\"Options\"] = \"OPTIONS\";\n    HttpMethod[\"Get\"] = \"GET\";\n    HttpMethod[\"Put\"] = \"PUT\";\n    HttpMethod[\"Post\"] = \"POST\";\n    HttpMethod[\"Delete\"] = \"DELETE\";\n})(HttpMethod || (HttpMethod = {}));\n\nclass HttpRequest {\n    constructor(xhr, descriptor) {\n        this.xhr = xhr;\n        this.method = descriptor.method;\n        this.url = descriptor.url;\n        this.headers = descriptor.headers;\n        this.queryParams = descriptor.queryParams;\n        this.data = descriptor.data;\n    }\n    setHeader(name, value) {\n        this.headers[name] = value;\n    }\n    setQueryParam(name, value) {\n        this.queryParams[name] = value;\n    }\n    getXMLHttpRequest() {\n        return this.xhr;\n    }\n    getResponseHeaders() {\n        if (this.xhr.readyState == this.xhr.HEADERS_RECEIVED) {\n            const headers = this.xhr.getAllResponseHeaders();\n            const arr = headers.trim().split(/[\\r\\n]+/);\n            // Create a map of header names to values\n            const headerMap = {};\n            for (const line of arr) {\n                const parts = line.split(': ');\n                const header = parts.shift();\n                const value = parts.join(': ');\n                headerMap[header] = value;\n            }\n            return headerMap;\n        }\n        return {};\n    }\n    open() {\n        if (this.xhr.readyState !== this.xhr.UNSENT)\n            return;\n        let url = this.url;\n        if (this.queryParams && Object.keys(this.queryParams).length > 0) {\n            url += encodeURI('?' + Object.keys(this.queryParams)\n                .map(param => param + '=' + this.queryParams[param])\n                .join('&'));\n        }\n        this.xhr.open(this.method, url, true);\n        this.xhr.setRequestHeader('X-Requested-With', 'XMLHttpRequest');\n        for (const header in this.headers) {\n            this.xhr.setRequestHeader(header, this.headers[header]);\n        }\n    }\n    abort() {\n        this.xhr.abort();\n    }\n}\n\nvar utils;\n(function (utils) {\n    function getAllDataTypes() {\n        return Object.values(DataType).filter(item => typeof item === \"number\");\n    }\n    utils.getAllDataTypes = getAllDataTypes;\n    function getDateDataTypes() {\n        return [DataType.Time, DataType.Date, DataType.DateTime];\n    }\n    utils.getDateDataTypes = getDateDataTypes;\n    function getStringDataTypes() {\n        return [DataType.String, DataType.Memo, DataType.FixedChar];\n    }\n    utils.getStringDataTypes = getStringDataTypes;\n    const _numericTypes = [DataType.Byte, DataType.Word, DataType.Int32,\n        DataType.Int64, DataType.Float, DataType.Currency, DataType.Autoinc];\n    function getNumericDataTypes() {\n        return _numericTypes;\n    }\n    utils.getNumericDataTypes = getNumericDataTypes;\n    const _intTypes = [DataType.Byte, DataType.Word, DataType.Int32, DataType.Int64, DataType.Autoinc];\n    //-------------- object functions -------------------\n    /**\n     * Copy the content of all objests passed in `args` parameters into `target`\n     * and returns the result\n     * NB: This function copies only the first level properties.\n     * For a deep copy please use `assignDeep`\n     * @param target - the target object\n     * @param args  - an array of the source objects\n     */\n    function assign(target, ...args) {\n        if (!target) {\n            target = {};\n        }\n        for (let i = 0; i < args.length; i++) {\n            let source = args[i];\n            if (source && source.hasOwnProperty) {\n                for (let key in source) {\n                    if (source.hasOwnProperty(key)) {\n                        target[key] = source[key];\n                    }\n                }\n            }\n        }\n        return target;\n    }\n    utils.assign = assign;\n    /**\n     * Copy the content of all objests passed in `args` parameters into `target`\n     * and returns the result\n     * NB: This function make a deep copy -\n     * so `assignDeep` will be called recursively for all object properties\n     * on the first level.\n     * @param target - the target object\n     * @param sources  - an array of the source objects\n     */\n    function assignDeep(target, ...sources) {\n        return assignDeepCore(new WeakMap(), target, sources);\n    }\n    utils.assignDeep = assignDeep;\n    function assignDeepCore(hashSet, target, sources) {\n        if (!target) {\n            target = {};\n        }\n        for (let source of sources) {\n            if (source && source.hasOwnProperty) {\n                for (let key in source) {\n                    if (source.hasOwnProperty(key)) {\n                        let sourceVal = source[key];\n                        //we don't make a deep copy of HTML elements and any other property marked as a 'reference' (ends with 'Ref')\n                        if (sourceVal !== null && typeof sourceVal === 'object'\n                            && !key.endsWith('Ref') && !(sourceVal instanceof HTMLElement)) {\n                            if (hashSet.has(sourceVal)) {\n                                target[key] = hashSet.get(sourceVal);\n                            }\n                            else {\n                                if (Array.isArray(sourceVal)) {\n                                    target[key] = createArrayFrom(sourceVal);\n                                    hashSet.set(sourceVal, target[key]);\n                                }\n                                else {\n                                    if (typeof target[key] == 'undefined' || target[key] == null) {\n                                        target[key] = Object.create(Object.getPrototypeOf(sourceVal));\n                                    }\n                                    hashSet.set(sourceVal, target[key]);\n                                    assignDeepCore(hashSet, target[key], [sourceVal]);\n                                }\n                            }\n                        }\n                        else {\n                            target[key] = sourceVal;\n                        }\n                    }\n                }\n            }\n        }\n        return target;\n    }\n    function getIfDefined(value, defaultValue) {\n        return (typeof value !== 'undefined') ? value : defaultValue;\n    }\n    utils.getIfDefined = getIfDefined;\n    function IsDefinedAndNotNull(value) {\n        return typeof value !== 'undefined' && value !== null;\n    }\n    utils.IsDefinedAndNotNull = IsDefinedAndNotNull;\n    function copyArrayTo(collection1, collection2) {\n        const len1 = collection1.length;\n        const len2 = collection2.length;\n        for (let i = 0; i < len1 && i < len2; i++) {\n            collection2[i] = collection1[i];\n        }\n    }\n    utils.copyArrayTo = copyArrayTo;\n    function createArrayFrom(collection) {\n        let result = [];\n        for (let item of collection) {\n            result.push(item);\n        }\n        return result;\n    }\n    utils.createArrayFrom = createArrayFrom;\n    /**\n     * Searches an array of the objects which implement ItemWithId by ID\n     * Returs the found object or null.\n     * @param array\n     * @param id\n     */\n    function findItemById(array, id) {\n        var arrLength = array.length;\n        for (var idx = 0; idx < arrLength; idx++) {\n            if (array[idx].id === id)\n                return array[idx];\n        }\n        return null;\n    }\n    utils.findItemById = findItemById;\n    function findItemIndexById(array, id) {\n        var arrLength = array.length;\n        for (var idx = 0; idx < arrLength; idx++) {\n            if (array[idx].id === id)\n                return idx;\n        }\n        return -1;\n    }\n    utils.findItemIndexById = findItemIndexById;\n    /**\n     * Searches an array of the objects which implement ItemWithId by ID\n     * Returs the index of the found element, or -1 if nothing was found.\n     * @param array\n     * @param id\n     */\n    function indexOfArrayItem(arr, item) {\n        if (arr.indexOf) {\n            return arr.indexOf(item);\n        }\n        else {\n            let len = arr.length;\n            for (let i = 0; i < len; i++) {\n                if (item == arr[i]) {\n                    return i;\n                }\n            }\n            return -1;\n        }\n    }\n    utils.indexOfArrayItem = indexOfArrayItem;\n    /**\n     * Moves an item in some array to a new position\n     * @param array\n     * @param index1\n     * @param index2\n     */\n    function moveArrayItem(array, index1, index2) {\n        if (index1 >= array.length) {\n            throw 'Index out of bounds: ' + index1;\n        }\n        if (index2 >= array.length) {\n            index2 = array.length - 1;\n        }\n        let item = array.splice(index1, 1)[0];\n        array.splice(index2, 0, item);\n    }\n    utils.moveArrayItem = moveArrayItem;\n    /**\n     * Searches for a particular item in the array are removes that item if found.\n     * @param arr\n     * @param value\n     */\n    function removeArrayItem(arr, value) {\n        let index = arr.indexOf(value);\n        if (index != -1) {\n            return arr.splice(index, 1)[0];\n        }\n    }\n    utils.removeArrayItem = removeArrayItem;\n    function insertArrayItem(arr, index, value) {\n        arr.splice(index, 0, value);\n    }\n    utils.insertArrayItem = insertArrayItem;\n    function fillArray(arr, value, start = 0, end) {\n        let len = arr.length >>> 0;\n        var relativeStart = start >> 0;\n        var k = relativeStart < 0 ?\n            Math.max(len + relativeStart, 0) :\n            Math.min(relativeStart, len);\n        var relativeEnd = end === undefined ?\n            len : end >> 0;\n        let final = relativeEnd < 0 ?\n            Math.max(len + relativeEnd, 0) :\n            Math.min(relativeEnd, len);\n        while (k < final) {\n            arr[k] = value;\n            k++;\n        }\n        return arr;\n    }\n    utils.fillArray = fillArray;\n    //------------ DOM utils ------------\n    /**\n     * Calculates the shift on which we need to move our element horizontally\n     * to find current window\n     * @param absLeft\n     * @param width\n     */\n    function shiftToFitWindow(absLeft, width) {\n        let body = document.getElementsByTagName('body')[0];\n        let winWidth = window.innerWidth || document.documentElement.clientWidth || body.clientWidth;\n        var absRight = absLeft + width;\n        let shift = 0;\n        if (absRight > winWidth) {\n            shift = winWidth - absRight - 10;\n            if (absLeft + shift < 0) {\n                shift = 10 - absLeft;\n            }\n        }\n        return shift;\n    }\n    utils.shiftToFitWindow = shiftToFitWindow;\n    /**\n     * Returns `true` if the value passed in the parameter is an object\n     * @param val\n     */\n    function isObject(val) {\n        if (val === null) {\n            return false;\n        }\n        return ((typeof val === 'function') || (typeof val === 'object'));\n    }\n    utils.isObject = isObject;\n    /**\n     * Returns `true` if the `DataType` value passed in the parameter\n     * represents some numeric type\n     * @param dtype\n     */\n    function isNumericType(dtype) {\n        const index = _numericTypes.indexOf(dtype);\n        return (index >= 0);\n    }\n    utils.isNumericType = isNumericType;\n    /**\n     * Returns `true` if the `DataType` value passed in the parameter\n     * represents some numeric type\n     * @param dtype\n     */\n    function isIntType(dtype) {\n        const index = _intTypes.indexOf(dtype);\n        return (index >= 0);\n    }\n    utils.isIntType = isIntType;\n    /**\n     * Returns `true` if the value passed in the parameter is an a numeric value\n     * @param val\n     */\n    function isNumeric(val) {\n        return !isNaN(parseFloat(val)) && isFinite(val);\n    }\n    utils.isNumeric = isNumeric;\n    /**\n     * Returns `true` if two data types  passed in parameters\n     * are compatible - so it's safe to copy the values between\n     * two expressions with these two types\n     * @param type1\n     * @param type2\n     */\n    function areCompatibleDataTypes(type1, type2) {\n        return typeof type1 == \"undefined\" || typeof type2 == \"undefined\" || type1 == DataType.Unknown || type2 == DataType.Unknown\n            || (type1 == type2) || (type1 == DataType.Date && type2 == DataType.DateTime)\n            || (type1 == DataType.DateTime && type2 == DataType.Date);\n    }\n    utils.areCompatibleDataTypes = areCompatibleDataTypes;\n    /**\n     * Returns `true` if the property with named `propName`\n     * in the object `obj` has some value\n     * @param obj\n     * @param propName\n     */\n    function isPropSet(obj, propName) {\n        return obj[propName] || obj[propName.toLowerCase()] || obj[propName.toUpperCase()];\n    }\n    utils.isPropSet = isPropSet;\n    //-------------- ID generator -----------\n    const prefixIdLen = 4;\n    const symbols = \"0123456789abcdefghijklmnopqrstuvwxyz\";\n    const magicTicks = 636712160627685350;\n    /**\n     * Generates an unique ID\n     */\n    function generateId(prefix) {\n        if (!prefix) {\n            prefix = 'easy';\n        }\n        let prfx = (prefix.length > prefixIdLen) ? squeezeMoniker(prefix, prefixIdLen) : prefix;\n        if (prfx && prfx.length > 0) {\n            prfx += \"-\";\n        }\n        //adding 3 random symbols\n        var randCharPart = symbols[getRandomInt(0, symbols.length)] +\n            symbols[getRandomInt(0, symbols.length)] +\n            symbols[getRandomInt(0, symbols.length)];\n        var randInt = getRandomInt(0, 10000);\n        //generating main ID part\n        //it's a 36-base representation of some random number based on current value of ticks\n        let ticksNum36 = intToNumBase(getNowTicks() - magicTicks - randInt);\n        return prfx + randCharPart + ticksNum36;\n    }\n    utils.generateId = generateId;\n    function intToNumBase(value, targetBase = 36) {\n        var buffer = '';\n        var rest = value;\n        do {\n            buffer = symbols[rest % targetBase] + buffer;\n            rest = Math.floor(rest /= targetBase);\n        } while (rest > 0);\n        return buffer;\n    }\n    function squeezeMoniker(str, maxlen) {\n        let parts = str.split('-');\n        let pml = 1;\n        let ptt = maxlen;\n        if (parts.length < maxlen) {\n            pml = maxlen / parts.length;\n            ptt = parts.length;\n        }\n        let result = \"\";\n        for (let i = 0; i < ptt; i++) {\n            result += squeeze(parts[i], pml);\n        }\n        return result;\n    }\n    function squeeze(str, maxlen) {\n        const len = str.length;\n        if (len > maxlen) {\n            let step = len / maxlen;\n            let result = \"\";\n            result += str[0];\n            let nextIndex = step;\n            let ch;\n            for (let i = 1; i < len; i++) {\n                ch = str[i];\n                if (i + 1 > nextIndex) {\n                    result += ch;\n                    nextIndex += step;\n                }\n            }\n            return result;\n        }\n        else {\n            return str;\n        }\n    }\n    function getRandomInt(min, max) {\n        return Math.floor(Math.random() * (max - min)) + min;\n    }\n    function getNowTicks() {\n        return (621355968e9 + (new Date()).getTime() * 1e4);\n    }\n    function safeParseInt(str) {\n        const res = parseInt(str);\n        if (isNaN(res))\n            throw `\"${str}\" is not a valid number`;\n        return res;\n    }\n    function getDaysInMonth(month, year) {\n        return new Date(year, month + 1, 0).getDate();\n    }\n    // ------------- date/time functions -------------------\n    // TO DO: improve to process all datetime cases\n    function strToDateTime(value, format) {\n        if (!value || value.length == 0)\n            return new Date();\n        const normalizedValue = value.replace(/[^a-zA-Z0-9_]/g, '-');\n        const normalizedFormat = format.replace(/[^a-zA-Z0-9_]/g, '-');\n        const formatItems = normalizedFormat.split('-');\n        const dateItems = normalizedValue.split('-');\n        const monthIndex = formatItems.indexOf(\"MM\");\n        const dayIndex = formatItems.indexOf(\"dd\");\n        const yearIndex = formatItems.indexOf(\"yyyy\");\n        const hourIndex = formatItems.indexOf(\"HH\");\n        const minutesIndex = formatItems.indexOf(\"mm\");\n        const secondsIndex = formatItems.indexOf(\"ss\");\n        const today = new Date();\n        try {\n            const year = yearIndex > -1 && yearIndex < dateItems.length\n                ? safeParseInt(dateItems[yearIndex])\n                : today.getFullYear();\n            const month = monthIndex > -1 && monthIndex < dateItems.length\n                ? safeParseInt(dateItems[monthIndex]) - 1\n                : today.getMonth() - 1;\n            if (month > 11)\n                throw '';\n            const day = dayIndex > -1 && dayIndex < dateItems.length\n                ? safeParseInt(dateItems[dayIndex])\n                : today.getDate();\n            if (day > getDaysInMonth(month, year))\n                throw '';\n            const hour = hourIndex > -1 && hourIndex < dateItems.length\n                ? safeParseInt(dateItems[hourIndex])\n                : 0;\n            if (hour > 23)\n                throw '';\n            const minute = minutesIndex > -1 && minutesIndex < dateItems.length\n                ? safeParseInt(dateItems[minutesIndex])\n                : 0;\n            if (minute > 59)\n                throw '';\n            const second = secondsIndex > -1 && secondsIndex < dateItems.length\n                ? safeParseInt(dateItems[secondsIndex])\n                : 0;\n            if (second > 59)\n                throw '';\n            return new Date(year, month, day, hour, minute, second);\n        }\n        catch (_a) {\n            throw `${value} is not a valid date.`;\n        }\n    }\n    utils.strToDateTime = strToDateTime;\n    function strToTime(str) {\n        const timeItems = str.split(':');\n        try {\n            const hour = timeItems.length > 0 ? safeParseInt(timeItems[0]) : 0;\n            if (hour > 23)\n                throw '';\n            const minute = timeItems.length > 1 ? safeParseInt(timeItems[1]) : 0;\n            if (minute > 59)\n                throw '';\n            const second = timeItems.length > 1 ? safeParseInt(timeItems[1]) : 0;\n            if (second > 59)\n                throw '';\n            return new Date(0, 0, 0, hour, minute, second);\n        }\n        catch (_a) {\n            throw `${str} is not a valid time.`;\n        }\n    }\n    utils.strToTime = strToTime;\n})(utils || (utils = {}));\n\nclass HttpActionResult {\n    constructor(request, promise) {\n        this.request = request;\n        this.promise = promise;\n    }\n    getPromise() {\n        return this.promise;\n    }\n    getRequest() {\n        return this.request;\n    }\n    then(onfulfilled, onrejected) {\n        return this.promise.then(onfulfilled, onrejected);\n    }\n    catch(onrejected) {\n        return this.promise.catch(onrejected);\n    }\n    finally(onfinally) {\n        return this.promise.finally(onfinally);\n    }\n}\n\nclass HttpResponseError extends Error {\n    constructor(status, message) {\n        super(message);\n        Object.setPrototypeOf(this, HttpResponseError.prototype);\n        this.status = status;\n    }\n}\nclass HttpClient {\n    /** Gets the response body for the latest request  */\n    get responseBody() {\n        return this._responseBody;\n    }\n    constructor() {\n        this.defaultHeaders = {};\n        this.customPayload = undefined;\n    }\n    get(url, options) {\n        return this.send(HttpMethod.Get, url, null, options);\n    }\n    post(url, data, options) {\n        return this.send(HttpMethod.Post, url, data, options);\n    }\n    put(url, data, options) {\n        return this.send(HttpMethod.Put, url, data, options);\n    }\n    delete(url, data, options) {\n        return this.send(HttpMethod.Delete, url, data, options);\n    }\n    send(method, url, data, options) {\n        options = options || {};\n        const dataType = options.dataType || 'json';\n        const contentType = options.contentType || (dataType !== 'form-data')\n            ? 'application/json'\n            : null;\n        if (data && dataType != 'form-data' && this.customPayload) {\n            data.data = utils.assignDeep(data.data || {}, this.customPayload);\n        }\n        const XHR = ('onload' in new XMLHttpRequest())\n            ? XMLHttpRequest\n            : window[\"XDomainRequest\"]; //IE support\n        const xhr = new XHR();\n        const desc = {\n            method: method,\n            url: url,\n            headers: Object.assign(Object.assign({}, this.defaultHeaders), options.headers || {}),\n            queryParams: options.queryParams || {},\n            data: data\n        };\n        if (contentType)\n            desc.headers['Content-Type'] = contentType;\n        const request = new HttpRequest(xhr, desc);\n        if (this.beforeEachRequest) {\n            console.warn(`HttpClient: 'beforeEachRequest' is deprecated and will be removed in future updates.\r\n            Use 'onRequest' instead`);\n            this.beforeEachRequest(request);\n        }\n        if (this.onRequest) {\n            this.onRequest(request);\n        }\n        const dataToSend = (request.data && typeof request.data !== 'string'\n            && dataType == 'json')\n            ? JSON.stringify(request.data)\n            : request.data;\n        request.open();\n        return new HttpActionResult(request, new Promise((resolve, reject) => {\n            if (options.responseType)\n                xhr.responseType = options.responseType;\n            xhr.onerror = (error) => {\n                reject(new HttpResponseError(xhr.status, xhr.responseText));\n            };\n            xhr.onreadystatechange = () => {\n                if (xhr.readyState != 4)\n                    return; //we process only the state change to DONE(4)\n                const responseContentType = xhr.getResponseHeader('Content-Type') || '';\n                const status = xhr.status;\n                if (status === 0) {\n                    reject(new HttpResponseError(status, \"Network error or the request was aborted\"));\n                }\n                else if (status >= 200 && status < 400) {\n                    //Success\n                    const responseObj = (xhr.responseType === 'arraybuffer' || xhr.responseType === 'blob')\n                        ? xhr.response\n                        : (responseContentType.indexOf('application/json') == 0\n                            ? JSON.parse(xhr.responseText)\n                            : xhr.responseText);\n                    this._responseBody = responseObj;\n                    if (this.onResponse) {\n                        this.onResponse(xhr);\n                    }\n                    resolve(responseObj);\n                }\n                else {\n                    //Error\n                    const rtPromise = (xhr.responseType === 'arraybuffer' || xhr.responseType === 'blob')\n                        ? HttpClient.decodeArrayBuffer(xhr.response)\n                        : Promise.resolve(xhr.responseText);\n                    rtPromise.then(responseText => {\n                        const responseObj = (responseContentType.indexOf('application/json') == 0)\n                            ? JSON.parse(responseText)\n                            : responseText;\n                        this._responseBody = responseObj;\n                        const message = responseObj.message ||\n                            (status == 404\n                                ? `No such endpoint: ${url}`\n                                : responseObj);\n                        reject(new HttpResponseError(status, message));\n                    });\n                }\n            };\n            xhr.send(dataToSend);\n        }));\n    }\n    static decodeArrayBuffer(uintArray) {\n        var reader = new FileReader();\n        return new Promise((resolve) => {\n            reader.onloadend = function () {\n                if (reader.readyState == FileReader.DONE) {\n                    resolve(reader.result);\n                }\n            };\n            reader.readAsText(new Blob([uintArray]));\n        });\n    }\n}\n\n/**\n * Contains internatialization functionality.\n */\nvar i18n;\n(function (i18n) {\n    let englishUSLocaleSettings = {\n        shortDateFormat: 'MM/dd/yyyy',\n        longDateFormat: 'dd MMM, yyyy',\n        editDateFormat: 'MM/dd/yyyy',\n        shortTimeFormat: 'HH:mm',\n        editTimeFormat: 'HH:mm',\n        longTimeFormat: 'HH:mm:ss',\n        shortMonthNames: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],\n        longMonthNames: ['January', 'February', 'March', 'April', 'May', 'June',\n            'July', 'August', 'September', 'October', 'November', 'December'],\n        shortWeekDayNames: ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'],\n        longWeekDayNames: ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'],\n        decimalSeparator: '.',\n        currency: 'USD'\n    };\n    let defaultLocale = {\n        localeId: 'en-US',\n        englishName: 'English',\n        displayName: 'English',\n        texts: {\n            ButtonOK: 'OK',\n            ButtonCancel: 'Cancel',\n            Yes: 'Yes',\n            No: 'No',\n            True: 'True',\n            False: 'False'\n        },\n        settings: englishUSLocaleSettings\n    };\n    let allLocales = {\n        'en-US': defaultLocale\n    };\n    let currentLocale;\n    const mappers = [];\n    function mapInfo(info) {\n        for (const mapper of mappers) {\n            mapper(info);\n        }\n    }\n    function addMapper(mapper) {\n        mappers.push(mapper);\n    }\n    i18n.addMapper = addMapper;\n    /**\n     * Gets added locales with their names.\n     * @returns  The locales.\n     */\n    function getLocales() {\n        let result = [];\n        for (let locale in allLocales) {\n            result.push({\n                locale: locale,\n                englishName: allLocales[locale].englishName,\n                displayName: allLocales[locale].displayName\n            });\n        }\n        return result.sort((a, b) => {\n            if (a.englishName > b.englishName) {\n                return 1;\n            }\n            else if (a.englishName === b.englishName) {\n                return 0;\n            }\n            return -1;\n        });\n    }\n    i18n.getLocales = getLocales;\n    /**\n     * Gets the current locale ID.\n     * @returns The locale.\n     */\n    function getCurrentLocale() {\n        return currentLocale.localeId;\n    }\n    i18n.getCurrentLocale = getCurrentLocale;\n    /**\n    * Sets the curent locale.\n    * @deprecated Use setCurrentLocale instead\n    * @param l The locale.\n    */\n    function setLocale(l) {\n        console.warn('This method is deprecated. Use setCurrentLocale instead');\n        setCurrentLocale(l);\n    }\n    i18n.setLocale = setLocale;\n    /**\n     * Sets the curent locale.\n     * @param localeId The locale.\n     */\n    function setCurrentLocale(localeId) {\n        const newLocale = allLocales[localeId];\n        if (newLocale) {\n            utils.assignDeep(currentLocale, newLocale);\n        }\n        else {\n            currentLocale.englishName = localeId;\n            currentLocale.displayName = localeId;\n            currentLocale.texts = utils.assignDeep({}, defaultLocale.texts);\n        }\n        currentLocale.localeId = localeId;\n    }\n    i18n.setCurrentLocale = setCurrentLocale;\n    /**\n     * Returns localized text by the key defined in parameter.\n     * Here we get the text of the resource string assigned to CmdClickToAddCondition key:\n     *\n     ```\n       const text = i18n.getText('CmdClickToAddCondition')\n     ```\n     * @param args The keys of the resource string.\n     * @returns Text of the resource defined by key or null if the key is not found\n     *\n     */\n    function getText(...args) {\n        let textsObj = currentLocale.texts;\n        let resText = '';\n        if (args && args.length) {\n            const argLength = args.length;\n            for (let i = 0; i < argLength; i++) {\n                resText = textsObj[args[i]];\n                if (typeof resText === 'object') {\n                    textsObj = resText;\n                }\n                else {\n                    break;\n                }\n            }\n        }\n        return resText;\n    }\n    i18n.getText = getText;\n    function getLocaleSettings() {\n        return currentLocale.settings;\n    }\n    i18n.getLocaleSettings = getLocaleSettings;\n    function getOneLocaleSetting(key) {\n        return currentLocale.settings[key];\n    }\n    i18n.getOneLocaleSetting = getOneLocaleSetting;\n    function getShortMonthName(monthNum) {\n        const settings = getLocaleSettings();\n        if (monthNum > 0 && monthNum < 13) {\n            return settings.shortMonthNames[monthNum - 1];\n        }\n        else {\n            throw 'Wrong month number: ' + monthNum;\n        }\n    }\n    i18n.getShortMonthName = getShortMonthName;\n    function getLongMonthName(monthNum) {\n        const settings = getLocaleSettings();\n        if (monthNum > 0 && monthNum < 13) {\n            return settings.longMonthNames[monthNum - 1];\n        }\n        else {\n            throw 'Wrong month number: ' + monthNum;\n        }\n    }\n    i18n.getLongMonthName = getLongMonthName;\n    function getShortWeekDayName(dayNum) {\n        const settings = getLocaleSettings();\n        if (dayNum > 0 && dayNum < 8) {\n            return settings.shortWeekDayNames.length >= dayNum\n                ? settings.shortWeekDayNames[dayNum - 1]\n                : dayNum.toString();\n        }\n        else {\n            throw 'Wrong month number: ' + dayNum;\n        }\n    }\n    i18n.getShortWeekDayName = getShortWeekDayName;\n    function getLongWeekDayName(dayNum) {\n        const settings = getLocaleSettings();\n        if (dayNum > 0 && dayNum < 8) {\n            return settings.longWeekDayNames.length >= dayNum\n                ? settings.longWeekDayNames[dayNum - 1]\n                : dayNum.toString();\n        }\n        else {\n            throw 'Wrong month number: ' + dayNum;\n        }\n    }\n    i18n.getLongWeekDayName = getLongWeekDayName;\n    /**\n     * Updates the locale settings (date/time formats, separators, etc) for the specified locale.\n     * @param settingsToUpdate a LocaleSettings object\n     */\n    function updateLocaleSettings(settingsToUpdate) {\n        if (!currentLocale.settings) {\n            currentLocale.settings = utils.assignDeep({}, englishUSLocaleSettings);\n        }\n        currentLocale.settings = utils.assignDeep(currentLocale.settings, settingsToUpdate);\n    }\n    i18n.updateLocaleSettings = updateLocaleSettings;\n    /**\n     * Updates the texts for the current locale\n     * @param texts A plain JS object that contains textual resources\n     */\n    function updateLocaleTexts(texts) {\n        if (typeof texts !== 'object') {\n            console.error('Wrong parameter type in updateLocaleTexts function call.' +\n                'The first parameter (localeId) is not necessary. Use updateLocaleTexts(texts) instead');\n            return;\n        }\n        mapInfo({ localeId: currentLocale.localeId, texts: texts });\n        utils.assignDeep(currentLocale.texts, texts);\n    }\n    i18n.updateLocaleTexts = updateLocaleTexts;\n    /**\n     * Updates the default texts for the current locale and all other locales available now\n     * This function does rewrite the texts in the locales, it just adds new textual resources if they didn't exists previously\n     * @param texts A plain JS object that contains textual resources\n     */\n    function updateDefaultTexts(texts) {\n        for (let localeId in allLocales) {\n            let locale = allLocales[localeId];\n            locale.texts = utils.assignDeep({}, texts, locale.texts);\n        }\n        currentLocale.texts = utils.assignDeep({}, texts, currentLocale.texts);\n    }\n    i18n.updateDefaultTexts = updateDefaultTexts;\n    /**\n     * Updates the information for the specified locale.\n     * @param localeId The locale ID (like 'en', 'de', 'uk', etc).\n     * If the locale does exist yet - it will be added\n     * @param localeInfo  a LocaleInfo object that contains the locale settings and textual resources\n     */\n    function updateLocaleInfo(localeId, localeInfo) {\n        mapInfo(localeInfo);\n        let localeInfoToUpdate = currentLocale;\n        if (localeId) {\n            if (!localeInfo.localeId) {\n                localeInfo.localeId = localeId;\n            }\n            localeInfoToUpdate = allLocales[localeId];\n            if (!localeInfoToUpdate) {\n                localeInfoToUpdate = utils.assignDeep({}, defaultLocale);\n                allLocales[localeId] = localeInfoToUpdate;\n            }\n        }\n        utils.assignDeep(localeInfoToUpdate, localeInfo);\n    }\n    i18n.updateLocaleInfo = updateLocaleInfo;\n    /**\n     * Adds the locale.\n     * @param localeId The locale ID (like 'en', 'de', 'uk', etc).\n     * If the locale does exist yet - it will be created\n     * @param localeInfo - a LocaleInfo object that contains the locale settings and textual resources\n     */\n    function addLocale(localeId, localeInfo) {\n        updateLocaleInfo(localeId, localeInfo);\n    }\n    i18n.addLocale = addLocale;\n    /**\n     * Overwrites some locale settings (date/time formats) with the formats used in browser's current language\n     */\n    function determineSettingsByLocale(localeId) {\n        const now = new Date(2020, 5, 7, 19, 34, 56, 88);\n        const dateOptions = { year: 'numeric', month: 'numeric', day: 'numeric' };\n        const timeOptions = { hour: 'numeric', minute: 'numeric', second: 'numeric' };\n        const dateStr = now.toLocaleDateString(localeId, dateOptions);\n        const timeStr = now.toLocaleTimeString(localeId, timeOptions);\n        let dateFormat = dateStr\n            .replace('07', 'dd')\n            .replace('7', 'd')\n            .replace('06', 'MM')\n            .replace('6', 'M')\n            .replace('2020', 'yyyy')\n            .replace('20', 'yy');\n        let timeFormat = timeStr\n            .replace('19', 'HH')\n            .replace('07', 'hh')\n            .replace('7', 'h')\n            .replace('34', 'mm')\n            .replace('56', 'ss')\n            .replace('PM', 'tt');\n        if (!currentLocale.settings) {\n            currentLocale.settings = {};\n        }\n        const localeSettings = {\n            shortDateFormat: dateFormat,\n            shortTimeFormat: timeFormat\n        };\n        updateLocaleSettings(localeSettings);\n    }\n    function loadBrowserLocaleSettings() {\n        const lang = typeof navigator === 'object' ? navigator.language : undefined;\n        determineSettingsByLocale(lang);\n    }\n    function resetLocales() {\n        if (!currentLocale) {\n            currentLocale = utils.assignDeep({}, defaultLocale);\n            loadBrowserLocaleSettings();\n        }\n    }\n    i18n.resetLocales = resetLocales;\n    const DT_FORMAT_RGEX = /\\[([^\\]]+)]|y{2,4}|M{1,4}|d{1,2}|H{1,2}|h{1,2}|m{2}|s{2}|t{2}/g;\n    /**\n     * Returns string representation of the date/time value according to the custom format (second parameter)\n     * The format is compatible with the one used in .NET: https://docs.microsoft.com/en-us/dotnet/standard/base-types/custom-date-and-time-format-strings\n     * @param date\n     * @param format\n     */\n    function dateTimeToStr(date, format) {\n        const year = date.getFullYear();\n        const yearStr = year.toString();\n        const month = date.getMonth() + 1;\n        const day = date.getDate();\n        const hour = date.getHours();\n        const minute = date.getMinutes();\n        const second = date.getSeconds();\n        const hour12 = hour % 12 || 12; //the remainder of the division by 12. Or 12 if it's 0\n        const isPm = hour > 11;\n        const matches = {\n            yyyy: yearStr,\n            yy: yearStr.substring(yearStr.length - 2),\n            MMMM: i18n.getLongMonthName(month),\n            MMM: i18n.getShortMonthName(month),\n            MM: (month < 10) ? '0' + month : month.toString(),\n            M: month.toString(),\n            dd: (day < 10) ? '0' + day : day.toString(),\n            d: day.toString(),\n            HH: (hour < 10) ? '0' + hour : hour.toString(),\n            H: hour.toString(),\n            hh: (hour12 < 10) ? '0' + hour12 : hour12.toString(),\n            h: hour12.toString(),\n            tt: isPm ? 'PM' : 'AM',\n            mm: (minute < 10) ? '0' + minute : minute.toString(),\n            ss: (second < 10) ? '0' + second : second.toString()\n        };\n        return format.replace(DT_FORMAT_RGEX, (match, $1) => {\n            return $1 || matches[match];\n        });\n    }\n    i18n.dateTimeToStr = dateTimeToStr;\n    function dateTimeToStrEx(dateTime, dataType, format) {\n        if (format) {\n            if (format == 'd') {\n                format = buildShortDateTimeFormat(DataType.Date);\n            }\n            else if (format == 'D') {\n                format = buildLongDateTimeFormat(DataType.Date);\n            }\n            else if (format == 'f') {\n                format = buildShortDateTimeFormat(DataType.DateTime);\n            }\n            else if (format == 'F') {\n                format = buildLongDateTimeFormat(DataType.DateTime);\n            }\n            else if (format == 'u') {\n                format = buildUniversalDateTimeFormat(dataType);\n            }\n        }\n        else {\n            format = buildShortDateTimeFormat(dataType);\n        }\n        return dateTimeToStr(dateTime, format);\n    }\n    i18n.dateTimeToStrEx = dateTimeToStrEx;\n    function buildShortDateTimeFormat(dataType) {\n        const localeSettings = getLocaleSettings();\n        let format;\n        switch (dataType) {\n            case DataType.Date:\n                format = localeSettings.shortDateFormat;\n                break;\n            case DataType.Time:\n                format = localeSettings.shortTimeFormat;\n                break;\n            default:\n                format = localeSettings.shortDateFormat + ' ' + localeSettings.shortTimeFormat;\n                break;\n        }\n        return format;\n    }\n    function buildLongDateTimeFormat(dataType) {\n        const localeSettings = getLocaleSettings();\n        let format;\n        switch (dataType) {\n            case DataType.Date:\n                format = localeSettings.longDateFormat;\n                break;\n            case DataType.Time:\n                format = localeSettings.longTimeFormat;\n                break;\n            default:\n                format = localeSettings.longDateFormat + ' ' + localeSettings.longTimeFormat;\n                break;\n        }\n        return format;\n    }\n    function buildUniversalDateTimeFormat(dataType) {\n        const localeSettings = getLocaleSettings();\n        let format;\n        const dateFormat = 'yyyy-MM-dd';\n        switch (dataType) {\n            case DataType.Date:\n                format = dateFormat;\n                break;\n            case DataType.Time:\n                format = localeSettings.shortTimeFormat;\n                break;\n            default:\n                format = dateFormat + ' ' + localeSettings.shortTimeFormat;\n                break;\n        }\n        return format;\n    }\n    /**\n    * Converts a numeric value to the string taking into the account the decimal separator\n    * @param num - the number to convert\n    * @param format - the format of the number representation (D - decimal, F - float, C - currency)\n    * @param decimalSeparator - the symbol that represents decimal separator. If not specified the function gets the one from the current locale settings.\n    */\n    function numberToStr(num, format, decimalSeparator) {\n        if (format && format.length > 0) {\n            const type = format.charAt(0).toUpperCase();\n            if (type === 'S') {\n                return formatWithSequence(num, format.slice(1));\n            }\n            else if (['D', 'F', 'C'].indexOf(type) >= 0) {\n                const locale = getCurrentLocale();\n                return num.toLocaleString(locale, getNumberFormatOptions(format));\n            }\n            else {\n                return convertWithMask(Math.trunc(num), format);\n            }\n        }\n        const localeSettings = getLocaleSettings();\n        decimalSeparator = decimalSeparator || localeSettings.decimalSeparator;\n        return num.toString().replace('.', decimalSeparator);\n    }\n    i18n.numberToStr = numberToStr;\n    function booleanToStr(bool, format) {\n        if (format && format.length > 0) {\n            const type = format.charAt(0).toUpperCase();\n            if (type === 'S') {\n                const values = format.slice(1).split('|');\n                if (values.length > 1) {\n                    const value = values[(bool) ? 1 : 0];\n                    return i18n.getText(value) || value;\n                }\n            }\n        }\n        return `${bool}`;\n    }\n    i18n.booleanToStr = booleanToStr;\n    const cachedSequenceFormats = {};\n    function formatWithSequence(number, format) {\n        if (!cachedSequenceFormats[format]) {\n            // parse and save in cache format values \n            const values = format.split('|')\n                .filter(v => v.length > 0)\n                .map(v => v.split('='));\n            cachedSequenceFormats[format] = {};\n            if (values.length > 0) {\n                if (values[0].length > 1) {\n                    for (const value of values) {\n                        cachedSequenceFormats[format][Number.parseInt(value[1])] = value[0];\n                    }\n                }\n                else {\n                    values.forEach((value, index) => {\n                        cachedSequenceFormats[format][index] = value[0];\n                    });\n                }\n            }\n        }\n        const values = cachedSequenceFormats[format];\n        if (values[number] !== undefined) {\n            const value = values[number];\n            return i18n.getText(value) || value;\n        }\n        return number.toString();\n    }\n    function convertWithMask(number, mask) {\n        let value = number.toString();\n        let result = '';\n        let index = value.length - 1;\n        for (let i = mask.length - 1; i >= 0; i--) {\n            const ch = mask.charAt(i);\n            if (ch === '#' || ch === '0') {\n                if (index >= 0) {\n                    result += value.charAt(index);\n                    index--;\n                }\n                else {\n                    if (ch === '0') {\n                        result += 0;\n                    }\n                }\n            }\n            else {\n                result += ch;\n            }\n        }\n        return result.split('').reverse().join('');\n    }\n    function getNumberFormatOptions(format) {\n        const localeSettings = getLocaleSettings();\n        const type = format[0].toUpperCase();\n        const digits = (format.length > 1)\n            ? Number.parseInt(format.slice(1))\n            : type == 'D' ? 1 : 2;\n        switch (type) {\n            case 'D':\n                return {\n                    style: 'decimal',\n                    useGrouping: false,\n                    minimumIntegerDigits: digits\n                };\n            case 'C':\n                return {\n                    style: 'currency',\n                    currency: localeSettings.currency,\n                    minimumFractionDigits: digits\n                };\n            default:\n                return {\n                    style: 'decimal',\n                    minimumFractionDigits: digits,\n                    maximumFractionDigits: digits\n                };\n        }\n    }\n})(i18n || (i18n = {}));\n\n/**\n * Represents one entity.\n */\nclass MetaEntity {\n    /** The default constructor. */\n    constructor(parent) {\n        /** Returns false if this entity is read-only */\n        this.isEditable = true;\n        this.name = \"\";\n        this.caption = \"\";\n        this.description = \"\";\n        this.parent = parent;\n        this.attributes = new Array();\n        this.subEntities = new Array();\n    }\n    /**\n    * Loads entity from its JSON representation object.\n    * @param model The Data Model.\n    * @param dto The JSON representation object.\n    */\n    loadFromData(model, dto) {\n        if (dto) {\n            this.id = dto.id;\n            this.name = dto.name;\n            this.captionPlural = dto.namePlur;\n            this.caption = dto.name;\n            this.description = dto.desc;\n            if (typeof (dto.ied) !== 'undefined')\n                this.isEditable = dto.ied;\n            this.subEntities = new Array();\n            if (dto.ents) {\n                for (let i = 0; i < dto.ents.length; i++) {\n                    let newEntity = model.createEntity(this);\n                    newEntity.loadFromData(model, dto.ents[i]);\n                    this.subEntities.push(newEntity);\n                }\n            }\n            this.attributes = new Array();\n            if (dto.attrs) {\n                for (let i = 0; i < dto.attrs.length; i++) {\n                    let newAttr = model.createEntityAttr(this);\n                    newAttr.loadFromData(model, dto.attrs[i]);\n                    this.attributes.push(newAttr);\n                }\n            }\n        }\n    }\n    scan(processAttribute, processEntity) {\n        let opts = { stop: false };\n        let internalProcessEntity = (entity) => {\n            if (processEntity)\n                processEntity(entity, opts);\n            if (entity.attributes) {\n                let attrCount = entity.attributes.length;\n                for (let i = 0; (i < attrCount) && !opts.stop; i++) {\n                    let attr = entity.attributes[i];\n                    if (processAttribute) {\n                        processAttribute(attr, opts);\n                    }\n                    if (opts.stop)\n                        return;\n                }\n            }\n            if (entity.subEntities) {\n                let subEntityCount = entity.subEntities.length;\n                for (let i = 0; (i < subEntityCount) && !opts.stop; i++) {\n                    internalProcessEntity(entity.subEntities[i]);\n                }\n            }\n        };\n        internalProcessEntity(this);\n    }\n    getFirstPrimaryAttr() {\n        return this.getPrimaryAttrs()[0];\n    }\n    getPrimaryAttrs() {\n        return this.attributes.filter(attr => attr.isPrimaryKey);\n    }\n}\nclass MetaEntityAttr {\n    /** The default constructor. */\n    constructor(entity) {\n        this.id = \"\";\n        this.caption = \"{Unrecognized attribute}\";\n        this.dataType = DataType.String;\n        this.size = 0;\n        this.isPrimaryKey = false;\n        this.isForeignKey = false;\n        this.isNullable = true;\n        this.showOnView = true;\n        this.isEditable = true;\n        this.showOnCreate = true;\n        this.showOnEdit = true;\n        this.showInLookup = false;\n        this.lookupAttr = \"\";\n        this.expr = \"\";\n        this.entity = entity;\n        this.kind = EntityAttrKind.Data;\n    }\n    /**\n     * Loads entity attribute from JSON representation object.\n     * @param model The Data Model.\n     * @param dto The JSON representation object.\n     */\n    loadFromData(model, dto) {\n        if (dto) {\n            this.id = dto.id;\n            this.description = dto.desc;\n            this.caption = dto.cptn;\n            this.dataType = dto.dtype;\n            this.isPrimaryKey = dto.ipk;\n            this.isForeignKey = dto.ifk;\n            this.size = dto.size;\n            this.lookupAttr = dto.lattr;\n            this.lookupEntity = dto.lent;\n            this.dataAttr = dto.dattr;\n            this.lookupDataAttr = dto.ldattr;\n            const isDataType = utils.getDateDataTypes().indexOf(this.dataType);\n            this.defaultValue = dto.defVal && isDataType ? new Date(dto.defVal) : dto.defVal;\n            this.isNullable = utils.getIfDefined(dto.nul, this.isNullable);\n            this.isEditable = utils.getIfDefined(dto.ied, this.isEditable);\n            this.showOnView = utils.getIfDefined(dto.ivis || dto.sov, this.showOnView);\n            this.showOnCreate = utils.getIfDefined(dto.soc, this.showOnCreate);\n            this.showOnEdit = utils.getIfDefined(dto.soe, this.showOnEdit);\n            this.showInLookup = utils.getIfDefined(dto.sil, this.showInLookup);\n            this.kind = dto.kind;\n            this.displayFormat = dto.dfmt;\n            if (dto.udata)\n                this.userData = dto.udata;\n            if (dto.edtr) {\n                this.defaultEditor = model.getEditorById(dto.edtr) || model.createValueEditor();\n            }\n        }\n    }\n}\n\n/**\n * Represents a value editor.\n */\nclass ValueEditor {\n    /** The default constructor. */\n    constructor() {\n        this.id = \"\";\n        this.tag = EditorTag.Unknown;\n        this.resType = DataType.Unknown;\n        this.defValue = \"\";\n    }\n    /**\n     * Loads value editor from its JSON representation object.\n     * @param data The JSON representation object.\n     */\n    loadFromData(data) {\n        if (data) {\n            this.id = data.id;\n            this.tag = data.tag;\n            this.defValue = data.defval;\n            this.resType = data.rtype;\n            this.accept = data.accept;\n            this.multiline = data.multiline;\n            if (data.subType) {\n                this.resType = data.subType;\n            }\n            if (data.name) {\n                this.name = data.name;\n            }\n            if (data.values) {\n                this.values = data.values;\n            }\n        }\n    }\n    getValueText(value) {\n        let result = \"\";\n        if (!this.values)\n            return result;\n        if (Array.isArray(value)) {\n            for (let item of this.values) {\n                if (value.indexOf(item.id) >= 0) {\n                    result += item.text + ',';\n                }\n            }\n        }\n        else {\n            for (let item of this.values) {\n                if (item.id === value) {\n                    result += item.text + ',';\n                }\n            }\n        }\n        if (result) {\n            result = result.substring(0, result.length - 1);\n        }\n        return result;\n    }\n}\n\n/**\n * Represents a data model\n */\nclass MetaData {\n    /** The default constructor. */\n    constructor() {\n        this.mainEntity = null;\n        this.id = '__none';\n        this.name = 'Empty model';\n        this.rootEntity = this.createEntity();\n        this.displayFormats = new Map();\n    }\n    /**\n     * Gets the main entity of model\n     * @return The main entity.\n     */\n    getMainEntity() {\n        return this.mainEntity;\n    }\n    createEntity(parent) {\n        return new MetaEntity(parent);\n    }\n    createEntityAttr(parent) {\n        return new MetaEntityAttr(parent);\n    }\n    createValueEditor() {\n        return new ValueEditor();\n    }\n    /**\n     * Loads data model from JSON.\n     * @param stringJson The JSON string.\n     */\n    loadFromJSON(stringJson) {\n        let model = JSON.parse(stringJson);\n        this.loadFromData(model);\n    }\n    /**\n     * Loads data model from its JSON representation object.\n     * @param data The JSON representation object.\n     */\n    loadFromData(data) {\n        this.id = data.id;\n        this.name = data.name;\n        this.version = data.vers;\n        //Editors\n        this.editors = new Array();\n        if (data.editors) {\n            for (let i = 0; i < data.editors.length; i++) {\n                let newEditor = this.createValueEditor();\n                newEditor.loadFromData(data.editors[i]);\n                this.editors.push(newEditor);\n            }\n        }\n        //rootEntity\n        this.rootEntity.loadFromData(this, data.entroot);\n        //DataFormats\n        this.displayFormats = new Map();\n        if (data.displayFormats) {\n            for (const dtypeStr in data.displayFormats) {\n                const dtype = DataType[dtypeStr];\n                const formats = data.displayFormats[dtypeStr] || new Array();\n                this.displayFormats.set(dtype, formats);\n            }\n        }\n    }\n    /**\n     * Gets the display formats.\n     * @returns The display formats.\n     */\n    getDisplayFormats() {\n        return this.displayFormats;\n    }\n    /**\n     * Gets the display formats for type\n     * @param type The type\n     * @returns An array of display formats\n     */\n    getDisplayFormatsForType(type) {\n        if (this.displayFormats.has(type)) {\n            return this.displayFormats.get(type);\n        }\n        return [];\n    }\n    /**\n     * Gets the default display format for the provided type\n     * @param type The type\n     * @returns The default type format or null\n     */\n    getDefaultFormat(type) {\n        if (this.displayFormats.has(type)) {\n            return this.displayFormats.get(type).filter(f => f.isdef)[0];\n        }\n        return null;\n    }\n    /**\n     * Sets data to data model.\n     * @param model Its JSON representation object or JSON string.\n     */\n    setData(model) {\n        if (typeof model === 'string') {\n            this.loadFromJSON(model);\n        }\n        else {\n            this.loadFromData(model);\n        }\n    }\n    /**\n     * Checks wether the data model is empty.\n     * @returns `true` if the data model is empty, otherwise `false`.\n     */\n    isEmpty() {\n        return this.rootEntity.subEntities.length === 0 && this.rootEntity.attributes.length === 0;\n    }\n    /**\n     * Gets ID of the data model.\n     * @returns The ID.\n     */\n    getId() {\n        return this.id;\n    }\n    /**\n     * Gets name of the data model.\n     * @returns The name.\n     */\n    getName() {\n        return this.name;\n    }\n    /**\n     * Gets root entity of the data model.\n     * @returns The root entity.\n     */\n    getRootEntity() {\n        return this.rootEntity;\n    }\n    /**\n     * Finds editor by its ID.\n     * @param editorId The editor ID.\n     * @returns The value editor or `null`.\n     */\n    getEditorById(editorId) {\n        for (let editor of this.editors) {\n            if (editor.id === editorId) {\n                return editor;\n            }\n        }\n        return null;\n    }\n    /**\n     * Gets entity attribute by its ID.\n     * This function runs through all attributes inside specified model (it's root entity and all its sub-entities).\n     * @param attrId The attribute ID.\n     * @returns The attribute or `null`.\n     */\n    getAttributeById(attrId) {\n        let attr = this.getEntityAttrById(this.getRootEntity(), attrId);\n        if (!attr) {\n            return null;\n        }\n        return attr;\n    }\n    /**\n     * Checks wether attribute contains such property.\n     * @param attrId The attribute ID.\n     * @param propName The property name.\n     * @returns `true` if the attribute contains the property, otherwise `false`.\n     */\n    checkAttrProperty(attrId, propName) {\n        let attribute = this.getAttributeById(attrId);\n        if (attribute) {\n            if (typeof attribute[propName] === 'undefined') {\n                throw 'No such property: ' + propName;\n            }\n            if (attribute[propName]) {\n                return true;\n            }\n            else if (attribute.lookupAttr) {\n                attrId = attribute.lookupAttr;\n                attribute = this.getAttributeById(attrId);\n                return attribute && attribute[propName];\n            }\n            else {\n                return false;\n            }\n        }\n        else\n            return false;\n    }\n    /**\n     * Gets entity attribute by its ID.\n     * This function runs through all attributes inside specified entity and all its sub-entities.\n     * @param entity\n     * @param attrId\n     * @returns The attribute or `null`.\n     */\n    getEntityAttrById(entity, attrId) {\n        let idx;\n        if (entity.attributes) {\n            let attrCount = entity.attributes.length;\n            for (idx = 0; idx < attrCount; idx++) {\n                if (entity.attributes[idx].id == attrId) {\n                    return entity.attributes[idx];\n                }\n            }\n        }\n        let res;\n        if (entity.subEntities) {\n            let subEntityCount = entity.subEntities.length;\n            for (idx = 0; idx < subEntityCount; idx++) {\n                res = this.getEntityAttrById(entity.subEntities[idx], attrId);\n                if (res)\n                    return res;\n            }\n        }\n        return null;\n    }\n    listByEntityWithFilter(entity, filterFunc) {\n        let result = new Array();\n        let caption;\n        let ent = null;\n        if (entity.subEntities) {\n            let subEntityCount = entity.subEntities.length;\n            for (let entIdx = 0; entIdx < subEntityCount; entIdx++) {\n                ent = entity.subEntities[entIdx];\n                if (!filterFunc || filterFunc(ent, null)) {\n                    caption = i18n.getText('Entities', ent.name);\n                    if (!caption) {\n                        caption = ent.caption;\n                    }\n                    let newEnt = utils.assign(this.createEntity(), { id: ent.name, text: caption, items: [], isEntity: true });\n                    newEnt.items = this.listByEntityWithFilter(ent, filterFunc);\n                    if (newEnt.items.length > 0)\n                        result.push(newEnt);\n                }\n            }\n        }\n        let attr = null;\n        if (entity.attributes) {\n            let attrCount = entity.attributes.length;\n            for (let attrIdx = 0; attrIdx < attrCount; attrIdx++) {\n                attr = entity.attributes[attrIdx];\n                if (!filterFunc || filterFunc(entity, attr)) {\n                    caption = i18n.getText('Attributes', attr.id);\n                    if (!caption)\n                        caption = attr.caption;\n                    let newEnt = utils.assign(this.createEntity(), { id: attr.id, text: caption, dataType: attr.dataType });\n                    result.push(newEnt);\n                }\n            }\n        }\n        return result;\n    }\n    listByEntity(entity, opts, filterFunc) {\n        opts = opts || {};\n        let resultEntities = [];\n        let resultAttributes = [];\n        let caption;\n        let ent = null;\n        if (entity.subEntities) {\n            let subEntityCount = entity.subEntities.length;\n            for (let entIdx = 0; entIdx < subEntityCount; entIdx++) {\n                ent = entity.subEntities[entIdx];\n                if (!filterFunc || filterFunc(ent, null)) {\n                    caption = i18n.getText('Entities', ent.name) || ent.caption;\n                    let newEnt = utils.assign(this.createEntity(), {\n                        id: ent.name,\n                        text: caption,\n                        items: [],\n                        isEntity: true,\n                        description: ent.description\n                    });\n                    let newOpts = utils.assign({}, opts);\n                    newOpts.includeRootData = false;\n                    newEnt.items = this.listByEntity(ent, newOpts, filterFunc);\n                    if (newEnt.items.length > 0) {\n                        resultEntities.push(newEnt);\n                    }\n                }\n            }\n        }\n        let attr = null;\n        if (entity.attributes) {\n            let attrCount = entity.attributes.length;\n            for (let attrIdx = 0; attrIdx < attrCount; attrIdx++) {\n                attr = entity.attributes[attrIdx];\n                if (!filterFunc || filterFunc(entity, attr)) {\n                    caption = i18n.getText('Attributes', attr.id) || attr.caption;\n                    resultAttributes.push(utils.assign(this.createEntityAttr(entity), {\n                        id: attr.id, text: caption,\n                        dataType: attr.dataType, lookupAttr: attr.lookupAttr,\n                        description: attr.description\n                    }));\n                }\n            }\n        }\n        let sortCheck = (a, b) => {\n            if (a.text.toLowerCase() == b.text.toLowerCase()) {\n                return 0;\n            }\n            if (a.text.toLowerCase() > b.text.toLowerCase()) {\n                return 1;\n            }\n            return -1;\n        };\n        if (opts.sortEntities) {\n            resultEntities.sort(sortCheck);\n            resultAttributes.sort(sortCheck);\n        }\n        let result;\n        if (!opts.attrPlacement || opts.attrPlacement == 0) {\n            result = resultEntities.concat(resultAttributes);\n        }\n        else {\n            result = resultAttributes.concat(resultEntities);\n        }\n        if (opts.attrPlacement == 2) {\n            result.sort(sortCheck);\n        }\n        if (opts.includeRootData) {\n            caption = i18n.getText('Entities', entity.name);\n            if (!caption)\n                caption = entity.caption;\n            return { id: entity.name, text: caption, items: result };\n        }\n        else {\n            return result;\n        }\n    }\n    /**\n     * Clears data model.\n     */\n    clear() {\n        this.rootEntity = this.createEntity();\n        this.editors = [];\n        this.version = '';\n    }\n    /**\n     * Add default value editors.\n     */\n    addDefaultValueEditors() {\n        let ve;\n        ve = this.addOrUpdateValueEditor('_DTE', EditorTag.Edit, DataType.String);\n        ve.defValue = '';\n        this.addOrUpdateValueEditor('_DPDE', EditorTag.DateTime, DataType.DateTime);\n        this.addOrUpdateValueEditor('_DPTE', EditorTag.DateTime, DataType.DateTime);\n    }\n    /**\n    * Add or update a value editor.\n    * @param id The id.\n    * @param tag The tag.\n    * @param resType The result type.\n    * @returns The value editor.\n    */\n    addOrUpdateValueEditor(id, tag, resType) {\n        let ve = utils.findItemById(this.editors, id);\n        if (!ve) {\n            ve = this.createValueEditor();\n            ve.id = id;\n            this.editors.push(ve);\n        }\n        ve.tag = tag;\n        ve.resType = resType;\n        return ve;\n    }\n    /**\n     * Gets entities tree.\n     * @param opts The options.\n     * @param filterFunc The filter function.\n     * Takes two parameters, Entity and EntityAttr (second parameter will be null for entities), and returns boolean (true if the corresponding entity or attribute).\n     * @returns The tree of the entities and their attributes according to options and the filter function\n     */\n    getEntitiesTree(opts, filterFunc) {\n        return this.listByEntity(this.getRootEntity(), opts, filterFunc);\n    }\n    /**\n     * Gets entities tree due to filter.\n     * @param filterFunc The filter function.\n     * Takes two parameters, Entity and EntityAttr (second parameter will be null for entities), and returns boolean (true if the corresponding entity or attribute).\n     * @returns The tree of the entities and their attributes according to the filter function\n     */\n    getEntitiesTreeWithFilter(filterFunc) {\n        return this.listByEntityWithFilter(this.getRootEntity(), filterFunc);\n    }\n    /**\n     * Finds full entity path by attribute\n     * @param attrId The attribute id.\n     * @param sep The separator.\n     * @returns The path.\n     */\n    getFullEntityPathByAttr(attrId, sep) {\n        sep = sep || ' ';\n        return this.getEntityPathByAttr(this.getRootEntity(), attrId, sep, true);\n    }\n    /**\n    * Finds entity path by attribute\n    * @param entity The entity.\n    * @param attrId The attribute id.\n    * @param sep The separator.\n    * @param root The root option.\n    * @returns The path.\n    */\n    getEntityPathByAttr(entity, attrId, sep, root) {\n        if (!entity)\n            return '';\n        sep = sep || ' ';\n        let entityCaption = '';\n        if (entity.caption && !root) {\n            let entityText = i18n.getText('Entities', entity.caption);\n            entityCaption = entityText ? entityText : entity.caption;\n        }\n        if (entity.attributes) {\n            let attrCount = entity.attributes.length;\n            for (let i = 0; i < attrCount; i++) {\n                if (entity.attributes[i].id == attrId) {\n                    return entityCaption;\n                }\n            }\n        }\n        if (entity.subEntities) {\n            let subEntityCount = entity.subEntities.length;\n            for (let i = 0; i < subEntityCount; i++) {\n                let ent = entity.subEntities[i];\n                let res = this.getEntityPathByAttr(ent, attrId, sep, false);\n                if (res !== '') {\n                    if (entityCaption !== '')\n                        res = entityCaption + sep + res;\n                    return res;\n                }\n            }\n        }\n        return '';\n    }\n    /**\n     * Gets the attribute text.\n     * @param attr The attribute.\n     * @param format The format.\n     * @returns Formatted text.\n     */\n    getAttributeText(attr, format) {\n        let attrText = i18n.getText('Attributes', attr.id);\n        if (!attrText) {\n            attrText = attr.caption;\n        }\n        if (!format) {\n            return attrText;\n        }\n        let result = '';\n        let entityPath = this.getFullEntityPathByAttr(attr.id, ' ');\n        if (entityPath) {\n            result = format.replace(new RegExp('{attr}', 'g'), attrText);\n            result = result.replace(new RegExp('{entity}', 'g'), entityPath);\n        }\n        else {\n            result = attrText;\n        }\n        return result.trim();\n    }\n    /**\n     * Scans model's entity tree and calls the callback functions for each attribute and entity.\n     * @param processAttribute The callback function which is called for each attribute in model's entity tree.\n     * The processed attribute is passed in the first function parameter.\n     * @param processEntity The callback function which is called for each entity in tree.\n     * The processed entity is passed in the first function parameter.\n     */\n    runThroughEntities(processAttribute, processEntity) {\n        this.getRootEntity().scan(processAttribute, processEntity);\n    }\n    /**\n     * Finds first attribute by filter.\n     * @param filterFunc The filter function. Takes EntityAttr object in parameter and returns boolean\n     */\n    getFirstAttributeByFilter(filterFunc) {\n        let res = null;\n        this.runThroughEntities(function (attr, opts) {\n            if (filterFunc(attr)) {\n                opts.stop = true;\n                res = attr;\n            }\n        }, null);\n        return res;\n    }\n}\n\n/**\n * Defines aggregations settings for the current context.\n * Group, aggregate columns, grand totals, etc.\n */\nclass AggregationSettings {\n    constructor(colStore) {\n        this.colStore = colStore;\n        this.aggregates = [];\n        this.groups = [];\n        this.useGrandTotals = false;\n        this.useRecordCount = false;\n        this._caseSensitiveGroups = false;\n        this.COUNT_FIELD_NAME = 'GRPRECCNT';\n    }\n    get caseSensitiveGroups() {\n        return this._caseSensitiveGroups;\n    }\n    set caseSensitiveGroups(value) {\n        this._caseSensitiveGroups = value;\n        this.updateCompareProc();\n    }\n    updateCompareProc() {\n        this.compareValues = this._caseSensitiveGroups\n            ? this.strictCompare\n            : this.caseInsensitiveCompare;\n    }\n    addGroup(settings) {\n        const cols = settings.columns || this.colStore.getColumnIds(settings.from, settings.to);\n        if (!this.colStore.validateColumns(cols))\n            throw \"Invalid columns: \" + cols;\n        if (this.hasColumnsInUse(cols))\n            throw \"Can't add same columns to different groups/aggregates\";\n        this.groups.push(Object.assign({ columns: cols }, settings));\n        return this;\n    }\n    addAggregateColumn(colIndexOrId, funcId) {\n        const colId = typeof colIndexOrId == 'string'\n            ? colIndexOrId\n            : this.colStore.getColumnIds(colIndexOrId, colIndexOrId)[0];\n        if (this.hasColumnsInUse([colId]) || !this.colStore.validateAggregate(colId, funcId))\n            throw 'Invalid aggregation function for the column: ' + colId;\n        this.aggregates.push({ colId, funcId });\n        return this;\n    }\n    addGrandTotals() {\n        this.useGrandTotals = true;\n        return this;\n    }\n    addCounts() {\n        this.useRecordCount = true;\n        return this;\n    }\n    getGroups() {\n        let cols = [];\n        const mappedGrops = this.groups.map(grp => {\n            cols = cols.concat(grp.columns);\n            return Object.assign(Object.assign({}, grp), { columns: Array.from(cols), aggregates: Array.from(this.aggregates) });\n        });\n        return mappedGrops;\n    }\n    getInternalGroups() {\n        return this.groups;\n    }\n    lastGroup() {\n        const groups = this.getGroups();\n        return groups[groups.length - 1];\n    }\n    getAggregates() {\n        return this.aggregates;\n    }\n    hasAggregates() {\n        return this.aggregates.length > 0;\n    }\n    hasGroups() {\n        return this.groups.length > 0;\n    }\n    hasGrandTotals() {\n        return this.useGrandTotals;\n    }\n    hasRecordCount() {\n        return this.useRecordCount;\n    }\n    isEmpty() {\n        return !(this.hasAggregates() || this.hasGroups() ||\n            this.hasGrandTotals() || this.hasRecordCount());\n    }\n    isValid() {\n        return (this.hasGroups() && (this.hasAggregates() || this.hasRecordCount()))\n            || (this.hasAggregates && this.hasGrandTotals());\n    }\n    drop() {\n        console.warn('\"drop()\" method is obsolete. Use \"clear()\" instead');\n        this.clear();\n    }\n    clear() {\n        this.groups = [];\n        this.aggregates = [];\n        this.useGrandTotals = false;\n        this.useRecordCount = false;\n        this.caseSensitiveGroups = false;\n        return this;\n    }\n    /**\n     * Checks if all columns from the list passed in the parameter are \"unused\".\n     * Here \"unused column\" means a column that is included neither in any group nor in the aggregates list.\n     * @param cols - the array of column IDs\n     * @returns true if all columns in the list are not used anywhere, othervise - fals\n     */\n    hasColumnsInUse(cols) {\n        for (const group of this.groups) {\n            const interCols = group.columns\n                .filter(c => cols.indexOf(c) >= 0);\n            if (interCols.length > 0)\n                return true;\n        }\n        for (const aggr of this.aggregates) {\n            if (cols.indexOf(aggr.colId) >= 0)\n                return true;\n        }\n        return false;\n    }\n    needAggrCalculation() {\n        return (this.hasAggregates() || this.hasRecordCount())\n            && (this.hasGrandTotals() || this.hasGroups());\n    }\n    saveToData() {\n        return {\n            groups: Array.from(this.groups),\n            ugt: this.useGrandTotals,\n            urc: this.useRecordCount,\n            csg: this.caseSensitiveGroups,\n            aggregates: Array.from(this.aggregates)\n        };\n    }\n    loadFromData(data) {\n        if (data) {\n            if (typeof data.ugt !== 'undefined')\n                this.useGrandTotals = data.ugt;\n            if (typeof data.urc !== 'undefined')\n                this.useRecordCount = data.urc;\n            if (typeof data.csg !== 'undefined')\n                this.caseSensitiveGroups = data.csg;\n            if (data.groups) {\n                this.groups = Array.from(data.groups);\n            }\n            if (data.aggregates) {\n                this.aggregates = Array.from(data.aggregates);\n            }\n        }\n    }\n    buildGroupKey(group, row) {\n        const caseInsensitive = !this.caseSensitiveGroups;\n        let result = {};\n        if (group) {\n            for (const colId of group.columns) {\n                let keyVal = row.getValue(colId);\n                if (caseInsensitive && typeof (keyVal) === 'string') {\n                    keyVal = keyVal.toLowerCase();\n                }\n                result[colId] = keyVal;\n            }\n        }\n        return result;\n    }\n    //returns true if value1 == value2\n    strictCompare(value1, value2) {\n        if (value1 instanceof Date) {\n            return value1.getTime() === value2.getTime();\n        }\n        else\n            return value1 === value2;\n    }\n    //makes a case insensative comparision of two values and return true if there are equal\n    caseInsensitiveCompare(value1, value2) {\n        if (value1 instanceof Date) {\n            return value1.getTime() === value2.getTime();\n        }\n        else {\n            const val1 = (typeof value1 === 'string') ? value1.toLowerCase() : value1;\n            const val2 = (typeof value2 === 'string') ? value2.toLowerCase() : value2;\n            return val1 === val2;\n        }\n    }\n}\n\nvar ColumnAlignment;\n(function (ColumnAlignment) {\n    ColumnAlignment[ColumnAlignment[\"None\"] = 0] = \"None\";\n    ColumnAlignment[ColumnAlignment[\"Left\"] = 1] = \"Left\";\n    ColumnAlignment[ColumnAlignment[\"Center\"] = 2] = \"Center\";\n    ColumnAlignment[ColumnAlignment[\"Right\"] = 3] = \"Right\";\n})(ColumnAlignment || (ColumnAlignment = {}));\nclass DataColumn {\n    constructor(desc) {\n        if (!desc)\n            throw Error(\"Options are required\");\n        if (!desc.id)\n            throw Error(\"Field Id is required\");\n        if (!desc.label)\n            throw Error(\"Label is required\");\n        this.id = desc.id;\n        this.type = utils.getIfDefined(desc.type, DataType.String);\n        this.label = desc.label;\n        this.originAttrId = desc.originAttrId;\n        this.isAggr = desc.isAggr || false;\n        this.displayFormat = desc.dfmt;\n        this.groupFooterColumnTemplate = desc.gfct;\n        this.style = desc.style || {};\n        this.description = desc.description;\n        this.calculatedWidth = 0;\n    }\n}\nclass DataColumnList {\n    constructor() {\n        this.items = [];\n        this.mapper = {};\n        this._dateColumnIdx = [];\n    }\n    get count() {\n        return this.items.length;\n    }\n    add(colOrDesc) {\n        let col;\n        if (colOrDesc instanceof DataColumn) {\n            col = colOrDesc;\n        }\n        else {\n            col = new DataColumn(colOrDesc);\n        }\n        const index = this.items.length;\n        this.items.push(col);\n        this.mapper[col.id] = index;\n        if ([DataType.Date, DataType.DateTime, DataType.Time].indexOf(col.type) >= 0) {\n            this._dateColumnIdx.push(index);\n        }\n        return index;\n    }\n    updateDateColumnIdx() {\n        this._dateColumnIdx = this.getItems()\n            .filter(col => [DataType.Date, DataType.DateTime, DataType.Time].indexOf(col.type) >= 0)\n            .map((col, index) => index);\n    }\n    put(index, col) {\n        if (index >= 0 && index < this.count) {\n            this.items[index] = col;\n            this.updateDateColumnIdx();\n        }\n    }\n    move(col, newIndex) {\n        let oldIndex = this.items.indexOf(col);\n        if (oldIndex >= 0 && oldIndex != newIndex) {\n            utils.moveArrayItem(this.items, oldIndex, newIndex);\n            this.updateDateColumnIdx();\n        }\n    }\n    get(index) {\n        if (index >= 0 && index < this.count) {\n            return this.items[index];\n        }\n        else {\n            return null;\n        }\n    }\n    getIndex(id) {\n        return this.mapper[id];\n    }\n    getItems() {\n        return this.items;\n    }\n    getDateColumnIndexes() {\n        return this._dateColumnIdx;\n    }\n    removeAt(index) {\n        const col = this.get(index);\n        this.items.splice(index, 1);\n        const removeDate = this._dateColumnIdx.indexOf(index);\n        if (removeDate >= 0) {\n            this._dateColumnIdx.splice(removeDate, 1);\n        }\n        delete this.mapper[col.id];\n    }\n    clear() {\n        this.items = [];\n        this._dateColumnIdx = [];\n        this.mapper = {};\n    }\n}\n\nclass DataRow {\n    constructor(columns, values) {\n        this.columns = columns;\n        this.values = values;\n    }\n    toArray() {\n        return Array.from(this.values);\n    }\n    size() {\n        return this.values.length;\n    }\n    getValue(colIdOrIndex) {\n        let index;\n        if (typeof colIdOrIndex === \"string\") {\n            index = this.columns.getIndex(colIdOrIndex);\n            if (index === undefined) {\n                throw new RangeError(`No column with id '${colIdOrIndex}'`);\n            }\n        }\n        else {\n            index = colIdOrIndex;\n        }\n        if (index >= this.values.length)\n            throw new RangeError(\"Out of range: \" + index);\n        return this.values[index];\n    }\n    setValue(colIdOrIndex, value) {\n        let index;\n        if (typeof colIdOrIndex === \"string\") {\n            index = this.columns.getIndex(colIdOrIndex);\n            if (index === undefined) {\n                throw new RangeError(`No column with id '${colIdOrIndex}'`);\n            }\n        }\n        else {\n            index = colIdOrIndex;\n        }\n        if (index >= this.values.length)\n            throw new RangeError(\"Out of range: \" + index);\n        this.values[index] = value;\n    }\n}\n\nclass EasyDataTable {\n    constructor(options) {\n        this._chunkSize = 1000;\n        this._elasticChunks = false;\n        this.cachedRows = [];\n        this.total = 0;\n        this.loader = null;\n        this.needTotal = true;\n        this.isInMemory = false;\n        options = options || {};\n        this._chunkSize = options.chunkSize || this._chunkSize;\n        this._elasticChunks = options.elasticChunks || this._elasticChunks;\n        this.loader = options.loader;\n        if (typeof options.inMemory !== 'undefined') {\n            this.isInMemory = options.inMemory;\n        }\n        if (this.isInMemory) {\n            this.needTotal = false;\n        }\n        this._columns = new DataColumnList();\n        this.onUpdate = options.onUpdate;\n        if (options.columns) {\n            for (const colDesc of options.columns) {\n                this._columns.add(colDesc);\n            }\n        }\n        if (options.rows) {\n            for (const rowData of options.rows) {\n                const row = this.createRow(rowData);\n                this.addRow(row);\n            }\n        }\n        this.needTotal = !this._elasticChunks;\n    }\n    get columns() {\n        return this._columns;\n    }\n    get chunkSize() {\n        return this._chunkSize;\n    }\n    set chunkSize(value) {\n        this._chunkSize = value;\n        this.total = 0;\n        this.needTotal = !this.elasticChunks;\n        this.cachedRows = [];\n    }\n    get elasticChunks() {\n        return this._elasticChunks;\n    }\n    set elasticChunks(value) {\n        this._elasticChunks = value;\n        this.total = 0;\n        this.needTotal = !this.elasticChunks;\n        this.cachedRows = [];\n    }\n    getRows(params) {\n        let fromIndex = 0, count = this._chunkSize;\n        if (params) {\n            if ('page' in params) {\n                fromIndex = params.pageSize * (params.page - 1);\n                count = params.pageSize;\n            }\n            else {\n                fromIndex = params.offset;\n                count = params.limit;\n            }\n        }\n        let endIndex = fromIndex + count; //the first index of the next page\n        //if we don't calculate total on this request\n        if (!this.needTotal && !this.elasticChunks) {\n            if (fromIndex >= this.total) {\n                return Promise.resolve([]);\n            }\n            if (endIndex > this.total) {\n                endIndex = this.total;\n            }\n        }\n        if (this.isInMemory && endIndex > this.cachedRows.length) {\n            endIndex = this.cachedRows.length;\n        }\n        let allChunksCached = endIndex <= this.cachedRows.length;\n        if (allChunksCached) {\n            return Promise.resolve(this.cachedRows.slice(fromIndex, endIndex));\n        }\n        //if loader is not defined\n        if (!this.loader) {\n            throw `Loader is not defined. Can't get the rows from ${fromIndex} to ${endIndex}`;\n        }\n        // we need total only for the first request\n        const needTotal = this.needTotal;\n        if (this.needTotal) {\n            this.needTotal = false;\n        }\n        let offset = this.cachedRows.length;\n        let limit = endIndex - offset;\n        if (limit < this._chunkSize) {\n            limit = this._chunkSize;\n        }\n        const resultPromise = this.loader.loadChunk({\n            offset: offset,\n            limit: limit,\n            needTotal: needTotal\n        })\n            .then(result => {\n            if (needTotal) {\n                this.total = result.total;\n            }\n            Array.prototype.push.apply(this.cachedRows, result.table.getCachedRows());\n            if (endIndex > this.cachedRows.length) {\n                endIndex = this.cachedRows.length;\n            }\n            if (this.elasticChunks) {\n                const count = result.table.getCachedCount();\n                if (count < limit) {\n                    this.total = this.cachedRows.length;\n                }\n            }\n            this.fireUpdated();\n            return this.cachedRows.slice(fromIndex, endIndex);\n        });\n        return resultPromise;\n    }\n    getRow(index) {\n        return this.getRows({ offset: index, limit: 1 })\n            .then(rows => rows.length > 0 ? rows[0] : null);\n    }\n    getTotal() {\n        return this.total;\n    }\n    setTotal(total) {\n        this.total = total;\n        this.needTotal = false;\n    }\n    getCachedCount() {\n        return this.cachedRows.length;\n    }\n    clear() {\n        this.columns.clear();\n        this.cachedRows = [];\n        this.total = 0;\n        this.needTotal = !this._elasticChunks;\n        this.fireUpdated();\n    }\n    createRow(dataOrRow) {\n        const dateIdx = this._columns.getDateColumnIndexes();\n        const values = new Array(this._columns.count);\n        const getValue = dataOrRow instanceof DataRow\n            ? (colId) => dataOrRow.getValue(colId)\n            : (colId) => dataOrRow[colId];\n        if (dataOrRow) {\n            this.columns.getItems().forEach((column) => {\n                const value = getValue(column.id);\n                const index = this.columns.getIndex(column.id);\n                values[index] = (dateIdx.indexOf(index) >= 0)\n                    ? this.mapDate(value, column.type)\n                    : value;\n            });\n        }\n        return new DataRow(this._columns, values);\n    }\n    mapDate(value, dtype) {\n        if (value) {\n            let result = new Date(value);\n            if (isNaN(result.getTime())\n                && dtype == DataType.Time) {\n                result = utils.strToTime(value);\n            }\n            return result;\n        }\n        return null;\n    }\n    addRow(rowOrValues) {\n        let newRow;\n        if (Array.isArray(rowOrValues)) {\n            let values = rowOrValues;\n            const dateIdx = this._columns.getDateColumnIndexes();\n            if (dateIdx.length > 0) {\n                for (const idx of dateIdx) {\n                    if (values[idx]) {\n                        values[idx] = this.mapDate(values[idx], this._columns.get(idx).type);\n                    }\n                }\n            }\n            newRow = new DataRow(this._columns, values);\n        }\n        else {\n            newRow = this.createRow(rowOrValues);\n        }\n        this.cachedRows.push(newRow);\n        const cachedTotal = this.getCachedCount();\n        if (cachedTotal > this.total) {\n            this.total = cachedTotal;\n        }\n        return newRow;\n    }\n    getCachedRows() {\n        return this.cachedRows;\n    }\n    totalIsKnown() {\n        if (this.elasticChunks) {\n            const count = this.getCachedCount();\n            return count === this.total;\n        }\n        return !this.needTotal;\n    }\n    fireUpdated() {\n        if (this.onUpdate) {\n            this.onUpdate(this);\n        }\n    }\n}\n\n/**\n * EasyData representation of GUID.\n */\nclass EasyGuid {\n    /**\n     * Generates new GUID.\n     * @returns The string representation of GUID.\n     */\n    static newGuid() {\n        return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {\n            var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);\n            return v.toString(16);\n        });\n    }\n}\n\n/**\n * The representation of event emitter.\n */\nclass EventEmitter {\n    /**\n     * The default constructor.\n     * @param source The source.\n     */\n    constructor(source) {\n        this.silentMode = 0;\n        this.events = new Array();\n        this.source = source;\n    }\n    /**\n     * Subscries to the event.\n     * @param eventType The event type.\n     * @param callback The callback.\n     * @returns The subscribtion ID.\n     */\n    subscribe(eventType, callback) {\n        let event = this.getEventRecByType(eventType);\n        const eventCallback = {\n            id: EasyGuid.newGuid(),\n            callback: callback\n        };\n        if (event) {\n            event.eventCallbacks.push(eventCallback);\n        }\n        else {\n            event = {\n                type: eventType,\n                eventCallbacks: new Array(eventCallback)\n            };\n            this.events.push(event);\n        }\n        return eventCallback.id;\n    }\n    /**\n     * Unsubsribes from the event.\n     * @param eventType The event type.\n     * @param callbackId The subscribtion ID.\n     */\n    unsubscribe(eventType, callbackId) {\n        let event = this.getEventRecByType(eventType);\n        if (event) {\n            let index = -1;\n            for (index = 0; index < event.eventCallbacks.length; index++) {\n                if (event.eventCallbacks[index].id === callbackId) {\n                    break;\n                }\n            }\n            if (index >= 0) {\n                event.eventCallbacks.splice(index, 1);\n            }\n        }\n    }\n    /**\n     * Fires the event.\n     * @param eventType The event type.\n     * @param data The event data.\n     * @param postpone  The postpone.\n     * @param force To fire force. If value is `true`, ignores silent mode.\n     */\n    fire(eventType, data, postpone = 0, force = false) {\n        if (this.silentMode && !force) {\n            return;\n        }\n        let eventRec = this.getEventRecByType(eventType);\n        if (eventRec) {\n            const eqevent = {\n                type: eventType,\n                source: this.source,\n                data: data\n            };\n            let emitAllFunc = () => {\n                for (let callback of eventRec.eventCallbacks) {\n                    callback.callback(eqevent);\n                }\n            };\n            if (postpone > 0) {\n                setTimeout(emitAllFunc, postpone);\n            }\n            else {\n                emitAllFunc();\n            }\n        }\n    }\n    /**\n     * Enters to silent mode.\n     */\n    enterSilentMode() {\n        this.silentMode++;\n    }\n    /**\n     * Exits from silent mode.\n     */\n    exitSilentMode() {\n        if (this.silentMode) {\n            this.silentMode--;\n        }\n    }\n    /**\n     * Checks if emitter is in silent mode.\n     * @return `true`, if silent mode is enable.\n     */\n    isSilent() {\n        return this.silentMode > 0;\n    }\n    getEventRecByType(eventType) {\n        for (let event of this.events) {\n            if (event.type == eventType) {\n                return event;\n            }\n        }\n        return null;\n    }\n}\n\nfunction repeatString(str, times) {\n    return str.repeat(times);\n}\nfunction reverseString(str) {\n    return str.split(\"\").reverse().join(\"\");\n}\nfunction strEndsWith(str, symbol) {\n    return str && str.lastIndexOf(symbol) == (str.length - symbol.length);\n}\n/**\n * Adds two paths and returns the result\n * Correctly processes leading and trailing slashes\n * @param path1\n * @param path2\n */\nfunction combinePath(path1, path2) {\n    let result = path1;\n    if (result != null && result.length > 0) {\n        if (result.charAt(result.length - 1) != '/')\n            result += \"/\";\n        result += path2;\n    }\n    else {\n        result = path2;\n    }\n    return result;\n}\n\nvar liquid;\n(function (liquid) {\n    function renderLiquidTemplate(template, vars) {\n        let result = template;\n        if (vars) {\n            for (let v in vars) {\n                const liquidVarRegexp = new RegExp('\\{\\{' + v + '\\}\\}', 'g');\n                result = result.replace(liquidVarRegexp, vars[v]);\n            }\n        }\n        return result;\n    }\n    liquid.renderLiquidTemplate = renderLiquidTemplate;\n})(liquid || (liquid = {}));\n\ni18n.resetLocales();\n\n//types\nif (typeof Object.values !== 'function') {\n    Object.values = function (obj) {\n        return Object.keys(obj).map(key => obj[key]);\n    };\n}\nif (typeof Math.trunc !== 'function') {\n    Math.trunc = function (x) {\n        if (isNaN(x)) {\n            return NaN;\n        }\n        if (x > 0) {\n            return Math.floor(x);\n        }\n        return Math.ceil(x);\n    };\n}\n\nexport { AggregationSettings, ColumnAlignment, DataColumn, DataColumnList, DataRow, DataType, EasyDataTable, EasyGuid, EditorTag, EntityAttrKind, EventEmitter, HttpClient, HttpMethod, HttpRequest, HttpResponseError, MetaData, MetaEntity, MetaEntityAttr, SpecialDatesResolver, TimeValue, ValueEditor, combinePath, i18n, liquid, registerSpecialDatesResolver, repeatString, reverseString, strEndsWith, utils };\n","\n/*\n * EasyQuery.JS Core v7.4.1-rc04\n * Copyright 2026 Korzh.com\n * Licensed under MIT\n *\n * Build time: 1/5/2026 11:26:54 PM\n */\n\nimport { i18n, DataType, utils, ValueEditor, MetaEntity, MetaEntityAttr, EditorTag, MetaData, EventEmitter, AggregationSettings, HttpClient, EasyDataTable } from '@easydata/core';\nexport { i18n } from '@easydata/core';\n\n/**\n * Represents a parser for format expressions in operators\n */\nclass FormatParser {\n    constructor(format) {\n        this.start(format);\n    }\n    /**\n     * Starts parsing of the format string passed in the parameter\n     * @param format\n     */\n    start(format) {\n        this.formatStr = format;\n        this.pos = 0;\n        this.exprNum = 0;\n        this.tokenText = '';\n    }\n    /**\n     * Skips all spcaes till the beginning of next token\n     */\n    skipSpaces() {\n        while (this.pos < this.formatStr.length && this.formatStr.charAt(this.pos) === ' ')\n            this.pos++;\n    }\n    /**\n     * Scans the source and gets the next token\n     */\n    next() {\n        this.skipSpaces();\n        if (this.pos >= this.formatStr.length)\n            return false;\n        var npos = 0;\n        if (this.formatStr.charAt(this.pos) === '{') {\n            npos = this.formatStr.indexOf('}', this.pos);\n            if (npos < 0)\n                return false;\n            this.tokenText = this.formatStr.substring(this.pos, npos + 1);\n            if (this.tokenText.indexOf('{expr') === 0) {\n                this.token = 'expression';\n                this.exprNum = parseInt(this.tokenText.substring(5, this.tokenText.length));\n            }\n            this.pos = npos + 1;\n        }\n        else if (this.formatStr.charAt(this.pos) === '[' && this.pos < this.formatStr.length - 1 && this.formatStr.charAt(this.pos + 1) === '[') {\n            this.pos += 2;\n            npos = this.formatStr.indexOf(']]', this.pos);\n            this.token = 'operator';\n            this.tokenText = this.formatStr.substring(this.pos, npos);\n            this.pos = npos + 2;\n        }\n        else {\n            this.token = 'text';\n            var npos1 = this.formatStr.indexOf('{', this.pos);\n            if (npos1 < 0)\n                npos1 = this.formatStr.length;\n            var npos2 = this.formatStr.indexOf('[[', this.pos);\n            if (npos2 < 0)\n                npos2 = this.formatStr.length;\n            npos = Math.min(npos1, npos2);\n            this.tokenText = this.formatStr.substring(this.pos, npos).trim();\n            this.pos = npos;\n        }\n        return true;\n    }\n    /**\n     * Returns current token\n     */\n    getToken() {\n        return {\n            type: this.token,\n            text: this.tokenText,\n            index: this.exprNum - 1\n        };\n    }\n    /**\n     * Parses all source string passed in constructor and returns the list of tokens\n     */\n    parse() {\n        let result = [];\n        while (this.next()) {\n            result.push(this.getToken());\n        }\n        return result;\n    }\n}\n\n/** Represents type of linking of conditions in group (predicate).*/\nvar LinkType;\n(function (LinkType) {\n    /**\n     * None of the conditions must be truth (all must be false).\n     * In SQL it will look like: `NOT (Condition1 OR Condition2 OR ...)`.\n     */\n    LinkType[LinkType[\"None\"] = 0] = \"None\";\n    /** At least one condition must be truth. In SQL they are connected by `OR` operator.*/\n    LinkType[LinkType[\"Any\"] = 1] = \"Any\";\n    /**\n     * Not all conditions must be truth (at least one must false).\n     * In SQL it will look like: `NOT(Condition1 AND Condition2 AND ...)`.\n     */\n    LinkType[LinkType[\"NotAll\"] = 2] = \"NotAll\";\n    /** All conditions must be truth, in result SQL they are connected by `AND` operator;*/\n    LinkType[LinkType[\"All\"] = 3] = \"All\";\n})(LinkType || (LinkType = {}));\n\nvar equtils;\n(function (equtils) {\n    /**\n     * Adds two paths and returns the result\n     * Correctly processes leading and trailing slashes\n     * @param path1\n     * @param path2\n     */\n    function combinePath(path1, path2) {\n        let result = path1;\n        if (result != null && result.length > 0) {\n            if (result.charAt(result.length - 1) != '/')\n                result += \"/\";\n            result += path2;\n        }\n        else {\n            result = path2;\n        }\n        return result;\n    }\n    equtils.combinePath = combinePath;\n    /**\n     * Converts a string to a `LinkType` value\n     * @param str\n     */\n    function strToLinkType(str) {\n        if (str == \"All\") {\n            return LinkType.All;\n        }\n        else if (str == \"NotAll\") {\n            return LinkType.NotAll;\n        }\n        else if (str == \"Any\") {\n            return LinkType.Any;\n        }\n        else {\n            return LinkType.None;\n        }\n    }\n    equtils.strToLinkType = strToLinkType;\n    /**\n     * Converts a `LinkType` value to a string\n     * @param type\n     */\n    function linkTypeToStr(type) {\n        if (type === LinkType.All) {\n            return \"All\";\n        }\n        else if (type === LinkType.NotAll) {\n            return \"NotAll\";\n        }\n        else if (type == LinkType.Any) {\n            return \"Any\";\n        }\n        else {\n            return \"None\";\n        }\n    }\n    equtils.linkTypeToStr = linkTypeToStr;\n    /**\n     * Parses the operator's format string and returns a list of tokens\n     * @param operator\n     */\n    function parseOperatorFormat(operator) {\n        let format = i18n.getText('Operators', operator.id, 'format');\n        if (!format) {\n            format = i18n.getText('Operators', operator.id, 'displayFormat');\n        }\n        if (!format) {\n            format = operator.displayFormat;\n        }\n        const parser = new FormatParser(format);\n        return parser.parse();\n    }\n    equtils.parseOperatorFormat = parseOperatorFormat;\n    //----------- value converstion utils --------------\n    /**\n     * Converts a value from one DataType to another\n     * @param value\n     * @param fromDataType - the original data type\n     * @param toDataType - the data type we want to get\n     */\n    function convertValue(value, fromDataType, toDataType) {\n        switch (toDataType) {\n            case DataType.String:\n                return value;\n            case DataType.Autoinc, DataType.Byte, DataType.Int32, DataType.Int64, DataType.Word:\n                let resInt = parseInt(value);\n                return isNaN(resInt) ? '' : resInt.toString();\n            case DataType.Currency, DataType.Float:\n                let resFloat = parseFloat(value);\n                return isNaN(resFloat) ? '' : resFloat.toString();\n            default:\n                return '';\n        }\n    }\n    equtils.convertValue = convertValue;\n    function downloadFile(data, filename) {\n        const blob = new Blob([data]);\n        if (window.navigator['msSaveOrOpenBlob']) {\n            // Internet Explorer\n            window.navigator['msSaveOrOpenBlob'](blob, filename);\n        }\n        else {\n            var a = document.createElement(\"a\");\n            document.body.appendChild(a);\n            a.style.display = \"none\";\n            a.href = window.URL.createObjectURL(blob);\n            a.download = filename;\n            a.click();\n            window.URL.revokeObjectURL(a.href);\n            document.body.removeChild(a);\n        }\n    }\n    equtils.downloadFile = downloadFile;\n})(equtils || (equtils = {}));\n\n/**\n * Represents an aggregate function\n */\nclass AggrFunction {\n    /** The default constructor. */\n    constructor() {\n        this.id = \"\";\n        this.caption = \"\";\n        this.sqlExpr = \"\";\n        this.displayFormat = \"\";\n        this.appliedTypes = [];\n    }\n    /**\n     * Loads an aggregate function from its JSON representation object\n     * @param aggrFunction The JSON representation object\n     */\n    loadFromData(aggrFunction) {\n        if (aggrFunction) {\n            this.id = aggrFunction.id;\n            this.caption = aggrFunction.cptn;\n            this.displayFormat = aggrFunction.fmt;\n            this.sqlExpr = aggrFunction.expr;\n            this.appliedTypes = aggrFunction.dtypes || this.appliedTypes;\n        }\n    }\n    getAppliedTypesOrDefault() {\n        if (this.appliedTypes.length > 0)\n            return this.appliedTypes;\n        if (this.id === 'SUM' || this.id === 'AVG') {\n            return [DataType.Autoinc, DataType.Byte, DataType.Currency, DataType.Float, DataType.Int32,\n                DataType.Int64, DataType.Word];\n        }\n        else if (this.id === 'MIN' || this.id === 'MAX') {\n            return [DataType.Autoinc, DataType.BCD, DataType.Byte, DataType.Currency, DataType.Date, DataType.DateTime, DataType.Time,\n                DataType.Float, DataType.Int32, DataType.Int64, DataType.Word];\n        }\n        return utils.getAllDataTypes();\n    }\n}\n\n/**\n * Represents a value editor.\n */\nclass EqValueEditor extends ValueEditor {\n    /** The default constructor. */\n    constructor() {\n        super();\n    }\n    /**\n     * Loads value editor from its JSON representation object.\n     * @param data The JSON representation object.\n     */\n    loadFromData(data) {\n        super.loadFromData(data);\n        if (data) {\n            if (data.sql) {\n                this.statement = data.sql;\n            }\n            if (data.extraParams) {\n                this.extraParams = data.extraParams;\n            }\n        }\n    }\n}\n\n/** Represents expression kinds.*/\nvar DataKind;\n(function (DataKind) {\n    /** Represents one value of some type: one constant or one attribute (field).*/\n    DataKind[DataKind[\"Scalar\"] = 0] = \"Scalar\";\n    /** The same as Scalar but represents only one constant value of some type.*/\n    DataKind[DataKind[\"Const\"] = 1] = \"Const\";\n    /** The same as Scalar but represents only one attribute.*/\n    DataKind[DataKind[\"Attribute\"] = 2] = \"Attribute\";\n    /** Represents a list of scalar values. */\n    DataKind[DataKind[\"List\"] = 4] = \"List\";\n    /** Special expression kind which represents a sub query.*/\n    DataKind[DataKind[\"Query\"] = 5] = \"Query\";\n    /** Special expression kind which represents a binding to parent column.*/\n    DataKind[DataKind[\"ParentColumn\"] = 6] = \"ParentColumn\";\n})(DataKind || (DataKind = {}));\n\n/**\n * Represents a logical expression or predicate, like comparisions or `LIKE` predicate.\n */\nclass Operator {\n    /** The default constructor. */\n    constructor() {\n        this.id = \"\";\n        this.expr = \"\";\n        this.constValueFormat = \"{const}\";\n        this.caption = \"{Unrecognized operator}\";\n        this.displayFormat = \"{expr1} [[{unrecognized operator}]] {expr2}\";\n        this.isRange = false;\n        this.caseIns = false;\n        this.paramCount = 2;\n        this.defaultOperand = new Operand();\n        this.appliedTypes = [];\n        this.operands = new Array();\n    }\n    /**\n    * Loads operator from its JSON representation object.\n    * @param model The Data Model.\n    * @param data The JSON representation object.\n    */\n    loadFromData(model, data) {\n        if (data) {\n            this.id = data.id;\n            this.caption = data.cptn;\n            this.caseIns = data.caseIns;\n            this.isRange = data.isRange;\n            this.displayFormat = data.fmt;\n            this.paramCount = data.pcnt || 0;\n            this.expr = data.expr;\n            this.appliedTypes = data.dtypes || this.appliedTypes;\n            if (data.defOperand) {\n                this.defaultOperand.loadFromData(model, data.defOperand);\n            }\n            if (data.editor) {\n                this.defaultOperand.editor = model.getEditorById(data.editor) || new EqValueEditor();\n            }\n            if (data.operands) {\n                for (let i = 0; i < data.operands.length; i++) {\n                    let newOperand = new Operand();\n                    newOperand.loadFromData(model, data.operands[i]);\n                    if (data.editor) {\n                        newOperand.editor = model.getEditorById(data.editor) || new EqValueEditor();\n                    }\n                    this.operands.push(newOperand);\n                }\n            }\n        }\n    }\n}\n/**\n * Represents one operand in some operator's expression\n */\nclass Operand {\n    /** The default constructor. */\n    constructor() {\n        this.kind = DataKind.Scalar;\n        this.dataType = DataType.Unknown;\n        this.editor = new EqValueEditor();\n        this.defValue = \"\";\n    }\n    /**\n     * Loads operand from its JSON representation object.\n     * @param model The Data Model.\n     * @param operand A plain JS object that represents the operand.\n     */\n    loadFromData(model, operand) {\n        this.kind = operand.kind;\n        this.dataType = operand.dtype;\n        this.defValue = operand.val;\n        this.defText = operand.txt;\n        if (operand.editor) {\n            this.editor = model.getEditorById(operand.editor) || new EqValueEditor();\n        }\n    }\n    /**\n     * Copies operand from other operand.\n     * @param src The source operand.\n     */\n    copyFrom(src) {\n        utils.assign(this, src);\n    }\n}\n\n/**\n * Represents one entity.\n */\nclass Entity extends MetaEntity {\n    /** The default constructor. */\n    constructor(parent) {\n        super(parent);\n        this.useInConditions = false;\n        this.useInResult = false;\n        this.useInSorting = false;\n    }\n    /**\n    * Loads entity from its JSON representation object.\n    * @param model The Data Model.\n    * @param data The JSON representation object.\n    */\n    loadFromData(model, data) {\n        super.loadFromData(model, data);\n        if (data) {\n            this.useInConditions = data.uic;\n            this.useInResult = data.uir;\n            this.useInSorting = data.uis;\n        }\n    }\n    scan(processAttribute, processEntity) {\n        super.scan((attr, opts) => processAttribute && processAttribute(attr, opts), (entity, opts) => processEntity && processEntity(entity, opts));\n    }\n}\n/**\n * Represents entity attribute.\n */\nclass EntityAttr extends MetaEntityAttr {\n    /** The default constructor. */\n    constructor(entity) {\n        super(entity);\n        /**\n         * The parameters associated with this entity attribute\n         */\n        this.params = [];\n        this.useInConditions = true;\n        this.useInResult = true;\n        this.useInSorting = true;\n        this.defaultOperator = \"\";\n        this.operators = new Array();\n        this.lookupAttr = \"\";\n        this.expr = \"\";\n    }\n    /**\n     * Loads entity attribute from JSON representation object.\n     * @param model The Data Model.\n     * @param data The JSON representation object.\n     */\n    loadFromData(model, data) {\n        super.loadFromData(model, data);\n        if (data) {\n            this.useInConditions = data.uic;\n            this.useInResult = data.uir;\n            this.useInSorting = data.uis;\n            this.expr = data.sql;\n            this.defaultOperator = data.defOperator;\n            this.operators = data.ops;\n            if (data.udata)\n                this.userData = data.udata;\n        }\n    }\n}\n\n/** Represents editor tags*/\nconst EqEditorTag = Object.assign(Object.assign({}, EditorTag), { \n    /** SqlList tag value */\n    SqlList: \"SQLLIST\", \n    /** SubQuery tag value */\n    SubQuery: \"SUBQUERY\", \n    /** Bind to parent column tag value */\n    BindToParentColumn: \"BINDTOPARENTCOLUMN\" });\n\n/**\n * Represents a data model\n */\nclass DataModel extends MetaData {\n    /** The default constructor. */\n    constructor() {\n        super();\n        this.mainEntity = null;\n        this.nullAttribute = new EntityAttr(null);\n        this.nullOperator = new Operator();\n        this.operators = new Array();\n        this.rootEntity = new Entity();\n        this.aggrFunctions = new Array();\n        this.dateMacros = ['Today', 'Yesterday',\n            'Tomorrow', 'FirstDayOfMonth', 'LastDayOfMonth',\n            'FirstDayOfWeek', 'FirstDayOfYear', 'FirstDayOfNextWeek', 'FirstDayOfPrevMonth',\n            'FirstDayOfNextMonth', 'FirstDayOfNextYear', 'FirstDayOfPrevYear', 'FirstDayOfPrevWeek'];\n        this.timeMacros = ['Now', 'HourStart', 'Midnight', 'Noon'];\n        this.links = [];\n    }\n    /**\n     * Gets the main entity of model\n     * @return The main entity.\n     */\n    getMainEntity() {\n        return this.mainEntity;\n    }\n    /**\n     * Loads data model from JSON.\n     * @param stringJson The JSON string.\n     */\n    loadFromJSON(stringJson) {\n        let model = JSON.parse(stringJson);\n        this.loadFromData(model);\n    }\n    /**\n     * Loads data model from its JSON representation object.\n     * @param data The JSON representation object.\n     */\n    loadFromData(data) {\n        if (!data || !data.entroot)\n            throw 'Invalid data model object value';\n        super.loadFromData(data);\n        //Operators\n        const newOperators = new Array();\n        if (data.operators) {\n            for (let i = 0; i < data.operators.length; i++) {\n                let newOperator = new Operator();\n                newOperator.loadFromData(this, data.operators[i]);\n                newOperators.push(newOperator);\n            }\n        }\n        this.operators = newOperators;\n        //rootEntity\n        this.rootEntity.loadFromData(this, data.entroot);\n        //Aggr Functions\n        this.aggrFunctions = new Array();\n        if (data.aggrfuncs) {\n            for (let i = 0; i < data.aggrfuncs.length; i++) {\n                let newAggrFunc = new AggrFunction();\n                newAggrFunc.loadFromData(data.aggrfuncs[i]);\n                this.aggrFunctions.push(newAggrFunc);\n            }\n        }\n    }\n    /**\n     * Gets the data model object.\n     * @returns Tha data model.\n     */\n    getObject() {\n        return this;\n    }\n    /**\n     * Sets data to data model.\n     * @param model Its JSON representation object or JSON string.\n     */\n    setData(model) {\n        if (typeof model === 'string') {\n            this.loadFromJSON(model);\n        }\n        else {\n            this.loadFromData(model);\n        }\n    }\n    /**\n     * Creates entity.\n     * @param parent The parent entity.\n     * @returns The Entity.\n     */\n    createEntity(parent) {\n        return new Entity(parent);\n    }\n    /**\n     * Creates entity attribute.\n     * @param parent The parent entity.\n     * @returns The entity attribute.\n     */\n    createEntityAttr(parent) {\n        return new EntityAttr(parent);\n    }\n    /**\n     * Creates new EqValueEditor\n     * @returns An instance of EqValueEditor class\n     */\n    createValueEditor() {\n        return new EqValueEditor();\n    }\n    /**\n     * Gets root entity of the data model.\n     * @returns The root entity.\n     */\n    getRootEntity() {\n        return this.rootEntity;\n    }\n    /**\n     * Finds editor by its ID.\n     * @param editorId The editor ID.\n     * @returns The value editor or `null`.\n     */\n    getEditorById(editorId) {\n        return super.getEditorById(editorId);\n    }\n    /**\n     * Gets entity attribute by its ID.\n     * This function runs through all attributes inside specified model (it's root entity and all its sub-entities).\n     * @param attrId The attribute ID.\n     * @returns The attribute or `null`.\n     */\n    getAttributeById(attrId) {\n        let attr = this.getEntityAttrById(this.getRootEntity(), attrId);\n        if (!attr) {\n            return null;\n        }\n        return attr;\n    }\n    /**\n    * Gets entity attribute by its ID.\n    * This function runs through all attributes inside specified model (it's root entity and all its sub-entities).\n    * @param attrId The attribute ID.\n    * @returns The attribute or `nullAttribute`.\n    */\n    getAttributeByIdSafe(attrId) {\n        const attr = this.getAttributeById(attrId);\n        if (!attr)\n            return this.nullAttribute;\n        return attr;\n    }\n    /**\n     * Checks wether attribute contains such property.\n     * @param attrId The attribute ID.\n     * @param propName The property name.\n     * @returns `true` if the attribute contains the property, otherwise `false`.\n     */\n    checkAttrProperty(attrId, propName) {\n        let attribute = this.getAttributeById(attrId);\n        if (attribute) {\n            if (typeof attribute[propName] === 'undefined') {\n                throw 'No such property: ' + propName;\n            }\n            if (attribute[propName]) {\n                return true;\n            }\n            else if (attribute.lookupAttr) {\n                attrId = attribute.lookupAttr;\n                attribute = this.getAttributeById(attrId);\n                return attribute && attribute[propName];\n            }\n            else {\n                return false;\n            }\n        }\n        else\n            return false;\n    }\n    /**\n     * Gets entity attribute by its ID.\n     * This function runs through all attributes inside specified entity and all its sub-entities.\n     * @param entity\n     * @param attrId\n     * @returns The attribute or `null`.\n     */\n    getEntityAttrById(entity, attrId) {\n        return super.getEntityAttrById(entity, attrId);\n    }\n    _listByEntityWithFilter(entity, filterFunc) {\n        let result = new Array();\n        let caption;\n        let ent = null;\n        if (entity.subEntities) {\n            let subEntityCount = entity.subEntities.length;\n            for (let entIdx = 0; entIdx < subEntityCount; entIdx++) {\n                ent = entity.subEntities[entIdx];\n                if (!filterFunc || filterFunc(ent, null)) {\n                    caption = i18n.getText('Entities', ent.name);\n                    if (!caption) {\n                        caption = ent.caption;\n                    }\n                    let newEnt = utils.assign(new Entity(), { id: ent.name, text: caption, items: [], isEntity: true });\n                    newEnt.items = this._listByEntityWithFilter(ent, filterFunc);\n                    if (newEnt.items.length > 0)\n                        result.push(newEnt);\n                }\n            }\n        }\n        let attr = null;\n        if (entity.attributes) {\n            let attrCount = entity.attributes.length;\n            for (let attrIdx = 0; attrIdx < attrCount; attrIdx++) {\n                attr = entity.attributes[attrIdx];\n                if (!filterFunc || filterFunc(entity, attr)) {\n                    caption = i18n.getText('Attributes', attr.id);\n                    if (!caption)\n                        caption = attr.caption;\n                    let newEnt = utils.assign(new Entity(), { id: attr.id, text: caption, dataType: attr.dataType });\n                    result.push(newEnt);\n                }\n            }\n        }\n        return result;\n    }\n    _listByEntity(entity, opts, filterFunc) {\n        opts = opts || {};\n        let resultEntities = [];\n        let resultAttributes = [];\n        let caption;\n        let ent = null;\n        if (entity.subEntities) {\n            let subEntityCount = entity.subEntities.length;\n            for (let entIdx = 0; entIdx < subEntityCount; entIdx++) {\n                ent = entity.subEntities[entIdx];\n                if (!filterFunc || filterFunc(ent, null)) {\n                    if (opts.addUIC !== false && ent.useInConditions !== false ||\n                        opts.addUIR !== false && ent.useInResult !== false ||\n                        opts.addUIS !== false && ent.useInSorting !== false) {\n                        caption = i18n.getText('Entities', ent.name) || ent.caption;\n                        let newEnt = utils.assign(new Entity(), {\n                            id: ent.name,\n                            text: caption,\n                            items: [],\n                            isEntity: true,\n                            description: ent.description\n                        });\n                        let newOpts = utils.assign({}, opts);\n                        newOpts.includeRootData = false;\n                        newEnt.items = this._listByEntity(ent, newOpts, filterFunc);\n                        if (newEnt.items.length > 0) {\n                            resultEntities.push(newEnt);\n                        }\n                    }\n                }\n            }\n        }\n        let attr = null;\n        if (entity.attributes) {\n            let attrCount = entity.attributes.length;\n            for (let attrIdx = 0; attrIdx < attrCount; attrIdx++) {\n                attr = entity.attributes[attrIdx];\n                if (!filterFunc || filterFunc(entity, attr)) {\n                    if (opts.addUIC !== false && attr.useInConditions !== false ||\n                        opts.addUIR !== false && attr.useInResult !== false ||\n                        opts.addUIS !== false && attr.useInSorting !== false) {\n                        caption = i18n.getText('Attributes', attr.id) || attr.caption;\n                        resultAttributes.push(utils.assign(new EntityAttr(entity), { id: attr.id, text: caption, dataType: attr.dataType, lookupAttr: attr.lookupAttr, description: attr.description }));\n                    }\n                }\n            }\n        }\n        let sortCheck = (a, b) => {\n            if (a.text.toLowerCase() == b.text.toLowerCase()) {\n                return 0;\n            }\n            if (a.text.toLowerCase() > b.text.toLowerCase()) {\n                return 1;\n            }\n            return -1;\n        };\n        if (opts.sortEntities) {\n            resultEntities.sort(sortCheck);\n            resultAttributes.sort(sortCheck);\n        }\n        let result;\n        if (!opts.attrPlacement || opts.attrPlacement == 0) {\n            result = resultEntities.concat(resultAttributes);\n        }\n        else {\n            result = resultAttributes.concat(resultEntities);\n        }\n        if (opts.attrPlacement == 2) {\n            result.sort(sortCheck);\n        }\n        if (opts.includeRootData) {\n            caption = i18n.getText('Entities', entity.name);\n            if (!caption)\n                caption = entity.caption;\n            return { id: entity.name, text: caption, items: result };\n        }\n        else {\n            return result;\n        }\n    }\n    /**\n     * Clears data model.\n     */\n    clear() {\n        super.clear();\n        this.operators = [];\n        this.aggrFunctions = [];\n    }\n    /**\n     * Add or update an operator.\n     * @param desc The operator descriptor.\n     * @returns The operator.\n     */\n    addOrUpdateOperator(desc) {\n        let op = utils.findItemById(this.operators, desc.id);\n        if (!op) {\n            op = new Operator();\n            op.id = desc.id;\n            this.operators.push(op);\n        }\n        op.caption = desc.caption;\n        op.expr = desc.expr || '';\n        op.displayFormat = desc.format;\n        op.defaultOperand = new Operand();\n        op.defaultOperand.kind = desc.kind || DataKind.Scalar;\n        if (desc.appliedTypes)\n            op.appliedTypes = desc.appliedTypes;\n        if (desc.paramCount > 0) {\n            op.paramCount = desc.paramCount;\n        }\n        this.runThroughEntities((attr, opts) => {\n            if (attr.operators.indexOf(op.id) < 0 && op.appliedTypes.indexOf(attr.dataType) >= 0) {\n                attr.operators.push(op.id);\n            }\n        });\n        return op;\n    }\n    /**\n     * Removes an operator.\n     * @param id The id.\n     * @param soft If `false` - removes operators from model and attributes. Otherwise only\n     * from attributes.\n     */\n    removeOperator(id, soft = false) {\n        let op = utils.findItemById(this.operators, id);\n        if (op) {\n            if (!soft)\n                utils.removeArrayItem(this.operators, op);\n            this.runThroughEntities((attr, opts) => {\n                utils.removeArrayItem(attr.operators, op.id);\n            });\n        }\n    }\n    /**\n     * Get operators for data type.\n     * @param type The data type\n     * @return The array of operator ids.\n     */\n    getOperatorIdsByDataType(type) {\n        switch (type) {\n            case DataType.String:\n            case DataType.Memo:\n                return 'StartsWith,EndsWith,Contains,Equal,InList,NotStartsWith,NotEndsWith,NotContains,NotEqual,NotInList,IsNull,IsNotNull'.split(',');\n            case DataType.Guid:\n                return 'Equal,NotEqual'.split(',');\n            case DataType.Date:\n            case DataType.DateTime:\n                return 'DateWithinToday,DateWithinThisWeek,DateWithinPrevWeek,DateWithinThisMonth,DateWithinPrevMonth,DateWithinThisYear,DateWithinPrevYear,DateBeforePrecise,DateAfterPrecise,DatePeriodPrecise,IsNull,IsNotNull'.split(',');\n            case DataType.Time:\n                return 'TimeBeforePrecise,TimeAfterPrecise,TimePeriodPrecise,IsNull,IsNotNull'.split(',');\n            case DataType.Byte:\n            case DataType.Word:\n            case DataType.Int32:\n            case DataType.Int64:\n            case DataType.Float:\n            case DataType.Currency:\n            case DataType.BCD:\n            case DataType.Autoinc:\n            case DataType.Unknown:\n                return 'Equal,Between,LessThan,LessOrEqual,GreaterThan,GreaterOrEqual,InList,NotEqual,NotBetween,NotInList,IsNull,IsNotNull'.split(',');\n            case DataType.Bool:\n                return 'IsTrue,NotTrue'.split(',');\n            default:\n                const result = [];\n                for (let op of this.operators)\n                    if (op.appliedTypes.indexOf(type) >= 0)\n                        result.push(op.id);\n                return result;\n        }\n    }\n    findAggrFunctionById(funcId) {\n        for (const func of this.aggrFunctions) {\n            if (func.id === funcId)\n                return func;\n        }\n        return null;\n    }\n    /**\n     * Finds link between two entities.\n     * @param entityFrom The entity `from`.\n     * @param entityTo The entity `to`.\n     * @return The link.\n     */\n    findLink(entityFrom, entityTo) {\n        for (let link of this.links) {\n            if (link.entityFrom == entityFrom\n                && link.entityTo == entityTo)\n                return link;\n        }\n        return null;\n    }\n    /**\n     * Get links with the entity.\n     * @param entity The entity.\n     * @return The link.\n     */\n    getLinksByEntity(entity) {\n        const result = [];\n        for (let link of this.links) {\n            if (link.entityFrom == entity || link.entityTo == entity) {\n                result.push(link);\n            }\n        }\n        return result;\n    }\n    /**\n     * Gets entities tree.\n     * @param opts The options.\n     * @param filterFunc The filter function.\n     * Takes two parameters, Entity and EntityAttr (second parameter will be null for entities), and returns boolean (true if the corresponding entity or attribute).\n     * @returns The tree of the entities and their attributes according to options and the filter function\n     */\n    getEntitiesTree(opts, filterFunc) {\n        return this._listByEntity(this.getRootEntity(), opts, filterFunc);\n    }\n    /**\n     * Gets entities tree due to filter.\n     * @param filterFunc The filter function.\n     * Takes two parameters, Entity and EntityAttr (second parameter will be null for entities), and returns boolean (true if the corresponding entity or attribute).\n     * @returns The tree of the entities and their attributes according to the filter function\n     */\n    getEntitiesTreeWithFilter(filterFunc) {\n        return this._listByEntityWithFilter(this.getRootEntity(), filterFunc);\n    }\n    /**\n     * Finds full entity path by attribute\n     * @param attrId The attribute id.\n     * @param sep The separator.\n     * @returns The path.\n     */\n    getFullEntityPathByAttr(attrId, sep) {\n        sep = sep || ' ';\n        return this.getEntityPathByAttr(this.getRootEntity(), attrId, sep, true);\n    }\n    /**\n    * Finds entity path by attribute\n    * @param entity The entity.\n    * @param attrId The attribute id.\n    * @param sep The separator.\n    * @param root The root option.\n    * @returns The path.\n    */\n    getEntityPathByAttr(entity, attrId, sep, root) {\n        return super.getEntityPathByAttr(entity, attrId, sep, root);\n    }\n    /**\n     * Gets the attribute text.\n     * @param attr The attribute.\n     * @param format The format.\n     * @returns Formatted text.\n     */\n    getAttributeText(attr, format) {\n        return super.getAttributeText(attr, format);\n    }\n    getFirstUICAttr() {\n        return this.getFirstUICAttrInEntity(this.getRootEntity());\n    }\n    /**\n     * Gets first `UIC` attribute in specified entity\n     * (`UIC` stands for `use in conditions` - so such attribute can be used in conditions)\n     * @param entity Entity object to search our attribute in.\n     * @returns The entity attribute or `null`\n     */\n    getFirstUICAttrInEntity(entity) {\n        if (entity.useInConditions !== false) {\n            if (entity.attributes) {\n                let attrCount = entity.attributes.length;\n                for (let i = 0; i < attrCount; i++) {\n                    if (entity.attributes[i].useInConditions) {\n                        return entity.attributes[i];\n                    }\n                }\n            }\n            if (entity.subEntities) {\n                let subEntityCount = entity.subEntities.length;\n                for (let i = 0; i < subEntityCount; i++) {\n                    let result = this.getFirstUICAttrInEntity(entity.subEntities[i]);\n                    if (result) {\n                        return result;\n                    }\n                }\n            }\n        }\n        return null;\n    }\n    /**\n     * Scans model's entity tree and calls the callback functions for each attribute and entity.\n     * @param processAttribute The callback function which is called for each attribute in model's entity tree.\n     * The processed attribute is passed in the first function parameter.\n     * @param processEntity The callback function which is called for each entity in tree.\n     * The processed entity is passed in the first function parameter.\n     */\n    runThroughEntities(processAttribute, processEntity) {\n        this.getRootEntity().scan(processAttribute, processEntity);\n    }\n    /**\n     * Finds first attribute by filter.\n     * @param filterFunc The filter function. Takes EntityAttr object in parameter and returns boolean\n     */\n    getFirstAttributeByFilter(filterFunc) {\n        let res = null;\n        this.runThroughEntities(function (attr, opts) {\n            if (filterFunc(attr)) {\n                opts.stop = true;\n                res = attr;\n            }\n        }, null);\n        return res;\n    }\n    /**\n     * Finds operator in model by its ID.\n     * This function runs through all operators inside specified model and returns the one with specified ID.\n     * @param operatorId An operator ID.\n     * @returns The operator or `null`.\n     */\n    findOperatorById(operatorId) {\n        if (this.operators.length > 0) {\n            let opCount = this.operators.length;\n            for (let idx = 0; idx < opCount; idx++) {\n                if (this.operators[idx].id == operatorId) {\n                    return this.operators[idx];\n                }\n            }\n        }\n        return null;\n    }\n    /**\n     * Finds operator in model by its ID.\n     * his function runs through all operators inside specified model and returns the one with specified ID.\n     * @param operatorId Operator ID.\n     * @returns The operator or special `NullOperator` object if operator is not found.\n     */\n    getOperatorById(operatorId) {\n        let op = this.findOperatorById(operatorId);\n        if (!op)\n            return this.nullOperator;\n        return op;\n    }\n    getDefaultOperatorIdForAttr(attr) {\n        if (attr.defaultOperator) {\n            return attr.defaultOperator;\n        }\n        else if (attr.operators.length > 0) {\n            return attr.operators[0];\n        }\n        else {\n            return this.nullOperator.id;\n        }\n    }\n    /**\n     * Gets caption of the aggregate function.\n     * @param funcId The function id.\n     * @returns The caption.\n     */\n    getAggrFunctionCaption(funcId) {\n        let funcTexts = i18n.getText('AggregateFunctions', funcId);\n        let funcCaption = funcTexts ? funcTexts.caption : i18n.getText('Aggr' + funcId.replace(' ', '') + '_Caption');\n        if (funcCaption) {\n            return funcCaption;\n        }\n        let func = utils.findItemById(this.aggrFunctions, funcId);\n        if (!func || !func.caption)\n            return funcId;\n        return func.caption;\n    }\n    /**\n     * Gets format of the aggregate function.\n     * @param funcId The function id.\n     * @returns The caption.\n     */\n    getAggrFunctionFormat(funcId) {\n        let funcTexts = i18n.getText('AggregateFunctions', funcId);\n        let funcFormat = funcTexts ? funcTexts.displayFormat : i18n.getText('Aggr' + funcId.replace(' ', '') + '_Format');\n        if (funcFormat) {\n            return funcFormat;\n        }\n        let func = utils.findItemById(this.aggrFunctions, funcId);\n        if (!func || !func.displayFormat)\n            return '';\n        return func.displayFormat;\n    }\n    /**\n     * Gets default operator for an attribute.\n     * @param attr The attribute.\n     * @returns The operator.\n     */\n    getDefaultOperatorForAttr(attr) {\n        let operatorId = this.getDefaultOperatorIdForAttr(attr);\n        return this.getOperatorById(operatorId);\n    }\n    /**\n     * Gets operand.\n     * @param attr The attribute.\n     * @param operator The operator.\n     * @param index The index.\n     * @returns The operand.\n     */\n    getOperand(attr, operator, index) {\n        let defOperand = new Operand();\n        if (operator && operator.defaultOperand) {\n            defOperand.copyFrom(operator.defaultOperand);\n            if (!defOperand.defValue) {\n                defOperand.defValue = '';\n            }\n            if (!defOperand.defText) {\n                defOperand.defText = '';\n            }\n        }\n        else {\n            defOperand.kind = DataKind.Scalar;\n            defOperand.dataType = attr.dataType;\n            defOperand.defValue = '';\n            defOperand.defText = '';\n            defOperand.editor = null;\n        }\n        let result = defOperand;\n        if (result.dataType === DataType.Unknown && attr) {\n            result.dataType = attr.dataType;\n        }\n        if (operator && (index >= 0)) {\n            if (operator.operands && operator.operands[index - 1]) {\n                result = utils.assign(result, operator.operands[index - 1]);\n            }\n        }\n        if (!result.editor) {\n            if (defOperand.editor) {\n                result.editor = defOperand.editor;\n            }\n            else if (defOperand.kind === DataKind.Query) {\n                result.editor.tag = EqEditorTag.SubQuery;\n            }\n            else if (attr && attr.defaultEditor) {\n                result.editor = attr.defaultEditor;\n            }\n            else if (result.dataType === DataType.Date || result.dataType === DataType.DateTime\n                || result.dataType === DataType.Time) {\n                result.editor.tag = EqEditorTag.DateTime;\n            }\n            else {\n                result.editor.tag = EqEditorTag.Edit;\n            }\n        }\n        return result;\n    }\n    /**\n     * Gets the list of aggegate functions.\n     * @returns AN array of aggregate functions.\n     */\n    getAggrFunctions() {\n        return this.aggrFunctions;\n    }\n    /**\n     * Checks wether macro value is date.\n     * @param macroExpr The macro value.\n     * @retruns `true` if the macro value is date, otherwise `false`.\n     */\n    isDateMacro(macroExpr, macroProcessor) {\n        const match = macroExpr.match(/\\${{?(.*?)}?}/);\n        if (match != null) {\n            const macroId = match[1];\n            if (utils.indexOfArrayItem(this.dateMacros, macroId) >= 0) {\n                if (macroProcessor) {\n                    macroProcessor(macroId);\n                }\n                return true;\n            }\n        }\n        return false;\n    }\n    /**\n     * Checks whether the expression passed in the parameter is an time macro.\n     * @param macroExpr The macro expression\n     * @retruns `true` if the expression is a time macro (like Now), otherwise `false`.\n     */\n    isTimeMacro(macroExpr, macroProcessor) {\n        const match = macroExpr.match(/\\${{?(.*?)}?}/);\n        if (match != null) {\n            const macroId = match[1];\n            if (utils.indexOfArrayItem(this.timeMacros, macroId) >= 0) {\n                if (macroProcessor) {\n                    macroProcessor(macroId);\n                }\n                return true;\n            }\n        }\n        return false;\n    }\n    /**\n     * Gets date by its macro value.\n     * @param macroExpr The macro value.\n     * @returns The date or `null`\n     */\n    getDateMacroValue(macroExpr) {\n        let d = new Date();\n        const res = this.isDateMacro(macroExpr, macroId => {\n            switch (macroId) {\n                case 'Today':\n                    break;\n                case 'Yesterday':\n                    d.setDate(d.getDate() - 1);\n                    break;\n                case 'Tomorrow':\n                    d.setDate(d.getDate() + 1);\n                    break;\n                case 'FirstDayOfMonth':\n                    d.setDate(1);\n                    break;\n                case 'LastDayOfMonth':\n                    d.setMonth(d.getMonth() + 1, 0);\n                    break;\n                case 'FirstDayOfPrevWeek':\n                    var day = d.getDay();\n                    day = (day == 0) ? 1 : 8 - day; //We start week from Monday, but js - from Sunday\n                    d.setDate(d.getDate() - day);\n                    break;\n                case 'FirstDayOfWeek':\n                    var day = d.getDay();\n                    day = (day == 0) ? 6 : day - 1; //We start week from Monday, but js - from Sunday\n                    d.setDate(d.getDate() - day);\n                    break;\n                case 'FirstDayOfYear':\n                    d.setMonth(0, 1);\n                    break;\n                case 'FirstDayOfNextWeek':\n                    var day = d.getDay();\n                    day = (day == 0) ? 1 : 8 - day; //We start week from Monday, but js - from Sunday\n                    d.setDate(d.getDate() + day);\n                    break;\n                case 'FirstDayOfNextMonth':\n                    d.setMonth(d.getMonth() + 1, 1);\n                    break;\n                case 'FirstDayOfPrevMonth':\n                    d.setMonth(d.getMonth() - 1, 1);\n                    break;\n                case 'FirstDayOfPrevYear':\n                    d.setFullYear(d.getFullYear() - 1, 0, 1);\n                    break;\n                case 'FirstDayOfNextYear':\n                    d.setFullYear(d.getFullYear() + 1, 0, 1);\n                    break;\n            }\n        });\n        return res ? d : null;\n    }\n    /**\n    * Gets the date value by a macro expression of the expression itself.\n    * @param macroExpr The macro value.\n    * @returns The date or macro valu.\n    */\n    getDateOrMacroValue(macroExpr) {\n        let d = this.getDateMacroValue(macroExpr);\n        return d ? d : macroExpr;\n    }\n    /**\n    * Gets time by its macro value.\n    * @param macroExpr The macro value.\n    * @returns The date or `null`.\n    */\n    getTimeMacroValue(macroExpr) {\n        let d = new Date();\n        const res = this.isDateMacro(macroExpr, macroId => {\n            switch (macroId) {\n                case 'Now':\n                    break;\n                case 'HourStart':\n                    d.setMinutes(0, 0, 0);\n                    break;\n                case 'Midnight':\n                    d.setHours(0, 0, 0, 0);\n                    break;\n                case 'Noon':\n                    d.setHours(12, 0, 0, 0);\n                    break;\n            }\n        });\n        return res ? d : null;\n    }\n    /**\n     * Gets a time value by macor or the macro itself.\n     * @param time The macro or time value.\n     * @returns The time value or a macro that represents a particular time.\n     */\n    getTimeOrMacroValue(time) {\n        var t = this.getTimeMacroValue(time);\n        return t ? t : time;\n    }\n    // /**\n    //  * Gets all date marcos.\n    //  * @returns The array of marcos\n    //  */\n    getAllDateMacros() {\n        return this.dateMacros;\n    }\n    /**\n     * Gets all time marcos.\n     * @returns The array of marcos\n     */\n    getAllTimeMacros() {\n        return this.timeMacros;\n    }\n}\n\n/** Contains several constant definitions for expressions tag */\nvar ExprTag;\n(function (ExprTag) {\n    /** Unknown expression */\n    ExprTag[ExprTag[\"Unknown\"] = 0] = \"Unknown\";\n    /** Constant expression */\n    ExprTag[ExprTag[\"Constant\"] = 1] = \"Constant\";\n    /** Entity attributre expression */\n    ExprTag[ExprTag[\"EntityAttribute\"] = 2] = \"EntityAttribute\";\n    /** Parent entity attribute expression */\n    ExprTag[ExprTag[\"ParentEntityAttribute\"] = 3] = \"ParentEntityAttribute\";\n    /** Agrregate function expression */\n    ExprTag[ExprTag[\"AggregateFunction\"] = 4] = \"AggregateFunction\";\n    /** Parent column expression */\n    ExprTag[ExprTag[\"ParentColumn\"] = 5] = \"ParentColumn\";\n    /** Query expression */\n    ExprTag[ExprTag[\"Query\"] = 11] = \"Query\";\n    /** Custom sql expression */\n    ExprTag[ExprTag[\"CustomSql\"] = 21] = \"CustomSql\";\n})(ExprTag || (ExprTag = {}));\n\n/**\n * Represents expression object.\n */\nclass Expression {\n    /** The default constructor. */\n    constructor(parent) {\n        this.parent = parent;\n        /** The tag. */\n        this.tag = ExprTag.Constant;\n        /** The data kind. */\n        this.kind = DataKind.Scalar;\n        /** The data type. */\n        this.dataType = DataType.Unknown;\n        /** The value. */\n        this._value = ''; //DO NOT forget remove any\n        /**\n         * The distinct option. (e.g `SELECT DISTINCT`)\n         */\n        this.distinct = false;\n        this._isDefaultValue = false;\n        this.getText = () => this.text || this._value;\n        this.args = new Array();\n    }\n    getParent() {\n        return this.parent;\n    }\n    getModel() {\n        return this.parent.getQuery().getModel();\n    }\n    /**\n     * Loads expression from its JSON representation object.\n     * @param model The Data Model.\n     * @param data The JSON representation object.\n     */\n    loadFromData(model, data) {\n        if (data) {\n            this.tag = data.tag;\n            if (data.val) {\n                this._value = data.val;\n                this.text = data.txt;\n            }\n            else if (data.id) {\n                this.kind = DataKind.Attribute;\n                this._value = data.id;\n                this.text = data.txt;\n            }\n            if (typeof data.dtype !== 'undefined') {\n                this.dataType = data.dtype;\n            }\n            if (this.tag == ExprTag.EntityAttribute\n                || this.tag == ExprTag.ParentEntityAttribute) {\n                this.kind = DataKind.Attribute;\n                //We don't load other info for EntityAttr\n            }\n            else {\n                if (typeof data.kind !== 'undefined') {\n                    this.kind = data.kind;\n                }\n                if (data.query) {\n                    this.subQuery = this.parent.getQuery().createSubQuery();\n                    this.subQuery.loadFromDataOrJson(data.query);\n                }\n                if (typeof data.distinct !== 'undefined') {\n                    this.distinct = data.distinct;\n                }\n                if (data.func) {\n                    this.func = data.func;\n                    if (data.args) {\n                        for (let i = 0; i < data.args.length; i++) {\n                            const arg = new Expression(this.parent);\n                            arg.loadFromData(model, data.args[i]);\n                            this.args.push(arg);\n                        }\n                    }\n                }\n                if (data.sql) {\n                    this.sql = data.sql;\n                    this.baseAttrId = data.baseAttrId;\n                }\n            }\n        }\n    }\n    /**\n    * Saves expression from JSON representation object.\n    * @returns The JSON representation object.\n    */\n    saveToData() {\n        let obj = {\n            tag: this.tag\n        };\n        obj.dtype = this.dataType;\n        //Do not save other info for EntityAttr\n        if (this.tag == ExprTag.EntityAttribute || this.tag == ExprTag.ParentEntityAttribute) {\n            if (this._value) {\n                obj.id = this._value;\n                obj.val = this._value;\n            }\n            if (this.text) {\n                obj.txt = this.text;\n            }\n            //Do not save other info for EntityAttr\n        }\n        else {\n            if (this.subQuery) {\n                obj.query = this.subQuery.toJSONData();\n            }\n            if (typeof this.kind !== \"undefined\") {\n                obj.kind = this.kind;\n            }\n            if (this._value) {\n                obj.val = this._value;\n            }\n            if (this.text) {\n                obj.txt = this.text;\n            }\n            if (this.distinct) {\n                obj.distinct = this.distinct;\n            }\n            if (this.func) {\n                obj.func = this.func;\n                obj.args = [];\n                for (let i = 0; i < this.args.length; i++) {\n                    obj.args.push(this.args[i].saveToData());\n                }\n            }\n            if (this.sql) {\n                obj.sql = this.sql;\n                obj.baseAttrId = this.baseAttrId;\n            }\n        }\n        return obj;\n    }\n    getIndex() {\n        return this.parent.getExpressionIndex(this);\n    }\n    get value() {\n        return this._value;\n    }\n    setValue(val, silent = false) {\n        this.setContent(val, undefined, silent);\n    }\n    setContent(val, txt, silent = false) {\n        let oldValue = this.value;\n        if (this.kind == DataKind.Attribute && val) {\n            const attr = this.getModel().getAttributeById(val);\n            if (!attr) {\n                throw \"No such entity attribute:\" + val;\n            }\n            this.dataType = attr.dataType;\n        }\n        this._value = val;\n        if (typeof txt !== 'undefined') {\n            this.text = txt;\n        }\n        else if (typeof this.text !== 'undefined') {\n            this.text = val;\n        }\n        this._isDefaultValue = false;\n        if (!silent) {\n            this.parent.expressionChanged(this, oldValue);\n        }\n    }\n    isEmpty() {\n        return !(this.text || this._value);\n    }\n    hasText() {\n        return this.text && this.text.length > 0;\n    }\n    tryCopyValueFrom(expr) {\n        if (this.kind == expr.kind) {\n            if (this.dataType == expr.dataType) {\n                this.setContent(expr.value.length ? expr.value : this._value, (expr.text && expr.text.length) ? expr.text : this.text, true);\n            }\n            else {\n                const val = equtils.convertValue(expr.value, expr.dataType, this.dataType);\n                this.setContent(val.length ? val : this._value, (expr.text && expr.text.length) ? expr.text : this.text, true);\n            }\n            this.subQuery = expr.subQuery;\n            this.sql = expr.sql;\n            this.baseAttrId = expr.baseAttrId;\n        }\n        else if (!this._isDefaultValue) {\n            this.setContent('', '', true);\n            this.subQuery = null;\n            this.sql = null;\n            this.baseAttrId = null;\n        }\n    }\n}\n\nvar QueryChangePart;\n(function (QueryChangePart) {\n    QueryChangePart[QueryChangePart[\"Conditions\"] = 1] = \"Conditions\";\n    QueryChangePart[QueryChangePart[\"Columns\"] = 2] = \"Columns\";\n    QueryChangePart[QueryChangePart[\"SortingColumns\"] = 4] = \"SortingColumns\";\n    QueryChangePart[QueryChangePart[\"Properties\"] = 32] = \"Properties\";\n    QueryChangePart[QueryChangePart[\"ExtraData\"] = 64] = \"ExtraData\";\n    QueryChangePart[QueryChangePart[\"Facets\"] = 128] = \"Facets\";\n    QueryChangePart[QueryChangePart[\"Aggregation\"] = 256] = \"Aggregation\";\n    QueryChangePart[QueryChangePart[\"All\"] = 511] = \"All\";\n})(QueryChangePart || (QueryChangePart = {}));\nvar QueryChangeAction;\n(function (QueryChangeAction) {\n    QueryChangeAction[QueryChangeAction[\"Add\"] = 1] = \"Add\";\n    QueryChangeAction[QueryChangeAction[\"Modify\"] = 2] = \"Modify\";\n    QueryChangeAction[QueryChangeAction[\"Delete\"] = 4] = \"Delete\";\n    QueryChangeAction[QueryChangeAction[\"Activate\"] = 8] = \"Activate\";\n    QueryChangeAction[QueryChangeAction[\"All\"] = 127] = \"All\";\n})(QueryChangeAction || (QueryChangeAction = {}));\n\n/** Represents sorting direction. */\nvar SortDirection;\n(function (SortDirection) {\n    /** No sorting. */\n    SortDirection[SortDirection[\"None\"] = 0] = \"None\";\n    /** Ascending order. */\n    SortDirection[SortDirection[\"Ascending\"] = 1] = \"Ascending\";\n    /** Descending order. */\n    SortDirection[SortDirection[\"Descending\"] = 2] = \"Descending\";\n})(SortDirection || (SortDirection = {}));\n/**\n * Represents some column which will be queried\n */\nclass QueryColumn {\n    get id() {\n        return this._id;\n    }\n    /** Column sorting direction */\n    get sorting() {\n        if (this.query) {\n            return this.query.getColumnSorting(this);\n        }\n        else {\n            return this._sorting;\n        }\n    }\n    ;\n    set sorting(direction) {\n        if (this.query) {\n            this.query.setColumnSorting(this, direction);\n        }\n        else {\n            this._sorting = direction;\n        }\n    }\n    /** The index of the column in the sorting list. */\n    get sortIndex() {\n        if (this.query) {\n            return this.query.getColumnSortIndex(this);\n        }\n        else {\n            return this._sortIndex;\n        }\n    }\n    ;\n    set sortIndex(index) {\n        if (this.query) {\n            this.query.setColumnSortIndex(this, index);\n        }\n        else {\n            this._sortIndex = index;\n        }\n    }\n    ;\n    /** the default constructor. */\n    constructor(query, justsorted = false) {\n        this.query = query;\n        this.justsorted = justsorted;\n        /** Column is enabled */\n        this.enabled = true;\n        /** The parameters associated with this column */\n        this.params = [];\n        this._isHidden = false;\n        this.query = query;\n        this._id = utils.generateId('col');\n        this.caption = '';\n        this._sorting = SortDirection.None;\n        this._sortIndex = -1;\n        this.expr = new Expression(this);\n        this.blockId = '';\n        this.justsorted = justsorted;\n    }\n    getModel() {\n        return this.query.getModel();\n    }\n    getQuery() {\n        return this.query;\n    }\n    /** Indicates whether this column is read-only */\n    isReadOnly() {\n        return false;\n    }\n    /** Indicates whether this column is just-sorted */\n    isJustSorted() {\n        return this.justsorted;\n    }\n    setReadOnly(value) {\n        //do nothing. Read-only columns are not supported here\n    }\n    /** Indicates whether this column is invisible */\n    isHidden() {\n        return this._isHidden;\n    }\n    setHidden(value) {\n        this._isHidden = value;\n    }\n    getDataType() {\n        if (this.expr.dataType === DataType.Unknown) {\n            let attrId = null;\n            if (this.expr.func) {\n                if (this.expr.func == \"COUNT\" || this.expr.func == \"CNTDST\")\n                    return DataType.Int64;\n                attrId = this.expr.args[0].value;\n            }\n            else {\n                attrId = this.expr.value;\n            }\n            const attr = this.query.getModel()\n                .getAttributeById(attrId);\n            if (attr)\n                return attr.dataType;\n        }\n        return this.expr.dataType;\n    }\n    /**\n      * Loads column from its JSON representation object.\n      * @param model The Data Model.\n      * @param colData The JSON representation object.\n      */\n    loadFromData(model, colData) {\n        if (colData) {\n            if (colData.id) {\n                this._id = colData.id;\n            }\n            this.caption = colData.cptn;\n            if (typeof colData.srt !== 'undefined') {\n                this._sorting = colData.srt;\n                this._sortIndex = (typeof colData.srtidx !== 'undefined')\n                    ? colData.srtidx\n                    : -1;\n            }\n            if (colData.enabled === false) {\n                this.enabled = colData.enabled;\n            }\n            this.expr.loadFromData(model, colData.expr);\n            this.blockId = colData.blockId;\n            this.displayFormat = colData.dfmt;\n            this.groupFooterColumnTemlate = colData.gfct;\n            if (colData.hidden) {\n                this.setHidden(true);\n            }\n        }\n    }\n    /**\n     * Saves the column to a data transfer object (ready for sending to the server-side) .\n     * @returns An plain object that represents the column.\n     */\n    saveToData() {\n        let obj = {};\n        obj.id = this._id;\n        if (typeof this.caption !== 'undefined') {\n            obj.cptn = this.caption;\n        }\n        if (this.sorting != SortDirection.None) {\n            obj.srt = this.sorting;\n            obj.srtidx = this.sortIndex;\n        }\n        obj.expr = this.expr.saveToData();\n        if (this.blockId) {\n            obj.blockId = this.blockId;\n        }\n        if (this.enabled === false) {\n            obj.enabled = this.enabled;\n        }\n        obj.dfmt = this.displayFormat;\n        obj.gfct = this.groupFooterColumnTemlate;\n        if (this.isHidden()) {\n            obj.hidden = true;\n        }\n        return obj;\n    }\n    fireChangedEvent() {\n        this.query.fireChangedEvent({\n            part: (this.justsorted)\n                ? QueryChangePart.SortingColumns\n                : QueryChangePart.Columns,\n            action: QueryChangeAction.Modify,\n            changee: this\n        });\n    }\n    getExpressionIndex(expr) {\n        return 0;\n    }\n    expressionChanged(expr, oldValue) {\n    }\n}\n\n/**\n * Represents a type of condition.\n * Current we have 2 possible types: a simple condition or a predicate - a group of conditions\n*/\nvar CondTag;\n(function (CondTag) {\n    /** An unknown type of condition (just in case).*/\n    CondTag[CondTag[\"Unknown\"] = 0] = \"Unknown\";\n    /** A simple condition (e.g. SomeField > SomeValue).*/\n    CondTag[CondTag[\"Simple\"] = 1] = \"Simple\";\n    /** A predicate (a group of conditions).*/\n    CondTag[CondTag[\"Group\"] = 51] = \"Group\";\n})(CondTag || (CondTag = {}));\n\nvar ConditionPart;\n(function (ConditionPart) {\n    ConditionPart[ConditionPart[\"EntityAttr\"] = 2] = \"EntityAttr\";\n    ConditionPart[ConditionPart[\"Operator\"] = 4] = \"Operator\";\n    ConditionPart[ConditionPart[\"Value\"] = 8] = \"Value\";\n    ConditionPart[ConditionPart[\"All\"] = 14] = \"All\";\n})(ConditionPart || (ConditionPart = {}));\n\n/**\n * Represents some condition.\n */\nclass Condition {\n    get id() {\n        return this._id;\n    }\n    get enabled() {\n        return this._enabled && (!this.getParent() || this.getParent().enabled);\n    }\n    set enabled(value) {\n        this._enabled = value && (!this.getParent() || this.getParent().enabled);\n        this.conditions && this.conditions.forEach((cond) => {\n            cond.enabled = value;\n        });\n    }\n    /**\n     * The default constructor.\n     * @param tag The condition tag\n     */\n    constructor(query, tag) {\n        this.query = query;\n        /**\n         *  The linking type.\n         */\n        this.linkType = LinkType.All; //only for predicates\n        this.parent = null;\n        this._id = utils.generateId('cond');\n        this.justAdded = false;\n        this.tag = tag || CondTag.Unknown;\n        this.enabled = true;\n        this.operatorId = '';\n        this.blockId = '';\n        this.expressions = new Array();\n        this.conditions = new Array();\n    }\n    getQuery() {\n        return this.query;\n    }\n    getModel() {\n        return this.query.getModel();\n    }\n    getParent() {\n        return this.parent;\n    }\n    setParent(parent) {\n        this.parent = parent;\n    }\n    getConditions() {\n        return this.conditions;\n    }\n    isEmpty() {\n        return this.conditions.length === 0;\n    }\n    isGroup() {\n        return (this.tag == CondTag.Group) || (this.parent == null);\n    }\n    getLevel() {\n        const parent = this.getParent();\n        return parent ? parent.getLevel() + 1 : 0;\n    }\n    /**\n     * Indicates whether this condition is read-only.\n     */\n    isReadOnly() {\n        return false;\n    }\n    setReadOnly(value) {\n    }\n    /**\n     * The value indicating whether this condition is parameterized.\n     */\n    isParameterized() {\n        return false;\n    }\n    setParameterized(value) {\n    }\n    /**\n     * Indicates whether this condition must be placed into `JOIN` clause in result `SQL`.\n     */\n    isInJoin() {\n        return false;\n    }\n    setInJoin(value) {\n    }\n    clearConditions() {\n        this.conditions = [];\n    }\n    addCondition(cond) {\n        cond.setParent(this);\n        return this.conditions.push(cond);\n    }\n    removeConditionAt(index) {\n        this.conditions.splice(index, 1);\n    }\n    /**\n    * Loads condtion from its JSON representation object.\n    * @param model The Data Model.\n    * @param data The JSON representation object.\n    */\n    loadFromData(model, data) {\n        if (data) {\n            this.tag = data.tag;\n            if (!this.tag) {\n                this.tag = (!this.parent || this.conditions.length > 0) ? CondTag.Group : CondTag.Simple;\n            }\n            if (typeof data.enabled !== 'undefined') {\n                this.enabled = data.enabled;\n            }\n            if (typeof data.disabled !== 'undefined') {\n                this.enabled = !data.disabled;\n            }\n            if (this.tag == CondTag.Simple) {\n                this.operatorId = data.op;\n                if (data.exprs) {\n                    for (let i = 0; i < data.exprs.length; i++) {\n                        let newExpr = new Expression(this);\n                        newExpr.loadFromData(model, data.exprs[i]);\n                        this.expressions.push(newExpr);\n                    }\n                }\n            }\n            this.linkType = data.linking;\n        }\n    }\n    /**\n     * Saves condition to JSON representation object.\n     * @returns The JSON representation object.\n     */\n    saveToData() {\n        let obj = {};\n        obj.tag = this.tag;\n        if (!this.enabled) {\n            obj.enabled = this.enabled;\n        }\n        if (this.tag == CondTag.Simple) {\n            obj.op = this.operatorId;\n            obj.exprs = [];\n            for (let i = 0; i < this.expressions.length; i++) {\n                obj.exprs.push(this.expressions[i].saveToData());\n            }\n        }\n        if (this.tag == CondTag.Group) {\n            //if condition group\n            obj.linking = this.linkType;\n        }\n        return obj;\n    }\n    fireChangedEvent(condPart = ConditionPart.All) {\n        this.query.fireChangedEvent({\n            part: QueryChangePart.Conditions,\n            action: QueryChangeAction.Modify,\n            changee: this,\n            condPart: condPart\n        });\n    }\n    getExpressionIndex(expr) {\n        return this.expressions.indexOf(expr, 0);\n    }\n    expressionChanged(expr, oldValue) {\n        if (expr.getIndex() == 0 && expr.tag == ExprTag.EntityAttribute) {\n            //this is a base entity attribute, we need to re-pack the whole condition\n            this.tuneOperatorForAttr(expr.value);\n        }\n    }\n    getOperatorId() {\n        return this.operatorId;\n    }\n    setOperatorId(newOperatorId, silent = false) {\n        const oldOperatorId = this.operatorId;\n        this.operatorId = newOperatorId;\n        if (!silent) {\n            const model = this.getModel();\n            const operator = model.getOperatorById(newOperatorId);\n            const attrId = this.expressions[0].value;\n            const attr = model.getAttributeById(attrId);\n            this.tuneValueExpressions(attr, operator, attr.id, oldOperatorId);\n        }\n    }\n    tuneOperatorForAttr(oldAttrId) {\n        const model = this.getModel();\n        const attrId = this.expressions[0].value;\n        const attr = model.getAttributeById(attrId);\n        if (attr != null) {\n            let newOperator = this.getModel().getDefaultOperatorForAttr(attr);\n            let oldOperatorId = this.operatorId;\n            this.operatorId = newOperator.id;\n            this.tuneValueExpressions(attr, newOperator, oldAttrId, oldOperatorId);\n        }\n    }\n    tuneValueExpressions(attr, operator, oldAttrId, oldOperatorId) {\n        const model = this.getModel();\n        if (!operator)\n            return;\n        let exprCount = this.expressions.length;\n        oldAttrId ? model.getAttributeById(oldAttrId) : null;\n        let oldOperator = null;\n        if (oldOperatorId) {\n            oldOperator = model.getOperatorById(oldOperatorId);\n        }\n        if (oldOperator && oldOperator.paramCount == operator.paramCount) {\n            //add  necessary expressions\n            let i = 1;\n            while (i < operator.paramCount) {\n                let oldOperand = model.getOperand(attr, oldOperator, i);\n                let operand = model.getOperand(attr, operator, i);\n                if (operand.dataType == DataType.Unknown) {\n                    operand.dataType = attr.dataType;\n                }\n                const editor = operand.editor && operand.editor.tag !== EditorTag.Unknown\n                    ? operand.editor\n                    : (attr.defaultEditor && attr.defaultEditor.tag !== EditorTag.Unknown\n                        ? attr.defaultEditor\n                        : new EqValueEditor());\n                if (i >= exprCount) {\n                    var valExpr = this.createValueExpr(operand);\n                    this.expressions.push(valExpr);\n                }\n                else {\n                    var oldExpr = this.expressions[i];\n                    //create new value expression according to the corresponding operand\n                    var newExpr = this.createValueExpr(operand);\n                    if (this.areCompitableEditors(oldOperand.editor, editor)) {\n                        newExpr.tryCopyValueFrom(oldExpr);\n                    }\n                    this.expressions[i] = newExpr;\n                }\n                i++;\n            }\n            if (exprCount > i) {\n                //remove all redundant expressions\n                this.expressions.splice(i, exprCount - i);\n            }\n        }\n        else {\n            this.expressions.splice(1, this.expressions.length - 1);\n            for (let i = 1; i < operator.paramCount; i++) {\n                let operand = model.getOperand(attr, operator, i);\n                if (operand.dataType == DataType.Unknown) {\n                    operand.dataType = attr.dataType;\n                }\n                var valExpr = this.createValueExpr(operand);\n                this.expressions.push(valExpr);\n            }\n        }\n    }\n    areCompitableEditors(oldEditor, newEditor) {\n        if (newEditor.tag != oldEditor.tag)\n            return false;\n        if (newEditor.resType != oldEditor.resType)\n            return false;\n        return true;\n    }\n    addExpressionByOperand(operand, val = null) {\n        let expr = this.createValueExpr(operand, val);\n        this.expressions.push(expr);\n        return expr;\n    }\n    createValueExpr(operand, val = null) {\n        let valueNotDefined = val === null || typeof val === 'undefined';\n        let value = val ? val : operand.defValue;\n        let text = val ? val : operand.defText;\n        let result = new Expression(this);\n        if (operand.kind === DataKind.Query) {\n            result.tag = ExprTag.Query;\n            result.dataType = operand.dataType;\n            result.kind = operand.kind;\n            result.setContent(value, text, true);\n        }\n        else if (operand.kind === DataKind.Attribute) {\n            if (!valueNotDefined) {\n                let defAttr = this.getModel().getFirstAttributeByFilter((attr) => {\n                    return attr.useInConditions == true && (!operand.dataType || attr.dataType == operand.dataType);\n                });\n                value = defAttr ? defAttr.id : null;\n            }\n            result.tag = ExprTag.EntityAttribute;\n            result.kind = operand.kind;\n            result.dataType = operand.dataType;\n            result.setContent(value, text, true);\n        }\n        else {\n            if (valueNotDefined) {\n                if (operand.defValue && operand.defValue != \"\") {\n                    value = operand.defValue;\n                }\n                else {\n                    if (operand.editor && operand.editor.defValue) {\n                        value = operand.editor.defValue;\n                    }\n                    else {\n                        value = '';\n                    }\n                }\n                if (operand.editor) {\n                    text = operand.editor.getValueText(value);\n                }\n            }\n            result.tag = ExprTag.Constant;\n            result.dataType = operand.dataType;\n            result.kind = operand.kind;\n            result.setContent(value, text, true);\n            result._isDefaultValue = valueNotDefined;\n        }\n        return result;\n    }\n}\n\nclass Tree {\n    constructor(value = null) {\n        this.childs = [];\n        this.value = null;\n        this.parent = null;\n        if (value) {\n            if (Array.isArray(value)) {\n                this.value = value[0];\n                if (value.length > 1) {\n                    this.addChild(new Tree(value.slice(1)));\n                }\n            }\n            else if (value instanceof Tree) {\n                this.value = value.value;\n                this.childs = value.childs;\n            }\n            else {\n                this.value = value;\n            }\n        }\n    }\n    contains(value) {\n        if (this.value === value)\n            return true;\n        for (let child of this.childs) {\n            if (child.contains(value))\n                return true;\n        }\n        return false;\n    }\n    findNode(value) {\n        if (this.value === value)\n            return this;\n        for (let child of this.childs) {\n            let result = child.findNode(value);\n            if (result)\n                return result;\n        }\n        return null;\n    }\n    addChild(child) {\n        child.parent = this;\n        this.childs.push(child);\n    }\n    setParents() {\n        for (let child of this.childs) {\n            child.parent = this;\n            child.setParents();\n        }\n    }\n}\n\n/**\n * The error that appears when the query is not valid\n */\nclass InvalidQueryError extends Error {\n    /**\n     * Creates an instance of error type.\n     * @param message The error message\n     */\n    constructor(message) {\n        super(message);\n        if (typeof Error[\"captureStackTrace\"] === \"function\") {\n            Error[\"captureStackTrace\"].apply(this, [InvalidQueryError]);\n        }\n        this.name = 'InvalidQueryError';\n    }\n}\n/**\n * Represents Query.\n */\nclass Query {\n    isModified() {\n        return this._isModified;\n    }\n    resetModified() {\n        this._isModified = false;\n    }\n    get enableAggregation() {\n        return this._enableAggregation;\n    }\n    set enableAggregation(value) {\n        const oldValue = this._enableAggregation;\n        this._enableAggregation = value;\n        if (!oldValue && value) {\n            this.processQueryForAggregation();\n            this.columns.filter(c => c.enabled\n                && c.expr.tag == ExprTag.AggregateFunction);\n        }\n        if (!this._enableAggregation) {\n            this.aggrSettings.clear();\n        }\n    }\n    /**\n     * The default constructor.\n     * @param model The data model.\n     * @param data JSON representation object.\n     * @param options The options.\n     * @throws {InvalidQueryError} The error throws when query is not valid.\n     */\n    constructor(model, data, options) {\n        /**\n         * Contains user-defined extra data for current query.\n         */\n        this.extraData = {};\n        this.innerData = {};\n        this.isNewbie = true;\n        this._isModified = false;\n        this._enableAggregation = false;\n        this.parentQuery = null;\n        this.drillDowns = [];\n        this.syncSortOrderWithColumnsOrder = true;\n        if (options) {\n            this.context = options.context;\n            if (this.context) {\n                this.syncSortOrderWithColumnsOrder = this.context.options.syncSortOrderWithColumnsOrder;\n            }\n        }\n        this.eventEmitter = new EventEmitter(this);\n        this.root = new Condition(this, CondTag.Group);\n        this.extraConditions = new Condition(this, CondTag.Group);\n        this.columns = new Array();\n        //this.justsorted = new Array<QueryColumn>();\n        this.sortedColumns = new Array();\n        if (!this.id) {\n            this.regenerateId();\n        }\n        this.setDefaultName();\n        this.description = '';\n        this.model = (model) ? model : new DataModel();\n        if (data) {\n            this.loadFromData(data);\n        }\n        this.attributeExprTag = (options) ? options.attrTag || ExprTag.EntityAttribute : ExprTag.EntityAttribute;\n        this.clientListRequestHandler = (options) ? options.clientListRequestHandler : new Array();\n        this.serverListRequestHandler = (options) ? options.serverListRequestHandler : new Array();\n        this.timezoneOffset = (new Date()).getTimezoneOffset();\n        this.aggrSettings = new AggregationSettings(this);\n        if (options) {\n            this.parentQuery = options.parent;\n        }\n        this.addChangedCallback(ev => {\n            if (ev.data\n                && ((ev.data.part & QueryChangePart.Columns) > 0)\n                && !ev.data.aggregation) {\n                if (this._enableAggregation && this.updateAggregationSettings()) {\n                    this.fireChangedEvent({\n                        part: QueryChangePart.Aggregation\n                    });\n                }\n            }\n        });\n    }\n    updateAggregationSettings() {\n        let hasChanged = false;\n        const aggrSettings = this.getAggregationSettings();\n        for (let i = aggrSettings.groups.length - 1; i >= 0; i--) {\n            const group = aggrSettings.groups[i];\n            for (let j = group.columns.length - 1; j >= 0; j--) {\n                const colId = group.columns[j];\n                if (!this.columns.find(col => col.id === colId)) {\n                    group.columns.splice(j, 1);\n                    hasChanged = true;\n                }\n            }\n            if (group.columns.length == 0) {\n                aggrSettings.groups.splice(i, 1);\n            }\n        }\n        const aggregates = aggrSettings.getAggregates();\n        for (let i = aggregates.length - 1; i >= 0; i--) {\n            const aggr = aggregates[i];\n            if (!this.columns.find(col => col.id === aggr.colId)) {\n                aggregates.splice(i, 1);\n                hasChanged = true;\n            }\n        }\n        // const isValidAggration = (aggrSettings.hasGroups() && (aggrSettings.hasAggregates() || aggrSettings.hasRecordCount())) \n        //                          || (aggrSettings.hasAggregates && aggrSettings.hasGrandTotals());\n        // if (!isValidAggration) {\n        //     this.enableAggregation = false;\n        // }\n        return hasChanged;\n    }\n    createSubQuery() {\n        return new Query(this.model, null, { parent: this, context: this.context });\n    }\n    useAggregation(settingsTuner, silent = false) {\n        this.aggrSettings.clear();\n        settingsTuner(this.aggrSettings);\n        if (this.enableAggregation) {\n            this.processQueryForAggregation(silent);\n        }\n        else if (!silent) {\n            console.warn('Aggregation is turned off. Turn it on with query.enableAggregation = true');\n            return;\n        }\n    }\n    useDefaultAggregation() {\n        this._enableAggregation = true;\n        this.useAggregation((settings) => {\n            const aggrCols = this.columns.filter(c => c.enabled\n                && c.expr.tag == ExprTag.AggregateFunction);\n            if (aggrCols.length) {\n                // query contains aggregate columns\n                const colsToGroup = this.columns.filter(c => c.enabled\n                    && c.expr.tag == ExprTag.EntityAttribute);\n                const aggrsToAdd = [];\n                for (const col of aggrCols) {\n                    aggrsToAdd.push({ id: col.id, func: col.expr.func });\n                    this.changeColumnType(col, ExprTag.EntityAttribute);\n                }\n                for (const aggr of aggrsToAdd) {\n                    settings.addAggregateColumn(aggr.id, aggr.func);\n                }\n                for (const col of colsToGroup) {\n                    settings.addGroup({ columns: [col.id], name: col.caption });\n                }\n                settings.addGrandTotals();\n                this.fireChangedEvent({\n                    part: QueryChangePart.Columns,\n                    wasModified: false\n                });\n            }\n            else {\n                // query does not has any aggr columns\n                const colToAggr = this.getColumns()\n                    .filter(c => c.enabled && c.expr.tag == ExprTag.EntityAttribute\n                    && this.model.getAttributeById(c.expr.value).dataType === DataType.Currency)[0];\n                const colToGroup = this.getColumns()\n                    .filter(c => c.enabled && c.expr.tag == ExprTag.EntityAttribute\n                    && this.model.getAttributeById(c.expr.value).dataType === DataType.String)[0];\n                if ((!colToAggr && !settings.hasAggregates()) || !colToGroup)\n                    return;\n                settings.addGrandTotals()\n                    .addAggregateColumn(colToAggr.id, 'SUM')\n                    .addGroup({ columns: [colToGroup.id], name: 'Default' });\n            }\n        });\n    }\n    processQueryForAggregation(silent = false) {\n        const aggrSettings = this.getAggregationSettings();\n        const groups = aggrSettings.getGroups();\n        if (groups.length > 0) {\n            const groupColIds = groups[groups.length - 1].columns;\n            //take the list of grouped columns from the latest group\n            let groupedCols = [];\n            let sortedCols = [];\n            for (const col of this.getColumns()) {\n                if (groupColIds.indexOf(col.id) >= 0) {\n                    groupedCols.push(col);\n                }\n                else if (this.getColumnSorting(col) != SortDirection.None) {\n                    sortedCols.push(col);\n                }\n            }\n            let sortIndex = 0;\n            groupedCols.forEach(col => {\n                if (this.getColumnSorting(col) == SortDirection.None) {\n                    this.setColumnSorting(col, SortDirection.Ascending);\n                }\n                this.setColumnSortIndex(col, sortIndex++);\n                //col.sortIndex = sortIndex++;\n            });\n            sortedCols.forEach(col => {\n                this.setColumnSortIndex(col, sortIndex++);\n                //     col.sortIndex = sortIndex++;\n            });\n            if (!silent) {\n                this.fireChangedEvent({\n                    part: QueryChangePart.Columns,\n                    aggregation: true,\n                    wasModified: false\n                });\n            }\n        }\n    }\n    getAggregationSettings() {\n        return this.aggrSettings;\n    }\n    getColumnIds(from, to) {\n        to = to || from;\n        return this.columns.slice(from, to - from + 1)\n            .map(c => c.id);\n    }\n    /**\n     * Checks if the columns with IDs passed in function's parameter exist and are valid\n     */\n    validateColumns(colIds) {\n        const enabledColIds = this.columns.filter(c => c.enabled).map(c => c.id);\n        let prevIndex = -1;\n        for (const col of colIds) {\n            const index = enabledColIds.indexOf(col);\n            if (index < 0)\n                return false;\n            if (prevIndex > index)\n                return false;\n            prevIndex = index;\n        }\n        return true;\n    }\n    validateAggregate(colId, funcId) {\n        const col = this.columns.filter(c => c.enabled && c.id === colId)[0];\n        const func = this.model.findAggrFunctionById(funcId);\n        if (!func || !col || func.appliedTypes.indexOf(col.expr.dataType) < 0)\n            return false;\n        return true;\n    }\n    isEx() {\n        return false;\n    }\n    /**\n     * Resets the query: clears all its conditions and columns, regenerate the ID and sets the default name.\n     * @param clearQuery Indicates whether we need to clear the content of the query on reset (default: true)\n     */\n    reset(clearQuery = true) {\n        if (clearQuery) {\n            this.clear();\n        }\n        this.regenerateId();\n        this.setDefaultName();\n        this._isModified = false;\n        this.isNewbie = true;\n    }\n    hasEnabledAggrColumns() {\n        return this.columns.filter(col => col.enabled\n            && col.expr.tag === ExprTag.AggregateFunction).length > 0;\n    }\n    setDefaultName() {\n        this.setName(i18n.getText('NewQueryName'));\n        return this.getName();\n    }\n    /**\n     * Validates wether the query corresponds to the model.\n     * @param options Validate options.\n     * @throws {InvalidQueryError} If query is not valid.\n     */\n    validate(options) {\n        options = options || {};\n        const entityAttrNotExistError = \"EntityAttribute isn't declared in the model: \";\n        const wrongExprTag = \"The expression has wrond tag: \";\n        if (!this.model) {\n            throw new InvalidQueryError(\"Model is not declared\");\n        }\n        if (this.columns) {\n            for (let column of this.columns) {\n                if (column.expr.tag == ExprTag.EntityAttribute\n                    || column.expr.tag === ExprTag.ParentEntityAttribute) {\n                    const attr = this.model.getAttributeById(column.expr.value);\n                    if (!attr) {\n                        throw new InvalidQueryError(entityAttrNotExistError + column.expr.value);\n                    }\n                }\n                else if (column.expr.tag === ExprTag.AggregateFunction) {\n                    const attr = this.model.getAttributeById(column.expr.args[0].value);\n                    if (!attr) {\n                        throw new InvalidQueryError(entityAttrNotExistError + column.expr.args[0].value);\n                    }\n                }\n                else if (column.expr.tag === ExprTag.Unknown) {\n                    throw new InvalidQueryError(wrongExprTag + column.expr.tag);\n                }\n            }\n        }\n        if (this.root && this.root.getConditions()) {\n            this.validateConditionGroup(this.root, options);\n        }\n    }\n    getAggregatedColumns() {\n        return this.getColumns().filter(col => col.enabled\n            && col.expr.tag === ExprTag.AggregateFunction);\n    }\n    /**\n     * Validates wether the query corresponds to the model.\n     * @param options Validate options.\n     * @returns `true` if it is valid, otherwise `false`\n     */\n    tryValidate(options) {\n        try {\n            this.validate(options);\n            return true;\n        }\n        catch (e) {\n            if (e instanceof InvalidQueryError) {\n                return false;\n            }\n            else {\n                throw e;\n            }\n        }\n    }\n    validateConditionGroup(curCond, options) {\n        if (curCond.isGroup()) {\n            for (let condition of curCond.getConditions()) {\n                if (!condition.enabled)\n                    continue;\n                this.validateConditionGroup(condition, options);\n            }\n        }\n        else if (curCond.expressions[0].tag === ExprTag.EntityAttribute) {\n            const attrId = curCond.expressions[0].value;\n            const attr = this.model.getAttributeById(attrId);\n            if (!attr) {\n                throw new InvalidQueryError(\"EntityAttribute isn't declared in the model: \" + attrId);\n            }\n            if (!options.checkExpressions)\n                return;\n            for (let i = 1; i < curCond.expressions.length; i++) {\n                const expr = curCond.expressions[i];\n                if (expr.tag !== ExprTag.Constant)\n                    continue;\n                //validate number exprs\n                if (utils.isNumericType(expr.dataType)) {\n                    if (!expr.value)\n                        continue;\n                    let values = [];\n                    if (expr.kind === DataKind.List) {\n                        values = expr.value.split(/\\s*,\\s*/);\n                    }\n                    else {\n                        values = [expr.value];\n                    }\n                    for (let value of values) {\n                        const parsedVal = +value;\n                        if (isNaN(parsedVal)) {\n                            throw new InvalidQueryError(\"Expression constant is NaN in condition:\" + curCond.id);\n                        }\n                        if (utils.isIntType(expr.dataType) && parsedVal != parseInt(value, 10)) {\n                            throw new InvalidQueryError(\"Expression constant is wrong interger in condition: \" + curCond.id);\n                        }\n                    }\n                }\n            }\n        }\n    }\n    /**\n     * Sets data to the query.\n     * @param data A plain JS object that represents the query or a JSON string\n     * @param options An instance of LoadQueryFromDataOptions interface that can contain different loading options\n     */\n    loadFromDataOrJson(data, options) {\n        if (data) {\n            if (typeof data === \"string\") {\n                this.loadFromJson(data, options);\n            }\n            else {\n                this.loadFromData(data, options);\n            }\n        }\n    }\n    /**\n     * Loads query from JSON.\n     * @param json The JSON string.\n     * @param options The options.\n     * @throws {InvalidQueryError} The error throws when query is not valid.\n     */\n    loadFromJson(json, options) {\n        let data = JSON.parse(json);\n        this.loadFromData(data, options);\n    }\n    /**\n     * Loads query from data representation.\n     * @param data The query DTO.\n     * @param options The options.\n     * @throws {InvalidQueryError} The error throws when query is not valid.\n     */\n    loadFromData(data, options) {\n        options = utils.assign({\n            changeStatus: true,\n            validate: true\n        }, options || {});\n        let noErrors = false;\n        this.clear();\n        this.clearDrillDowns();\n        if (data) {\n            this.id = data.id;\n            this.root.loadFromData(this.model, data.root);\n            if (data.root && data.root.conds) {\n                for (let i = 0; i < data.root.conds.length; i++) {\n                    const condData = data.root.conds[i];\n                    if (condData.conds && !this.isEx()) {\n                        console.error(\"Community version doesn't support working with groups.\");\n                        continue;\n                    }\n                    const cond = this.createCondition();\n                    cond.loadFromData(this.model, condData);\n                    this.root.addCondition(cond);\n                }\n            }\n            this.name = data.name;\n            if (data.desc) {\n                this.description = data.desc;\n            }\n            this.sortedColumns = [];\n            if (data.justsortcols) {\n                for (let i = 0; i < data.justsortcols.length; i++) {\n                    let newCol = this.createColumn(true);\n                    newCol.loadFromData(this.model, data.justsortcols[i]);\n                    //this.justsorted.push(newCol);\n                    this.addColumnToSorted(newCol);\n                }\n            }\n            if (data.cols) {\n                for (let i = 0; i < data.cols.length; i++) {\n                    let newCol = this.createColumn();\n                    newCol.loadFromData(this.model, data.cols[i]);\n                    this.columns.push(newCol);\n                    if (newCol._sorting != SortDirection.None) {\n                        this.addColumnToSorted(newCol);\n                    }\n                }\n            }\n            this.sortedColumns.sort((col1, col2) => {\n                return col1._sortIndex - col2._sortIndex;\n            });\n            this.fixupSortingIndices();\n            if (data.extraData) {\n                this.extraData = data.extraData;\n            }\n            this.innerData = data.innerData || this.innerData;\n            if (this.innerData && this.innerData.aggr) {\n                this._enableAggregation = this.innerData.aggr.enabled || false;\n                this.useAggregation(settings => {\n                    settings.loadFromData(this.innerData.aggr);\n                }, true);\n            }\n            if (data.dds && data.dds.length) {\n                for (let dd of data.dds) {\n                    const query = this.addDrillDown();\n                    query.loadFromData(dd);\n                }\n            }\n        }\n        if (this._enableAggregation) {\n            this.updateAggregationSettings();\n        }\n        noErrors = true;\n        if (noErrors) {\n            if (options.changeStatus) {\n                this.isNewbie = false;\n                this._isModified = false;\n            }\n        }\n        if (options.validate) {\n            this.validate();\n        }\n    }\n    /**\n     *\n     */\n    addDrillDown() {\n        const query = this.context.createQuery();\n        query.parentQuery = this;\n        this.drillDowns.push(query);\n        return query;\n    }\n    getDrillDowns() {\n        return this.drillDowns;\n    }\n    getParentQuery() {\n        return this.parentQuery;\n    }\n    /**\n     *\n     */\n    findColumnById(colId) {\n        for (let col of this.columns) {\n            if (col.id === colId)\n                return col;\n        }\n        return null;\n    }\n    /**\n     * Gets DataModel object associated with this query.\n     * @retruns The data model.\n     */\n    getModel() {\n        return this.model;\n    }\n    /**\n     * Sets DataModel object associated with this query.\n     * @param model The data model.\n     */\n    setModel(model) {\n        this.model = model;\n    }\n    /**\n     * Loads data model.\n     * @param model JSON representation object or JSON string.\n     */\n    loadModelData(model) {\n        this.model.setData(model);\n    }\n    /**\n     * Returns JSON representation of this query.\n     * @retruns JSON string.\n     */\n    toJSON() {\n        return JSON.stringify(this.toJSONData());\n    }\n    /**\n     * Returns JSON representation of this query.\n     * @retruns JSON representation object.\n     */\n    toJSONData() {\n        this.fixupSortingIndices();\n        let obj = {\n            modelId: this.model ? this.model.getId() : null,\n            modelName: this.model ? this.model.getName() : null\n        };\n        obj.id = this.id;\n        obj.name = this.name;\n        if (this.description) {\n            obj.desc = this.description;\n        }\n        obj.cols = [];\n        for (let i = 0; i < this.columns.length; i++) {\n            obj.cols.push(this.columns[i].saveToData());\n        }\n        obj.justsortcols = [];\n        // for (let i = 0; i < this.justsorted.length; i++) {\n        //     obj.justsortcols.push(this.justsorted[i].saveToData());\n        // }\n        this.sortedColumns.forEach(col => {\n            if (col.isJustSorted()) {\n                obj.justsortcols.push(col.saveToData());\n            }\n        });\n        if (this.extraData) {\n            obj.extraData = this.extraData;\n        }\n        if (this.innerData) {\n            obj.innerData = this.innerData;\n            obj.innerData.aggr = this.aggrSettings.saveToData();\n            obj.innerData.aggr.enabled = this._enableAggregation;\n        }\n        const rootCondToData = (condGroup) => {\n            const result = condGroup.saveToData();\n            result.conds = [];\n            const conditions = condGroup.getConditions();\n            for (let i = 0; i < conditions.length; i++) {\n                if (conditions[i].isGroup() && !this.isEx()) {\n                    console.error(\"Community version doesn't support working with groups.\");\n                    continue;\n                }\n                result.conds.push(conditions[i].saveToData());\n            }\n            return result;\n        };\n        obj.root = rootCondToData(this.root);\n        obj.extraConds = rootCondToData(this.extraConditions);\n        if (this.drillDowns.length > 0) {\n            obj.dds = [];\n            for (let dd of this.drillDowns) {\n                obj.dds.push(dd.toJSONData());\n            }\n        }\n        obj.timezoneOffset = this.timezoneOffset;\n        obj.locale = i18n.getCurrentLocale();\n        return obj;\n    }\n    /**\n     * Checks wether query does not contains any condtion.\n     * @retruns `true` if query does not contain any condition, otherwise `false`.\n     */\n    isEmptyConditions() {\n        return this.root.isEmpty();\n    }\n    /**\n     * Checks wether query does not contains any column.\n     * @retruns `true` if query does not contain any column, otherwise `false`.\n     */\n    isEmptyColumns() {\n        return !this.columns || this.columns.length === 0;\n    }\n    /**\n     * Checks wether query does not contains any column and any condition.\n     * @retruns `true` if query does not contain any column and any condition, otherwise `false`.\n     */\n    isEmpty() {\n        return this.isEmptyColumns() && this.isEmptyConditions();\n    }\n    /**\n     * Clears the query (all conditions, columns, extraData, etc).\n     */\n    clear() {\n        this._enableAggregation = false;\n        this.aggrSettings.clear();\n        this.clearColumns();\n        this.clearConditions();\n        this.clearExtraConditions();\n        this.innerData = {};\n        this.extraData = {};\n    }\n    /**\n     * Clears all columns in query\n     */\n    clearColumns() {\n        this.columns = [];\n        //this.justsorted = [];\n        this.sortedColumns = [];\n    }\n    /**\n     * Clears all conditions in query.\n     */\n    clearConditions() {\n        this.root.clearConditions();\n        this.root.linkType = LinkType.All;\n        this.root.enabled = true;\n    }\n    /**\n     * Clears all extra conditions in query\n     */\n    clearExtraConditions() {\n        this.extraConditions.clearConditions();\n    }\n    /**\n     * Clears all drill downs\n     */\n    clearDrillDowns() {\n        this.drillDowns = [];\n    }\n    /**\n     * Gets query ID.\n     * @returns The ID>\n     */\n    getId() {\n        return this.id;\n    }\n    /**\n     * Sets query ID.\n     * @param id New Query ID.\n     */\n    setId(id) {\n        this.id = id;\n    }\n    /**\n     * Regenerates the query ID.\n     */\n    regenerateId() {\n        this.id = utils.generateId(\"quer\");\n    }\n    /**\n     * Gets name of the query.\n     * @retruns The name.\n     */\n    getName() {\n        return this.name;\n    }\n    /**\n     * Sets name of the query\n     * @param name New name.\n     */\n    setName(name) {\n        this.name = this.validateName(name);\n    }\n    validateName(name) {\n        let validName = name || 'query';\n        //remove invalid characters\n        return validName.replace(/[\"'<>\\\\]/g, '').trim();\n    }\n    /**\n     * Gets description of the query.\n     * @retruns The description.\n     */\n    getDescription() {\n        return this.description ? this.description : '';\n    }\n    /**\n     * Sets description of the query\n     * @param description New description.\n     */\n    setDescription(description) {\n        this.description = description;\n    }\n    /**\n     * Get array of columns.\n     * @retruns Columns.\n     */\n    getColumns() {\n        return this.columns;\n    }\n    /**\n     * Gets array of columns that are used as keys\n     * for totals.\n     */\n    getUsedInTotalsColumns() {\n        const aggrs = this.getAggregatedColumns();\n        if (aggrs.length === 0)\n            return [];\n        const cols = this.getColumns()\n            .filter(col => col.enabled && col.expr.tag === ExprTag.EntityAttribute);\n        if (cols.length)\n            cols.pop();\n        return cols;\n    }\n    addColumnToSorted(col) {\n        const colJson = JSON.stringify(col.expr.saveToData());\n        let isUnique = true;\n        this.sortedColumns.forEach(scol => {\n            const qcolJson = JSON.stringify(scol.expr.saveToData());\n            if (qcolJson === colJson) {\n                isUnique = false;\n            }\n        });\n        if (isUnique) {\n            this.sortedColumns.push(col);\n        }\n    }\n    /**\n     * Get array of columns used only in sorting.\n     * @retruns Columns.\n     */\n    getJustSortedColumns() {\n        return this.sortedColumns.filter(col => {\n            return col.isJustSorted();\n        });\n    }\n    /**\n     * Gets array of columns used in sorting\n     * @retruns Columns\n     */\n    getSortedColumns() {\n        return this.sortedColumns;\n    }\n    /**\n     * Gets Colummn sorting index.\n     * @param col The column.\n     * @retruns The index.\n     */\n    getColumnSortIndex(col) {\n        return this.sortedColumns.indexOf(col);\n    }\n    setColumnSortIndex(col, index) {\n        if (index < 0)\n            return;\n        let colIdx = this.getColumnSortIndex(col);\n        if (colIdx < 0) {\n            this.addColumnToSorted(col);\n            colIdx = this.sortedColumns.length - 1;\n        }\n        utils.moveArrayItem(this.sortedColumns, colIdx, index);\n        this.fixupSortingIndices();\n    }\n    getColumnSorting(col) {\n        const idx = this.getColumnSortIndex(col);\n        if (idx >= 0) {\n            return col._sorting != SortDirection.None ? col._sorting : SortDirection.Ascending;\n        }\n        else {\n            return SortDirection.None;\n        }\n    }\n    setColumnSorting(col, direction) {\n        const idx = this.getColumnSortIndex(col);\n        col._sorting = direction;\n        if (idx >= 0) {\n            if (direction == SortDirection.None) {\n                utils.removeArrayItem(this.sortedColumns, col);\n                this.fixupSortingIndices();\n            }\n        }\n        else {\n            if (direction != SortDirection.None) {\n                this.addColumnToSorted(col);\n                this.fixupSortingIndices();\n            }\n        }\n        this.adjustColumnsSorting();\n    }\n    fixupSortingIndices() {\n        this.sortedColumns.forEach((col, index) => {\n            col._sortIndex = index;\n        });\n    }\n    adjustColumnsSorting() {\n        if (!this.syncSortOrderWithColumnsOrder) {\n            return;\n        }\n        if (this.getJustSortedColumns().length > 0) {\n            return;\n        }\n        let idx = 0;\n        this.columns.forEach(col => {\n            if (col.sorting != SortDirection.None) {\n                const colIdx = this.getColumnSortIndex(col);\n                if (colIdx >= 0) {\n                    utils.moveArrayItem(this.sortedColumns, colIdx, idx);\n                    idx++;\n                }\n            }\n        });\n        this.fixupSortingIndices();\n    }\n    createColumn(justsorted = false) {\n        return new QueryColumn(this, justsorted);\n    }\n    getColumnById(id) {\n        return utils.findItemById(this.columns, id);\n    }\n    /**\n     * Adds a new column with specified parameters\n     * @param descriptor The descriptor of the new column. Can contain different parameters like:\n     * `attribute` - a reference to a EntityAttr object,\n     * `attributeId` - an ID of the entity attribute we need (if we don't indicate `attribute`),\n     * `index`, sorting`, 'sortIndex` and other\n     *\n     * @param silent Indicates if we should raise a queryChanged event. If true - the operation will be performed silently, so no event is raised.\n     * @retruns The column.\n     * @example\n     * query.addColumn({\n     *     attributeId: 'Customers.CompanyName',\n     *     sortIndex: SortDirection.Ascending\n     * }});\n     */\n    addColumn(descriptor, silent = false) {\n        let newColumn;\n        const justsorted = descriptor.justsorted || (descriptor.column && descriptor.column.isJustSorted());\n        if (descriptor.column) {\n            newColumn = descriptor.column;\n        }\n        else {\n            newColumn = this.createColumn(descriptor.justsorted);\n            let attr;\n            if (descriptor.attribute) {\n                attr = descriptor.attribute;\n            }\n            else if (descriptor.attributeId) {\n                attr = this.model.getAttributeById(descriptor.attributeId);\n                if (!attr) {\n                    throw new Error(`Incorrect attribute id (${descriptor.attributeId}): addColumn`);\n                }\n            }\n            else if (typeof descriptor.constValue === 'undefined' && !descriptor.customSql) {\n                throw new Error('Not enought data for addColumn operation. One of the following options must be defined: attribute, attributeId, constValue or customSlq');\n            }\n            if (attr) {\n                let checkedOption = justsorted ? attr.useInSorting : attr.useInResult;\n                if (!checkedOption) {\n                    if (attr.lookupAttr) {\n                        attr = this.model.getAttributeById(attr.lookupAttr);\n                        checkedOption = justsorted ? attr.useInSorting : attr.useInResult;\n                    }\n                    if (!checkedOption) {\n                        throw new Error(`Can't use this attribute for a column`);\n                    }\n                }\n            }\n            if (descriptor.aggrFuncId && descriptor.customSql) {\n                console.warn(\"Column cannot be created using aggrFuncId and customSql at the same time. \" +\n                    \"cusomSql will be used.\");\n            }\n            if (typeof descriptor.constValue !== 'undefined') {\n                newColumn.expr.tag = ExprTag.Constant;\n                newColumn.expr.setValue(descriptor.constValue);\n                newColumn.expr.kind = DataKind.Scalar;\n                newColumn.expr.dataType = descriptor.constType || DataType.String;\n            }\n            else if (descriptor.customSql) {\n                newColumn.caption = 'Custom SQL Column';\n                newColumn.expr.tag = ExprTag.CustomSql;\n                newColumn.expr.sql = descriptor.customSql;\n                newColumn.expr.kind = DataKind.Query;\n                newColumn.expr.dataType = DataType.Unknown;\n                newColumn.expr.baseAttrId = descriptor.attributeId;\n                if (!this.context.options.allowCustomExpressions) {\n                    newColumn.enabled = false;\n                }\n            }\n            else if (descriptor.aggrFuncId) {\n                const funcId = descriptor.aggrFuncId;\n                newColumn.expr.tag = ExprTag.AggregateFunction;\n                newColumn.expr.func = descriptor.aggrFuncId;\n                newColumn.expr.kind = DataKind.Scalar;\n                newColumn.expr.dataType = funcId == 'COUNT' || funcId == 'CNTDST' ? 4 : attr.dataType;\n                newColumn.expr.distinct = false;\n                const arg = new Expression(newColumn);\n                arg.setValue(attr.id, true);\n                arg.tag = ExprTag.EntityAttribute;\n                arg.kind = DataKind.Attribute;\n                arg.dataType = attr.dataType;\n                newColumn.expr.args.push(arg);\n            }\n            else {\n                newColumn.expr.setValue(attr.id, true);\n                newColumn.expr.tag = ExprTag.EntityAttribute;\n                newColumn.expr.kind = DataKind.Attribute;\n                newColumn.expr.dataType = attr.dataType;\n                newColumn.params.concat(attr.params);\n            }\n            newColumn.caption = descriptor.caption || this.context.getDefaultColumnCaption(newColumn);\n            newColumn._sorting = descriptor.sorting || SortDirection.None;\n            newColumn._sortIndex = descriptor.sortIndex || -1;\n            newColumn.enabled = utils.getIfDefined(descriptor.enabled, true);\n            newColumn.setReadOnly(utils.getIfDefined(descriptor.readonly, false));\n        }\n        if (!justsorted) {\n            if (descriptor.index && descriptor.index >= 0 && descriptor.index < this.columns.length) {\n                this.columns.splice(descriptor.index, 0, newColumn);\n            }\n            else {\n                this.columns.push(newColumn);\n            }\n        }\n        this.setColumnSorting(newColumn, newColumn._sorting);\n        if (!silent) {\n            this.fireColumnsChangedEvent(QueryChangeAction.Add, newColumn, justsorted);\n        }\n        return newColumn;\n    }\n    /**\n     * Adds a new column with specified index.\n     * @param column The column or array of columns\n     * @param index The index of new column\n     * @param author The author.\n     * @example\n     * const column = new Column();\n     * column.caption = \"Company name\";\n     *\n     * query.addColumnObj(column, 1)\n     */\n    addColumnObj(column, index, author) {\n        let columns = this.columns;\n        if (typeof column.length == \"undefined\") {\n            if (typeof index == \"number\") {\n                columns.splice(index, 0, column);\n            }\n            else {\n                columns.push(column);\n            }\n            if (column.sorting != SortDirection.None) {\n                this.addColumnToSorted(column);\n            }\n            this.fixupSortingIndices();\n        }\n        else {\n            if (typeof index == \"number\") {\n                columns.push.apply(columns, [index, 0].concat(column));\n            }\n            else {\n                columns.push.apply(columns, [].concat(column));\n            }\n            column.forEach(col => {\n                if (col.sorting != SortDirection.None) {\n                    this.addColumnToSorted(col);\n                }\n            });\n            this.fixupSortingIndices();\n        }\n    }\n    /**\n     * Changes column to Aggregate function, custom expression or simple column.\n     * @param column The column to change.\n     * @param tag New column expression tag.\n     * @param args The arguments (Contains aggregate function id)\n     */\n    changeColumnType(column, tag, args) {\n        if (column.isJustSorted())\n            return;\n        args = args || {};\n        if (tag === ExprTag.AggregateFunction) {\n            if (!args.funcId)\n                throw Error('\"funcId\" argument is not defined');\n            if (column.expr.tag == ExprTag.AggregateFunction) {\n                column.expr.func = args.funcId;\n                return;\n            }\n            const expr = new Expression(column);\n            expr.tag = ExprTag.AggregateFunction;\n            expr.func = args.funcId;\n            expr.distinct = false;\n            expr.dataType = args.funcId == 'COUNT' || args.funcId == 'CNTDST' ? 4 : column.expr.dataType;\n            const arg = new Expression(column);\n            arg.loadFromData(this.model, column.expr.saveToData());\n            expr.args.push(arg);\n            column.expr = expr;\n        }\n        else if (tag === ExprTag.CustomSql) {\n            const attrId = (column.expr.tag == ExprTag.AggregateFunction)\n                ? column.expr.args[0].value\n                : column.expr.value;\n            let sqlText = '';\n            if (this.model) {\n                sqlText = this.model.getAttributeById(attrId).expr;\n            }\n            const customSqlExpr = new Expression(column);\n            customSqlExpr.tag = ExprTag.CustomSql;\n            customSqlExpr.dataType = DataType.String; //the default data type\n            customSqlExpr.sql = sqlText;\n            customSqlExpr.baseAttrId = attrId;\n            column.expr = customSqlExpr;\n        }\n        else if (tag === ExprTag.EntityAttribute) {\n            if (column.expr.tag === ExprTag.EntityAttribute\n                || column.expr.tag === ExprTag.ParentEntityAttribute) {\n                return;\n            }\n            const attrId = (column.expr.tag == ExprTag.AggregateFunction)\n                ? column.expr.args[0].value\n                : column.expr.baseAttrId;\n            const attr = attrId\n                ? this.model.getAttributeById(attrId)\n                : this.model.getFirstUICAttr();\n            const expr = new Expression(column);\n            expr.tag = ExprTag.EntityAttribute;\n            expr.dataType = attr.dataType;\n            expr.setValue(attr.id, true);\n            column.expr = expr;\n        }\n        column.caption = this.context.getDefaultColumnCaption(column);\n    }\n    /**\n     * Moves the column with specified index to another position.\n     * @param index1 The index of the column that should be moved.\n     * @param index2 The index of the position the column should be moved to\n     */\n    moveColumn(index1, index2) {\n        const columns = this.getColumns();\n        utils.moveArrayItem(columns, index1, index2);\n        this.adjustColumnsSorting();\n    }\n    /**\n     * Removes a column.\n     * @param column The column to be removed.\n     */\n    removeColumn(column) {\n        utils.removeArrayItem(this.columns, column);\n        utils.removeArrayItem(this.sortedColumns, column);\n    }\n    /**\n     * Adds a condition group - a group of simple conditions (predicates) linked by AND or OR\n     * @param descriptor The descriptor of the new condition group.\n     * @returns The new search condition.\n     */\n    addConditionGroup(descriptor, addChildCondition = true) {\n        console.error(\"Community version doesn't support working with groups.\");\n        return null;\n    }\n    addExtraConditionGroup(descriptor, addChildCondition = true) {\n        console.error(\"Community version doesn't support working with groups.\");\n        return null;\n    }\n    createCondition(tag = CondTag.Simple) {\n        return new Condition(this, tag);\n    }\n    safeStringify(obj) {\n        const seen = new WeakSet();\n        return JSON.stringify(obj, function (key, value) {\n            if (typeof value === \"object\" && value !== null) {\n                if (seen.has(value))\n                    return \"[Circular]\";\n                seen.add(value);\n            }\n            return value;\n        });\n    }\n    /**\n     *  Adds a new simple condition (a predicate)\n     * @param descriptor The descriptor which defines different parameters of the new condition\n     * @returns The new condition.\n     */\n    addSimpleCondition(descriptor) {\n        let parent = descriptor.parent || this.getRootCondition();\n        let model = this.getModel();\n        if (!model)\n            return null;\n        if (!descriptor.attribute && !descriptor.attributeId) {\n            throw new Error(\"Either `attribute` or `attributeId` parameter must have a value\");\n        }\n        if (!descriptor.attribute) {\n            descriptor.attribute = model.getAttributeById(descriptor.attributeId);\n            if (!descriptor.attribute) {\n                throw new Error(\"Could not find attribute: \" + descriptor.attributeId);\n            }\n        }\n        if (!descriptor.operator && descriptor.operatorId) {\n            descriptor.operator = model.getOperatorById(descriptor.operatorId);\n            if (!descriptor.operator) {\n                throw new Error(\"Could not find operator: \" + descriptor.operatorId);\n            }\n        }\n        if (!descriptor.operator) {\n            descriptor.operator = model.getDefaultOperatorForAttr(descriptor.attribute);\n        }\n        let cond = this.createSimpleConditionObject(descriptor.attribute, descriptor.operator, descriptor.value);\n        parent.addCondition(cond);\n        cond.enabled = utils.getIfDefined(descriptor.enabled, true);\n        cond.setReadOnly(utils.getIfDefined(descriptor.readonly, false));\n        return cond;\n    }\n    addSimpleExtraCondition(descriptor) {\n        descriptor.parent = descriptor.parent || this.extraConditions;\n        return this.addSimpleCondition(descriptor);\n    }\n    createSimpleConditionObject(attr, operator, inputValues) {\n        if (!attr || !attr.useInConditions) {\n            let attrCaption = attr ? attr.caption : 'NULL';\n            throw \"Can't add a condition with such attribute: \" + attrCaption;\n        }\n        let cond = this.createCondition(CondTag.Simple);\n        cond.setOperatorId(operator.id, true);\n        let attrExpr = new Expression(cond);\n        attrExpr.setValue(attr.id, true);\n        attrExpr.tag = this.attributeExprTag;\n        attrExpr.kind = DataKind.Attribute;\n        attrExpr.dataType = attr.dataType;\n        cond.expressions.push(attrExpr);\n        let model = this.getModel();\n        const valCount = operator.paramCount;\n        let values = utils.fillArray(new Array(valCount - 1), null);\n        if (inputValues !== null && typeof inputValues !== \"undefined\") {\n            if (Array.isArray(inputValues)) {\n                utils.copyArrayTo(inputValues, values);\n            }\n            else if (valCount > 0) {\n                values[0] = inputValues;\n            }\n        }\n        var valLength = values.length;\n        for (var i = 0; i < valLength; i++) {\n            let operand = model.getOperand(attr, operator, i + 1);\n            cond.addExpressionByOperand(operand, values[i]);\n        }\n        return cond;\n    }\n    /**\n     * Removes several columns passed as array.\n     * @param columnsToRemove The list of columns to be removed.\n     * @param author The author.\n     */\n    removeColumns(columnsToRemove, author) {\n        let justSortedColumns = columnsToRemove.filter(c => c.isJustSorted());\n        let columns = columnsToRemove.filter(c => !c.isJustSorted());\n        function removeFromArray(arr, arrToRemove) {\n            let ctrLen = arrToRemove.length;\n            for (let i = 0; i < ctrLen; i++) {\n                let index = arr.indexOf(arrToRemove[i]);\n                if (index >= 0) {\n                    arr.splice(index, 1);\n                }\n            }\n        }\n        if (columns.length > 0) {\n            removeFromArray(this.getColumns(), columns);\n            removeFromArray(this.sortedColumns, columns);\n        }\n        if (justSortedColumns.length > 0) {\n            //removeFromArray(this.getJustSortedColumns(), justSortedColumns);\n            removeFromArray(this.sortedColumns, justSortedColumns);\n        }\n        this.fixupSortingIndices();\n    }\n    /**\n     * Fires process event.\n     * @param data The data.\n     */\n    fireProcessEvent(data) {\n        this.eventEmitter.fire('query.process', data);\n    }\n    fireChangedEvent(params, postpone, wasModified) {\n        params = params || { part: QueryChangePart.All };\n        if (typeof (postpone) != 'undefined' || typeof (wasModified) != 'undefined') {\n            params.postpone = postpone || 0;\n            params.wasModified = wasModified;\n            console.warn('Method with \\'postpone\\' and \\'wasModified\\' args is deprecated. Pass params in data object');\n        }\n        this._isModified = typeof (params.wasModified) != 'undefined'\n            ? params.wasModified\n            : true;\n        const eventData = params || {\n            part: QueryChangePart.All\n        };\n        this.eventEmitter.fire('query.change', eventData, params.postpone || 0);\n    }\n    fireColumnsChangedEvent(action, column, justsorted = false) {\n        this.fireChangedEvent({\n            part: (justsorted)\n                ? QueryChangePart.SortingColumns\n                : QueryChangePart.Columns,\n            action: action,\n            changee: column\n        });\n    }\n    fireConditionsChangedEvent(action, condition) {\n        this.fireChangedEvent({\n            part: QueryChangePart.Conditions,\n            action: action,\n            changee: condition\n        });\n    }\n    /**\n     * Runs through condition with this callback.\n     * @param processCondition The function to process condition.\n     */\n    runThroughConditions(processCondition) {\n        let processGroup = function (predicate) {\n            for (let i = 0; i < predicate.getConditions().length; i++) {\n                let cond = predicate.getConditions()[i];\n                if (cond.isGroup()) {\n                    processGroup(cond);\n                }\n                else {\n                    if (processCondition)\n                        processCondition(cond);\n                }\n            }\n        };\n        processGroup(this.getRootCondition());\n    }\n    /**\n     * Gets one value for the attribute\n     * @param attrId The attribute ID.\n     * @retruns The value.\n     */\n    getOneValueForAttr(attrId) {\n        let res = null;\n        this.runThroughConditions(function (cond) {\n            if (cond.enabled) {\n                const expr = cond.expressions[0];\n                const opid = cond.getOperatorId();\n                if (expr.value == attrId && cond.expressions[1] &&\n                    (opid == \"Equal\" || opid == \"InList\" || opid == \"StartsWith\")) {\n                    res = cond.expressions[1].value;\n                }\n            }\n        });\n        return res;\n    }\n    /**\n     * Gets root predicate\n     * @retruns The condition.\n     */\n    getRootCondition() {\n        return this.root;\n    }\n    /**\n     * Add process callback\n     * @param callback The callback.\n     * @retruns The callback ID.\n     */\n    addProcessCallback(callback) {\n        return this.eventEmitter.subscribe('query.process', callback);\n    }\n    /**\n     * Remove process callback\n     * @param callbackId The callback ID.\n     */\n    removeProcessCallback(callbackId) {\n        this.eventEmitter.unsubscribe('query.process', callbackId);\n    }\n    /**\n     * Add changed callback\n     * @param callback The callback ID.\n     */\n    addChangedCallback(callback) {\n        return this.eventEmitter.subscribe('query.change', callback);\n    }\n    /**\n     * Remove changed callback\n     * @param callbackId The callback ID.\n     */\n    removeChangedCallback(callbackId) {\n        this.eventEmitter.unsubscribe('query.change', callbackId);\n    }\n    /**\n     * Retruns conditions text\n     */\n    getConditionsText() {\n        const model = this.getModel();\n        if (!model)\n            return '';\n        const getConditionGroupText = (group) => {\n            let result = '', conjKey = 'Conj' + equtils.linkTypeToStr(group.linkType), conjText = i18n.getText(conjKey), condText, i;\n            for (i = 0; i < group.getConditions().length; i++) {\n                condText = '';\n                let cond = group.getConditions()[i];\n                if (cond.enabled || typeof (cond.enabled) === 'undefined') {\n                    if (cond.isGroup()) {\n                        condText = getConditionGroupText(cond);\n                        if (condText) {\n                            condText = '(' + condText + ')';\n                        }\n                    }\n                    else {\n                        let opId = cond.getOperatorId();\n                        let operator = model.getOperatorById(opId);\n                        let parts = equtils.parseOperatorFormat(operator);\n                        let plen = parts.length;\n                        for (let pi = 0; pi < plen; pi++) {\n                            let part = parts[pi];\n                            let txt = part.text;\n                            if (part.type == 'expression') {\n                                let expr = cond.expressions[part.index];\n                                if (expr.kind == DataKind.Attribute || expr.tag == ExprTag.EntityAttribute) {\n                                    let attr = model.getAttributeById(expr.value);\n                                    if (attr != null) {\n                                        txt = model.getAttributeText(attr, '{entity} {attr}');\n                                    }\n                                }\n                                if (expr.kind == DataKind.Query) {\n                                    txt = ': (' + expr.subQuery.getConditionsText() + ')';\n                                }\n                                else {\n                                    txt = expr.getText();\n                                    if (this.model.isDateMacro(txt) || this.model.isTimeMacro(txt)) {\n                                        const macroText = txt.substring(3, txt.length - 2);\n                                        const res = i18n.getText(macroText);\n                                        txt = res || txt;\n                                    }\n                                }\n                            }\n                            if (pi > 0)\n                                condText += ' ';\n                            condText += txt;\n                        }\n                    }\n                }\n                if (condText) {\n                    if (i > 0 && result) {\n                        result += ' ' + conjText + ' ';\n                    }\n                    result += condText;\n                }\n            }\n            if (group.linkType == LinkType.None || group.linkType == LinkType.NotAll) {\n                result = 'not ( \" + result + \" )';\n            }\n            return result;\n        };\n        return getConditionGroupText(this.getRootCondition());\n    }\n    /**\n    * Retruns conditions text\n    */\n    getConditionsTextAsHtml() {\n        const model = this.getModel();\n        if (!model)\n            return '<div class=\"eqjs-query-text\"></div>';\n        const quoteExprText = (expr) => {\n            if (expr.kind == DataKind.Query) {\n                return `&lt;${expr.getText()}&gt;`;\n            }\n            else if (expr.kind == DataKind.List) {\n                return `[${expr.getText()}]`;\n            }\n            else if (expr.dataType == DataType.String\n                || expr.dataType == DataType.Memo\n                || expr.dataType == DataType.FixedChar) {\n                return `&quot;${expr.getText()}&quot;`;\n            }\n            else {\n                let txt = expr.getText();\n                if (this.model.isDateMacro(txt) || this.model.isTimeMacro(txt)) {\n                    const macroText = txt.substring(3, txt.length - 2);\n                    const res = i18n.getText(macroText);\n                    txt = res || txt;\n                }\n                return txt;\n            }\n        };\n        const getConditionGroupText = (group) => {\n            let result = '', conjKey = \"Conj\" + equtils.linkTypeToStr(group.linkType), conjText = `<span class=\"eqjs-query-text-conj\">${i18n.getText(conjKey)}</span>`, condText, i;\n            for (i = 0; i < group.getConditions().length; i++) {\n                condText = \"\";\n                let cond = group.getConditions()[i];\n                if (cond.enabled || typeof (cond.enabled) === \"undefined\") {\n                    if (cond.isGroup()) {\n                        condText = getConditionGroupText(cond);\n                        if (condText) {\n                            condText = \"(\" + condText + \")\";\n                        }\n                    }\n                    else {\n                        let opId = cond.getOperatorId();\n                        let operator = model.getOperatorById(opId);\n                        let parts = equtils.parseOperatorFormat(operator);\n                        let plen = parts.length;\n                        for (let pi = 0; pi < plen; pi++) {\n                            let part = parts[pi];\n                            let txt = part.text;\n                            if (part.type == \"expression\") {\n                                let expr = cond.expressions[part.index];\n                                if (expr.kind == DataKind.Attribute || expr.tag == ExprTag.EntityAttribute) {\n                                    let attr = model.getAttributeById(expr.value);\n                                    txt = `<span class=\"eqjs-query-text-attr\">${model.getAttributeText(attr, \"{entity} {attr}\")}</span>`;\n                                }\n                                else {\n                                    txt = `<span class=\"eqjs-query-text-expr\">${quoteExprText(expr)}</span>`;\n                                }\n                            }\n                            else if (part.type == \"operator\") {\n                                txt = `<span class=\"eqjs-query-text-op\">${txt}</span>`;\n                            }\n                            if (pi > 0)\n                                condText += \" \";\n                            condText += txt;\n                        }\n                    }\n                }\n                if (condText) {\n                    if (i > 0 && result) {\n                        result += \" \" + conjText + \" \";\n                    }\n                    result += condText;\n                }\n            }\n            if (group.linkType == LinkType.None || group.linkType == LinkType.NotAll) {\n                result = \"<span class=\\\"eqjs-query-text-conj\\\">not</span> ( \" + result + \" )\";\n            }\n            return result;\n        };\n        return `<div class=\"eqjs-query-text\">${getConditionGroupText(this.getRootCondition())}</div>`;\n    }\n    /**\n     * Gets an array of all entities used in the query.\n     */\n    getEntitiesInQuery() {\n        if (this.model.id !== this.id)\n            throw Error('Model mithmatch');\n        const entities = [];\n        const columns = this.getColumns();\n        for (let column of columns) {\n            if (!column.enabled)\n                continue;\n            this.addEntityByExpression(entities, column.expr);\n        }\n        const rootCond = this.getRootCondition();\n        this.fillEntitiesByCondtionGroup(entities, rootCond);\n        return entities;\n    }\n    fillEntitiesByCondtionGroup(entities, root) {\n        for (let condition of root.getConditions()) {\n            if (!condition.isGroup()) {\n                for (let expr of condition.expressions) {\n                    this.addEntityByExpression(entities, expr);\n                    if (expr.args) {\n                        for (let arg of expr.args) {\n                            this.addEntityByExpression(entities, arg);\n                        }\n                    }\n                }\n            }\n            else {\n                this.fillEntitiesByCondtionGroup(entities, condition);\n            }\n        }\n    }\n    addEntityByExpression(entities, expr) {\n        if (expr.tag !== ExprTag.EntityAttribute)\n            return;\n        const attrId = expr.baseAttrId || expr.value;\n        if (attrId) {\n            const attr = this.model.getAttributeById(attrId);\n            if (attr) {\n                if (attr.entity && utils.indexOfArrayItem(entities, attr.entity) < 0) {\n                    entities.push(attr.entity);\n                }\n            }\n        }\n    }\n    /**\n     * Builds and returns the path (actually the tree) between the entities used in the query.\n     */\n    buildQueryPath() {\n        let entity = this.model.getMainEntity() || this.model.rootEntity;\n        const tree = this.createTreeNodeFromEntity(entity);\n        tree.setParents();\n        return tree;\n    }\n    createTreeNodeFromEntity(entity) {\n        let tree = new Tree(entity);\n        for (let subEnentity of entity.subEntities) {\n            tree.addChild(this.createTreeNodeFromEntity(subEnentity));\n        }\n        return tree;\n    }\n}\n\nclass BrowserQueryStorage {\n    constructor(context) {\n        this.context = context;\n        console.warn('BrowserQueryStorage is used for managing queries');\n    }\n    init(options) {\n        let keyPrefix = 'eq';\n        if (options && options.keyPrefix) {\n            keyPrefix = options.keyPrefix;\n        }\n        this.queryListKey = keyPrefix + '-querylist';\n        this.queryKeyPrefix = keyPrefix;\n    }\n    getQueryList(options) {\n        return new Promise((resolve, reject) => {\n            try {\n                const itemsString = localStorage.getItem(this.queryListKey);\n                if (itemsString) {\n                    resolve(JSON.parse(itemsString));\n                }\n                resolve([]);\n            }\n            catch (err) {\n                reject(err);\n            }\n        });\n    }\n    newQuery(options) {\n        return new Promise((resolve, reject) => {\n            const query = this.context.createQuery();\n            query.reset();\n            query.setDefaultName();\n            if (options) {\n                if (options.query) {\n                    query.loadFromData(options.query.toJSONData());\n                }\n                if (options.queryId) {\n                    query.setId(options.queryId);\n                }\n                if (options.name) {\n                    query.setName(options.name);\n                }\n                if (options.description) {\n                    query.setDescription(options.description);\n                }\n            }\n            this._saveQuery(query);\n            resolve(query.toJSONData());\n        });\n    }\n    loadQuery(options) {\n        return new Promise((resolve, reject) => {\n            try {\n                const queryItem = localStorage.getItem(this.queryKeyPrefix + '-' + options.queryId);\n                if (queryItem) {\n                    resolve(JSON.parse(queryItem));\n                }\n                throw new Error('Query is not found: ' + options.queryId);\n            }\n            catch (err) {\n                reject(err);\n            }\n        });\n    }\n    saveQuery(options) {\n        return new Promise((resolve, reject) => {\n            try {\n                const modelId = options.modelId || this.context.getModel().getId();\n                const query = options.query || this.context.getQuery();\n                this._saveQuery(query);\n                resolve(null);\n            }\n            catch (err) {\n                reject(err);\n            }\n        });\n    }\n    _saveQuery(query) {\n        let queryList = [];\n        const itemsString = localStorage.getItem(this.queryListKey);\n        if (itemsString) {\n            queryList = JSON.parse(itemsString);\n        }\n        let item = utils.findItemById(queryList, query.getId());\n        if (!item) {\n            item = { id: query.getId(), name: query.getName(), text: query.getDescription() };\n            queryList.push(item);\n        }\n        item.name = query.getName();\n        item.text = query.getDescription();\n        localStorage.setItem(this.queryListKey, JSON.stringify(queryList));\n        localStorage.setItem(this.queryKeyPrefix + '-' + query.getId(), query.toJSON());\n    }\n    removeQuery(options) {\n        return new Promise((resolve, reject) => {\n            try {\n                const modelId = options.modelId || this.context.getModel().getId();\n                const queryId = options.queryId || this.context.getQuery().getId();\n                let queryList = [];\n                const itemsString = localStorage.getItem(this.queryListKey);\n                if (itemsString) {\n                    queryList = JSON.parse(itemsString);\n                }\n                queryList = queryList.filter(item => item.id != queryId);\n                localStorage.setItem(this.queryListKey, JSON.stringify(queryList));\n                localStorage.removeItem(this.queryKeyPrefix + '-' + queryId);\n                resolve();\n            }\n            catch (err) {\n                reject(err);\n            }\n        });\n    }\n}\n\nclass EqModelLoader {\n    constructor(context) {\n        this.context = context;\n        this.modelPromise = null;\n    }\n    init(options) {\n    }\n    getContext() {\n        return this.context;\n    }\n    createModelLoadingPromise() {\n        this.modelPromise = new Promise((resolve, reject) => {\n            this.modelLoadingResolveFunc = resolve;\n            this.modelLoadingRejectFunc = reject;\n        });\n    }\n    /**\n     * Returns the `Promise` of the model loading process\n     */\n    getModelPromise() {\n        return this.modelPromise\n            || Promise.reject(new Error(\"Model has been never loaded.\"));\n    }\n    startModelLoading(options) {\n        this.createModelLoadingPromise();\n        this.sendLoadModelRequest(options);\n        return this.modelPromise;\n    }\n}\n\nclass EqServerModelLoader extends EqModelLoader {\n    constructor(context) {\n        super(context);\n    }\n    init() {\n    }\n    sendLoadModelRequest(options) {\n        const context = this.getContext();\n        const http = context.getServices().getHttpClient();\n        const url = context.resolveEndpoint('GetModel', { modelId: options.modelId });\n        http.get(url)\n            .then((responseData) => {\n            if (!responseData.model) {\n                this.modelLoadingRejectFunc(new Error('Wrong response format for \"GetModel\" request'));\n            }\n            this.modelLoadingResolveFunc(responseData.model);\n        })\n            .catch(error => {\n            this.modelLoadingRejectFunc(error);\n        });\n    }\n}\n\nclass EqServerDataFetcher {\n    constructor(context) {\n        this.context = context;\n    }\n    fetchData(fetchOptions) {\n        const query = fetchOptions.query || this.context.getQuery();\n        const queryId = query.getId();\n        let requestData = {\n            'options': fetchOptions.options\n        };\n        if (typeof (fetchOptions.queryId) !== 'undefined') {\n            requestData.queryId = fetchOptions.queryId;\n        }\n        else {\n            requestData.query = query.toJSONData();\n        }\n        if (fetchOptions.debug) {\n            requestData.debug = fetchOptions.debug;\n        }\n        if (fetchOptions.chunk) {\n            requestData.chunk = fetchOptions.chunk;\n        }\n        if (fetchOptions.data) {\n            requestData.data = fetchOptions.data;\n        }\n        if (typeof (fetchOptions.aux) != 'undefined') {\n            requestData.aux = fetchOptions.aux;\n        }\n        const url = this.context.resolveEndpoint('FetchData', { modelId: query.getModel().getId(), queryId: queryId });\n        const http = this.context.getServices().getHttpClient();\n        return http.post(url, requestData)\n            .then(data => data);\n    }\n}\n\nclass EqServerQuerySynchronizer {\n    constructor(context) {\n        this.context = context;\n    }\n    syncQuery(options) {\n        options = options || {};\n        const query = options.query || this.context.getQuery();\n        const ops = options.options || {};\n        let requestData = {\n            'query': query.toJSONData(),\n            'options': ops,\n        };\n        if (options.data) {\n            requestData.data = options.data;\n        }\n        const url = this.context.resolveEndpoint('SyncQuery', { modelId: query.getModel().getId(), queryId: query.getId() });\n        const http = this.context.getServices().getHttpClient();\n        return http.post(url, requestData)\n            .then(responseData => responseData);\n    }\n}\n\nclass EqServerValueListResolver {\n    constructor(context) {\n        this.context = context;\n    }\n    loadValueList(options) {\n        const modelId = options.modelId || this.context.getModel().getId();\n        const requestData = utils.assign({ modelId: modelId }, options.params);\n        const editorId = requestData.editorId;\n        const http = this.context.getServices().getHttpClient();\n        const url = this.context.resolveEndpoint('GetValueList', { modelId: modelId, listId: editorId });\n        let queryParams = {};\n        if (options && options.params && options.params.queryParams) {\n            queryParams = options.params.queryParams;\n        }\n        return http.get(url, { queryParams: queryParams })\n            .then((responseData) => {\n            if (responseData && responseData.values) {\n                return responseData.values;\n            }\n            else {\n                throw new Error('Wrong response format. No \"values\" property');\n            }\n        });\n    }\n}\n\nclass EqQueryFileLoader {\n    constructor(context) {\n        this.context = context;\n    }\n    getQueryFile(options) {\n        const query = options.query || this.context.getQuery();\n        const url = this.context.resolveEndpoint('GetQueryFile', { modelId: query.getModel().getId(),\n            format: options.format || 'xml' });\n        const http = this.context.getServices().getHttpClient();\n        const actionResult = http.post(url, {\n            query: query.toJSONData()\n        });\n        const request = actionResult.getRequest();\n        return actionResult.then((responseData) => {\n            const blob = new Blob([responseData]);\n            const dispositionHeader = request.getXMLHttpRequest().getResponseHeader(\"Content-Disposition\");\n            let fileName = dispositionHeader\n                ? dispositionHeader.match(/filename=\"?([^\"]*)\"?$/)[1]\n                : 'query.json';\n            if (options.fileName) {\n                fileName = options.fileName\n                    + fileName.substring(fileName.lastIndexOf('.'));\n            }\n            if (window.navigator['msSaveOrOpenBlob']) {\n                // Internet Explorer\n                window.navigator['msSaveOrOpenBlob'](blob, fileName);\n            }\n            else {\n                const a = document.createElement(\"a\");\n                document.body.appendChild(a);\n                a.style.display = \"none\";\n                a.href = window.URL.createObjectURL(blob);\n                a.download = fileName;\n                a.click();\n                window.URL.revokeObjectURL(a.href);\n                document.body.removeChild(a);\n            }\n        });\n    }\n    uploadQueryFile(options) {\n        options = options || {};\n        const query = options.query || this.context.getQuery();\n        const url = this.context.resolveEndpoint('UploadQueryFile', { modelId: query.getModel().getId() });\n        const http = this.context.getServices().getHttpClient();\n        return http.post(url, options.data, {\n            dataType: 'form-data'\n        })\n            .then(responseData => {\n            return responseData.query;\n        });\n    }\n}\n\nclass EqAggregatesContainer {\n    constructor(context) {\n        this.context = context;\n        this.levels = {};\n    }\n    getAggregateData(level, groupKey) {\n        return new Promise((resolve, reject) => {\n            const processFunc = (data) => {\n                // map values\n                const keyStr = this.groupKeyToStr(groupKey);\n                const value = data.get(keyStr);\n                if (value) {\n                    resolve(value);\n                }\n                else {\n                    reject(`Can't find data for ${keyStr}`);\n                }\n            };\n            const desc = this.getLevelDesc(level, false);\n            if (desc) {\n                if (desc.data) {\n                    processFunc(desc.data);\n                }\n                else {\n                    desc.receivedCallbacks.push(processFunc);\n                }\n            }\n        });\n    }\n    setAggregateData(level, data) {\n        const desc = this.getLevelDesc(level, true);\n        desc.data = data;\n        if (desc.receivedCallbacks) {\n            for (const callback of desc.receivedCallbacks) {\n                callback(desc.data);\n            }\n        }\n        desc.receivedCallbacks = [];\n    }\n    updateAggregateData(level, groupKey, values) {\n        const desc = this.getLevelDesc(level, true);\n        const key = this.groupKeyToStr(groupKey);\n        desc.data.set(key, values);\n    }\n    groupKeyToStr(groupKey) {\n        return JSON.stringify(groupKey);\n    }\n    getLevelDesc(level, createIfNotExists) {\n        let desc = this.levels[level];\n        if (!desc && createIfNotExists) {\n            desc = {\n                receivedCallbacks: [],\n                data: new Map()\n            };\n            this.levels[level] = desc;\n        }\n        return desc;\n    }\n    clear() {\n        this.levels = {};\n    }\n}\nclass DefaultAggregatesCalculator {\n    constructor(context) {\n        this.context = context;\n        this.aggrs = null;\n    }\n    getAggrContainer() {\n        return this.aggrs;\n    }\n    calculate(options) {\n        console.warn(\"Grand totals and sub totals aggregation calculation can be used in Enterprise version only\");\n        options = options || {};\n        options.maxLevel = options.maxLevel >= 0\n            ? options.maxLevel : 0;\n        this.aggrs = new EqAggregatesContainer(this.context);\n        const query = this.context.createQuery();\n        query.loadFromData(this.context.getQuery().toJSONData());\n        const settings = this.context.getQuery().getAggregationSettings();\n        const aggrColId = settings.getAggregates().map(a => a.colId);\n        const columns = query.getColumns()\n            .filter(col => aggrColId.indexOf(col.id) < 0);\n        for (let i = 0; i < columns.length; i++) {\n            columns[i].enabled = false;\n        }\n        if (settings.hasGrandTotals()) {\n            this.aggrs.setAggregateData(0, new Map());\n            if (options.resultObtained)\n                options.resultObtained({}, 0);\n        }\n        const groups = settings.getGroups();\n        for (let level = 1; level <= groups.length && level <= options.maxLevel; level++) {\n            this.aggrs.setAggregateData(level, new Map());\n            if (options.resultObtained)\n                options.resultObtained({}, level);\n        }\n        return Promise.resolve();\n    }\n    needRecalculation() {\n        return true;\n    }\n    reset() {\n    }\n}\n\nclass EqServiceProvider {\n    static getInstance() {\n        if (!EqServiceProvider._instance) {\n            EqServiceProvider._instance = new EqServiceProvider();\n        }\n        return EqServiceProvider._instance;\n    }\n    constructor() {\n        this.services = {};\n        this.httpClient = new HttpClient();\n        this.httpClient.defaultHeaders['x-eqjs-version'] = '7.4.0';\n        this.modelResolver = (_) => new DataModel();\n        this.modelStorageResolver = null;\n        this.queryResolver = (context) => new Query(context.getModel(), null, { context: context });\n        this.modelLoaderResolver = (context) => new EqServerModelLoader(context);\n        this.queryStorageResolver = (context) => new BrowserQueryStorage(context);\n        this.querySynchronizerResolver = (context) => new EqServerQuerySynchronizer(context);\n        this.vllResolver = (context) => new EqServerValueListResolver(context);\n        this.dataFetcherResolver = (context) => new EqServerDataFetcher(context);\n        this.queryFileLoaderResolver = (context) => new EqQueryFileLoader(context);\n        this.aggrCalculatoResolver = (context) => new DefaultAggregatesCalculator(context);\n    }\n    reset() {\n    }\n    getHttpClient() {\n        return this.httpClient;\n    }\n    createDataModel(context) {\n        if (!this.modelResolver) {\n            throw 'Model resolver is not defined';\n        }\n        return this.modelResolver(context);\n    }\n    createQuery(context) {\n        if (!this.queryResolver) {\n            throw 'Query resolver is not defined';\n        }\n        return this.queryResolver(context);\n    }\n    registerDataModelResolver(resolver) {\n        this.modelResolver = resolver;\n    }\n    getDataModelResolver() {\n        return this.modelResolver;\n    }\n    registerQueryResolver(resolver) {\n        this.queryResolver = resolver;\n    }\n    getQueryResolver() {\n        return this.queryResolver;\n    }\n    registerModelLoaderResolver(resolver) {\n        this.modelLoaderResolver = resolver;\n    }\n    getModelLoaderResolver() {\n        if (!this.modelLoaderResolver) {\n            throw 'ModelLoaderResolver is not defined';\n        }\n        return this.modelLoaderResolver;\n    }\n    registerModelStorageResolver(resolver) {\n        this.modelStorageResolver = resolver;\n    }\n    getModelStorageResolver() {\n        if (!this.modelStorageResolver) {\n            throw 'ModelStorageResolver is not defined';\n        }\n        return this.modelStorageResolver;\n    }\n    registerQueryStorageResolver(resolver) {\n        this.queryStorageResolver = resolver;\n    }\n    getQueryStorageResolver() {\n        if (!this.queryStorageResolver) {\n            throw 'QueryStorageResolver is not defined';\n        }\n        return this.queryStorageResolver;\n    }\n    registerDataFetcherResolver(resolver) {\n        this.dataFetcherResolver = resolver;\n    }\n    getDataFetcherResolver() {\n        if (!this.dataFetcherResolver) {\n            throw 'DataFetcherResolver is not defined';\n        }\n        return this.dataFetcherResolver;\n    }\n    registerQuerySyncronizerResolver(resolver) {\n        this.querySynchronizerResolver = resolver;\n    }\n    getQuerySynchronizerResolver() {\n        if (!this.querySynchronizerResolver) {\n            throw 'QuerySynchronizerResolver is not defined';\n        }\n        return this.querySynchronizerResolver;\n    }\n    registerValueListLoaderResolver(resolver) {\n        this.vllResolver = resolver;\n    }\n    getValueListLoaderResolver() {\n        if (!this.vllResolver) {\n            throw 'Resolver for ValueListLoader is not defined';\n        }\n        return this.vllResolver;\n    }\n    registerQueryFileLoaderResolver(resolver) {\n        this.queryFileLoaderResolver = resolver;\n    }\n    getQueryFileLoaderResolver() {\n        if (!this.queryFileLoaderResolver) {\n            throw 'Resolver for QueryFileLoader is not defined';\n        }\n        return this.queryFileLoaderResolver;\n    }\n    registerAggregatesCalculator(resolver) {\n        this.aggrCalculatoResolver = resolver;\n    }\n    getAggregatesCalculatorResolver() {\n        if (!this.aggrCalculatoResolver) {\n            throw 'Resolver for AggregatesCalculator is not defined';\n        }\n        return this.aggrCalculatoResolver;\n    }\n    registerService(serviceId, serviceResolver) {\n        this.services[serviceId] = serviceResolver;\n    }\n    getService(serviceId) {\n        const serviceResolver = this.services[serviceId];\n        if (serviceResolver) {\n            return serviceResolver();\n        }\n    }\n}\n\n/** Represents groups of widgets. Used to identify widgets */\nvar WidgetGroup;\n(function (WidgetGroup) {\n    /** None widget group. */\n    WidgetGroup[WidgetGroup[\"None\"] = 0] = \"None\";\n    /** The group of widgets responsible for the Model. */\n    WidgetGroup[WidgetGroup[\"Model\"] = 1] = \"Model\";\n    /** The group of widgets responsible for the Query. */\n    WidgetGroup[WidgetGroup[\"Query\"] = 2] = \"Query\";\n    /** The group of widgets responsible for the Result. */\n    WidgetGroup[WidgetGroup[\"Result\"] = 4] = \"Result\";\n    /** The group of widgets responsible for the statement. */\n    WidgetGroup[WidgetGroup[\"Statement\"] = 8] = \"Statement\";\n    /** The group of widgets responsible for tracking Query status. */\n    WidgetGroup[WidgetGroup[\"QueryStatus\"] = 16] = \"QueryStatus\";\n    /** All. */\n    WidgetGroup[WidgetGroup[\"All\"] = 65535] = \"All\";\n})(WidgetGroup || (WidgetGroup = {}));\n\n//possibly move it to the EasyData lib on the next update\nvar EmptyChunk = {\n    offset: 0,\n    limit: 0,\n    needTotal: false\n};\n\nclass EqServerExporter {\n    constructor(context) {\n        this.context = context;\n    }\n    setFormat(format, responseType) {\n        this.format = format;\n        this.responseType = responseType;\n    }\n    export(exportOptions) {\n        exportOptions = exportOptions || {};\n        const http = this.context.getServices().getHttpClient();\n        const format = this.format || \"csv\";\n        const query = exportOptions.query || this.context.getQuery();\n        const modelId = query.getModel().getId();\n        let requestData = {\n            'settings': exportOptions.settings,\n            'chunk': EmptyChunk\n        };\n        if (typeof (exportOptions.queryId) !== 'undefined') {\n            requestData.queryId = exportOptions.queryId;\n        }\n        else {\n            requestData.query = query.toJSONData();\n        }\n        if (exportOptions.data) {\n            requestData.data = exportOptions.data;\n        }\n        if (exportOptions.options) {\n            requestData.options = exportOptions.options;\n        }\n        const url = this.context.resolveEndpoint('ExportTotal', { modelId: modelId, format: format });\n        const actionResult = http.post(url, requestData, { responseType: this.responseType });\n        const request = actionResult.getRequest();\n        return actionResult.then((responseData) => {\n            const dispositionHeader = request.getXMLHttpRequest().getResponseHeader(\"Content-Disposition\");\n            const filename = dispositionHeader\n                ? dispositionHeader.match(/filename=\"?([^\"]*)\"?$/)[1]\n                : 'export-data.' + format;\n            equtils.downloadFile(responseData, filename);\n        });\n    }\n}\n\nclass EasyQueryDataLoader {\n    constructor(context) {\n        this.context = context;\n    }\n    loadChunk(chunk) {\n        // We have to refactor page logic in view to make it simplier to integrate \n        // different grids\n        this.dataLoadPromise = new Promise((resolve, reject) => {\n            const fetchOptions = {\n                chunk: chunk,\n                success: (result) => {\n                    const dataTable = new EasyDataTable({\n                        loader: this.context.dataLoader, //TODO: Why not just `this`?\n                        chunkSize: this.context.resultTable.chunkSize\n                    });\n                    const resultSet = result.resultSet;\n                    for (const col of resultSet.cols) {\n                        dataTable.columns.add(col);\n                    }\n                    dataTable.setTotal(result.meta.totalRecords);\n                    for (const row of resultSet.rows) {\n                        dataTable.addRow(row);\n                    }\n                    let totalRecords = 0;\n                    if (result.meta && result.meta.totalRecords) {\n                        totalRecords = result.meta.totalRecords;\n                    }\n                    resolve({\n                        table: dataTable,\n                        total: totalRecords,\n                        hasNext: !chunk.needTotal || chunk.offset + chunk.limit < totalRecords\n                    });\n                },\n                error: (error) => reject(error)\n            };\n            if (this.context.debugMode) {\n                fetchOptions.debug = `Data Chunk. Offset: ${chunk.offset}`;\n            }\n            this.context.fetchDataChunk(fetchOptions);\n        });\n        return this.dataLoadPromise;\n    }\n}\n\nvar EqActionResult;\n(function (EqActionResult) {\n    EqActionResult[EqActionResult[\"Error\"] = 0] = \"Error\";\n    EqActionResult[EqActionResult[\"Success\"] = 1] = \"Success\";\n})(EqActionResult || (EqActionResult = {}));\n\nvar EqAction;\n(function (EqAction) {\n    EqAction[\"LoadModel\"] = \"LoadModel\";\n    EqAction[\"LoadQuery\"] = \"LoadQuery\";\n    EqAction[\"LoadQueryList\"] = \"LoadQueryList\";\n    EqAction[\"NewQuery\"] = \"NewQuery\";\n    EqAction[\"SaveQuery\"] = \"SaveQuery\";\n    EqAction[\"RemoveQuery\"] = \"RemoveQuery\";\n    EqAction[\"SyncQuery\"] = \"SyncQuery\";\n    EqAction[\"FetchData\"] = \"FetchData\";\n    EqAction[\"GetValueList\"] = \"GetValueList\";\n    EqAction[\"ExportResult\"] = \"ExportResult\";\n    EqAction[\"GetQueryFile\"] = \"GetQueryFile\";\n    EqAction[\"UploadQueryFile\"] = \"UploadQueryFile\";\n})(EqAction || (EqAction = {}));\n\n/**\n * Encapsulates all information about EasyQuery components on some webpage\n * and provides some basic operation over those components\n * Each context includes the following main components:\n *  - one data model,\n *  - one query,\n *  - one result set\n *  - several UI widgets.\n */\nclass EqContext {\n    constructor() {\n        this.options = {\n            syncSortOrderWithColumnsOrder: true,\n            attributeFormat: '{entity} {attr}',\n            columnTitleFormat: null //means it will be the same as attributeFormat\n        };\n        this.servicesInitialized = false;\n        this.modelLoader = null;\n        this.queryStorage = null;\n        this.querySynchronizer = null;\n        this.dataFetcher = null;\n        this.valueListLoader = null;\n        this.queryFileLoader = null;\n        this.aggrCalculator = null;\n        this.internalListCache = {};\n        this.loadModelOnStart = true;\n        this.loadQueryOnStart = false;\n        this.useStoredQueryOnFetch = false;\n        this.debugMode = false;\n        this._backendInfo = {\n            type: 'EQN-ANC',\n            subType: 'asp-net-core-razor'\n        };\n        //----------- endpoint processing functions --------------\n        this.endpointVarsRegex = /\\{.*?\\}/g;\n        this.elasticPaging = false;\n        this._predefinedListRequestHandlers = {\n            '_DSDE': (params, onResult) => {\n                const data = this.getModel().getAllDateMacros()\n                    .map(macroId => {\n                    return { id: '${{' + macroId + '}}', text: i18n.getText(macroId) };\n                });\n                onResult(data);\n                return true;\n            },\n            '_DSTE': (params, onResult) => {\n                const data = this.getModel().getAllTimeMacros()\n                    .map(macroId => {\n                    return { id: '${{' + macroId + '}}', text: i18n.getText(macroId) };\n                });\n                onResult(data);\n                return true;\n            }\n        };\n        this._listRequestHandler = (options, onResult) => {\n            if (options == null || !options.listName)\n                return;\n            const query = this.getQuery();\n            const params = utils.assign({ listName: options.listName }, options.editorParams);\n            const reqParams = {};\n            const attrPattern = /@{{(.+?)}}/;\n            for (const prop in params) {\n                if (!params[prop])\n                    continue;\n                let match = params[prop].match(attrPattern);\n                if (match) {\n                    let paramValue = query.getOneValueForAttr(match[1]);\n                    if (!paramValue) {\n                        paramValue = '';\n                    }\n                    reqParams[prop] = params[prop].replace(attrPattern, paramValue);\n                }\n            }\n            const requestParams = {\n                listName: reqParams.listName,\n                editorId: options.editorId,\n                queryParams: reqParams\n            };\n            let list = this.getListFromCache(options);\n            if (list && list.length > 0) {\n                onResult(list);\n                return;\n            }\n            let processed = false;\n            const predefinedHandler = this._predefinedListRequestHandlers[options.editorId];\n            if (predefinedHandler) {\n                processed = predefinedHandler(options, onResult);\n            }\n            if (!processed && this.clientListRequestHandler) {\n                processed = this.clientListRequestHandler(options, onResult);\n            }\n            if (!processed) {\n                this.loadValueList({\n                    params: requestParams,\n                    success: (data) => {\n                        if (data) {\n                            this.addListToCache(options, data);\n                        }\n                        onResult(data);\n                    },\n                    error: (message) => {\n                        onResult(null);\n                    }\n                });\n            }\n        };\n        this.baseEndpoint = 'api/easyquery';\n        this.eqServices = EqServiceProvider.getInstance();\n        this.widgets = new Array();\n        this.eventEmitter = new EventEmitter(this);\n        this.exporters = new Map();\n        this.endpoints = new Map();\n        this.dataLoader = new EasyQueryDataLoader(this);\n        this.resultTable = new EasyDataTable({\n            loader: this.dataLoader,\n            onUpdate: this.onResultTableUpdate.bind(this)\n        });\n        this.resultTable.id = 'ResultTable';\n        this.errorHandlerId = this.addEventListener('error', (context, status) => {\n            status.result = EqActionResult.Error;\n            const msgTitle = status.action ? status.action + ' error' : 'Error';\n            let msgText = status.text ? status.text : '';\n            if (status.sourceError && status.sourceError.message !== msgText) {\n                msgText += '\\n' + status.sourceError;\n            }\n            console.error(msgTitle + ': ' + msgText);\n        });\n    }\n    getServices() {\n        return this.eqServices;\n    }\n    getModelLoader() {\n        if (!this.modelLoader) {\n            const modelLoaderResolver = this.eqServices.getModelLoaderResolver();\n            this.modelLoader = modelLoaderResolver(this);\n        }\n        return this.modelLoader;\n    }\n    getModelStorage() {\n        if (!this.modelStorage) {\n            const modelStorageResolver = this.eqServices.getModelStorageResolver();\n            this.modelStorage = modelStorageResolver(this);\n        }\n        return this.modelStorage;\n    }\n    getQueryStorage() {\n        if (!this.queryStorage) {\n            const queryStorageResolver = this.eqServices.getQueryStorageResolver();\n            this.queryStorage = queryStorageResolver(this);\n        }\n        return this.queryStorage;\n    }\n    getQuerySynchronizer() {\n        if (!this.querySynchronizer) {\n            const querySynchronizerResolver = this.eqServices.getQuerySynchronizerResolver();\n            this.querySynchronizer = querySynchronizerResolver(this);\n        }\n        return this.querySynchronizer;\n    }\n    getDataFetcher() {\n        if (!this.dataFetcher) {\n            const dataFetcherResolver = this.eqServices.getDataFetcherResolver();\n            this.dataFetcher = dataFetcherResolver(this);\n        }\n        return this.dataFetcher;\n    }\n    getValueListLoader() {\n        if (!this.valueListLoader) {\n            const vllResolver = this.eqServices.getValueListLoaderResolver();\n            this.valueListLoader = vllResolver(this);\n        }\n        return this.valueListLoader;\n    }\n    getQueryFileLoader() {\n        if (!this.queryFileLoader) {\n            const queryFileLoaderResolver = this.eqServices.getQueryFileLoaderResolver();\n            this.queryFileLoader = queryFileLoaderResolver(this);\n        }\n        return this.queryFileLoader;\n    }\n    getAggregatesCalculator() {\n        if (!this.aggrCalculator) {\n            const aggrCalculatorResolver = this.eqServices.getAggregatesCalculatorResolver();\n            this.aggrCalculator = aggrCalculatorResolver(this);\n        }\n        return this.aggrCalculator;\n    }\n    /**\n    * Activates `Enterprise` functionality of the library. Works only with @easyquery/enterprise packag and a proper license key.\n    * @param keyOrInitCallback The license key or a callback wich is called after\n    * loading the license key from the back-end.\n    * If the callback function is called useEnterprise will try to get the license key from {base}/lck endpoint\n    *\n    * @example\n    * context.useEnterprise('license key');\n    * //or\n    * context.useEnterprise(() => {\n    *   //further logic\n    *\tview.init(options);\n    * });\n    */\n    useEnterprise(keyOrInitCallback) {\n        console.warn('This method does nothing and should not be called in the Community version of the library');\n    }\n    registerExporter(format, resolver) {\n        this.exporters.set(format, resolver);\n    }\n    registerServerExporter(format, responseType) {\n        this.registerExporter(format, (context) => {\n            const exporter = new EqServerExporter(context);\n            exporter.setFormat(format, responseType);\n            return exporter;\n        });\n    }\n    getExporter(format) {\n        const resolver = this.exporters.get(format);\n        if (resolver) {\n            return resolver(this);\n        }\n        return null;\n    }\n    getExportFormats() {\n        return Array.from(this.exporters.keys());\n    }\n    addDefaultExporters() {\n        this.registerServerExporter('csv', 'arraybuffer');\n        this.registerServerExporter('excel-html', 'arraybuffer');\n    }\n    resolveEndpoint(endpointKey, options) {\n        options = options || {};\n        let result = this.endpoints.get(endpointKey);\n        if (!result) {\n            throw endpointKey + ' endpoint is not defined';\n        }\n        let matches = result.match(this.endpointVarsRegex);\n        if (matches) {\n            for (let match of matches) {\n                let opt = match.substring(1, match.length - 1);\n                let optVal = options[opt];\n                if (!optVal) {\n                    if (opt == 'modelId') {\n                        optVal = this.getModel().getId();\n                    }\n                    else if (opt == 'queryId') {\n                        optVal = this.getQuery().getId();\n                    }\n                    else {\n                        throw `Parameter [${opt}] is not defined`;\n                    }\n                }\n                result = result.replace(match, optVal);\n            }\n        }\n        return result;\n    }\n    setEndpoint(key, value) {\n        this.endpoints.set(key, value);\n    }\n    setEndpointIfNotExist(key, value) {\n        if (!this.endpoints.has(key))\n            this.endpoints.set(key, value);\n    }\n    setDefaultEndpoints(endpointBase) {\n        this.setEndpointIfNotExist('GetModel', equtils.combinePath(endpointBase, 'models/{modelId}'));\n        this.setEndpointIfNotExist('GetQuery', equtils.combinePath(endpointBase, 'models/{modelId}/queries/{queryId}'));\n        this.setEndpointIfNotExist('SaveQuery', equtils.combinePath(endpointBase, 'models/{modelId}/queries/{queryId}'));\n        this.setEndpointIfNotExist('SyncQuery', equtils.combinePath(endpointBase, 'models/{modelId}/queries/{queryId}/sync'));\n        this.setEndpointIfNotExist('NewQuery', equtils.combinePath(endpointBase, 'models/{modelId}/queries'));\n        this.setEndpointIfNotExist('RemoveQuery', equtils.combinePath(endpointBase, 'models/{modelId}/queries/{queryId}'));\n        this.setEndpointIfNotExist('GetQueryList', equtils.combinePath(endpointBase, 'models/{modelId}/queries'));\n        this.setEndpointIfNotExist('FetchData', equtils.combinePath(endpointBase, 'models/{modelId}/fetch'));\n        this.setEndpointIfNotExist('GetValueList', equtils.combinePath(endpointBase, 'models/{modelId}/valuelists/{listId}'));\n        this.setEndpointIfNotExist('ExportTotal', equtils.combinePath(endpointBase, 'models/{modelId}/export/{format}'));\n        this.setEndpointIfNotExist('ExportStart', equtils.combinePath(endpointBase, 'models/{modelId}/export/start/{format}'));\n        this.setEndpointIfNotExist('ExportStatus', equtils.combinePath(endpointBase, 'models/{modelId}/export/status/{exportId}'));\n        this.setEndpointIfNotExist('ExportGetResult', equtils.combinePath(endpointBase, 'models/{modelId}/export/result/{exportId}'));\n        this.setEndpointIfNotExist('GetQueryFile', equtils.combinePath(endpointBase, 'models/{modelId}/getqueryfile/{format}'));\n        this.setEndpointIfNotExist('UploadQueryFile', equtils.combinePath(endpointBase, 'models/{modelId}/uploadqueryfile'));\n    }\n    initStart() {\n        this.servicesInitialized = true;\n    }\n    /**\n     * Initializes the context\n     * @param options\n     */\n    init(options) {\n        if (!this.servicesInitialized)\n            this.initStart();\n        options = options || {};\n        this.setOptions(options);\n        if (typeof (options.debugMode) !== 'undefined') {\n            this.debugMode = options.debugMode;\n        }\n        if (typeof (options.chunkSize) !== 'undefined') {\n            this.resultTable.chunkSize = options.chunkSize;\n        }\n        if (typeof (options.elasticPaging) !== 'undefined') {\n            this.elasticPaging = options.elasticPaging;\n        }\n        if (options.listCache) {\n            this.setExternalListCache(options.listCache);\n        }\n        if (options.locale) {\n            i18n.setCurrentLocale(options.locale);\n        }\n        if (options.localeSettings) {\n            i18n.updateLocaleSettings(options.localeSettings);\n        }\n        if (options.endpoint) {\n            this.baseEndpoint = options.endpoint;\n            console.warn('The `endpoint` option is deprecated.\\n'\n                + 'Please use `context.useEndpoint(endpointURL)` function instead.');\n        }\n        this.setDefaultEndpoints(this.baseEndpoint);\n        if (options.modelStorageResolver) {\n            const eqServices = this.getServices();\n            eqServices.registerModelStorageResolver(options.modelStorageResolver);\n        }\n        this.loadQueryOnStart = false;\n        if (options.loadQueryOnStart) {\n            this.loadQueryOnStart = options.loadQueryOnStart;\n        }\n        this.loadModelOnStart = true;\n        if (typeof options.loadModelOnStart !== 'undefined') {\n            this.loadModelOnStart = options.loadModelOnStart;\n        }\n        if (options.handlers) {\n            if (options.handlers.onInit) {\n                this.addEventListener('ready', options.handlers.onInit);\n            }\n            if (options.handlers.afterLoadModel) {\n                this.addEventListener('loadModel', options.handlers.afterLoadModel);\n            }\n            if (options.handlers.afterLoadQuery) {\n                this.addEventListener('loadQuery', options.handlers.afterLoadQuery);\n            }\n            if (options.handlers.afterSyncQuery) {\n                this.addEventListener('syncQuery', options.handlers.afterSyncQuery);\n            }\n            if (options.handlers.afterFetchData) {\n                this.addEventListener('fetchData', options.handlers.afterFetchData);\n            }\n            if (options.handlers.afterExportResult) {\n                this.addEventListener('exportResult', options.handlers.afterExportResult);\n            }\n            if (options.handlers.onProcessStart) {\n                this.addEventListener('processStart', options.handlers.onProcessStart);\n            }\n            if (options.handlers.onProcessEnd) {\n                this.addEventListener('processEnd', options.handlers.onProcessEnd);\n            }\n            if (options.handlers.onError) {\n                this.removeEventListener('error', this.errorHandlerId);\n                this.addEventListener('error', options.handlers.onError);\n            }\n            if (options.handlers.onListRequest) {\n                this.clientListRequestHandler = options.handlers.onListRequest;\n            }\n            if (options.handlers.beforeLoadModel) {\n                this.beforeLoadModel = options.handlers.beforeLoadModel;\n            }\n            if (options.handlers.beforeLoadQuery) {\n                this.beforeLoadQuery = options.handlers.beforeLoadQuery;\n            }\n            if (options.handlers.beforeSyncQuery) {\n                this.beforeSyncQuery = options.handlers.beforeSyncQuery;\n            }\n            if (options.handlers.beforeFetchData) {\n                this.beforeFetchData = options.handlers.beforeFetchData;\n            }\n            if (options.handlers.beforeExportResult) {\n                this.beforeExportResult = options.handlers.beforeExportResult;\n            }\n        }\n        this.initialQuery = options.initialQuery;\n        this.defaultQueryId = options.defaultQueryId || '';\n        this.defaultModelId = options.defaultModelId || '__default';\n        const modelLoader = this.getModelLoader();\n        modelLoader.init(options);\n        const queryStorage = this.getQueryStorage();\n        queryStorage.init(options);\n        if (options.useDefaultExporters !== false) {\n            this.addDefaultExporters();\n        }\n        if (options.serverExporters) {\n            this.exporters.clear();\n            for (const format of options.serverExporters) {\n                this.registerServerExporter(format, \"arraybuffer\");\n            }\n        }\n        const query = this.getQuery();\n        if (options.defaultQueryId) {\n            query.setId(options.defaultQueryId);\n        }\n        //init widgets\n        this.widgets.forEach((widget) => {\n            let widgetOptions = {};\n            if (options.widgets && options.widgets[widget.getWidgetType()]) {\n                widgetOptions = options.widgets[widget.getWidgetType()];\n            }\n            widget.init(this, widgetOptions);\n        });\n        if (this.loadModelOnStart) {\n            this.loadDefaultModel();\n        }\n        else {\n            this.fireEvent('ready');\n        }\n    }\n    setOptions(options) {\n        utils.assign(this.options, options);\n    }\n    get backendInfo() {\n        return this._backendInfo;\n    }\n    /**\n     * Sets endpoint for all EasyQuery actions. Should be called before `init` and\n     * `useEnterprise` methods\n     * @param endpoint\n     * @example\n     * ```\n     * view.getContext()\n     *     .useEndpoint('/api/easyquery')\n     *     .useEnterprise(function () {\n     *          view.init();\n     *     });\n     * ```\n     */\n    useEndpoint(endpoint) {\n        this.baseEndpoint = endpoint;\n        return this;\n    }\n    /**\n     * Allows to specify the type of backend service.\n     *\n     * @param backendInfo - the structure that contains information about the app used on the backend\n     * Possible values for `ptag` property: 'EQN-ANC' - ASP.NET Core or 'EQN-ASP' - for ASP.NET 4 backend\n     */\n    useBackend(backendInfo) {\n        if (backendInfo.type) {\n            this._backendInfo.type = backendInfo.type;\n        }\n        if (backendInfo.subType) {\n            this._backendInfo.subType = backendInfo.subType;\n        }\n        else {\n            switch (this._backendInfo.type) {\n                case 'EQN-ANC':\n                    this._backendInfo.subType = 'asp-net-core-razor';\n                    break;\n                case 'EQN-ASP':\n                    this._backendInfo.subType = 'asp-net-4-mvc';\n                    break;\n                default:\n                    this._backendInfo.subType = 'other';\n                    break;\n            }\n        }\n        return this;\n    }\n    /**\n     * Add a new widget to the context.\n     * After that the widget will start to receive messages from other context components.\n     * @param widget\n     */\n    addWidget(widget) {\n        this.widgets.push(widget);\n    }\n    /**\n     * Returns all widgets with current type.\n     * @param widgetType The widget type\n     */\n    getAllWidgetsByType(widgetType) {\n        return this.widgets\n            .filter(widget => widget.getWidgetType() === widgetType);\n    }\n    /**\n     * Returns first registerd widget with current type\n     * @param widgetType The widget type\n     */\n    getWidgetByType(widgetType) {\n        const widgets = this.getAllWidgetsByType(widgetType);\n        return widgets.length > 0 ? widgets[0] : null;\n    }\n    /**\n     * This method is called automatically when some change was made either in context's data model or query\n     * @param groups\n     */\n    refreshWidgets(groups = WidgetGroup.All) {\n        this.widgets.forEach((widget) => {\n            if (widget.belongsToGroup(groups)) {\n                widget.refresh();\n            }\n        });\n    }\n    /**\n     * Register a new handler for 'query changed' event\n     * @param callback\n     */\n    addQueryChangedCallback(callback) {\n        this.getQuery().addChangedCallback(callback);\n    }\n    /**\n     * Removes the function from the list of registerd handlers for 'query changed' event\n     * @param callback\n     */\n    removeQueryChangedCallback(callback) {\n        this.getQuery().removeChangedCallback(callback);\n    }\n    /**\n     * Creates a new query object using the current instance of EqServices\n     */\n    createQuery() {\n        return this.eqServices.createQuery(this);\n    }\n    /**\n     * Gets the current query\n     */\n    getQuery() {\n        if (!this.query) {\n            if (!this.servicesInitialized) {\n                throw new Error(\"Can't create query until the context is initialized\");\n            }\n            this.query = this.createQuery();\n        }\n        return this.query;\n    }\n    /**\n     * Gets the current data model\n     */\n    getModel() {\n        if (!this.dataModel) {\n            this.dataModel = this.eqServices.createDataModel(this);\n        }\n        return this.dataModel;\n    }\n    /**\n     * Sets the content of the current data model\n     */\n    loadModelFromData(modelPlainData) {\n        this.getQuery().loadModelData(modelPlainData);\n        this.dataModel = this.getQuery().getModel();\n    }\n    /**\n     * Sets the ID of the default model\n     * @param modelId\n     */\n    setDefaultModelId(modelId) {\n        this.defaultModelId = modelId;\n    }\n    /**\n     * Notifies context components about starting of some long process (e.g. model loading)\n     * This method raises onProcessStart event in the context and all its widgets\n     * @param message\n     * @param groups\n     */\n    startProcess(message, groups) {\n        this.eventEmitter.fire('processStart', message);\n        this.widgets.forEach((widget) => {\n            if (widget.belongsToGroup(groups)) {\n                widget.onProcessStart();\n            }\n        });\n    }\n    /**\n     * Notifies all context components about the finishing of some long process\n     * @param status\n     * @param groups\n     */\n    endProcess(status, groups) {\n        this.eventEmitter.fire('processEnd', status);\n        if (status.result === EqActionResult.Error) {\n            this.throwError(status);\n        }\n        this.widgets.forEach((widget) => {\n            if (widget.belongsToGroup(groups)) {\n                widget.onProcessEnd();\n            }\n        });\n    }\n    /**\n     * Throws the error passed in the function parameter.\n     * If onError event handler is defined - we call that method.\n     * Otherwise - just place the error message to the browser console.\n     * @param status an instance of ActionStatus inteface that represents the action on which the error occurred\n     */\n    throwError(status) {\n        status.result = EqActionResult.Error;\n        this.eventEmitter.fire('error', status);\n    }\n    /**\n     * If `defaultModelId` property is define - this method calls `loadModel` function in the broker\n     * to load the model with such ID.\n     */\n    loadDefaultModel() {\n        this.loadModel({\n            modelId: this.defaultModelId,\n            silent: true,\n            success: () => {\n                this.refreshWidgets(WidgetGroup.Model);\n                let query = this.getQuery();\n                this.fireEvent('initialModelLoad');\n                if (this.initialQuery) {\n                    query.loadFromData(this.initialQuery, {\n                        changeStatus: false\n                    });\n                }\n                if (this.loadQueryOnStart) {\n                    this.loadQuery({\n                        queryId: this.defaultQueryId,\n                        modelId: this.defaultModelId,\n                        success: () => {\n                            //if we load query on start - then we should throw the 'ready' event only after its successful loading\n                            this.throwReady();\n                        },\n                        error: () => {\n                            //if the default query can't be loaded - we still throw the 'ready' event\n                            this.throwReady();\n                        }\n                    });\n                }\n                else {\n                    this.throwReady();\n                }\n            }\n        });\n    }\n    /**\n     * Refreshes all widgets and raises 'ready' event\n     */\n    throwReady() {\n        this.refreshWidgets(WidgetGroup.Query);\n        this.fireEvent('ready');\n    }\n    /**\n     * Clears the content of the current query\n     */\n    clearQuery() {\n        const query = this.getQuery();\n        query.clear();\n        query.fireChangedEvent({\n            part: QueryChangePart.All\n        });\n    }\n    /**\n     * Clears all query results (the data set and the statement, if any)\n     */\n    clearResult() {\n        this.resultTable.clear(); // do not set resultTable to null. Just clear\n        this.resultStatement = null;\n        this.resultContent = null;\n    }\n    /**\n     * Sets the external 'list cache' provider - an object which implements `ExternalListCache` inteface\n     * @param cache\n     */\n    setExternalListCache(cache) {\n        this.externalListCache = cache;\n    }\n    getListFromCache(params) {\n        const key = this.getListCacheKey(params);\n        if (this.externalListCache) {\n            return this.externalListCache.get(key);\n        }\n        else {\n            return this.internalListCache[key];\n        }\n    }\n    getListCacheKey(params) {\n        let key = params.listName == 'SQL' ? 'SQL_' + params.editorId : params.listName;\n        if (params.queryParams) {\n            key += '_' + Object.keys(params.queryParams).filter(k => k != 'listName')\n                .map(k => params.queryParams[k])\n                .join('_');\n        }\n        return key;\n    }\n    addListToCache(params, list) {\n        const key = this.getListCacheKey(params);\n        if (this.externalListCache) {\n            this.externalListCache.set(key, list);\n        }\n        else {\n            this.internalListCache[key] = list;\n        }\n    }\n    /**\n     * Clears the current list cache.\n     */\n    resetListCache() {\n        if (this.externalListCache) {\n            this.externalListCache.clear();\n        }\n        else {\n            this.internalListCache = {};\n        }\n    }\n    /**\n     * Gets the handler for 'GetList' requests\n     */\n    getListRequestHandler() {\n        return this._listRequestHandler;\n    }\n    /**\n     * Adds the translations of the EasyQuery messages for some locale\n     * @param locale - the ISO code of the locale (like `en` or `uk`)\n     * @param localeInfo - Locale settings and translations of EasyQuery texts and messages.\n     * We expected an object with the struture of LocaleInfo interface here.\n     */\n    addLocale(locale, localeInfo) {\n        i18n.addLocale(locale, localeInfo);\n    }\n    addEventListener(eventType, handler) {\n        return this.eventEmitter.subscribe(eventType, (event) => handler(this, event.data));\n    }\n    /**\n     * Remove event handler for event type .\n     * @param eventType The event type.\n     * @param handlerId The handler id.\n     */\n    removeEventListener(eventType, handlerId) {\n        this.eventEmitter.unsubscribe(eventType, handlerId);\n    }\n    fireEvent(eventType, data) {\n        this.eventEmitter.fire(eventType, data);\n    }\n    getBaseEndpoint() {\n        return this.baseEndpoint;\n    }\n    /**\n     * Sends a `loadValueList` requesthe server and processes the response.\n     * @param options A map of options to pass to `loadValueList` function.\n     */\n    loadValueList(options) {\n        options = options || {};\n        this.startProcess({\n            action: EqAction.GetValueList,\n            text: 'Loading values'\n        }, WidgetGroup.Result);\n        const valueListResolver = this.getValueListLoader();\n        valueListResolver.loadValueList(options)\n            .then((values) => {\n            this.endProcess({\n                result: EqActionResult.Success,\n                action: EqAction.GetValueList,\n                text: 'Values loaded'\n            }, WidgetGroup.Result);\n            if (options.success) {\n                options.success(values);\n            }\n        })\n            .catch((error) => {\n            const editorId = options && options.params ? options.params.editorId : 'undefined';\n            const errorMessage = `Can't load the value list for editor ${editorId}.\\n ${error.message}`;\n            this.endProcess({\n                result: EqActionResult.Error,\n                action: EqAction.GetValueList,\n                text: errorMessage,\n                sourceError: error\n            }, WidgetGroup.Result);\n            if (options.error) {\n                options.error(errorMessage, 'GetValueList');\n            }\n        });\n    }\n    /**\n     * Starts the process of the model loading.\n     * This method can initiate a request to EasyQueryServer backend or get the model from OData or GraphQL endpoint\n     * The content of the `options` parameter depends on concrete loader implementation.\n     * @param options A map of options to pass to `loadModel` function (can be ommited)\n     * @example\n     * context.loadModel()\n     *    .then(model => {\n     *       alert(\"Model loaded!\");\n     *    });\n     */\n    loadModel(options) {\n        if (this.beforeLoadModel) {\n            this.beforeLoadModel(this, options);\n        }\n        const modelId = options.modelId || '__default';\n        const silent = options.silent || false;\n        this.startProcess({\n            action: EqAction.LoadModel,\n            text: 'Loading model: ' + modelId\n        }, WidgetGroup.Model);\n        const modelLoader = this.getModelLoader();\n        return modelLoader.startModelLoading(options)\n            .then((value) => {\n            if (value) {\n                this.loadModelFromData(value);\n                if (this.dataModel.isEmpty()) {\n                    console.warn(`Empty model has been loaded. Model ID: ${this.dataModel.getId()}`);\n                }\n            }\n            else {\n                console.warn('Model has not been changed.');\n            }\n            this.fireEvent('loadModel');\n            this.endProcess({\n                result: EqActionResult.Success,\n                action: EqAction.LoadModel,\n                text: 'Model loaded: ' + modelId\n            }, WidgetGroup.Model);\n            if (!silent) {\n                this.clearQuery();\n                this.clearResult();\n                this.refreshWidgets();\n            }\n            if (options.success) {\n                options.success(this.getModel());\n            }\n            return this.getModel();\n        })\n            .catch(error => {\n            const errorMessage = `Can't load model ${modelId}.\\n ${error.message}`;\n            this.endProcess({\n                result: EqActionResult.Error,\n                action: EqAction.LoadModel,\n                text: errorMessage,\n                sourceError: error\n            }, WidgetGroup.Model);\n            if (options.error) {\n                options.error(errorMessage, \"LoadModel\");\n            }\n            return this.getModel();\n        });\n    }\n    callWhenModelLoaded(callFunc) {\n        const modelLoader = this.getModelLoader();\n        modelLoader.getModelPromise().then(() => {\n            callFunc();\n        });\n    }\n    /**\n     * Loads the query\n     * @param options\n     * The content of the `options` parameter depends on `QueryStorage` implementation.\n     * Usually it contains `success`, `error` callbacks and `queryId` property of the query to load.\n     * @example\n     * context.loadQuery({\n     *      queryId: \"query-id\"\n     * });\n     */\n    loadQuery(options) {\n        options = options || {};\n        const modelLoader = this.getModelLoader();\n        this.clearResult();\n        modelLoader.getModelPromise()\n            .then(() => {\n            options = options || {};\n            const queryId = options.queryId;\n            const silent = options.silent || false;\n            if (this.beforeLoadQuery) {\n                this.beforeLoadQuery(this, options);\n            }\n            this.startProcess({\n                action: EqAction.LoadQuery,\n                text: \"Query loading: \" + queryId\n            }, WidgetGroup.Query);\n            const queryStorage = this.getQueryStorage();\n            queryStorage.loadQuery(options)\n                .then((data) => {\n                if (data) {\n                    this.query.loadFromData(data, {\n                        validate: false\n                    });\n                }\n                this.limitCustomSqlColumns();\n                this.fireEvent('loadQuery');\n                this.endProcess({\n                    result: EqActionResult.Success,\n                    action: EqAction.LoadQuery,\n                    text: 'Query loaded: ' + queryId\n                }, WidgetGroup.Query);\n                this.query.resetModified();\n                if (!silent) {\n                    this.query.fireChangedEvent({\n                        part: QueryChangePart.Properties,\n                        wasModified: this.query.isModified()\n                    });\n                    this.refreshWidgets();\n                }\n                if (options.success) {\n                    options.success(this.query);\n                }\n            })\n                .catch((error) => {\n                const query = this.getQuery();\n                error.message = \"Can't load query [\" + query.getId() + \"]\\n\" + (error.message || \"\");\n                if (options.error) {\n                    options.error(error.message, EqAction.LoadQuery);\n                }\n                this.endProcess({\n                    result: EqActionResult.Error,\n                    action: EqAction.LoadQuery,\n                    text: error.message,\n                    sourceError: error\n                }, WidgetGroup.Query);\n            });\n        })\n            .catch((error) => {\n            console.error(error);\n        });\n    }\n    /**\n     * Loads the list of queries available for the current user.\n     * @param options\n     * The content of the `options` parameter depends on `QueryStorage` implementation.\n     * Usually it contains `success`, `error` callbacks\n     */\n    loadQueryList(options) {\n        const modelLoader = this.getModelLoader();\n        modelLoader.getModelPromise()\n            .then(() => {\n            this.startQueryListLoading(options);\n        })\n            .catch((error) => {\n            const errorMessage = `Can't load the list of available queries.\\n ${error.message}`;\n            this.throwError({\n                action: EqAction.LoadQueryList,\n                text: errorMessage,\n                sourceError: error\n            });\n        });\n    }\n    startQueryListLoading(options) {\n        options = options || {};\n        const queryStorage = this.getQueryStorage();\n        const queryListLoadingPromise = queryStorage.getQueryList(options);\n        queryListLoadingPromise\n            .then((queries) => {\n            if (options.success) {\n                options.success(queries);\n            }\n        })\n            .catch((error) => {\n            const errorMessage = `Can't load the list of available queries.\\n ${error.message}`;\n            if (options.error) {\n                options.error(errorMessage, 'LoadQueryList');\n            }\n            else {\n                this.throwError({\n                    action: EqAction.LoadQueryList,\n                    text: errorMessage,\n                    sourceError: error\n                });\n            }\n        });\n    }\n    /**\n     * Creates a new query and returns its content back to the client-side.\n     * @param options\n     * The content of the `options` parameter depends on `QueryStorage` implementation.\n     * Usually it contains `success`, `error` callbacks and `silent` option\n     * @example\n     * context.newQuery({\n     *    silent: true\n     * });\n     */\n    newQuery(options) {\n        options = options || {};\n        const clearQuery = typeof options.clearQuery !== 'undefined' ? options.clearQuery : true;\n        this.query.reset(clearQuery);\n        if (options.queryId) {\n            this.query.setId(options.queryId);\n        }\n        if (options.name) {\n            this.query.setName(options.name);\n        }\n        if (options.description) {\n            this.query.setDescription(options.description);\n        }\n        const silent = options.silent || false;\n        let useStorage = true;\n        if (typeof options.useStorage !== 'undefined') {\n            useStorage = options.useStorage;\n        }\n        const onNewQuery = () => {\n            const query = this.getQuery();\n            query.isNewbie = true;\n            if (!silent) {\n                query.fireChangedEvent({\n                    part: QueryChangePart.All,\n                    wasModified: query.isModified()\n                });\n            }\n        };\n        if (useStorage) {\n            this.startProcess({\n                action: EqAction.NewQuery,\n                text: 'New query creation...'\n            }, WidgetGroup.Query);\n            const queryStorage = this.getQueryStorage();\n            queryStorage.newQuery(options)\n                .then((queryData) => {\n                if (queryData) {\n                    this.query.loadFromData(queryData);\n                }\n                this.endProcess({\n                    result: EqActionResult.Success,\n                    action: EqAction.NewQuery,\n                    text: 'A new query has been created'\n                }, WidgetGroup.Query);\n                onNewQuery();\n                if (options.success) {\n                    options.success();\n                }\n            })\n                .catch((error) => {\n                const errorMessage = `Can't create a new query.\\n${error.message}`;\n                this.endProcess({\n                    result: EqActionResult.Error,\n                    action: EqAction.NewQuery,\n                    text: errorMessage,\n                    sourceError: error\n                }, WidgetGroup.Query);\n                if (options.error) {\n                    options.error(errorMessage, \"NewQuery\");\n                }\n            });\n        }\n        else {\n            onNewQuery();\n        }\n        return this.query;\n    }\n    /**\n     * Saves the current query to some storage on the server-side.\n     * @param options\n     * The content of the `options` parameter depends on `QueryStorage` implementation.\n     * Usually it contains `success` and `error` callbacks\n     */\n    saveQuery(options) {\n        options = options || {};\n        const query = this.getQuery();\n        this.startProcess({\n            action: EqAction.SaveQuery,\n            text: 'Query saving: ' + query.getId()\n        }, WidgetGroup.Query);\n        const queryStorage = this.getQueryStorage();\n        queryStorage.saveQuery(options)\n            .then((data) => {\n            this.endProcess({\n                action: EqAction.SaveQuery,\n                result: EqActionResult.Success,\n                text: \"Query saved: \" + query.getId()\n            }, WidgetGroup.Query);\n            if (data) {\n                query.loadFromData(data);\n            }\n            query.resetModified();\n            query.isNewbie = false;\n            if (options.success) {\n                options.success();\n            }\n        })\n            .catch((error) => {\n            const errorMessage = `Can't save query ${query.getId()}.\\n ${error.message}`;\n            this.endProcess({\n                action: EqAction.SaveQuery,\n                result: EqActionResult.Error,\n                text: errorMessage,\n                sourceError: error\n            }, WidgetGroup.Query);\n            if (options.error) {\n                options.error(errorMessage, EqAction.SaveQuery);\n            }\n        });\n    }\n    /**\n     * Removes the current query from some storage on the server-side.\n     * @param options\n     * The content of the `options` parameter depends on `QueryStorage` implementation.\n     * Usually it contains `success` and `error` callbacks\n     */\n    removeQuery(options) {\n        options = options || {};\n        const query = this.getQuery();\n        this.startProcess({\n            action: EqAction.RemoveQuery,\n            text: 'Query deleting: ' + query.getId()\n        }, WidgetGroup.Query);\n        const queryStorage = this.getQueryStorage();\n        queryStorage.removeQuery(options)\n            .then(() => {\n            query.reset();\n            this.endProcess({\n                action: EqAction.RemoveQuery,\n                result: EqActionResult.Success,\n                text: \"Query deleted: \" + query.getId()\n            }, WidgetGroup.Query);\n            if (options.success) {\n                options.success();\n            }\n        })\n            .catch((error) => {\n            const errorMessage = `Can't remove query ${query.getId()}.\\n ${error.message}`;\n            this.endProcess({\n                action: EqAction.RemoveQuery,\n                result: EqActionResult.Error,\n                text: errorMessage,\n                sourceError: error\n            }, WidgetGroup.Query);\n            if (options.error) {\n                options.error(errorMessage, 'RemoveQuery');\n            }\n        });\n    }\n    /**\n     * Syncronizes the current query.\n     * @param options\n     * The content of the `options` parameter depends on `QuerySyncronizer` implementation.\n     * Usually it contains `success` and `error` callbacks\n     */\n    syncQuery(options) {\n        options = options || {};\n        const query = this.getQuery();\n        if (this.beforeSyncQuery) {\n            this.beforeSyncQuery(this, options);\n        }\n        this.startProcess({\n            action: EqAction.SyncQuery,\n            text: 'Query syncing: ' + query.getId()\n        }, WidgetGroup.Query);\n        const querySyncrhonizer = this.getQuerySynchronizer();\n        querySyncrhonizer.syncQuery(options)\n            .then((result) => {\n            this.resultStatement = result && result.statement\n                ? result.statement\n                : '';\n            this.fireEvent('syncQuery');\n            this.refreshWidgets(WidgetGroup.Statement);\n            this.endProcess({\n                result: EqActionResult.Success,\n                action: EqAction.SyncQuery,\n                text: 'Query synced: ' + query.getId()\n            }, WidgetGroup.Query);\n            if (result) {\n                if (result.querySaved) {\n                    const q = result.query;\n                    if (q) {\n                        query.setId(q.id);\n                        query.setName(q.name);\n                        query.setDescription(q.desc);\n                        query.extraData = q.extraData;\n                    }\n                    query.resetModified();\n                    this.refreshWidgets(WidgetGroup.QueryStatus);\n                }\n                if (options.success) {\n                    options.success(result);\n                }\n            }\n        })\n            .catch((error) => {\n            const errorMessage = `Can't synchronize query ${query.getId()}.\\n ${error.message}`;\n            this.endProcess({\n                result: EqActionResult.Error,\n                action: EqAction.SyncQuery,\n                text: errorMessage,\n                sourceError: error\n            }, WidgetGroup.Query);\n            if (options.error) {\n                options.error(errorMessage, 'SyncQuery');\n            }\n        });\n    }\n    /**\n     * Fetches the data (usuall by executing current query) and processes the result.\n     * @param options\n     * The `options` parameter in addition to the options defined in FetchDataOptions structure may also contain `success` and `error` callbacks.\n     * @example\n     * context.fetchData({ success: function(result) {\n     *   //do whatever you want with the result\n     * }})\n     *\n     */\n    fetchData(options) {\n        options = options || {};\n        const elasticPaging = typeof (options.elasticPaging) !== 'undefined'\n            ? options.elasticPaging\n            : this.elasticPaging;\n        this.resultTable.elasticChunks = elasticPaging;\n        options.chunk = options.chunk ||\n            {\n                offset: 0,\n                limit: this.resultTable.chunkSize,\n                needTotal: !elasticPaging\n            };\n        if (this.debugMode) {\n            options.debug = 'Fetching the result set. Initial chunk';\n        }\n        if (!this.query.tryValidate({\n            checkExpressions: true\n        })) {\n            return;\n        }\n        //just to support the old way of catching \"group fetch\" operation finish\n        if (options.groupFetchSuccess) {\n            this.afterGroupFetch = options.groupFetchSuccess;\n        }\n        if (this.resultTable.elasticChunks) {\n            options.chunk.limit++;\n        }\n        this.fetchDataChunk(Object.assign(Object.assign({}, options), { success: (result) => {\n                if (result.statement) {\n                    this.resultStatement = result.statement;\n                    this.refreshWidgets(WidgetGroup.Statement);\n                }\n                const aggrCalculator = this.getAggregatesCalculator();\n                aggrCalculator.reset();\n                this.resultContent = result;\n                if (result.resultSet) {\n                    this.resultTable.clear();\n                    this.resultTable.id = this.query.getId();\n                    const resultSet = result.resultSet;\n                    for (const col of resultSet.cols) {\n                        this.resultTable.columns.add(col);\n                    }\n                    if (result.meta && typeof (result.meta.totalRecords) !== 'undefined') {\n                        this.resultTable.setTotal(result.meta.totalRecords);\n                    }\n                    const count = resultSet.rows.length;\n                    if (this.resultTable.elasticChunks && count === options.chunk.limit) {\n                        resultSet.rows.splice(resultSet.rows.length - 1, 1);\n                    }\n                    for (const row of resultSet.rows) {\n                        this.resultTable.addRow(row);\n                    }\n                    if (this.resultTable.elasticChunks) {\n                        this.resultTable['total'] = (count < options.chunk.limit)\n                            ? resultSet.rows.length\n                            : 0;\n                    }\n                    this.resultTable.fireUpdated();\n                }\n                if (options.success) {\n                    options.success(result);\n                }\n            } }));\n    }\n    getQueryFile(options) {\n        const query = this.getQuery();\n        this.startProcess({\n            action: EqAction.GetQueryFile,\n            text: 'Getting query file: ' + query.getId()\n        }, WidgetGroup.Query);\n        const queryFileLoader = this.getQueryFileLoader();\n        queryFileLoader.getQueryFile(options)\n            .then(() => {\n            this.endProcess({\n                result: EqActionResult.Success,\n                action: EqAction.GetQueryFile,\n                text: 'Getting query file: ' + query.getId()\n            }, WidgetGroup.Query);\n            if (options.success) {\n                options.success();\n            }\n        })\n            .catch(error => {\n            const errorMessage = `Can't get file for query ${query.getId()}.\\n ${error.message}`;\n            this.endProcess({\n                result: EqActionResult.Error,\n                action: EqAction.GetQueryFile,\n                text: errorMessage,\n                sourceError: error\n            }, WidgetGroup.Query);\n            if (options.error) {\n                options.error(errorMessage, 'GetQueryFile');\n            }\n        });\n    }\n    uploadQueryFile(options) {\n        const query = this.getQuery();\n        this.startProcess({\n            action: EqAction.UploadQueryFile,\n            text: 'Uploading query file: ' + query.getId()\n        }, WidgetGroup.Query);\n        const queryFileLoader = this.getQueryFileLoader();\n        queryFileLoader.uploadQueryFile(options)\n            .then((data) => {\n            query.loadFromData(data);\n            this.fireEvent('loadQuery');\n            this.refreshWidgets();\n            this.endProcess({\n                result: EqActionResult.Success,\n                action: EqAction.UploadQueryFile,\n                text: 'Uploading query file: ' + query.getId()\n            }, WidgetGroup.Query);\n            if (options.success) {\n                options.success();\n            }\n        })\n            .catch(error => {\n            const errorMessage = `Can't upload a file for query ${query.getId()}.\\n ${error.message}`;\n            this.endProcess({\n                result: EqActionResult.Error,\n                action: EqAction.UploadQueryFile,\n                text: errorMessage,\n                sourceError: error\n            }, WidgetGroup.Query);\n            if (options.error) {\n                options.error(errorMessage, 'UploadQueryFile');\n            }\n        });\n    }\n    fetchDataChunk(options) {\n        const queryId = this.getQuery().getId();\n        let fetchOptions = options || {};\n        fetchOptions.data = fetchOptions.data || {}; // add empty data property for convenience\n        if (this.useStoredQueryOnFetch) {\n            fetchOptions.queryId = this.query.getId();\n        }\n        if (this.beforeFetchData) {\n            this.beforeFetchData(this, fetchOptions);\n        }\n        this.startProcess({\n            action: EqAction.FetchData,\n            text: 'Fetching data for the query: ' + queryId\n        }, WidgetGroup.Result);\n        const dataFetcher = this.getDataFetcher();\n        dataFetcher.fetchData(fetchOptions)\n            .then((result) => {\n            if (result.statement) {\n                this.resultStatement = result.statement;\n            }\n            this.resultContent = result;\n            // we need to call success callback before firing fetchData,\n            // because otherwise, it won't update the result table \n            // in the context before afterFetchData callback is called.\n            if (fetchOptions.success) {\n                fetchOptions.success(result);\n            }\n            this.fireEvent('fetchData');\n            this.endProcess({\n                result: EqActionResult.Success,\n                action: EqAction.FetchData,\n                text: 'Data fetching is finished for the query: ' + queryId\n            }, WidgetGroup.Result);\n        })\n            .catch((error) => {\n            const errorMessage = `Data fetching error for the query ${queryId}. \\n${error.message}`;\n            this.endProcess({\n                result: EqActionResult.Error,\n                action: EqAction.FetchData,\n                text: errorMessage,\n                sourceError: error\n            }, WidgetGroup.Result);\n            if (fetchOptions.error) {\n                fetchOptions.error(errorMessage, EqAction.FetchData);\n            }\n        });\n    }\n    onResultTableUpdate() {\n        const aggrSettings = this.query.getAggregationSettings();\n        const calculator = this.getAggregatesCalculator();\n        if (aggrSettings.needAggrCalculation() && calculator.needRecalculation()) {\n            calculator.calculate({\n                maxLevel: aggrSettings.getGroups().length + 1,\n                resultObtained: (result, level) => {\n                    if (this.afterGroupFetch) {\n                        this.afterGroupFetch(result);\n                    }\n                },\n                errorOccurred: error => {\n                    const errorMessage = `Data fetching error on group level ${error.level} query. \\n${error.message}`;\n                    this.throwError({\n                        action: EqAction.FetchData,\n                        text: errorMessage,\n                        sourceError: error\n                    });\n                }\n            });\n        }\n    }\n    /**\n     * Fetches the data for a drill-down query (if defined) and processes the result.\n     * @param options\n     */\n    fetchDrillDownData(options) {\n        options = options || {};\n        options.chunk = options.chunk ||\n            {\n                offset: 0,\n                limit: this.resultTable.chunkSize,\n                needTotal: true\n            };\n        const query = options.query;\n        const queryId = query.getId();\n        this.startProcess({\n            action: EqAction.FetchData,\n            text: 'DrillDown executing: ' + queryId\n        }, WidgetGroup.Result);\n        const queryExecutor = this.getDataFetcher();\n        queryExecutor.fetchData(options)\n            .then((result) => {\n            this.endProcess({\n                result: EqActionResult.Success,\n                action: EqAction.FetchData,\n                text: 'DrillDown execution error: ' + queryId\n            }, WidgetGroup.Result);\n            if (options.success) {\n                options.success(result);\n            }\n        })\n            .catch((error) => {\n            const errorMessage = `Drill-down data fetching error for query ${queryId}. \\n${error.message}`;\n            this.endProcess({\n                result: EqActionResult.Error,\n                action: EqAction.FetchData,\n                text: errorMessage,\n            }, WidgetGroup.Result);\n            if (options.error) {\n                options.error(errorMessage, 'DrillDown');\n            }\n            else {\n                this.throwError({\n                    action: EqAction.FetchData,\n                    text: errorMessage\n                });\n            }\n        });\n    }\n    /**\n     * Fetches the data for the query defined in this context and exports them to the specified format.\n     * @param options\n     * The content of the `options` parameter depends on `EqExporter` implementation.\n     * Usually it contains `format` property which defines the format of the exported data (e.g. `csv`),\n     * and `success` and `error` callbacks\n     * @example\n     * context.exportResult({\n     *      format: csv\n     * });\n     *\n     */\n    exportResult(options) {\n        let exportOptions = options || {};\n        exportOptions.chunk = exportOptions.chunk || EmptyChunk;\n        exportOptions.data = exportOptions.data || {}; //add data property for convenience\n        if (this.beforeExportResult) {\n            this.beforeExportResult(this, exportOptions);\n        }\n        const format = exportOptions.format;\n        if (format) {\n            const exporter = this.getExporter(format);\n            if (exporter) {\n                const queryId = this.getQuery().getId();\n                if (this.useStoredQueryOnFetch) {\n                    exportOptions.queryId = queryId;\n                }\n                this.startProcess({\n                    action: EqAction.ExportResult,\n                    text: 'Exporting result for query: ' + queryId\n                }, WidgetGroup.Result);\n                const localeSettings = i18n.getLocaleSettings();\n                exportOptions.settings = localeSettings;\n                const aggrSettings = this.query.getAggregationSettings();\n                if (aggrSettings.hasAggregates()\n                    && (aggrSettings.hasGrandTotals() || aggrSettings.hasGroups())) {\n                    exportOptions.aggregates = aggrSettings.saveToData();\n                }\n                exporter.export(exportOptions)\n                    .then((result) => {\n                    this.fireEvent('exportResult');\n                    this.endProcess({\n                        result: EqActionResult.Success,\n                        action: EqAction.ExportResult,\n                        text: `The result set for query [${queryId}] has been successfully exported`\n                    }, WidgetGroup.Result);\n                    if (exportOptions.success) {\n                        exportOptions.success();\n                    }\n                })\n                    .catch((error) => {\n                    const errorMessage = `Error on exporting data for query  ${queryId}. \\n${error.message}`;\n                    this.endProcess({\n                        result: EqActionResult.Error,\n                        action: EqAction.ExportResult,\n                        text: errorMessage,\n                        sourceError: error\n                    }, WidgetGroup.Result);\n                    if (exportOptions.error) {\n                        exportOptions.error(errorMessage, 'ExportResult');\n                    }\n                });\n            }\n            else {\n                console.error('No exporter for this format: ' + format);\n            }\n        }\n    }\n    /**\n     * Initiates the data export process for the query defined in this context.\n     * @param options\n     * The content of the `options` parameter depends on `EqExporter` implementation.\n     * Usually it contains `format` property which defines the format of the exported data (e.g. `csv`),\n     * and `success` and `error` callbacks\n     * @example\n     * context.exportStart({\n     *      format: csv\n     * });\n     *\n     */\n    exportStart(options) {\n        let exportOptions = options || {};\n        exportOptions.chunk = exportOptions.chunk || EmptyChunk;\n        exportOptions.data = exportOptions.data || {}; //add data property for convenience\n        if (this.beforeExportResult) {\n            this.beforeExportResult(this, exportOptions);\n        }\n        const format = exportOptions.format || 'csv';\n        {\n            const queryId = this.getQuery().getId();\n            if (this.useStoredQueryOnFetch) {\n                exportOptions.queryId = queryId;\n            }\n            const localeSettings = i18n.getLocaleSettings();\n            exportOptions.settings = localeSettings;\n            const aggrSettings = this.query.getAggregationSettings();\n            if (aggrSettings.hasAggregates()\n                && (aggrSettings.hasGrandTotals() || aggrSettings.hasGroups())) {\n                exportOptions.aggregates = aggrSettings.saveToData();\n            }\n            const query = exportOptions.query || this.getQuery();\n            const modelId = query.getModel().getId();\n            let requestData = {\n                'settings': exportOptions.settings,\n                'chunk': EmptyChunk\n            };\n            if (typeof (exportOptions.queryId) !== 'undefined') {\n                requestData.queryId = exportOptions.queryId;\n            }\n            else {\n                requestData.query = query.toJSONData();\n            }\n            if (exportOptions.data) {\n                requestData.data = exportOptions.data;\n            }\n            if (exportOptions.options) {\n                requestData.options = exportOptions.options;\n            }\n            const http = this.getServices().getHttpClient();\n            const url = this.resolveEndpoint('ExportStart', { modelId: modelId, format: format });\n            const actionResult = http.post(url, requestData);\n            actionResult\n                .then((responseData) => {\n                this.fireEvent('exportStart');\n                if (exportOptions.success) {\n                    exportOptions.success();\n                }\n                this.startExportStatusCheck(responseData.exportId);\n            })\n                .catch((error) => {\n                const errorMessage = `Error on initating data export for query  ${queryId}. \\n${error.message}`;\n                this.endProcess({\n                    result: EqActionResult.Error,\n                    action: EqAction.ExportResult,\n                    text: errorMessage,\n                    sourceError: error\n                }, WidgetGroup.Result);\n                if (exportOptions.error) {\n                    exportOptions.error(errorMessage, 'ExportResult');\n                }\n            });\n        }\n    }\n    startExportStatusCheck(exportId) {\n        let interval;\n        const checkStatus = () => {\n            const http = this.getServices().getHttpClient();\n            const url = this.resolveEndpoint('ExportStatus', { exportId: exportId });\n            const actionResult = http.get(url);\n            actionResult\n                .then((responseData) => {\n                if (responseData.status === 2) {\n                    clearInterval(interval);\n                    const url = this.resolveEndpoint('ExportGetResult', { exportId: exportId });\n                    const actionResult = http.get(url, { responseType: 'blob' });\n                    const request = actionResult.getRequest();\n                    return actionResult.then((downloadResponseData) => {\n                        const dispositionHeader = request.getXMLHttpRequest().getResponseHeader(\"Content-Disposition\");\n                        const filename = dispositionHeader\n                            ? dispositionHeader.match(/filename=\"?([^\"]*)\"?$/)[1]\n                            : 'export-data';\n                        equtils.downloadFile(downloadResponseData, filename);\n                    });\n                }\n                else if (responseData.status === 3) {\n                    clearInterval(interval);\n                }\n            })\n                .catch((error) => {\n                clearInterval(interval);\n                const errorMessage = `Error on checking data export status for exportId  ${exportId}. \\n${error.message}`;\n                console.error(errorMessage);\n            });\n        };\n        interval = setInterval(() => {\n            checkStatus();\n        }, 3000);\n        //initial check\n        checkStatus();\n    }\n    limitCustomSqlColumns() {\n        if (!this.options.allowCustomExpressions) {\n            this.query.getColumns().forEach(col => {\n                if (col.expr.tag === ExprTag.CustomSql) {\n                    col.enabled = false;\n                }\n            });\n        }\n    }\n    getAttributeTitle(attr) {\n        const format = this.options.attributeFormat;\n        return this.getModel().getAttributeText(attr, format);\n    }\n    getColumnTitle(attr) {\n        const format = this.options.columnTitleFormat || this.options.attributeFormat;\n        return this.getModel().getAttributeText(attr, format);\n    }\n    getDefaultColumnCaption(column) {\n        let attr;\n        const model = this.getModel();\n        switch (column.expr.tag) {\n            case ExprTag.Constant:\n                return \"Contant Column\";\n            case ExprTag.CustomSql:\n                return \"SQL Column\";\n            case ExprTag.ParentColumn:\n                return \"Parent Column\";\n            case ExprTag.Query:\n                return \"Query Column\";\n            case ExprTag.EntityAttribute:\n            case ExprTag.ParentEntityAttribute:\n                attr = model.getAttributeById(column.expr.value);\n                return this.getColumnTitle(attr);\n            case ExprTag.AggregateFunction:\n                attr = model.getAttributeById(column.expr.args[0].value);\n                return this.getColumnTitle(attr) + ' ' + model.getAggrFunctionCaption(column.expr.func);\n            default:\n                return 'Column';\n        }\n    }\n}\n\nlet eqContextResolver;\nfunction registerEqContextResolver(resolver) {\n    eqContextResolver = resolver;\n}\nfunction createEqContext() {\n    if (!eqContextResolver) {\n        throw Error('No context resolver');\n    }\n    return eqContextResolver();\n}\n\nregisterEqContextResolver(() => new EqContext());\n\nvar eqconsts;\n(function (eqconsts) {\n    /**\n     * Defines some commonly used constants\n     */\n    class ConstLists {\n        constructor() {\n            /**\n             * Contains macros for the special dates (like Today, First day of the month, etc)\n             */\n            this.SpecDateValues = [\n                { id: '${Today}', key: 'Today', isDefault: true },\n                { id: '${Yesterday}', key: 'Yesterday' },\n                { id: '${Tomorrow}', key: 'Tomorrow' },\n                { id: '${FirstDayOfMonth}', key: 'FirstDayOfMonth' },\n                { id: '${FirstDayOfYear}', key: 'FirstDayOfYear' }\n            ];\n            /**\n             * Contains macros for the special times (like Now, Noon, etc)\n             */\n            this.SpecTimeValues = [\n                { id: '${Now}', key: 'Now', isDefault: true },\n                { id: '${HourStart}', key: 'HourStart' },\n                { id: '${Midnight}', key: 'Midnight' },\n                { id: '${Noon}', key: 'Noon' }\n            ];\n            /**\n             * Boolean values macros (true and false)\n             */\n            this.BooleanValues = [\n                { id: '${false}', key: 'False' },\n                { id: '${true}', key: 'True', isDefault: true }\n            ];\n        }\n    }\n    /**\n     * Contains some constants (macros) with special date/time and boolean values.\n     */\n    eqconsts.constLists = new ConstLists();\n    /**\n     * Constants representing various types of relationships between conditions\n     */\n    eqconsts.predicateLinkTypeList = [\n        { id: 'All', key: 'LinkTypeAll' },\n        { id: 'Any', key: 'LinkTypeAny' },\n        { id: 'None', key: 'LinkTypeNone' },\n        { id: 'NotAll', key: 'LinkTypeNotAll' }\n    ];\n})(eqconsts || (eqconsts = {}));\n\n/**\n * Represents Google data table class\n */\nclass GoogleDataConverter {\n    /**\n     * The default constructor.\n     * @param data The table instance or its JSON representation.\n     */\n    constructor(data) {\n        if (!data) {\n            data = {\n                cols: [],\n                rows: []\n            };\n        }\n        if (typeof data === \"string\") {\n            this.loadFromJSON(data);\n        }\n        else {\n            this.tableObj = data;\n        }\n    }\n    /**\n     * Loads data table from JSON.\n     * @param json The JSON representation.\n     */\n    loadFromJSON(json) {\n        this.tableObj = JSON.parse(json);\n    }\n    /**\n     * Saves data table to JSON.\n     * @returns The JSON representation.\n     */\n    toJSON() {\n        return JSON.stringify(this.tableObj);\n    }\n    /**\n     * Gets the google data table object.\n     * @returns The data table.\n     */\n    getObject() {\n        return this.tableObj;\n    }\n    /**\n     * Cheks wether the table is empty\n     * @returns `true` if the table is empty, `false` if it is not.\n     */\n    isEmpty() {\n        return this.getNumberOfColumns() == 0 || this.getNumberOfRows() == 0;\n    }\n    /**\n     * Gets the number of columns\n     * @returns The number.\n     */\n    getNumberOfColumns() {\n        return this.tableObj.cols.length;\n    }\n    /**\n     * Gets the column object.\n     * @param colIndex The column index.\n     * @returns The column object.\n     */\n    getColumnObject(colIndex) {\n        return colIndex < this.tableObj.cols.length ? this.tableObj.cols[colIndex] : null;\n    }\n    /**\n     * Gets the column ID.\n     * @param colIndex The column index.\n     * @returns The column ID.\n     */\n    getColumnId(colIndex) {\n        var col = this.getColumnObject(colIndex);\n        return col ? col.id : null;\n    }\n    /**\n     * Gets the column LABEL.\n     * @param colIndex The column index.\n     * @returns The column ID.\n     */\n    getColumnLabel(colIndex) {\n        var col = this.getColumnObject(colIndex);\n        return col ? col.label : null;\n    }\n    /**\n     *  Gets the column type.\n     * @param colIndex The column index.\n     * @returns The column type.\n     */\n    getColumnType(colIndex) {\n        var col = this.getColumnObject(colIndex);\n        return col ? col.type : null;\n    }\n    /**\n     * Gets the column properties.\n     * @param colIndex The column index.\n     * @returns The column properties.\n     */\n    getColumnProperties(colIndex) {\n        var col = this.getColumnObject(colIndex);\n        return col ? col.p : null;\n    }\n    /**\n     * Gets the number of rows.\n     * @returns The number.\n     */\n    getNumberOfRows() {\n        return this.tableObj.rows.length;\n    }\n    convertValue(value, colIndex) {\n        const colType = this.googleDataTypeToDataType(this.getColumnType(colIndex));\n        if ([DataType.Date, DataType.DateTime, DataType.Time].includes(colType)) {\n            // return eval(`new ${value}`)\n            return new Function(value, 'return new value');\n        }\n        return value;\n    }\n    /**\n     *  Gets the value.\n     * @param rowIndex\n     * @param colIndex\n     */\n    getValue(rowIndex, colIndex) {\n        const row = rowIndex < this.tableObj.rows.length ? this.tableObj.rows[rowIndex] : null;\n        if (row) {\n            const cell = colIndex < this.tableObj.cols.length ? row.c[colIndex] : null;\n            if (cell) {\n                return this.convertValue(cell.v, colIndex);\n            }\n        }\n        return null;\n    }\n    getRow(rowIndex) {\n        const googleRow = rowIndex < this.tableObj.rows.length ? this.tableObj.rows[rowIndex] : null;\n        const googleCells = googleRow.c;\n        const row = googleCells.map((obj, idx) => this.convertValue(obj.v, idx), this);\n        return row;\n    }\n    convertTo(dataTable) {\n        const colCount = this.getNumberOfColumns();\n        for (let i = 0; i < colCount; i++) {\n            dataTable.columns.add({\n                id: this.getColumnId(i),\n                label: this.getColumnLabel(i),\n                type: this.googleDataTypeToDataType(this.getColumnType(i))\n            });\n        }\n        const rowCount = this.getNumberOfRows();\n        for (let i = 0; i < rowCount; i++) {\n            dataTable.addRow(this.getRow(i));\n        }\n    }\n    googleDataTypeToDataType(googleDataType) {\n        switch (googleDataType) {\n            case 'string':\n                return DataType.String;\n            case 'number':\n                return DataType.Float;\n            case 'boolean':\n                return DataType.Bool;\n            case 'date':\n                return DataType.Date;\n            case 'datetime':\n                return DataType.DateTime;\n            case 'timeofday':\n                return DataType.Time;\n            default:\n                return DataType.String;\n        }\n    }\n}\n\nclass InMemoryModelStorage {\n    constructor(models) {\n        this.models = [];\n        if (models) {\n            utils.assign(this.models, [], models);\n        }\n    }\n    getModels() {\n        return new Promise((resolve, reject) => {\n            resolve(this.models);\n        });\n    }\n}\n\n/**\n * Represents a widget - a visual element with \"knows\" how to render itself.\n * Some widgets just display some information from the context (like the generated SQL or the result set).\n * Others - allow user to interact with them to define query conditions or columns.\n */\nclass Widget {\n    /**\n     Initializes a new instance of the `Widget` class\n     * @param slot - an HTML element in which we should place our widget.\n     */\n    constructor(slot) {\n        this.slot = slot;\n        this._id = utils.generateId(this.getWidgetType());\n    }\n    get id() {\n        return this._id;\n    }\n    /**\n     * Initializes the widget and assign it to some context\n     * @param context\n     * @param options\n     */\n    init(context, options) {\n        this.context = context;\n    }\n    /**\n     * Returns current context (the one this widget belongs to)\n     */\n    getContext() {\n        return this.context;\n    }\n    /**\n     * Refreshes the widget's content\n     */\n    refresh() {\n        this.refreshCore();\n    }\n    /**\n     * This function is called from `refresh` function.\n     * It does nothing in the base `Widget` class\n     * but can be overridden in derived classes\n     * to implement the functionality specific for a particular widget\n     */\n    refreshCore() {\n    }\n    /**\n     * This function is called on the start of some process this widget participates in.\n     * For example, some widgets can show a spinner or a progress bar\n     * at the beginning of some long process (e.g. model loading).\n     */\n    onProcessStart() {\n        this.onProcessStartCore();\n    }\n    /**\n     * This function is called from `onProcessStart` function.\n     * It does nothing in the base `Widget` class\n     * but can be overridden in derived classes\n     * to implement the functionality specific for a particular widget.\n     */\n    onProcessStartCore() {\n    }\n    /**\n     * This function is called on the end of some process this widget participates in.\n     * For example, some widgets should be updated on model loading\n     * or after the execution of the current query\n     */\n    onProcessEnd() {\n        this.onProcessEndCore();\n    }\n    /**\n     * This function is called from `onProcessEnd` function.\n     * It does nothing in the base `Widget` class\n     * but can be overridden in derived classes\n     * to implement the functionality specific for a particular widget.\n     */\n    onProcessEndCore() {\n    }\n    /**\n     * Returns `true` if the widget belongs to one of the groups specified in the parameter\n     * @param groups\n     */\n    belongsToGroup(groups) {\n        if (typeof groups != 'undefined' && groups != null) {\n            if ((groups & this.group) === 0)\n                return false;\n        }\n        return true;\n    }\n    destroy() {\n        this.destroyCore();\n    }\n    destroyCore() {\n    }\n}\n\nfunction addEasyQueryCoreTexts() {\n    i18n.updateDefaultTexts({\n        NewQueryName: '[New query]',\n        //DateTime macroses\n        Today: 'Today',\n        Yesterday: 'Yesterday',\n        Tomorrow: 'Tomorrow',\n        FirstDayOfMonth: 'First day of the month',\n        LastDayOfMonth: 'Last day of the month',\n        FirstDayOfWeek: 'First day of the week',\n        FirstDayOfYear: 'First day of the year',\n        FirstDayOfNextWeek: 'First day of the next week',\n        FirstDayOfNextMonth: 'First day of the next month',\n        FirstDayOfNextYear: 'First day of the next year',\n        Now: 'Now',\n        HourStart: 'This hour start',\n        Midnight: 'Midnight',\n        Noon: 'Noon',\n        Entities: {},\n        Attributes: {},\n        Operators: {},\n        AggregateFunctions: {}\n    });\n}\naddEasyQueryCoreTexts();\n\nexport { AggrFunction, BrowserQueryStorage, CondTag, Condition, ConditionPart, DataKind, DataModel, DefaultAggregatesCalculator, EasyQueryDataLoader, EmptyChunk, Entity, EntityAttr, EqAction, EqActionResult, EqAggregatesContainer, EqContext, EqEditorTag, EqModelLoader, EqQueryFileLoader, EqServerDataFetcher, EqServerExporter, EqServerModelLoader, EqServerQuerySynchronizer, EqServerValueListResolver, EqServiceProvider, EqValueEditor, ExprTag, Expression, FormatParser, GoogleDataConverter, InMemoryModelStorage, InvalidQueryError, LinkType, Operand, Operator, Query, QueryChangeAction, QueryChangePart, QueryColumn, SortDirection, Tree, Widget, WidgetGroup, createEqContext, eqconsts, equtils, registerEqContextResolver };\n","\n/*\n * EasyData.JS UI v1.5.10\n * Build time: 1/5/2026, 9:15:45 PM\n * Copyright 2020-2026 Korzh.com\n * Licensed under MIT\n */\n\nimport { utils, ColumnAlignment, DataType, i18n, EventEmitter, DataRow, liquid } from '@easydata/core';\n\nvar browserUtils;\n(function (browserUtils) {\n    let _isFirefox = null;\n    let mobileModeChangeHandler;\n    function isIE() {\n        {\n            const ua = navigator.userAgent;\n            return ua.includes('MSIE') || ua.includes('Trident');\n        }\n    }\n    browserUtils.isIE = isIE;\n    function isEdge() {\n        const ua = window.navigator.userAgent;\n        return !isIE() && ua.includes('Edge/');\n    }\n    browserUtils.isEdge = isEdge;\n    function isFirefox() {\n        if (_isFirefox === null) {\n            const ua = navigator.userAgent;\n            _isFirefox = ua.toLowerCase().includes('firefox');\n        }\n        return _isFirefox;\n    }\n    browserUtils.isFirefox = isFirefox;\n    let _detectedIsMobileMode = false;\n    let _isMobileMode = undefined;\n    let detectIsMobileMode = () => {\n        const oldValue = isMobileMode();\n        _detectedIsMobileMode = window.matchMedia('only screen and (max-width: 840px)').matches\n            || window.matchMedia('only screen and (max-height: 420px)').matches;\n        const newValue = isMobileMode();\n        if (newValue !== oldValue && mobileModeChangeHandler) {\n            mobileModeChangeHandler(newValue);\n        }\n    };\n    detectIsMobileMode();\n    window.addEventListener('resize', () => detectIsMobileMode());\n    function isMobileMode() {\n        if (_isMobileMode !== undefined) {\n            return _isMobileMode;\n        }\n        else {\n            return _detectedIsMobileMode;\n        }\n    }\n    browserUtils.isMobileMode = isMobileMode;\n    function setIsMobileMode(value) {\n        const oldValue = isMobileMode();\n        _isMobileMode = value;\n        const newValue = isMobileMode();\n        if (newValue !== oldValue && mobileModeChangeHandler) {\n            mobileModeChangeHandler(newValue);\n        }\n    }\n    browserUtils.setIsMobileMode = setIsMobileMode;\n    function onMobileModeChanged(callback) {\n        mobileModeChangeHandler = callback;\n    }\n    browserUtils.onMobileModeChanged = onMobileModeChanged;\n})(browserUtils || (browserUtils = {}));\n\n/**\n * Wraps all the elements inside \"parent\" by \"wrapper\" element\n * @param parent The element to add wrapper to.\n * @param wrapper The element that will wrap child elements.\n */\nfunction wrapInner(parent, wrapper) {\n    parent.appendChild(wrapper);\n    while (parent.firstChild !== wrapper) {\n        wrapper.appendChild(parent.firstChild);\n    }\n}\n/**\n * Creates ands adds a new [[HTMLElement]] to \"parent\"\n * @param parent The element to add new element to.\n * @param tag Html tag of the new element.\n * @param options The options. In particular, options.cssClass sets the new element class.\n * @returns New element.\n */\nfunction addElement(parent, tag, options) {\n    let element = document.createElement(tag);\n    let opts = options || {};\n    if (opts.cssClass) {\n        element.className = opts.cssClass;\n    }\n    parent.appendChild(element);\n    return element;\n}\n/**\n * Adds css class to the html element.\n * @param element The element to add css class to.\n * @param className The name of the css class to be added.\n */\nfunction addCssClass(element, className) {\n    element.className = (element.className)\n        ? element.className + ' ' + className\n        : className;\n}\n/**\n * Hides the html element.\n * @param element The element to be hidden.\n */\nfunction hideElement(element) {\n    element.style.display = 'none';\n}\n/**\n * Shows the html element.\n * @param element The element to be shown.\n * @param display The value of \"display\" style to be set. Default value is \"block\".\n */\nfunction showElement(element, display) {\n    if (!display) {\n        display = '';\n    }\n    element.style.display = display;\n}\n/**\n * Hides the \"first\" element and shows the \"second\".\n * @param first The element to be hidden.\n * @param second The element to be shown.\n * @param options The options. The following options are applied:\n * - display - the value of \"display\" style to be set. Default value is \"block\"\n * - duration - the duration of fading in and out\n * - complete - the callback to be called when toggle is complete\n */\nfunction toggleVisibility(first, second, options) {\n    if (!options) {\n        options = {};\n    }\n    if (!options.display) {\n        options.display = '';\n    }\n    if (!options.duration) {\n        options.duration = 200;\n    }\n    //TODO: later we need to make it fading in and out\n    hideElement(first);\n    showElement(second, options.display);\n    if (options.complete) {\n        options.complete();\n    }\n}\n/**\n * Checks if element is visible\n * @param element The element to check.\n * @returns `true` if visible, otherwise - `false`.\n */\nfunction isVisible(element) {\n    return element.style.display != 'none'\n        && element.offsetWidth != 0\n        && element.offsetHeight != 0;\n}\nfunction createBrowserEvent(eventName) {\n    var event;\n    if (typeof (Event) === 'function') {\n        event = new Event(eventName);\n    }\n    else {\n        event = document.createEvent('Event');\n        event.initEvent(eventName, true, true);\n    }\n    return event;\n}\nfunction getViewportSize() {\n    const width = Math.max(document.documentElement.clientWidth || 0, window.innerWidth || 0);\n    const height = Math.max(document.documentElement.clientHeight || 0, window.innerHeight || 0);\n    return {\n        width: width,\n        height: height\n    };\n}\nfunction getDocSize() {\n    if (browserUtils.isIE())\n        return getWinSize();\n    const width = Math.max(document.documentElement.clientWidth, document.body.clientWidth || 0);\n    const height = Math.max(document.documentElement.clientHeight, document.body.clientHeight || 0);\n    return {\n        width: width,\n        height: height\n    };\n}\nfunction getScrollPos() {\n    const body = document.body;\n    const docElem = document.documentElement;\n    return {\n        top: window.pageYOffset || docElem.scrollTop || body.scrollTop,\n        left: window.pageXOffset || docElem.scrollLeft || body.scrollLeft\n    };\n}\nfunction getElementAbsolutePos(element) {\n    let res = { x: 0, y: 0 };\n    if (element !== null) {\n        const position = offset(element);\n        res = { x: position.left, y: position.top };\n    }\n    return res;\n}\nfunction offset(element) {\n    const defaultBoundingClientRect = { top: 0, right: 0, bottom: 0, left: 0, width: 0, height: 0 };\n    let box;\n    try {\n        box = element.getBoundingClientRect();\n    }\n    catch (_a) {\n        box = defaultBoundingClientRect;\n    }\n    const body = document.body;\n    const docElem = document.documentElement;\n    const scollPos = getScrollPos();\n    const scrollTop = scollPos.top;\n    const scrollLeft = scollPos.left;\n    const clientTop = docElem.clientTop || body.clientTop || 0;\n    const clientLeft = docElem.clientLeft || body.clientLeft || 0;\n    const top = box.top + scrollTop - clientTop;\n    const left = box.left + scrollLeft - clientLeft;\n    return { top: Math.round(top), left: Math.round(left) };\n}\nfunction getWinSize() {\n    return {\n        width: window.innerWidth,\n        height: window.innerHeight\n    };\n}\nfunction slideDown(target, duration, callback) {\n    target.style.removeProperty('display');\n    let display = window.getComputedStyle(target).display;\n    if (display === 'none')\n        display = 'block';\n    target.style.display = display;\n    let height = target.offsetHeight;\n    target.style.overflow = 'hidden';\n    target.style.height = 0 + 'px';\n    target.style.paddingTop = 0 + 'px';\n    target.style.paddingBottom = 0 + 'px';\n    target.style.marginTop = 0 + 'px';\n    target.style.marginBottom = 0 + 'px';\n    target.offsetHeight;\n    target.style.boxSizing = 'border-box';\n    target.style.transitionProperty = \"height, margin, padding\";\n    target.style.transitionDuration = duration + 'ms';\n    target.style.height = height + 'px';\n    target.style.removeProperty('padding-top');\n    target.style.removeProperty('padding-bottom');\n    target.style.removeProperty('margin-top');\n    target.style.removeProperty('margin-bottom');\n    window.setTimeout(() => {\n        target.style.removeProperty('height');\n        target.style.removeProperty('overflow');\n        target.style.removeProperty('transition-duration');\n        target.style.removeProperty('transition-property');\n        target.style.removeProperty('box-sizing');\n        if (callback) {\n            callback();\n        }\n    }, duration);\n}\nfunction slideUp(target, duration, callback) {\n    target.style.transitionProperty = 'height, margin, padding';\n    target.style.transitionDuration = duration + 'ms';\n    target.style.boxSizing = 'border-box';\n    target.style.height = target.offsetHeight + 'px';\n    target.offsetHeight;\n    target.style.overflow = 'hidden';\n    target.style.height = 0 + 'px';\n    target.style.paddingTop = 0 + 'px';\n    target.style.paddingBottom = 0 + 'px';\n    target.style.marginTop = 0 + 'px';\n    target.style.marginBottom = 0 + 'px';\n    window.setTimeout(() => {\n        target.style.display = 'none';\n        target.style.removeProperty('height');\n        target.style.removeProperty('padding-top');\n        target.style.removeProperty('padding-bottom');\n        target.style.removeProperty('margin-top');\n        target.style.removeProperty('margin-bottom');\n        target.style.removeProperty('overflow');\n        target.style.removeProperty('transition-duration');\n        target.style.removeProperty('transition-property');\n        target.style.removeProperty('box-sizing');\n        if (callback) {\n            callback();\n        }\n    }, duration);\n}\nconst eqCssPrefix = 'eqjs';\nconst eqCssMobile = 'eqjs-mobile';\nfunction getMobileCssClass() {\n    return browserUtils.isMobileMode() ? 'k-mobile' : null;\n}\n\nfunction mask(input, maskPattern) {\n    const d = { 9: '[0-9]', a: '[a-z]' };\n    const mask = maskPattern.split('');\n    const keyDownHandler = (e) => {\n        // backspace key or delete key\n        if (e.keyCode === 8 || e.keyCode === 46) {\n            e.preventDefault();\n            let mskd = [];\n            let startSelection = input.selectionStart;\n            if (startSelection == 0)\n                return;\n            let selection = startSelection;\n            let onlyLodash = true;\n            for (let index = mask.length - 1; index >= 0; index--) {\n                const el = mask[index];\n                if (d[el]) {\n                    let t = new RegExp(d[el], 'i').test(input.value.charAt(index));\n                    if (t && index != startSelection - 1) {\n                        onlyLodash = false;\n                    }\n                    if (index === startSelection - 1)\n                        selection--;\n                    mskd.push(t && index != startSelection - 1\n                        ? input.value.charAt(index)\n                        : '_');\n                }\n                else {\n                    if (index === selection - 1)\n                        selection--;\n                    if (startSelection - 1 === index)\n                        startSelection--;\n                    mskd.push(el);\n                }\n            }\n            input.value = !onlyLodash ? mskd.reverse().join('') : '';\n            input.selectionStart = input.selectionEnd = selection < 0 ? 0 : selection;\n            const event = document.createEvent('Event');\n            event.initEvent('input', true, true);\n            input.dispatchEvent(event);\n        }\n    };\n    const keyPressHandler = (e) => {\n        const char = String.fromCharCode(e.charCode);\n        if (char) {\n            e.preventDefault();\n            let mskd = [];\n            let selectionStart = input.selectionStart;\n            let selection = selectionStart;\n            mask.forEach((el, index) => {\n                if (d[el]) {\n                    const ch = (index != selectionStart)\n                        ? input.value.charAt(index)\n                        : char;\n                    let t = new RegExp(d[el], 'i').test(ch);\n                    mskd.push(t ? ch : '_');\n                    if (t && selectionStart === index)\n                        selection++;\n                }\n                else {\n                    mskd.push(el);\n                    if (selection === index)\n                        selection++;\n                    if (selectionStart === index)\n                        selectionStart++;\n                }\n            });\n            input.value = mskd.join('');\n            input.selectionStart = input.selectionEnd = selection;\n            const event = document.createEvent('Event');\n            event.initEvent('input', true, true);\n            input.dispatchEvent(event);\n        }\n    };\n    const inputHandler = (e) => {\n        if (e.type === 'focus' && input.value !== '')\n            return;\n        let mskd = [];\n        let startSelection = input.selectionStart;\n        mask.forEach((el, index) => {\n            if (d[el]) {\n                let t = new RegExp(d[el], 'i').test(input.value.charAt(index));\n                mskd.push(t ? input.value.charAt(index) : '_');\n            }\n            else {\n                mskd.push(el);\n            }\n        });\n        input.value = mskd.join('');\n        input.selectionStart = input.selectionEnd = startSelection;\n    };\n    input.addEventListener('keydown', keyDownHandler);\n    input.addEventListener('keypress', keyPressHandler);\n    input.addEventListener('input', inputHandler);\n    input.addEventListener('focus', inputHandler);\n}\n\nclass DomElementBuilder {\n    constructor(tag, parent) {\n        if (typeof tag === \"string\") {\n            this.element = document.createElement(tag);\n        }\n        else {\n            this.element = tag;\n        }\n        if (parent && this.element.parentElement !== parent) {\n            parent.appendChild(this.element);\n        }\n    }\n    addChild(tag, childBuilder) {\n        const builder = domel(tag, this.element);\n        if (childBuilder) {\n            childBuilder(builder);\n        }\n        return this;\n    }\n    addChildElement(element) {\n        if (element) {\n            this.element.appendChild(element);\n        }\n        return this;\n    }\n    attr(attrId, attrValue) {\n        this.element.setAttribute(attrId, attrValue);\n        return this;\n    }\n    id(value) {\n        return this.attr(\"id\", value);\n    }\n    focus() {\n        this.element.focus();\n        return this;\n    }\n    title(value) {\n        return this.attr('title', value);\n    }\n    data(dataId, dataValue = null) {\n        if (dataValue === null) {\n            this.element.removeAttribute('data-' + dataId);\n            return this;\n        }\n        else {\n            return this.attr('data-' + dataId, dataValue);\n        }\n    }\n    show() {\n        return this.removeStyle('display');\n    }\n    hide(toHide = true) {\n        return (toHide) ? this.setStyle('display', 'none') : this;\n    }\n    visible(isVisible = true) {\n        return isVisible ? this.setStyle('visibility', 'visible') : this.setStyle('visibility', 'hidden');\n    }\n    isVisible() {\n        return !!(this.element.offsetWidth || this.element.offsetHeight || this.element.getClientRects().length);\n    }\n    addClass(className, ...classNames) {\n        if (className) {\n            const fullList = [...className.trim().split(\" \"), ...classNames];\n            for (let i = 0; i < fullList.length; i++)\n                this.element.classList.add(fullList[i]);\n        }\n        return this;\n    }\n    removeClass(className, ...classNames) {\n        if (className) {\n            const fullList = [...className.trim().split(\" \"), ...classNames];\n            for (let i = 0; i < fullList.length; i++)\n                this.element.classList.remove(fullList[i]);\n        }\n        return this;\n    }\n    toggleClass(className, force = undefined) {\n        if (className) {\n            this.element.classList.toggle(className, force);\n        }\n        return this;\n    }\n    on(eventType, listener) {\n        const eventTypes = eventType.split(' ');\n        for (let i = 0; i < eventTypes.length; i++) {\n            this.element.addEventListener(eventTypes[i], listener);\n        }\n        return this;\n    }\n    off(eventType, listener) {\n        const eventTypes = eventType.split(' ');\n        for (let i = 0; i < eventTypes.length; i++) {\n            this.element.removeEventListener(eventTypes[i], listener);\n        }\n        return this;\n    }\n    setStyle(styleId, styleValue) {\n        this.element.style.setProperty(styleId, styleValue);\n        return this;\n    }\n    removeStyle(styleId) {\n        this.element.style.removeProperty(styleId);\n        return this;\n    }\n    text(text) {\n        this.element.innerText = text;\n        return this;\n    }\n    html(html) {\n        this.element.innerHTML = html;\n        return this;\n    }\n    clear() {\n        const oldElem = this.element;\n        this.element = document.createElement(this.element.tagName);\n        oldElem.replaceWith(this.element);\n    }\n    addText(text) {\n        const textEl = document.createTextNode(text);\n        this.element.appendChild(textEl);\n        return this;\n    }\n    addHtml(html) {\n        this.element.innerHTML += html;\n        return this;\n    }\n    toDOM() {\n        return this.element;\n    }\n    appendTo(parent) {\n        if (parent) {\n            parent.appendChild(this.element);\n        }\n        return this;\n    }\n}\nclass DomTextAreaElementBuilder extends DomElementBuilder {\n    constructor(element, parent) {\n        if (element) {\n            super(element, parent);\n        }\n        else {\n            super(\"textarea\", parent);\n        }\n    }\n    name(value) {\n        this.element.name = value;\n        return this;\n    }\n    rows(rows) {\n        this.element.rows = rows;\n        return this;\n    }\n    cols(cols) {\n        this.element.cols = cols;\n        return this;\n    }\n    value(value) {\n        this.element.value = value;\n        return this;\n    }\n}\nclass DomInputElementBuilder extends DomElementBuilder {\n    constructor(element, parent) {\n        if (element) {\n            super(element, parent);\n        }\n        else {\n            super(\"input\", parent);\n        }\n    }\n    name(value) {\n        this.element.name = value;\n        return this;\n    }\n    type(value) {\n        this.element.type = value;\n        return this;\n    }\n    size(value) {\n        this.element.size = value;\n        return this;\n    }\n    value(value) {\n        if (value instanceof Date) {\n            this.element.valueAsDate = value;\n        }\n        else if (typeof value === \"number\") {\n            this.element.valueAsNumber = value;\n        }\n        else {\n            this.element.value = value;\n        }\n        return this;\n    }\n    mask(maskPattern) {\n        mask(this.element, maskPattern);\n        return this;\n    }\n}\nclass DomSelectElementBuilder extends DomElementBuilder {\n    constructor(element, parent) {\n        if (element) {\n            super(element, parent);\n        }\n        else {\n            super(\"select\", parent);\n        }\n    }\n    addOption(value) {\n        const option = document.createElement('option');\n        if (typeof value === \"string\") {\n            option.value = value;\n            option.innerHTML = value;\n        }\n        else {\n            option.value = value.value;\n            option.innerHTML = value.title || value.value;\n            option.selected = value.selected || false;\n        }\n        this.element.appendChild(option);\n        return this;\n    }\n    value(value) {\n        this.element.value = value;\n        return this;\n    }\n}\nfunction domel(tag, parent) {\n    if (tag === \"div\" || tag instanceof HTMLDivElement) {\n        return new DomElementBuilder(tag, parent);\n    }\n    if (tag === \"span\" || tag instanceof HTMLSpanElement) {\n        return new DomElementBuilder(tag, parent);\n    }\n    else if (tag === \"a\" || tag instanceof HTMLAnchorElement) {\n        return new DomElementBuilder(tag, parent);\n    }\n    else if (tag === \"button\" || tag instanceof HTMLButtonElement) {\n        return new DomElementBuilder(tag, parent);\n    }\n    else if (tag === \"img\" || tag instanceof HTMLImageElement) {\n        return new DomElementBuilder(tag, parent);\n    }\n    else if (tag === \"input\" || tag instanceof HTMLInputElement) {\n        return new DomInputElementBuilder(tag instanceof HTMLInputElement ? tag : null, parent);\n    }\n    else if (tag === \"textarea\" || tag instanceof HTMLTextAreaElement) {\n        return new DomTextAreaElementBuilder(tag instanceof HTMLTextAreaElement ? tag : null, parent);\n    }\n    else if (tag === \"select\" || tag instanceof HTMLSelectElement) {\n        return new DomSelectElementBuilder(tag instanceof HTMLSelectElement ? tag : null, parent);\n    }\n    return new DomElementBuilder(tag, parent);\n}\n\nconst touchEventIsDefined = typeof TouchEvent !== 'undefined';\nvar DropEffect;\n(function (DropEffect) {\n    DropEffect[\"None\"] = \"none\";\n    DropEffect[\"Allow\"] = \"allow\";\n    DropEffect[\"Forbid\"] = \"forbid\";\n})(DropEffect || (DropEffect = {}));\nclass EqDragEvent {\n    constructor(item, dragImage, sourceEvent) {\n        this.dropEffect = DropEffect.Allow;\n        this.pageX = 0;\n        this.pageY = 0;\n        this.item = item;\n        this.dragImage = dragImage;\n        this.data = item.data;\n        this.sourceEvent = sourceEvent;\n        if (sourceEvent && sourceEvent instanceof MouseEvent) {\n            this.pageX = sourceEvent.pageX,\n                this.pageY = sourceEvent.pageY;\n        }\n        if (sourceEvent && touchEventIsDefined && sourceEvent instanceof TouchEvent\n            && sourceEvent.touches[0]) {\n            this.pageX = sourceEvent.touches[0].pageX,\n                this.pageY = sourceEvent.touches[0].pageY;\n        }\n    }\n}\nclass Position {\n    constructor(ev) {\n        if (ev && ev instanceof MouseEvent) {\n            this.x = ev.pageX,\n                this.y = ev.pageY;\n        }\n        if (ev && touchEventIsDefined && ev instanceof TouchEvent && ev.touches[0]) {\n            this.x = ev.touches[0].pageX,\n                this.y = ev.touches[0].pageY;\n        }\n    }\n}\nclass DragManager {\n    constructor() {\n        this.delta = 5;\n        this.draggableItem = null;\n        this.dragImage = null;\n        this.finishedSuccessfully = false;\n        this.mouseDownPosition = null;\n        this.containerDescriptors = [];\n        this.containerDescriptorIndex = -1;\n        this.dropEffect = DropEffect.None;\n        this.classPrefix = 'eqjs-drop';\n        this.DRAG_DISABLED_ATTR = 'drag-disabled';\n    }\n    registerDraggableItem(descriptor) {\n        const element = descriptor.element;\n        if (!element) {\n            throw Error(\"Element in draggle item is null or undefined\");\n        }\n        element.ondragstart = function () {\n            return false;\n        };\n        const detectDragging = (ev) => {\n            if (element.hasAttribute(this.DRAG_DISABLED_ATTR)) {\n                return;\n            }\n            ev.preventDefault();\n            if (ev instanceof MouseEvent) {\n                ev.stopPropagation();\n            }\n            const cursorPosition = new Position(ev);\n            if (Math.abs(cursorPosition.x - this.mouseDownPosition.x) > this.delta\n                || Math.abs(cursorPosition.y - this.mouseDownPosition.y) > this.delta) {\n                startDragging(ev);\n            }\n        };\n        const mouseMoveEventListener = (ev) => {\n            this.mouseMoveDragListener(ev);\n        };\n        const startDragging = (ev) => {\n            ev.preventDefault();\n            ev.stopPropagation();\n            element.removeEventListener('mousemove', detectDragging);\n            element.removeEventListener('touchmove', detectDragging);\n            this.finishedSuccessfully = false;\n            if (descriptor.beforeDragStart)\n                descriptor.beforeDragStart();\n            this.dragImage = domel('div')\n                .setStyle('position', 'absolute')\n                .setStyle('z-index', '65530')\n                .toDOM();\n            document.body.appendChild(this.dragImage);\n            this.dragImage.appendChild(element.cloneNode(true));\n            if (descriptor.renderer) {\n                descriptor.renderer(this.dragImage);\n            }\n            this.dropEffect = DropEffect.None;\n            this.updateCusror(this.dropEffect);\n            this.updateImageClass(this.dropEffect);\n            this.draggableItem = {\n                element: element,\n                scope: descriptor.scope,\n                data: descriptor.data\n            };\n            this.updateDragItemPosition(ev);\n            const event = new EqDragEvent(this.draggableItem, this.dragImage, ev);\n            event.dropEffect = this.dropEffect;\n            if (descriptor.onDragStart) {\n                descriptor.onDragStart(event);\n            }\n            if (this.dropEffect !== event.dropEffect) {\n                this.dropEffect = event.dropEffect;\n                this.updateImageClass(this.dropEffect);\n            }\n            document.addEventListener('mousemove', mouseMoveEventListener, true);\n            document.addEventListener('touchmove', mouseMoveEventListener, true);\n        };\n        const mouseDownListener = (ev) => {\n            if (touchEventIsDefined && ev instanceof TouchEvent) {\n                ev.preventDefault();\n            }\n            this.mouseDownPosition = new Position(ev);\n            element.addEventListener('mousemove', detectDragging);\n            element.addEventListener('touchmove', detectDragging);\n            document.addEventListener('mouseup', mouseUpListener);\n            document.addEventListener('touchend', mouseUpListener);\n        };\n        element.addEventListener('mousedown', mouseDownListener);\n        element.addEventListener('touchstart', mouseDownListener);\n        const mouseUpListener = (ev) => {\n            this.mouseDownPosition = null;\n            element.removeEventListener('mousemove', detectDragging);\n            element.removeEventListener('touchmove', detectDragging);\n            document.removeEventListener('mousemove', mouseMoveEventListener, true);\n            document.removeEventListener('touchmove', mouseMoveEventListener, true);\n            if (this.draggableItem) {\n                endDraggind(ev);\n            }\n        };\n        const endDraggind = (ev) => {\n            try {\n                if (this.containerDescriptorIndex >= 0) {\n                    const dropContDesc = this.containerDescriptors[this.containerDescriptorIndex];\n                    const container = {\n                        element: dropContDesc.element,\n                        scopes: dropContDesc.scopes,\n                        data: dropContDesc.data\n                    };\n                    const event = new EqDragEvent(this.draggableItem, this.dragImage, ev);\n                    try {\n                        if (container.scopes.indexOf(this.draggableItem.scope) >= 0\n                            && this.dropEffect === DropEffect.Allow) {\n                            this.finishedSuccessfully = true;\n                            if (dropContDesc.onDrop) {\n                                dropContDesc.onDrop(container, event);\n                            }\n                        }\n                    }\n                    finally {\n                        if (dropContDesc.onDragLeave) {\n                            dropContDesc.onDragLeave(container, event);\n                        }\n                    }\n                }\n            }\n            finally {\n                try {\n                    const event = new EqDragEvent(this.draggableItem, this.dragImage, ev);\n                    event.data.finishedSuccessfully = this.finishedSuccessfully;\n                    if (descriptor.onDragEnd) {\n                        descriptor.onDragEnd(event);\n                    }\n                }\n                finally {\n                    this.draggableItem = null;\n                    if (this.dragImage && this.dragImage.parentElement) {\n                        this.dragImage.parentElement.removeChild(this.dragImage);\n                    }\n                    this.dragImage = null;\n                    this.finishedSuccessfully = false;\n                    document.removeEventListener('mouseup', mouseUpListener);\n                    document.removeEventListener('touchend', mouseUpListener);\n                }\n            }\n        };\n    }\n    registerDropContainer(descriptor) {\n        const element = descriptor.element;\n        if (!element) {\n            throw Error(\"Element in drop container is null or undefined\");\n        }\n        this.containerDescriptors.push(descriptor);\n    }\n    removeDropContainer(descriptorOrSlot) {\n        const descs = this.containerDescriptors\n            .filter(desc => desc === descriptorOrSlot\n            || desc.element == descriptorOrSlot);\n        if (descs) {\n            for (const desc of descs) {\n                utils.removeArrayItem(this.containerDescriptors, desc);\n            }\n        }\n    }\n    mouseMoveDragListener(ev) {\n        if (ev instanceof MouseEvent) {\n            ev.preventDefault();\n        }\n        ev.stopPropagation();\n        this.updateDragItemPosition(ev);\n        if (this.containerDescriptorIndex == -1) {\n            for (let i = 0; i < this.containerDescriptors.length; i++) {\n                const descriptor = this.containerDescriptors[i];\n                if (this.detectDragEnterEvent(descriptor.element, ev)) {\n                    this.containerDescriptorIndex = i;\n                    break;\n                }\n            }\n            if (this.containerDescriptorIndex >= 0) {\n                this.dragEnterEvent(ev);\n            }\n        }\n        else {\n            const descriptor = this.containerDescriptors[this.containerDescriptorIndex];\n            if (this.detectDragLeaveEvent(descriptor.element, ev)) {\n                this.dragLeaveEvent(ev);\n                this.containerDescriptorIndex = -1;\n            }\n        }\n        if (this.containerDescriptorIndex >= 0) {\n            const descriptor = this.containerDescriptors[this.containerDescriptorIndex];\n            const container = {\n                element: descriptor.element,\n                scopes: descriptor.scopes,\n                data: descriptor.data\n            };\n            if (container.scopes.indexOf(this.draggableItem.scope) >= 0) {\n                const event = new EqDragEvent(this.draggableItem, this.dragImage, ev);\n                event.dropEffect = this.dropEffect;\n                if (descriptor.onDragOver) {\n                    descriptor.onDragOver(container, event);\n                }\n            }\n        }\n    }\n    updateCusror(dropEffect) {\n        switch (dropEffect) {\n            case DropEffect.Allow:\n                this.setCursorStyle(this.dragImage, 'grabbing');\n                break;\n            case DropEffect.Forbid:\n                this.setCursorStyle(this.dragImage, 'no-drop');\n                break;\n            default:\n                this.setCursorStyle(this.dragImage, 'grabbing');\n                break;\n        }\n    }\n    updateImageClass(dropEffect) {\n        this.dragImage.classList.remove(`${this.classPrefix}-allow`);\n        this.dragImage.classList.remove(`${this.classPrefix}-forbid`);\n        this.dragImage.classList.remove(`${this.classPrefix}-none`);\n        switch (dropEffect) {\n            case DropEffect.Allow:\n                this.dragImage.classList.add(`${this.classPrefix}-allow`);\n                break;\n            case DropEffect.None:\n                this.dragImage.classList.add(`${this.classPrefix}-none`);\n                break;\n            case DropEffect.Forbid:\n                this.dragImage.classList.add(`${this.classPrefix}-forbid`);\n                break;\n            default:\n                this.dragImage.classList.add(`${this.classPrefix}-none`);\n                break;\n        }\n    }\n    setCursorStyle(element, cursor) {\n        if (element) {\n            element.style.cursor = cursor;\n            for (let i = 0; i < element.children.length; i++) {\n                this.setCursorStyle(element.children[i], cursor);\n            }\n        }\n    }\n    updateDragItemPosition(ev) {\n        if (this.dragImage) {\n            const pos = new Position(ev);\n            this.dragImage.style.top = (pos.y - this.dragImage.offsetHeight / 2) + 'px';\n            this.dragImage.style.left = (pos.x - this.dragImage.offsetWidth / 2) + 'px';\n        }\n    }\n    dragEnterEvent(ev) {\n        const descriptor = this.containerDescriptors[this.containerDescriptorIndex];\n        const container = {\n            element: descriptor.element,\n            scopes: descriptor.scopes,\n            data: descriptor.data\n        };\n        if (container.scopes.indexOf(this.draggableItem.scope) >= 0) {\n            const event = new EqDragEvent(this.draggableItem, this.dragImage, ev);\n            event.dropEffect = DropEffect.Allow;\n            if (descriptor.onDragEnter) {\n                descriptor.onDragEnter(container, event);\n            }\n            this.dropEffect = event.dropEffect;\n            this.updateCusror(this.dropEffect);\n            this.updateImageClass(this.dropEffect);\n        }\n        else {\n            if (this.dropEffect !== DropEffect.Forbid) {\n                this.dropEffect = DropEffect.None;\n                this.updateCusror(this.dropEffect);\n                this.updateImageClass(this.dropEffect);\n            }\n        }\n    }\n    dragLeaveEvent(ev) {\n        const descriptor = this.containerDescriptors[this.containerDescriptorIndex];\n        const container = {\n            element: descriptor.element,\n            scopes: descriptor.scopes,\n            data: descriptor.data\n        };\n        if (container.scopes.indexOf(this.draggableItem.scope) >= 0) {\n            const event = new EqDragEvent(this.draggableItem, this.dragImage, ev);\n            event.dropEffect = DropEffect.None;\n            if (descriptor.onDragLeave) {\n                descriptor.onDragLeave(container, event);\n            }\n            this.dropEffect = event.dropEffect;\n            this.updateCusror(this.dropEffect);\n            this.updateImageClass(this.dropEffect);\n        }\n    }\n    detectDragEnterEvent(container, ev) {\n        const containerPos = getElementAbsolutePos(container);\n        const pos = new Position(ev);\n        if (pos.y < containerPos.y || pos.y > containerPos.y + container.offsetHeight) {\n            return false;\n        }\n        if (pos.x < containerPos.x || pos.x > containerPos.x + container.offsetWidth) {\n            return false;\n        }\n        return true;\n    }\n    detectDragLeaveEvent(container, ev) {\n        const containerPos = getElementAbsolutePos(container);\n        const pos = new Position(ev);\n        if (pos.y > containerPos.y && pos.y < containerPos.y + container.offsetHeight\n            && pos.x > containerPos.x && pos.x < containerPos.x + container.offsetWidth) {\n            return false;\n        }\n        return true;\n    }\n}\n//global variable\nconst eqDragManager = new DragManager();\n\nvar AutoResizeColumns;\n(function (AutoResizeColumns) {\n    AutoResizeColumns[AutoResizeColumns[\"Always\"] = 0] = \"Always\";\n    AutoResizeColumns[AutoResizeColumns[\"Once\"] = 1] = \"Once\";\n    AutoResizeColumns[AutoResizeColumns[\"Never\"] = 2] = \"Never\";\n})(AutoResizeColumns || (AutoResizeColumns = {}));\n\n//import { CellRendererType } from \"./easy_grid_cell_renderer\";\n//import { GridCellRenderer } from './easy_grid_cell_renderer';\nconst DEFAULT_WIDTH_STRING = 250;\nconst ROW_NUM_WIDTH = 60;\nvar GridColumnAlign;\n(function (GridColumnAlign) {\n    GridColumnAlign[GridColumnAlign[\"NONE\"] = 1] = \"NONE\";\n    GridColumnAlign[GridColumnAlign[\"LEFT\"] = 2] = \"LEFT\";\n    GridColumnAlign[GridColumnAlign[\"CENTER\"] = 3] = \"CENTER\";\n    GridColumnAlign[GridColumnAlign[\"RIGHT\"] = 4] = \"RIGHT\";\n})(GridColumnAlign || (GridColumnAlign = {}));\nfunction MapAlignment(alignment) {\n    switch (alignment) {\n        case ColumnAlignment.Left:\n            return GridColumnAlign.LEFT;\n        case ColumnAlignment.Center:\n            return GridColumnAlign.CENTER;\n        case ColumnAlignment.Right:\n            return GridColumnAlign.RIGHT;\n        default:\n            return GridColumnAlign.NONE;\n    }\n}\nclass GridColumn {\n    constructor(column, grid, isRowNum = false) {\n        this._label = null;\n        this._description = null;\n        //public left: number;\n        this.align = GridColumnAlign.NONE;\n        this.isVisible = true;\n        this.isRowNum = false;\n        this.dataColumn = column;\n        this.grid = grid;\n        const widthOptions = grid.options.columnWidths || {};\n        if (column) {\n            if (column.style.alignment) {\n                this.align = MapAlignment(column.style.alignment);\n            }\n            this.width = (widthOptions && widthOptions[this.type]) ? widthOptions[this.type].default : DEFAULT_WIDTH_STRING;\n            this._description = column.description;\n        }\n        else if (isRowNum) {\n            this.isRowNum = true;\n            this.width = (widthOptions && widthOptions.rowNumColumn) ? widthOptions.rowNumColumn.default : ROW_NUM_WIDTH;\n            this._label = '';\n        }\n    }\n    get label() {\n        return this._label ? this._label : this.isRowNum ? '' : this.dataColumn.label;\n    }\n    ;\n    set label(value) {\n        this._label = this.label;\n    }\n    /** Get column description. */\n    get description() {\n        return this._description;\n    }\n    get type() {\n        return this.dataColumn ? this.dataColumn.type : null;\n    }\n}\nclass GridColumnList {\n    constructor(columnList, grid) {\n        this.items = [];\n        this.grid = grid;\n        this.sync(columnList);\n    }\n    sync(columnList, hasRowNumCol = true) {\n        this.clear();\n        const rowNumCol = new GridColumn(null, this.grid, true);\n        this.add(rowNumCol);\n        if (!hasRowNumCol) {\n            rowNumCol.isVisible = false;\n        }\n        if (columnList) {\n            for (let column of columnList.getItems()) {\n                const col = new GridColumn(column, this.grid);\n                if (this.grid.options.onSyncGridColumn) {\n                    this.grid.options.onSyncGridColumn(col);\n                }\n                this.add(col);\n            }\n        }\n    }\n    get count() {\n        return this.items.length;\n    }\n    add(col) {\n        const index = this.items.length;\n        this.items.push(col);\n        return index;\n    }\n    put(index, col) {\n        if (index >= 0 && index < this.items.length) {\n            this.items[index] = col;\n        }\n    }\n    move(col, newIndex) {\n        let oldIndex = this.items.indexOf(col);\n        if (oldIndex >= 0 && oldIndex != newIndex)\n            utils.moveArrayItem(this.items, oldIndex, newIndex);\n    }\n    get(index) {\n        if (index >= 0 && index < this.items.length) {\n            return this.items[index];\n        }\n        else {\n            return null;\n        }\n    }\n    //    public getIndex(name: string) : number {\n    //        return this.mapper[name];\n    //    }\n    getItems() {\n        return this.items;\n    }\n    removeAt(index) {\n        this.get(index);\n        this.items.splice(index, 1);\n        //delete this.mapper[col.name];\n    }\n    clear() {\n        this.items = [];\n        //this.mapper = {};\n    }\n}\n\nconst cssPrefix$1 = \"keg\";\nconst DFMT_REGEX = /{0:(.*?)}/g;\nvar CellRendererType;\n(function (CellRendererType) {\n    CellRendererType[CellRendererType[\"STRING\"] = 1] = \"STRING\";\n    CellRendererType[CellRendererType[\"NUMBER\"] = 2] = \"NUMBER\";\n    CellRendererType[CellRendererType[\"DATETIME\"] = 3] = \"DATETIME\";\n    CellRendererType[CellRendererType[\"BOOL\"] = 4] = \"BOOL\";\n})(CellRendererType || (CellRendererType = {}));\nconst StringCellRendererDefault = (value, column, cellValueElement, rowElement) => {\n    const text = value ? value.toString().replace(/\\n/g, '\\u21B5 ') : '';\n    cellValueElement.innerText = text;\n    cellValueElement.title = text;\n    if (column.align == GridColumnAlign.NONE) {\n        cellValueElement.classList.add(`${cssPrefix$1}-cell-value-align-left`);\n    }\n};\nconst NumberCellRendererDefault = (value, column, cellValueElement, rowElement) => {\n    let strValue = (value || '').toString();\n    if (typeof value == 'number') {\n        if (column.dataColumn && column.dataColumn.displayFormat\n            && DFMT_REGEX.test(column.dataColumn.displayFormat)) {\n            strValue = column.dataColumn.displayFormat.replace(DFMT_REGEX, (_, $1) => {\n                return i18n.numberToStr(value, $1);\n            });\n        }\n        else {\n            strValue = value.toLocaleString();\n        }\n    }\n    cellValueElement.innerText = strValue;\n    cellValueElement.title = strValue;\n    if (column.align == GridColumnAlign.NONE) {\n        cellValueElement.classList.add(`${cssPrefix$1}-cell-value-align-right`);\n    }\n};\nconst DateTimeCellRendererDefault = (value, column, cellValueElement, rowElement) => {\n    const isDate = Object.prototype.toString.call(value) === '[object Date]';\n    let strValue = (value || '').toString();\n    if (isDate) {\n        if (column.dataColumn && column.dataColumn.displayFormat\n            && DFMT_REGEX.test(column.dataColumn.displayFormat)) {\n            strValue = column.dataColumn.displayFormat.replace(DFMT_REGEX, (_, $1) => {\n                return i18n.dateTimeToStrEx(value, column.type, $1);\n            });\n        }\n        else {\n            const locale = i18n.getCurrentLocale();\n            const timeOptions = { hour: 'numeric', minute: 'numeric', second: 'numeric' };\n            switch (column.type) {\n                case DataType.Date:\n                    strValue = value.toLocaleDateString(locale);\n                    break;\n                case DataType.Time:\n                    strValue = value.toLocaleTimeString(locale, timeOptions);\n                    break;\n                case DataType.DateTime:\n                    strValue = `${value.toLocaleDateString(locale)} ${value.toLocaleTimeString(locale, timeOptions)}`;\n                    break;\n            }\n        }\n    }\n    cellValueElement.innerText = strValue;\n    cellValueElement.title = strValue;\n    if (column.align == GridColumnAlign.NONE) {\n        cellValueElement.classList.add(`${cssPrefix$1}-cell-value-align-right`);\n    }\n};\nconst BoolCellRendererDefault = (value, column, cellValueElement, rowElement) => {\n    if (column.dataColumn && column.dataColumn.displayFormat\n        && DFMT_REGEX.test(column.dataColumn.displayFormat)) {\n        const strValue = column.dataColumn.displayFormat.replace(DFMT_REGEX, (_, $1) => {\n            return i18n.booleanToStr(value, $1);\n        });\n        return StringCellRendererDefault(strValue, column, cellValueElement);\n    }\n    else {\n        cellValueElement.classList.add(`${cssPrefix$1}-cell-value-bool`);\n        cellValueElement.classList.add(`${cssPrefix$1}-${value ? 'cell-value-true' : 'cell-value-false'}`);\n    }\n};\nclass GridCellRendererStore {\n    constructor(options) {\n        this.renderers = {};\n        this.defaultRenderers = {};\n        this.registerRenderer('StringDefault', StringCellRendererDefault);\n        this.setDefaultRenderer(CellRendererType.STRING, StringCellRendererDefault);\n        this.registerRenderer('NumberDefault', NumberCellRendererDefault);\n        this.setDefaultRenderer(CellRendererType.NUMBER, NumberCellRendererDefault);\n        this.registerRenderer('DateTimeDefault', DateTimeCellRendererDefault);\n        this.setDefaultRenderer(CellRendererType.DATETIME, DateTimeCellRendererDefault);\n        this.registerRenderer('BoolDefault', BoolCellRendererDefault);\n        this.setDefaultRenderer(CellRendererType.BOOL, BoolCellRendererDefault);\n    }\n    getDefaultRenderer(columnType) {\n        const cellType = this.getCellType(columnType);\n        return this.defaultRenderers[CellRendererType[cellType]];\n    }\n    getDefaultRendererByType(rendererType) {\n        return this.defaultRenderers[CellRendererType[rendererType]];\n    }\n    setDefaultRenderer(cellType, renderer) {\n        if (renderer) {\n            this.defaultRenderers[CellRendererType[cellType]] = renderer;\n        }\n    }\n    getRenderer(name) {\n        return this.renderers[name];\n    }\n    registerRenderer(name, renderer) {\n        this.renderers[name] = renderer;\n    }\n    getCellType(dataType) {\n        switch (dataType) {\n            case DataType.Autoinc:\n            case DataType.Byte:\n            case DataType.Word:\n            case DataType.Currency:\n            case DataType.Float:\n            case DataType.Int32:\n            case DataType.Int64:\n                return CellRendererType.NUMBER;\n            case DataType.Date:\n            case DataType.DateTime:\n            case DataType.Time:\n                return CellRendererType.DATETIME;\n            case DataType.Bool:\n                return CellRendererType.BOOL;\n            default:\n                return CellRendererType.STRING;\n        }\n    }\n}\n\nconst DEFAULT_ROW_HEIGHT = 36;\n/** Represents a grid widget with columns rows, paging, custom rendering and more */\nclass EasyGrid {\n    /** Creates and initializes all internal properties of the grid object */\n    constructor(options) {\n        this.cssPrefix = \"keg\";\n        this.pagination = { page: 1, pageSize: 30, total: 0 };\n        this.paginationOptions = {\n            maxButtonCount: 10,\n            useBootstrap: false\n        };\n        this.defaultDataGridOptions = {\n            slot: null,\n            dataTable: null,\n            fixHeightOnFirstRender: false,\n            syncGridColumns: true,\n            useRowNumeration: true,\n            allowDragDrop: false,\n            aggregates: {\n                settings: null,\n                calculatorRef: null\n            },\n            paging: {\n                enabled: true,\n                pageSize: 30,\n                pageSizeItems: [20, 30, 50, 100, 200]\n            },\n            columnWidths: {\n                autoResize: AutoResizeColumns.Always,\n                stringColumns: {\n                    min: 100,\n                    max: 500,\n                    default: 250\n                },\n                numberColumns: {\n                    min: 60,\n                    default: 120\n                },\n                boolColumns: {\n                    min: 50,\n                    default: 80\n                },\n                dateColumns: {\n                    min: 80,\n                    default: 200\n                },\n                otherColumns: {\n                    min: 100,\n                    max: 500,\n                    default: 250\n                },\n                rowNumColumn: {\n                    min: 40,\n                    default: 60\n                }\n            },\n            showPlusButton: false,\n            viewportRowsCount: null,\n            showActiveRow: true\n        };\n        this.rowsOnPagePromise = null;\n        this.containerInitialHeight = 0;\n        this.firstRender = true;\n        this.prevRowTotals = null;\n        this.landingIndex = -1;\n        this.landingSlot = domel('div')\n            .addClass(`${this.cssPrefix}-col-landing-slot`)\n            .addChildElement(domel('div')\n            .toDOM())\n            .toDOM();\n        this._activeRowIndex = -1;\n        if (options && options.paging) {\n            options.paging = utils.assign(this.defaultDataGridOptions.paging, options.paging);\n        }\n        this.options = this.mergeOptions(options);\n        this.processColumnWidthsOptions();\n        if (!this.options.slot)\n            throw Error('\"slot\" parameter is required to initialize EasyDataGrid');\n        if (!this.options.dataTable)\n            throw Error('\"dataTable\" parameter is required to initialize EasyDataGrid');\n        this.dataTable = options.dataTable;\n        this.eventEmitter = new EventEmitter(this);\n        this.cellRendererStore = new GridCellRendererStore(options);\n        this.columns = new GridColumnList(this.dataTable.columns, this);\n        this.setSlot(this.options.slot);\n        this.init(this.options);\n    }\n    mergeOptions(options) {\n        const aggrOptions = utils.assignDeep({}, this.defaultDataGridOptions.aggregates, options.aggregates);\n        const colWidthOptions = utils.assignDeep({}, this.defaultDataGridOptions.columnWidths, options.columnWidths);\n        const pagingOptions = utils.assignDeep({}, this.defaultDataGridOptions.paging, options.paging);\n        const result = utils.assign({}, this.defaultDataGridOptions, options);\n        result.aggregates = aggrOptions;\n        result.columnWidths = colWidthOptions;\n        result.paging = pagingOptions;\n        return result;\n    }\n    processColumnWidthsOptions() {\n        const widthOptions = this.options.columnWidths;\n        if (!widthOptions)\n            return;\n        //string columns\n        utils.getStringDataTypes().forEach(dataType => {\n            widthOptions[dataType] = Object.assign(Object.assign({}, widthOptions.stringColumns), widthOptions[dataType]);\n        });\n        //numeric columns\n        utils.getNumericDataTypes().forEach(dataType => {\n            widthOptions[dataType] = Object.assign(Object.assign({}, widthOptions.numberColumns), widthOptions[dataType]);\n        });\n        //bool columns\n        widthOptions[DataType.Bool] = Object.assign(Object.assign({}, widthOptions.boolColumns), widthOptions[DataType.Bool]);\n        //date columns\n        utils.getDateDataTypes().forEach(dataType => {\n            widthOptions[dataType] = Object.assign(Object.assign({}, widthOptions.dateColumns), widthOptions[dataType]);\n        });\n        //other columns\n        const knownTypes = [\n            ...utils.getStringDataTypes(),\n            ...utils.getNumericDataTypes(),\n            ...utils.getDateDataTypes(),\n            DataType.Bool\n        ];\n        utils.getAllDataTypes().forEach(dataType => {\n            if (!(dataType in knownTypes)) {\n                widthOptions[dataType] = Object.assign(Object.assign({}, widthOptions.otherColumns), widthOptions[dataType]);\n            }\n        });\n        widthOptions[DataType.Unknown] = widthOptions.otherColumns;\n    }\n    setSlot(slot) {\n        if (typeof slot === 'string') {\n            if (slot.length) {\n                if (slot[0] === '#') {\n                    this.slot = document.getElementById(slot.substring(1));\n                }\n                else if (slot[0] === '.') {\n                    const result = document.getElementsByClassName(slot.substring(1));\n                    if (result.length)\n                        this.slot = result[0];\n                }\n                else {\n                    throw Error('Unrecognized slot parameter ' +\n                        '(Must be id, class or HTMLElement): ' + slot);\n                }\n            }\n        }\n        else {\n            this.slot = slot;\n        }\n    }\n    /** Initializes grid widget according to the options passed in the parameter */\n    init(options) {\n        if (options.onInit) {\n            this.addEventListener('init', options.onInit);\n        }\n        if (options.onRowClick) {\n            this.addEventListener('rowClick', options.onRowClick);\n        }\n        if (options.onRowDbClick) {\n            this.addEventListener('rowDbClick', options.onRowDbClick);\n        }\n        if (options.onPlusButtonClick) {\n            this.addEventListener('plusButtonClick', options.onPlusButtonClick);\n        }\n        if (options.onColumnChanged) {\n            this.addEventListener('columnChanged', options.onColumnChanged);\n        }\n        if (options.onColumnDeleted) {\n            this.addEventListener('columnDeleted', options.onColumnDeleted);\n        }\n        if (options.onColumnMoved) {\n            this.addEventListener('columnMoved', options.onColumnMoved);\n        }\n        if (options.onPageChanged) {\n            this.addEventListener('pageChanged', options.onPageChanged);\n        }\n        if (options.onActiveRowChanged) {\n            this.addEventListener('activeRowChanged', options.onActiveRowChanged);\n        }\n        this.addEventListener('pageChanged', ev => this.activeRowIndex = -1);\n        utils.assign(this.paginationOptions, options.pagination);\n        this.pagination.pageSize = this.options.paging.pageSize\n            || this.pagination.pageSize;\n        if (this.options.allowDragDrop) {\n            eqDragManager.registerDropContainer({\n                element: this.slot,\n                scopes: [\"gridColumnMove\"],\n                onDragEnter: (_, ev) => {\n                    this.slot.classList.add(`${eqCssPrefix}-drophover`);\n                    this.showLandingSlot(ev.pageX, ev.pageY);\n                },\n                onDragOver: (_, ev) => {\n                    this.showLandingSlot(ev.pageX, ev.pageY);\n                },\n                onDragLeave: (_, ev) => {\n                    ev.dropEffect = DropEffect.Forbid;\n                    this.slot.classList.remove(`${eqCssPrefix}-drophover`);\n                    this.hideLandingSlot();\n                },\n                onDrop: (_, ev) => {\n                    this.dataTable.columns.move(ev.data.column, this.landingIndex);\n                    this.refresh();\n                    this.fireEvent({\n                        type: 'columnMoved',\n                        columnId: ev.data.column.id,\n                        newIndex: this.landingIndex\n                    });\n                }\n            });\n        }\n        this.refresh();\n        this.fireEvent('init');\n    }\n    /** Fires a grid event. You can pass either an event type\n     * (like 'init', 'rowClick', 'pageChanged', etc )\n     * or a ready-to-use grid event object\n     * */\n    fireEvent(event) {\n        if (typeof event === \"string\") {\n            this.eventEmitter.fire(event);\n        }\n        else {\n            this.eventEmitter.fire(event.type, event);\n        }\n    }\n    /** Allows to set the data (represented by a EasyDataTable object)\n     *  or to replace the existing one associated with the grid */\n    setData(data) {\n        this.dataTable = data;\n        this.clear();\n        this.refresh();\n    }\n    /** Returns the EasyDataTable object associated with the grid via `setData()` call */\n    getData() {\n        return this.dataTable;\n    }\n    /** Gets the list of grid columns */\n    getColumns() {\n        return this.columns;\n    }\n    /** This function is called when the grid is destroyed */\n    destroy() {\n        this.slot.innerHTML = \"\";\n    }\n    /** Clears the current DOM object and re-renders everything from the scratch */\n    refresh() {\n        this.clearDOM();\n        this.render();\n    }\n    clearDOM() {\n        this.slot.innerHTML = '';\n    }\n    /** Clears all DOM object in the grid and return it to its initial state */\n    clear() {\n        this.pagination.page = 1;\n        this.clearDOM();\n    }\n    /** Renders the grid */\n    render() {\n        if (!this.hasData() && !this.options.showPlusButton)\n            return;\n        this.containerInitialHeight = this.slot.clientHeight;\n        this.rootDiv = document.createElement('div');\n        this.rootDiv.style.width = '100%';\n        this.rootDiv.classList.add(`${this.cssPrefix}-root`);\n        this.columns.sync(this.dataTable.columns, this.options.useRowNumeration);\n        this.renderHeader();\n        this.rootDiv.appendChild(this.headerDiv);\n        this.renderBody();\n        this.rootDiv.appendChild(this.bodyDiv);\n        this.renderFooter();\n        this.rootDiv.appendChild(this.footerDiv);\n        let gridContainer = document.createElement('div');\n        gridContainer.classList.add(`${this.cssPrefix}-container`);\n        gridContainer.appendChild(this.rootDiv);\n        this.slot.appendChild(gridContainer);\n        const needAutoResize = this.options.columnWidths.autoResize !== AutoResizeColumns.Never;\n        if (this.rowsOnPagePromise) {\n            this.rowsOnPagePromise\n                .then(() => this.updateHeight())\n                .then(() => {\n                this.firstRender = false;\n                this.rowsOnPagePromise = null;\n            });\n        }\n        else {\n            setTimeout(() => {\n                this.updateHeight()\n                    .then(() => {\n                    this.firstRender = false;\n                    if (needAutoResize) {\n                        this.resizeColumns();\n                    }\n                });\n            }, 100);\n        }\n    }\n    updateHeight() {\n        return new Promise((resolve) => {\n            if (this.options.viewportRowsCount) {\n                const firstRow = this.bodyCellContainerDiv.firstElementChild;\n                const rowHeight = firstRow ? firstRow.offsetHeight : DEFAULT_ROW_HEIGHT;\n                const rowCount = this.options.viewportRowsCount; // || DEFAULT_ROW_COUNT;\n                let viewportHeight = rowHeight * rowCount;\n                domel(this.bodyViewportDiv)\n                    .setStyle('height', `${viewportHeight}px`);\n                setTimeout(() => {\n                    const sbHeight = this.bodyViewportDiv.offsetHeight - this.bodyViewportDiv.clientHeight;\n                    viewportHeight = viewportHeight + sbHeight;\n                    domel(this.bodyViewportDiv)\n                        .setStyle('height', `${viewportHeight}px`);\n                    resolve();\n                }, 100);\n                return;\n            }\n            else if (this.containerInitialHeight > 0) ;\n            resolve();\n        })\n            .then(() => {\n            if (this.options.fixHeightOnFirstRender && this.firstRender) {\n                this.slot.style.height = `${this.slot.offsetHeight}px`;\n            }\n        });\n    }\n    getContainerWidth() {\n        return this.columns.getItems()\n            .filter(col => col.isVisible)\n            .map(col => col.width)\n            .reduce((sum, current) => { return sum + current; });\n    }\n    renderHeader() {\n        this.headerDiv = domel('div')\n            .addClass(`${this.cssPrefix}-header`)\n            .toDOM();\n        this.headerViewportDiv = domel('div', this.headerDiv)\n            .addClass(`${this.cssPrefix}-header-viewport`)\n            .toDOM();\n        this.headerCellContainerDiv = domel('div', this.headerViewportDiv)\n            .addClass(`${this.cssPrefix}-header-cell-container`)\n            .toDOM();\n        this.headerRowDiv = domel('div', this.headerCellContainerDiv)\n            .addClass(`${this.cssPrefix}-header-row`)\n            .toDOM();\n        this.columns.getItems().forEach((column, index) => {\n            if (!column.isVisible) {\n                return;\n            }\n            let hd = this.renderColumnHeader(column, index);\n            this.headerRowDiv.appendChild(hd);\n            if (column.isRowNum) {\n                domel(hd)\n                    .addChildElement(this.renderHeaderButtons());\n            }\n        });\n        const containerWidth = this.getContainerWidth();\n        domel(this.headerCellContainerDiv)\n            .setStyle('width', `${containerWidth}px`);\n    }\n    hasData() {\n        return this.dataTable.columns.count > 0;\n    }\n    renderColumnHeader(column, index) {\n        let colBuilder = domel('div')\n            .addClass(`${this.cssPrefix}-header-cell`)\n            .data('col-idx', `${index}`)\n            .setStyle('width', `${column.width}px`);\n        if (column.dataColumn) {\n            colBuilder\n                .data('col-id', `${column.dataColumn.id}`);\n        }\n        let colDiv = colBuilder.toDOM();\n        domel('div', colDiv)\n            .addClass(`${this.cssPrefix}-header-cell-resize`);\n        if (!column.isRowNum) {\n            domel('div', colDiv)\n                .addClass(`${this.cssPrefix}-header-cell-label`)\n                .text(column.label);\n        }\n        if (column.description) {\n            domel('div', colDiv)\n                .addClass('question-mark')\n                .title(column.description);\n        }\n        if (this.options.allowDragDrop) {\n            eqDragManager.registerDraggableItem({\n                element: colDiv,\n                scope: \"gridColumnMove\",\n                data: { column: column },\n                renderer: (dragImage) => {\n                    dragImage.innerHTML = '';\n                    const attrLabel = document.createElement('div');\n                    attrLabel.innerText = column.label;\n                    dragImage.classList.add(`${this.cssPrefix}-sortable-helper`);\n                    dragImage.appendChild(attrLabel);\n                },\n                onDragStart: (ev) => {\n                    ev.dropEffect = DropEffect.Allow;\n                }\n            });\n        }\n        return colDiv;\n    }\n    renderBody() {\n        this.bodyDiv = domel('div')\n            .addClass(`${this.cssPrefix}-body`)\n            .toDOM();\n        this.bodyViewportDiv = domel('div', this.bodyDiv)\n            .addClass(`${this.cssPrefix}-body-viewport`)\n            .attr('tabIndex', '0')\n            .toDOM();\n        this.bodyCellContainerDiv = domel('div', this.bodyViewportDiv)\n            .addClass(`${this.cssPrefix}-cell-container`)\n            .toDOM();\n        const showAggrs = this.canShowAggregates();\n        if (this.dataTable) {\n            this.showProgress();\n            this.rowsOnPagePromise = this.getRowsToRender()\n                .then((rows) => {\n                this.pagination.total = this.dataTable.getTotal();\n                this.hideProgress();\n                //prevent double rendering (bad solution, we have to figure out how to avoid this behavior properly)\n                this.bodyCellContainerDiv.innerHTML = '';\n                this.prevRowTotals = null;\n                let rowsToRender = 0;\n                if (rows.length) {\n                    const groups = showAggrs\n                        ? this.options.aggregates.settings.getGroups()\n                        : [];\n                    rowsToRender = (rows.length < this.pagination.pageSize)\n                        ? rows.length\n                        : this.pagination.pageSize;\n                    rows.forEach((row, index) => {\n                        if (showAggrs)\n                            this.updateTotalsState(groups, row);\n                        //we don't actually render the last row\n                        if (index < rowsToRender) {\n                            const tr = this.renderRow(row, index);\n                            this.bodyCellContainerDiv.appendChild(tr);\n                        }\n                    });\n                    const showGrandTotalsOnEachPage = this.options.aggregates && this.options.aggregates.showGrandTotalsOnEachPage;\n                    if (showAggrs && (this.isLastPage() || showGrandTotalsOnEachPage)) {\n                        const row = new DataRow(this.dataTable.columns, new Array(this.dataTable.columns.count));\n                        this.updateTotalsState(groups, row, true);\n                    }\n                }\n                const needAutoResize = this.options.columnWidths.autoResize !== AutoResizeColumns.Never;\n                if (needAutoResize) {\n                    this.resizeColumns();\n                }\n                else {\n                    const containerWidth = this.getContainerWidth();\n                    domel(this.bodyCellContainerDiv)\n                        .setStyle('width', `${containerWidth}px`);\n                }\n                return rowsToRender;\n            })\n                .catch(error => { console.error(error); return 0; });\n        }\n        this.bodyViewportDiv.addEventListener('scroll', ev => {\n            domel(this.headerViewportDiv)\n                .setStyle('margin-left', `-${this.bodyViewportDiv.scrollLeft}px`);\n        });\n        this.bodyViewportDiv.addEventListener('keydown', this.onViewportKeydown.bind(this));\n    }\n    isLastPage() {\n        if (this.dataTable.elasticChunks) {\n            return this.dataTable.totalIsKnown()\n                && (this.pagination.page * this.pagination.pageSize) >= this.pagination.total;\n        }\n        return this.pagination.page * this.pagination.pageSize >= this.pagination.total;\n    }\n    canShowAggregates() {\n        if (!this.options || !this.options.aggregates || !this.options.aggregates.settings)\n            return false;\n        const aggrSettings = this.options.aggregates.settings;\n        const result = (aggrSettings.hasAggregates() || aggrSettings.hasRecordCount())\n            && (aggrSettings.hasGroups() || aggrSettings.hasGrandTotals());\n        return result;\n    }\n    updateTotalsState(groups, newRow, isLast = false) {\n        const aggrSettings = this.options.aggregates.settings;\n        if (this.prevRowTotals && aggrSettings.hasGroups()) {\n            let changeLevel = -1;\n            for (let level = 1; level <= groups.length; level++) {\n                const group = groups[level - 1];\n                for (const col of group.columns) {\n                    if (!aggrSettings.compareValues(this.prevRowTotals.getValue(col), newRow.getValue(col))) {\n                        changeLevel = level;\n                        break;\n                    }\n                }\n                if (changeLevel !== -1)\n                    break;\n            }\n            if (changeLevel !== -1) {\n                for (let level = groups.length; level >= changeLevel; level--) {\n                    const row = new DataRow(this.dataTable.columns, this.prevRowTotals.toArray());\n                    const tr = this.renderTotalsRow(level, row);\n                    this.bodyCellContainerDiv.appendChild(tr);\n                }\n            }\n        }\n        if (isLast && aggrSettings.hasGrandTotals() && aggrSettings.hasAggregates()) {\n            const tr = this.renderTotalsRow(0, newRow);\n            this.bodyCellContainerDiv.appendChild(tr);\n        }\n        this.prevRowTotals = newRow;\n    }\n    applyGroupColumnTemplate(template, value, count) {\n        let result = template.replace(/{{\\s*GroupValue\\s*}}/g, value ? `${value}` : '-');\n        result = result.replace(/{{\\s*GroupCount\\s*}}/g, count ? `${count}` : '-');\n        return result;\n    }\n    renderTotalsRow(level, row) {\n        const aggrSettings = this.options.aggregates.settings;\n        const group = (level > 0)\n            ? aggrSettings.getGroups()[level - 1]\n            : { columns: [], aggregates: aggrSettings.getAggregates() };\n        const rowBuilder = domel('div')\n            .addClass(`${this.cssPrefix}-row`)\n            .addClass(`${this.cssPrefix}-row-totals`)\n            .addClass(`${this.cssPrefix}-totals-lv${level}`)\n            .data('totals-level', `${level}`)\n            .attr('tabindex', '-1');\n        const rowElement = rowBuilder.toDOM();\n        this.columns.getItems().forEach((column, index) => {\n            if (!column.isVisible) {\n                return;\n            }\n            let val = '';\n            const colIndex = !column.isRowNum\n                ? this.dataTable.columns.getIndex(column.dataColumn.id)\n                : -1;\n            if (!column.isRowNum && column.dataColumn) {\n                if (group.columns.indexOf(column.dataColumn.id) >= 0) {\n                    val = row.getValue(colIndex);\n                }\n            }\n            if (colIndex == this.dataTable.columns.count - 1) {\n                val = '.  .  .  .  .  .';\n            }\n            rowElement.appendChild(this.renderCell(column, index, val, rowElement));\n        });\n        const aggrContainer = this.options.aggregates.calculatorRef.getAggrContainer();\n        const aggrCols = aggrSettings.getAggregates().map(c => c.colId);\n        const key = aggrSettings.buildGroupKey(group, row);\n        aggrContainer.getAggregateData(level, key)\n            .then((values) => {\n            for (const aggrColId of aggrCols) {\n                row.setValue(aggrColId, values[aggrColId]);\n            }\n            rowElement.innerHTML = '';\n            this.columns.getItems().forEach((column, index) => {\n                if (!column.isVisible) {\n                    return;\n                }\n                let val = '';\n                const colIndex = !column.isRowNum\n                    ? this.dataTable.columns.getIndex(column.dataColumn.id)\n                    : -1;\n                if (!column.isRowNum) {\n                    let isLastGroupColumn = false;\n                    if (column.dataColumn) {\n                        const groupColIndex = group.columns.indexOf(column.dataColumn.id);\n                        const aggrColIndex = aggrCols.indexOf(column.dataColumn.id);\n                        if (level > 0) {\n                            isLastGroupColumn = groupColIndex == group.columns.length - 1;\n                        }\n                        else {\n                            //if it's a grand total row consider first column as the last group column\n                            isLastGroupColumn = colIndex == 0;\n                        }\n                        if (groupColIndex >= 0 || aggrColIndex >= 0) {\n                            val = row.getValue(colIndex);\n                        }\n                    }\n                    let groupFooterTemplate = '';\n                    if (level > 0) {\n                        groupFooterTemplate = column.dataColumn.groupFooterColumnTemplate;\n                        //set the default template for the last grouping column\n                        if (!groupFooterTemplate && aggrSettings.hasRecordCount() && isLastGroupColumn) {\n                            groupFooterTemplate = '{{GroupValue}} ({{GroupCount}})';\n                        }\n                    }\n                    if (groupFooterTemplate) {\n                        const cellDiv = this.renderCell(column, index, val, rowElement);\n                        const innerCell = cellDiv.firstChild;\n                        val = innerCell.innerHTML;\n                        val = this.applyGroupColumnTemplate(groupFooterTemplate, val, values[aggrSettings.COUNT_FIELD_NAME]);\n                    }\n                }\n                const cellDiv = this.renderCell(column, index, val, rowElement);\n                rowElement.appendChild(cellDiv);\n            });\n        })\n            .catch((error) => console.error(error));\n        return rowElement;\n    }\n    onViewportKeydown(ev) {\n        if (this.options.showActiveRow) {\n            const rowCount = this.bodyCellContainerDiv.querySelectorAll(`.${this.cssPrefix}-row`).length;\n            let newValue;\n            switch (ev.key) {\n                case 'ArrowLeft':\n                    break;\n                case 'ArrowRight':\n                    break;\n                case 'ArrowUp':\n                    ev.preventDefault();\n                    newValue = this.activeRowIndex < 0 || this.activeRowIndex >= rowCount ? rowCount - 1 : this.activeRowIndex - 1;\n                    this.activeRowIndex = newValue >= 0 ? newValue : 0;\n                    break;\n                case 'ArrowDown':\n                    ev.preventDefault();\n                    newValue = this.activeRowIndex < 0 || this.activeRowIndex >= rowCount ? 0 : this.activeRowIndex + 1;\n                    this.activeRowIndex = newValue < rowCount ? newValue : rowCount - 1;\n                    break;\n            }\n        }\n    }\n    ensureRowVisibility(rowOrIndex) {\n        const row = typeof rowOrIndex === 'number'\n            ? this.getDataRow(rowOrIndex)\n            : rowOrIndex;\n        if (row) {\n            let rowRect = row.getBoundingClientRect();\n            const viewportRect = this.bodyViewportDiv.getBoundingClientRect();\n            const rowTop = rowRect.top - viewportRect.top;\n            const rowBottom = rowRect.bottom - viewportRect.top;\n            const viewportHeight = this.bodyViewportDiv.clientHeight;\n            const windowHeight = window.innerHeight || document.documentElement.clientHeight;\n            if (rowTop > 0 &&\n                rowBottom <= viewportHeight &&\n                rowRect.top > 0 &&\n                rowRect.bottom < windowHeight) {\n                return;\n            }\n            if (rowTop < 0) {\n                this.bodyViewportDiv.scrollTop = this.bodyViewportDiv.scrollTop + rowTop;\n            }\n            else if (rowBottom > viewportHeight) {\n                this.bodyViewportDiv.scrollTop = this.bodyViewportDiv.scrollTop + rowBottom - viewportHeight;\n            }\n            rowRect = row.getBoundingClientRect();\n            if (rowRect.top < 0) {\n                document.documentElement.scrollTop = document.documentElement.scrollTop + rowRect.top;\n            }\n            else if (rowRect.bottom > windowHeight) {\n                document.documentElement.scrollTop = document.documentElement.scrollTop + rowRect.bottom - windowHeight;\n            }\n        }\n    }\n    /** Returns a promise with the list of the rows to render on one page.\n     * The list contains pageSize+1 row to make it possible\n     * to render the totals row (if it appears to be on the edge between pages)\n     */\n    getRowsToRender() {\n        if (this.options.paging.enabled === false) {\n            return Promise.resolve(this.dataTable.getCachedRows());\n        }\n        return this.dataTable.getRows({\n            offset: (this.pagination.page - 1) * this.pagination.pageSize,\n            limit: this.pagination.pageSize + 1\n        })\n            .catch(error => {\n            console.error(error);\n            return [];\n        });\n    }\n    renderFooter() {\n        this.footerDiv = domel('div')\n            .addClass(`${this.cssPrefix}-footer`)\n            .toDOM();\n        if (this.rowsOnPagePromise) {\n            this.rowsOnPagePromise.then(count => {\n                this.footerDiv.innerHTML = '';\n                this.footerPaginateDiv = this.renderPageNavigator();\n                this.footerDiv.appendChild(this.footerPaginateDiv);\n                const pageInfoBlock = this.renderPageInfoBlock(count);\n                this.footerDiv.appendChild(pageInfoBlock);\n            });\n        }\n    }\n    renderPageInfoBlock(count) {\n        const pageInfoDiv = domel('div')\n            .addClass(`${this.cssPrefix}-page-info`)\n            .toDOM();\n        const rowCount = this.dataTable.getTotal();\n        if (rowCount > 0) {\n            const fistPageRecordNum = count\n                ? (this.pagination.page - 1) * this.pagination.pageSize + 1\n                : 0;\n            const lastPageRecordNum = count\n                ? fistPageRecordNum + count - 1\n                : 0;\n            let totalStr = this.dataTable.getTotal().toString();\n            if (this.dataTable.elasticChunks) {\n                const count = this.dataTable.getCachedCount();\n                const total = this.dataTable.getTotal();\n                if (count !== total)\n                    totalStr = '?';\n            }\n            pageInfoDiv.innerHTML = i18n.getText('GridPageInfo')\n                .replace('{FirstPageRecordNum}', `<span>${fistPageRecordNum.toString()}</span>`)\n                .replace('{LastPageRecordNum}', `<span>${lastPageRecordNum.toString()}</span>`)\n                .replace('{Total}', `<span>${totalStr}</span>`);\n        }\n        return pageInfoDiv;\n    }\n    showProgress() {\n    }\n    hideProgress() {\n    }\n    getLocalIndexByGlobal(index) {\n        if (this.pagination) {\n            return index % this.pagination.pageSize;\n        }\n        else {\n            return index;\n        }\n    }\n    getGlobalIndexByLocal(index) {\n        if (this.pagination) {\n            return (this.pagination.page - 1) * this.pagination.pageSize + index;\n        }\n        else {\n            return index;\n        }\n    }\n    renderRow(row, index) {\n        let indexGlobal = this.getGlobalIndexByLocal(index);\n        let rowBuilder = domel('div')\n            .addClass(`${this.cssPrefix}-row`)\n            .addClass(`${this.cssPrefix}-row-${index % 2 == 1 ? 'odd' : 'even'}`)\n            .data('row-idx', `${indexGlobal}`)\n            .attr('tabindex', '-1')\n            .on('click', (ev) => {\n            this.activeRowIndex = index;\n            this.fireEvent({\n                type: 'rowClick',\n                row: row,\n                rowIndex: index,\n                sourceEvent: ev\n            });\n        })\n            .on('dblclick', (ev) => {\n            this.fireEvent({\n                type: 'rowDbClick',\n                row: row,\n                rowIndex: index,\n                sourceEvent: ev\n            });\n        });\n        if (index == 0) {\n            rowBuilder.addClass(`${this.cssPrefix}-row-first`);\n        }\n        let rowElement = rowBuilder.toDOM();\n        if (this.options.showActiveRow && index == this.activeRowIndex) {\n            rowBuilder.addClass(`${this.cssPrefix}-row-active`);\n        }\n        this.columns.getItems().forEach((column, index) => {\n            if (!column.isVisible) {\n                return;\n            }\n            const colindex = column.isRowNum ? -1 : this.dataTable.columns.getIndex(column.dataColumn.id);\n            let val = column.isRowNum ? indexGlobal + 1 : row.getValue(colindex);\n            rowElement.appendChild(this.renderCell(column, index, val, rowElement));\n        });\n        return rowElement;\n    }\n    renderCell(column, colIndex, value, rowElement) {\n        const builder = domel('div')\n            .addClass(`${this.cssPrefix}-cell`)\n            .data('col-idx', `${colIndex}`)\n            .attr('tabindex', '-1')\n            .setStyle('width', `${column.width}px`);\n        if (column.align == GridColumnAlign.LEFT) {\n            builder.addClass(`${this.cssPrefix}-cell-align-left`);\n        }\n        else if (column.align == GridColumnAlign.RIGHT) {\n            builder.addClass(`${this.cssPrefix}-cell-align-right`);\n        }\n        else if (column.align == GridColumnAlign.CENTER) {\n            builder.addClass(`${this.cssPrefix}-cell-align-center`);\n        }\n        const cellElement = builder.toDOM();\n        const valueCell = cellElement.appendChild(domel('div')\n            .addClass(`${this.cssPrefix}-cell-value`)\n            .toDOM());\n        const cellRenderer = this.getCellRenderer(column);\n        if (cellRenderer) {\n            cellRenderer(value, column, valueCell, rowElement);\n        }\n        return cellElement;\n    }\n    getCellRenderer(column) {\n        let cellRenderer;\n        if (column.isRowNum) {\n            cellRenderer = this.cellRendererStore.getDefaultRendererByType(CellRendererType.NUMBER);\n        }\n        else {\n            cellRenderer = this.cellRendererStore.getDefaultRenderer(column.type);\n        }\n        if (this.options && this.options.onGetCellRenderer) {\n            cellRenderer = this.options.onGetCellRenderer(column, cellRenderer) || cellRenderer;\n        }\n        return cellRenderer;\n    }\n    /** Sets current grid pages (if paging is used) */\n    setPage(page) {\n        this.pagination.page = page;\n        this.fireEvent({ type: \"pageChanged\", page: page });\n        this.refresh();\n        this.bodyViewportDiv.focus();\n    }\n    renderPageNavigator() {\n        let paginateDiv = document.createElement('div');\n        paginateDiv.className = `${this.cssPrefix}-pagination-wrapper`;\n        const rowCount = this.dataTable.getTotal();\n        const totalRows = this.dataTable.getTotal();\n        const pageSize = this.pagination.pageSize;\n        const totalPages = Math.ceil(totalRows / pageSize);\n        const distance = 8, islandSize = 3;\n        const prefix = this.paginationOptions.useBootstrap ? '' : `${this.cssPrefix}-`;\n        if (!this.options.paging || !this.options.paging.enabled || rowCount <= pageSize) {\n            return paginateDiv;\n        }\n        const buttonClickHandler = (ev) => {\n            const element = ev.target;\n            if (element.hasAttribute('data-page')) {\n                const page = parseInt(element.getAttribute('data-page'));\n                this.setPage(page);\n            }\n        };\n        const renderPaginationItem = (pageIndex, content, disabled, extreme, active, title) => {\n            const li = document.createElement('li');\n            li.className = `${prefix}page-item`;\n            if (!extreme) {\n                if (active) {\n                    li.className += ' active';\n                }\n                const a = document.createElement('a');\n                a.setAttribute('href', 'javascript:void(0)');\n                a.innerHTML = content || pageIndex.toString();\n                a.setAttribute(\"data-page\", `${pageIndex}`);\n                a.className = `${prefix}page-link`;\n                a.addEventListener(\"click\", buttonClickHandler);\n                if (title) {\n                    a.setAttribute(\"title\", title);\n                }\n                li.appendChild(a);\n                return li;\n            }\n            let a = document.createElement('span');\n            a.setAttribute('aria-hidden', 'true');\n            a.className = `${prefix}page-link`;\n            if (disabled) {\n                li.className += ' disabled';\n            }\n            else {\n                if (this.paginationOptions.useBootstrap) {\n                    a = document.createElement('a');\n                    a.setAttribute('href', 'javascript:void(0)');\n                    a.setAttribute(\"data-page\", `${pageIndex}`);\n                }\n                else {\n                    let newA = document.createElement('a');\n                    newA.setAttribute('href', 'javascript:void(0)');\n                    newA.setAttribute('data-page', `${pageIndex}`);\n                    a = newA;\n                }\n                a.className = `${prefix}page-link`;\n                a.addEventListener(\"click\", buttonClickHandler);\n            }\n            a.innerHTML = content;\n            if (title) {\n                a.setAttribute(\"title\", title);\n            }\n            li.appendChild(a);\n            return li;\n        };\n        const pageIndex = this.pagination.page || 1;\n        let ul = document.createElement('ul');\n        ul.className = `${prefix}pagination`;\n        ul.style.userSelect = 'none';\n        paginateDiv.appendChild(ul);\n        if (this.dataTable.elasticChunks) {\n            let cell = renderPaginationItem(pageIndex - 1, '&laquo;', pageIndex == 1, true, false);\n            ul.appendChild(cell);\n            cell = renderPaginationItem(pageIndex + 1, '&raquo;', this.isLastPage(), true, false);\n            ul.appendChild(cell);\n        }\n        else {\n            if (totalPages > 10) {\n                ul.appendChild(renderPaginationItem(pageIndex - 10, '&laquo;', pageIndex <= 10, true, false, \"Jump left on 10 pages\"));\n            }\n            ul.appendChild(renderPaginationItem(pageIndex - 1, '&lsaquo;', pageIndex == 1, true, false, \"Prev Page\"));\n            ul.appendChild(renderPaginationItem(1, '1', pageIndex == 1, false, pageIndex === 1));\n            if (totalPages <= 10) {\n                for (let i = 2; i < totalPages; i++) {\n                    ul.appendChild(renderPaginationItem(i, `${i}`, pageIndex === i, false, pageIndex === i));\n                }\n            }\n            else {\n                if (pageIndex < distance) {\n                    for (let i = 2; i <= distance; i++) {\n                        ul.appendChild(renderPaginationItem(i, `${i}`, false, false, pageIndex === i));\n                    }\n                    if (totalPages > distance) {\n                        ul.appendChild(renderPaginationItem(-1, `...`, true, true, false));\n                    }\n                }\n                else if (pageIndex <= totalPages && pageIndex > totalPages - distance + 1) {\n                    if (totalPages > distance) {\n                        ul.appendChild(renderPaginationItem(-1, `...`, true, true, false));\n                    }\n                    for (let i = totalPages - distance + 1; i < totalPages; i++) {\n                        ul.appendChild(renderPaginationItem(i, `${i}`, pageIndex === i, false, pageIndex === i));\n                    }\n                }\n                else {\n                    ul.appendChild(renderPaginationItem(-1, `...`, true, true, false));\n                    // Island Left Side\n                    for (let i = islandSize; i > 0; i--) {\n                        ul.appendChild(renderPaginationItem(pageIndex - i, `${pageIndex - i}`, false, false, false));\n                    }\n                    // Center of Island\n                    ul.appendChild(renderPaginationItem(pageIndex, `${pageIndex}`, false, false, true));\n                    // Island Right Size\n                    for (let i = 1; i <= islandSize; i++) {\n                        ul.appendChild(renderPaginationItem(pageIndex + i, `${pageIndex + i}`, false, false, false));\n                    }\n                    ul.appendChild(renderPaginationItem(-1, `...`, true, true, false));\n                }\n            }\n            if (totalPages > 1 || pageIndex < totalPages) {\n                ul.appendChild(renderPaginationItem(totalPages, `${totalPages}`, pageIndex === totalPages, false, pageIndex === totalPages));\n            }\n            ul.appendChild(renderPaginationItem(pageIndex + 1, '&rsaquo;', pageIndex == totalPages, true, false, \"Next Page\"));\n            if (totalPages > 10) {\n                ul.appendChild(renderPaginationItem(pageIndex + 10, '&raquo;', pageIndex >= totalPages - 10, true, false, \"Jump right on 10 pages\"));\n            }\n        }\n        if (this.options.paging.allowPageSizeChange) {\n            const selectChangeHandler = (ev) => {\n                const newValue = parseInt(ev.target.value);\n                this.pagination.pageSize = newValue;\n                this.pagination.page = 1;\n                this.refresh();\n            };\n            const pageSizes = document.createElement('div');\n            pageSizes.className = `${this.cssPrefix}-page-sizes`;\n            const selectSize = document.createElement('div');\n            selectSize.className = `kfrm-select ${this.cssPrefix}-page-sizes-select`;\n            pageSizes.appendChild(selectSize);\n            const sel = document.createElement('select');\n            const selOptions = this.options.paging.pageSizeItems || [];\n            const selSet = new Set(selOptions);\n            selSet.add(this.options.paging.pageSize || 20);\n            Array.from(selSet).forEach(el => {\n                const option = document.createElement(\"option\");\n                option.value = el.toString();\n                option.text = el.toString();\n                sel.appendChild(option);\n            });\n            sel.value = (this.pagination.pageSize || 20).toString();\n            selectSize.appendChild(sel);\n            sel.addEventListener('change', selectChangeHandler);\n            const labelDiv = document.createElement('div');\n            labelDiv.className = `${this.cssPrefix}-page-sizes-label`;\n            pageSizes.appendChild(labelDiv);\n            const label = document.createElement('span');\n            label.innerText = i18n.getText('GridItemsPerPage');\n            labelDiv.appendChild(label);\n            paginateDiv.appendChild(pageSizes);\n        }\n        return paginateDiv;\n    }\n    addEventListener(eventType, handler) {\n        return this.eventEmitter.subscribe(eventType, event => handler(event.data));\n    }\n    removeEventListener(eventType, handlerId) {\n        this.eventEmitter.unsubscribe(eventType, handlerId);\n    }\n    renderHeaderButtons() {\n        if (this.options.showPlusButton) {\n            return domel('div')\n                .addClass(`${this.cssPrefix}-header-btn-plus`)\n                .title(this.options.plusButtonTitle || 'Add')\n                .addChild('a', builder => builder\n                .attr('href', 'javascript:void(0)')\n                .on('click', (e) => {\n                e.preventDefault();\n                this.fireEvent({\n                    type: 'plusButtonClick',\n                    sourceEvent: e\n                });\n            }))\n                .toDOM();\n        }\n        return domel('span')\n            .addText('#')\n            .toDOM();\n    }\n    showLandingSlot(pageX, pageY) {\n        const colElems = this.headerRowDiv.querySelectorAll(`[class*=${this.cssPrefix}-table-col]`);\n        const cols = [];\n        for (let i = 1; i < colElems.length; i++) {\n            const rowElem = colElems[i];\n            if (rowElem.style.display === 'none')\n                continue;\n            cols.push(rowElem);\n        }\n        if (cols.length === 0) {\n            this.landingIndex = 0;\n            this.headerRowDiv.appendChild(this.landingSlot);\n            return;\n        }\n        const landingPos = getElementAbsolutePos(this.landingSlot);\n        if (pageX >= landingPos.x && pageX <= landingPos.x + this.landingSlot.offsetWidth) {\n            return;\n        }\n        let newLandingIndex = this.landingIndex;\n        for (let col of cols) {\n            const colPos = getElementAbsolutePos(col);\n            const width = col.offsetWidth;\n            if (pageX > colPos.x && pageX < colPos.x + width) {\n                // -1 as we don't need to count add button here\n                newLandingIndex = parseInt(col.getAttribute('data-col-idx')) - 1;\n            }\n        }\n        if (newLandingIndex != this.landingIndex) {\n            this.landingIndex = newLandingIndex;\n            if (this.landingIndex < cols.length) {\n                this.headerRowDiv.insertBefore(this.landingSlot, cols[this.landingIndex]);\n            }\n            else {\n                this.headerRowDiv.appendChild(this.landingSlot);\n            }\n        }\n    }\n    hideLandingSlot() {\n        this.landingIndex = -1;\n        setTimeout(() => {\n            if (this.landingSlot.parentElement) {\n                this.landingSlot.parentElement.removeChild(this.landingSlot);\n            }\n        }, 10);\n    }\n    get activeRowIndex() {\n        return this._activeRowIndex;\n    }\n    set activeRowIndex(value) {\n        if (value !== this._activeRowIndex) {\n            const oldValue = this._activeRowIndex;\n            this._activeRowIndex = value;\n            this.updateActiveRow();\n            this.fireEvent({\n                type: 'activeRowChanged',\n                oldValue,\n                newValue: this.activeRowIndex,\n                rowIndex: this.getGlobalIndexByLocal(this.activeRowIndex)\n            });\n        }\n    }\n    updateActiveRow() {\n        if (this.options.showActiveRow) {\n            const rows = this.bodyCellContainerDiv.querySelectorAll(`[class*=${this.cssPrefix}-row-active]`);\n            rows.forEach(el => { el.classList.remove(`${this.cssPrefix}-row-active`); });\n            const activeRow = this.getActiveRow();\n            if (activeRow) {\n                activeRow.classList.add(`${this.cssPrefix}-row-active`);\n                this.ensureRowVisibility(this.activeRowIndex);\n            }\n        }\n    }\n    getActiveRow() {\n        return this.getDataRow(this.activeRowIndex);\n    }\n    getDataRow(index) {\n        const rows = Array.from(this.bodyCellContainerDiv.querySelectorAll(`.${this.cssPrefix}-row:not(.${this.cssPrefix}-row-totals)`));\n        if (index >= 0 && index < rows.length)\n            return rows[index];\n        return null;\n    }\n    /** Makes the grid focused for keyboard events */\n    focus() {\n        this.bodyViewportDiv.focus();\n    }\n    /** Resizes columns according to the data they represent */\n    resizeColumns() {\n        if (this.options.columnWidths.autoResize === AutoResizeColumns.Never)\n            return;\n        const containerWidth = this.bodyCellContainerDiv.style.width;\n        this.bodyCellContainerDiv.style.visibility = 'hidden';\n        this.bodyCellContainerDiv.style.width = '1px';\n        //this.headerRowDiv.style.visibility = 'hidden';\n        this.headerRowDiv.style.width = '1px';\n        let sumWidth = 0;\n        const columns = this.columns.getItems();\n        const headerCells = this.headerCellContainerDiv.querySelectorAll(`.${this.cssPrefix}-header-cell`);\n        let headerIdx = 0;\n        for (let idx = 0; idx < this.columns.count; idx++) {\n            const column = columns[idx];\n            if (!column.isVisible)\n                continue;\n            const calculatedWidth = this.options.columnWidths.autoResize !== AutoResizeColumns.Always && column.dataColumn\n                ? column.dataColumn.calculatedWidth\n                : 0;\n            const cellValues = this.bodyCellContainerDiv.querySelectorAll(`.${this.cssPrefix}-cell[data-col-idx=\"${idx}\"] > .${this.cssPrefix}-cell-value`);\n            let maxWidth = 0;\n            if (calculatedWidth > 0) {\n                sumWidth += calculatedWidth;\n                column.width = calculatedWidth;\n                cellValues.forEach(value => {\n                    value.parentElement.style.width = `${calculatedWidth}px`;\n                });\n                headerCells[headerIdx].style.width = `${calculatedWidth}px`;\n            }\n            else {\n                if (cellValues.length == 0) {\n                    headerCells[headerIdx].style.width = null;\n                    headerCells[headerIdx].style.whiteSpace = 'nowrap';\n                }\n                maxWidth = headerCells[headerIdx].offsetWidth;\n                if (cellValues.length > 0) {\n                    cellValues.forEach(value => {\n                        value.parentElement.style.width = null;\n                        const width = value.parentElement.offsetWidth;\n                        if (width > maxWidth) {\n                            maxWidth = width;\n                        }\n                    });\n                    maxWidth += 3;\n                    const maxOption = column.isRowNum\n                        ? this.options.columnWidths.rowNumColumn.max || 500\n                        : this.options.columnWidths[column.dataColumn.type].max || 2000;\n                    const minOption = column.isRowNum\n                        ? this.options.columnWidths.rowNumColumn.min || 0\n                        : this.options.columnWidths[column.dataColumn.type].min || 20;\n                    if (maxWidth > maxOption) {\n                        maxWidth = maxOption;\n                    }\n                    if (maxWidth < minOption) {\n                        maxWidth = minOption;\n                    }\n                    if (utils.isNumericType(column.type)) {\n                        //increase the calculated width in 1.3 times for numeric columns\n                        maxWidth = Math.round(maxWidth * 1.3);\n                    }\n                    sumWidth += maxWidth;\n                    column.width = maxWidth;\n                    cellValues.forEach(value => {\n                        value.parentElement.style.width = `${maxWidth}px`;\n                    });\n                    headerCells[headerIdx].style.width = `${maxWidth}px`;\n                    if (column.dataColumn) {\n                        column.dataColumn.calculatedWidth = maxWidth;\n                    }\n                }\n                else {\n                    sumWidth += maxWidth;\n                }\n            }\n            headerIdx++;\n        }\n        if (sumWidth > 0) {\n            this.bodyCellContainerDiv.style.width = `${sumWidth}px`;\n            this.headerCellContainerDiv.style.width = `${sumWidth}px`;\n        }\n        else {\n            this.bodyCellContainerDiv.style.width = containerWidth;\n            this.headerCellContainerDiv.style.width = containerWidth;\n        }\n        this.bodyCellContainerDiv.style.visibility = null;\n        this.headerRowDiv.removeAttribute('style');\n    }\n}\n\nclass Calendar {\n    get cssPrefix() {\n        return 'kdtp-cal';\n    }\n    constructor(slot, options) {\n        this.slot = slot;\n        this.options = options || {};\n        if (!this.options.yearRange) {\n            this.options.yearRange = 'c-10:c+10';\n        }\n        if (!this.options.minDate) {\n            this.options.minDate = \"none\";\n        }\n        if (!this.options.maxDate) {\n            this.options.maxDate = \"none\";\n        }\n    }\n    setDate(date) {\n        this.selectedDate = new Date(date);\n    }\n    getDate() {\n        return this.selectedDate;\n    }\n    dateChanged(apply) {\n        if (this.options.onDateChanged) {\n            this.options.onDateChanged(this.selectedDate, apply);\n        }\n    }\n}\nfunction dateLikeToDate(input) {\n    let result;\n    if (input == null || input === 'none') {\n        return null;\n    }\n    if (typeof input === 'string') {\n        if (input === 'today') {\n            result = new Date();\n            result.setHours(0, 0, 0, 0);\n        }\n        else {\n            result = new Date(input);\n            result.setHours(0, 0, 0, 0);\n        }\n    }\n    else if (Array.isArray(input)) {\n        result = new Date(input[0], input[1] - 1, input[2]);\n        result.setHours(0, 0, 0, 0);\n    }\n    else {\n        if (input instanceof Date) {\n            result = new Date(input.getFullYear(), input.getMonth(), input.getDate());\n            result.setHours(0, 0, 0, 0);\n        }\n        else {\n            result = null;\n        }\n    }\n    return result;\n}\n\nclass DateTimePicker {\n    get cssPrefix() {\n        return 'kdtp';\n    }\n    constructor(options) {\n        this.calendar = null;\n        this.timePicker = null;\n        this.options = options;\n        const defaultDate = this.options.defaultDate\n            ? dateLikeToDate(this.options.defaultDate)\n            : new Date();\n        this.setDateTime(defaultDate);\n        this.render();\n    }\n    setDateTime(dateTime) {\n        this.currentDateTime = dateTime;\n        if (this.calendar) {\n            this.calendar.setDate(this.currentDateTime);\n        }\n        if (this.timePicker) {\n            this.timePicker.setTime(this.currentDateTime);\n        }\n    }\n    getDateTime() {\n        return this.currentDateTime;\n    }\n    render() {\n        if (this.options.showCalendar) {\n            this.calendar = this.createCalendar({\n                yearRange: this.options.yearRange,\n                showDateTimeInput: this.options.showDateTimeInput,\n                timePickerIsUsed: this.options.showTimePicker,\n                minDate: this.options.minDate,\n                maxDate: this.options.maxDate,\n                oneClickDateSelection: this.options.oneClickDateSelection,\n                onDateChanged: (date, apply) => {\n                    this.currentDateTime = date;\n                    if (this.timePicker) {\n                        this.timePicker.setTime(this.currentDateTime);\n                    }\n                    if (this.options.showTimePicker) {\n                        this.dateTimeChanged();\n                    }\n                    if (apply) {\n                        this.apply(this.currentDateTime);\n                    }\n                }\n            });\n            if (this.calendar) {\n                this.calendar.setDate(this.currentDateTime);\n                this.calendar.render();\n            }\n        }\n        if (this.options.showTimePicker) {\n            this.timePicker = this.createTimePicker({\n                onTimeChanged: (time) => {\n                    this.currentDateTime.setHours(time.getHours());\n                    this.currentDateTime.setMinutes(time.getMinutes());\n                    if (this.calendar) {\n                        this.calendar.setDate(this.currentDateTime);\n                    }\n                    this.dateTimeChanged();\n                }\n            });\n            if (this.timePicker)\n                this.timePicker.render();\n        }\n    }\n    refresh() {\n        if (this.calendar) {\n            this.calendar.refresh();\n        }\n        if (this.timePicker) {\n            this.timePicker.refresh();\n        }\n    }\n    createCalendar(options) {\n        return null;\n    }\n    createTimePicker(options) {\n        return null;\n    }\n    show(anchor) {\n        if (this.options.beforeShow) {\n            this.options.beforeShow();\n        }\n        const pos = getElementAbsolutePos(anchor || document.body);\n        this.slot.style.top = pos.y + anchor.clientHeight + 'px';\n        this.slot.style.left = pos.x + 'px';\n    }\n    apply(date) {\n        if (this.options.onApply) {\n            this.options.onApply(date);\n        }\n        this.destroy();\n    }\n    cancel() {\n        if (this.options.onCancel) {\n            this.options.onCancel();\n        }\n        this.destroy();\n    }\n    destroy() {\n        this.slot.innerHTML = '';\n    }\n    dateTimeChanged() {\n        if (this.options.onDateTimeChanged) {\n            this.options.onDateTimeChanged(this.currentDateTime);\n        }\n    }\n}\n\nclass DefaultCalendar extends Calendar {\n    constructor(slot, options) {\n        super(slot, options);\n        this.daysOfWeek = [\"Sun\", \"Mon\", \"Tue\", \"Wed\", \"Thu\", \"Fri\", \"Sat\"];\n        this.months = [\"Jan\", \"Feb\", \"Mar\", \"Apr\", \"May\", \"Jun\", \"Jul\", \"Aug\", \"Sep\", \"Oct\", \"Nov\", \"Dec\"];\n        this.calendarBody = null;\n        this.isManualInputChanging = false;\n        for (let i = 0; i < this.daysOfWeek.length; i++) {\n            this.daysOfWeek[i] = i18n.getShortWeekDayName(i + 1);\n        }\n        for (let i = 0; i < this.months.length; i++) {\n            this.months[i] = i18n.getLongMonthName(i + 1);\n        }\n    }\n    setDate(date) {\n        super.setDate(date);\n        this.selectedMonth = this.getDate().getMonth();\n        this.selectedYear = this.getDate().getFullYear();\n        this.refresh();\n    }\n    render() {\n        this.slot.innerHTML = '';\n        const header = domel('div', this.slot)\n            .addClass(`${this.cssPrefix}-header`);\n        if (this.options.showDateTimeInput) {\n            header\n                .addChildElement(this.renderManualDateInput());\n        }\n        else {\n            header\n                .addChild('span', builder => this.headerTextElem = builder.toDOM());\n        }\n        domel(this.slot)\n            .addChildElement(this.renderCalendarButtons());\n        this.calendarBody = domel('div', this.slot)\n            .addClass(`${this.cssPrefix}-body`)\n            .toDOM();\n        this.rerenderMonth();\n    }\n    refresh() {\n        this.rerenderMonth();\n    }\n    getInputDateFormat() {\n        const settings = i18n.getLocaleSettings();\n        return (this.options.timePickerIsUsed)\n            ? `${settings.editDateFormat} ${settings.editTimeFormat}`\n            : settings.editDateFormat;\n    }\n    renderManualDateInput() {\n        const format = this.getInputDateFormat();\n        const builder = domel('input')\n            .attr('placeholder', format)\n            .addClass(`${this.cssPrefix}-header-input`);\n        builder\n            .mask(format.replace('yyyy', '9999')\n            .replace('MM', '99')\n            .replace('dd', '99')\n            .replace('HH', '99')\n            .replace('mm', '99')\n            .replace('ss', '99'))\n            .on('input', ev => {\n            builder.removeClass('error');\n            try {\n                this.isManualInputChanging = true;\n                const newDate = utils.strToDateTime(this.manualInputElem.value, format);\n                const minDate = dateLikeToDate(this.options.minDate);\n                const maxDate = dateLikeToDate(this.options.maxDate);\n                if (newDate < minDate || newDate > maxDate) {\n                    throw new Error();\n                }\n                this.setDate(newDate);\n                this.jump(this.getDate().getFullYear(), this.getDate().getMonth());\n                this.dateChanged(false);\n            }\n            catch (e) {\n                builder.addClass('error');\n            }\n            finally {\n                this.isManualInputChanging = false;\n            }\n        })\n            .on('keydown', (ev) => {\n            if (ev.keyCode === 13) {\n                ev.preventDefault();\n                ev.stopPropagation();\n                if (this.manualInputElem.className.indexOf('error') < 0\n                    && !this.isManualInputChanging)\n                    this.dateChanged(true);\n            }\n        })\n            .on('focus', () => {\n            setTimeout(() => {\n                this.manualInputElem.selectionStart = 0;\n                this.manualInputElem.selectionEnd = 0;\n            }, 50);\n        });\n        this.manualInputElem = builder.toDOM();\n        return this.manualInputElem;\n    }\n    updateDisplayedDateValue() {\n        if (this.manualInputElem) {\n            if (!this.isManualInputChanging) {\n                const format = this.getInputDateFormat();\n                this.manualInputElem.value = i18n.dateTimeToStr(this.getDate(), format);\n                this.manualInputElem.focus();\n            }\n        }\n        else if (this.headerTextElem) {\n            const locale = i18n.getCurrentLocale();\n            this.headerTextElem.innerText = this.getDate().toLocaleString(locale == 'en' ? undefined : locale, {\n                year: 'numeric',\n                month: 'long',\n                day: 'numeric',\n            });\n        }\n    }\n    renderCalendarButtons() {\n        const builder = domel('nav')\n            .addClass(`${this.cssPrefix}-nav`)\n            .addChild('div', builder => builder\n            .addClass(`${this.cssPrefix}-nav-prev`)\n            .on('click', () => {\n            this.prev();\n        })\n            .addChild('span', builder => builder.html('&lsaquo;')))\n            .addChild('div', builder => builder\n            .addClass(`${this.cssPrefix}-nav-selectors`)\n            .addChild('div', builder => builder\n            .addClass(`${this.cssPrefix}-nav-month`)\n            .addChild('select', builder => {\n            builder\n                .on('change', () => {\n                this.jump(this.selectedYear, parseInt(this.selectMonthElem.value));\n            });\n            for (let i = 0; i < this.months.length; i++) {\n                builder.addChild('option', builder => builder\n                    .attr('value', i.toString())\n                    .text(this.months[i]));\n            }\n            this.selectMonthElem = builder.toDOM();\n        }))\n            .addChild('div', builder => builder\n            .addClass(`${this.cssPrefix}-nav-year`)\n            .addChild('select', builder => this.selectYearElem = builder\n            .on('change', () => {\n            this.jump(parseInt(this.selectYearElem.value), this.selectedMonth);\n        })\n            .toDOM())))\n            .addChild('div', builder => builder\n            .addClass(`${this.cssPrefix}-nav-next`)\n            .on('click', () => {\n            this.next();\n        })\n            .addChild('span', builder => builder.html('&rsaquo;')));\n        return builder.toDOM();\n    }\n    prev() {\n        this.selectedYear = (this.selectedMonth === 0) ? this.selectedYear - 1 : this.selectedYear;\n        this.selectedMonth = (this.selectedMonth === 0) ? 11 : this.selectedMonth - 1;\n        this.rerenderMonth();\n    }\n    next() {\n        this.selectedYear = (this.selectedMonth === 11) ? this.selectedYear + 1 : this.selectedYear;\n        this.selectedMonth = (this.selectedMonth + 1) % 12;\n        this.rerenderMonth();\n    }\n    rerenderSelectYear() {\n        const match = /c-(\\d*):c\\+(\\d*)/g.exec(this.options.yearRange);\n        let minusYear = 0;\n        let plusYear = 1;\n        if (match !== null) {\n            minusYear = parseInt(match[1]);\n            plusYear = parseInt(match[2]);\n        }\n        this.selectYearElem.innerHTML = '';\n        for (let i = 0; i <= minusYear + plusYear; i++) {\n            let op = document.createElement(\"option\");\n            let year = this.selectedYear - minusYear + i;\n            op.value = year.toString();\n            op.innerText = year.toString();\n            this.selectYearElem.appendChild(op);\n        }\n    }\n    jump(year, month) {\n        this.selectedYear = year;\n        this.selectedMonth = month;\n        this.rerenderMonth();\n    }\n    rerenderMonth() {\n        if (this.calendarBody == null)\n            return;\n        const minDate = dateLikeToDate(this.options.minDate);\n        const maxDate = dateLikeToDate(this.options.maxDate);\n        //header text\n        this.updateDisplayedDateValue();\n        this.rerenderSelectYear();\n        let firstDay = (new Date(this.selectedYear, this.selectedMonth)).getDay();\n        let daysInMonth = new Date(this.selectedYear, this.selectedMonth + 1, 0).getDate();\n        this.calendarBody.innerHTML = '';\n        this.selectYearElem.value = this.selectedYear.toString();\n        this.selectMonthElem.value = this.selectedMonth.toString();\n        this.daysOfWeek.forEach((day, idx) => {\n            domel('div', this.calendarBody)\n                .addClass(`${this.cssPrefix}-weekday`)\n                .addClass(idx == 0 || idx == 6 ? `${this.cssPrefix}-weekend` : '')\n                .text(day);\n        });\n        // Add empty cells before first day\n        for (let i = 0; i < firstDay; i++) {\n            domel('div', this.calendarBody)\n                .addClass(`${this.cssPrefix}-day-empty`);\n        }\n        // Add all month days\n        const today = new Date();\n        for (let day = 1; day <= daysInMonth; day++) {\n            let date = new Date(this.selectedYear, this.selectedMonth, day);\n            date.setHours(0, 0, 0, 0); // Align date\n            const builder = domel('div', this.calendarBody)\n                .addClass(`${this.cssPrefix}-day`)\n                .attr('data-date', day.toString())\n                .text(day.toString())\n                .on('click', (e) => {\n                const dateNum = parseInt(e.target.getAttribute('data-date'));\n                const newDate = new Date(this.selectedYear, this.selectedMonth, dateNum);\n                if ((minDate == null || newDate >= minDate)\n                    && (maxDate == null || newDate <= maxDate)) {\n                    this.setDate(newDate);\n                    this.dateChanged(this.options.oneClickDateSelection);\n                }\n            });\n            if (day === today.getDate() && this.selectedYear === today.getFullYear() && this.selectedMonth === today.getMonth()) {\n                builder.addClass(`${this.cssPrefix}-day-current`);\n            }\n            const selectedDate = this.getDate();\n            if (day === selectedDate.getDate() && this.selectedYear === selectedDate.getFullYear() && this.selectedMonth === selectedDate.getMonth()) {\n                builder.addClass(`${this.cssPrefix}-day-selected`);\n            }\n            if (minDate) {\n                if (date < minDate) {\n                    builder.addClass(`${this.cssPrefix}-day-disabled`);\n                }\n            }\n            if (maxDate) {\n                if (date > maxDate) {\n                    builder.addClass(`${this.cssPrefix}-day-disabled`);\n                }\n            }\n            const dayOfWeek = (firstDay + day - 1) % 7;\n            if (dayOfWeek == 0 || dayOfWeek == 6) {\n                builder.addClass(`${this.cssPrefix}-weekend`);\n            }\n            if (typeof this.options.onDrawDay === \"function\") {\n                this.options.onDrawDay.apply(builder.toDOM(), [\n                    builder.toDOM(),\n                    new Date(this.selectedYear, this.selectedMonth, day)\n                ]);\n            }\n        }\n        // Add an empty cells after last day\n        const cellsDrawnInLastRow = (firstDay + daysInMonth) % 7;\n        const cellsToDraw = cellsDrawnInLastRow == 0 ? 0 : 7 - cellsDrawnInLastRow;\n        for (let i = 0; i < cellsToDraw; i++) {\n            domel('div', this.calendarBody)\n                .addClass(`${this.cssPrefix}-day-empty`);\n        }\n    }\n}\n\nclass TimePicker {\n    get cssPrefix() {\n        return 'kdtp-tp';\n    }\n    constructor(slot, options) {\n        this.slot = slot;\n        this.options = options || {};\n    }\n    setTime(time) {\n        this.currentTime = new Date(time);\n    }\n    getTime() {\n        return new Date(this.currentTime);\n    }\n    refresh() {\n        this.render();\n    }\n    timeChanged() {\n        if (this.options.onTimeChanged) {\n            this.options.onTimeChanged(this.currentTime);\n        }\n    }\n}\n\nclass DefaultTimePicker extends TimePicker {\n    setTime(time) {\n        super.setTime(time);\n        this.updateDisplayedTime();\n        this.hoursInput.valueAsNumber = time.getHours();\n        this.minutesInput.valueAsNumber = time.getMinutes();\n    }\n    render() {\n        this.slot.innerHTML = '';\n        domel('div', this.slot)\n            .addClass(`${this.cssPrefix}-time`)\n            .addChild('span', builder => this.timeText = builder.toDOM())\n            .toDOM();\n        const slidersBuilder = domel('div', this.slot)\n            .addClass(`${this.cssPrefix}-sliders`);\n        slidersBuilder\n            .addChild('div', builder => builder\n            .addClass(`${this.cssPrefix}-time-row`)\n            .title('Hours')\n            .addChild('input', builder => this.hoursInput = builder\n            .addClass(`${this.cssPrefix}-input-hours`)\n            .type('range')\n            .attr('min', '0')\n            .attr('max', '23')\n            .attr('step', '1')\n            .on('input', (e) => {\n            this.currentTime.setHours(this.hoursInput.valueAsNumber);\n            this.updateDisplayedTime();\n            this.timeChanged();\n        })\n            .toDOM()));\n        slidersBuilder\n            .addChild('div', builder => builder\n            .addClass(`${this.cssPrefix}-time-row`)\n            .title('Minutes')\n            .addChild('input', builder => this.minutesInput = builder\n            .addClass(`${this.cssPrefix}-input-minutes`)\n            .type('range')\n            .attr('min', '0')\n            .attr('max', '59')\n            .attr('step', '1')\n            .on('input', (e) => {\n            this.currentTime.setMinutes(this.minutesInput.valueAsNumber);\n            this.updateDisplayedTime();\n            this.timeChanged();\n        })\n            .toDOM()));\n        return this.slot;\n    }\n    updateDisplayedTime() {\n        const locale = i18n.getCurrentLocale();\n        const timeToDraw = this.currentTime.toLocaleString(locale == 'en' ? undefined : locale, {\n            hour: \"numeric\",\n            minute: \"numeric\"\n        });\n        this.timeText.innerText = timeToDraw;\n    }\n}\n\nclass DefaultDateTimePicker extends DateTimePicker {\n    render() {\n        const sb = domel('div', document.body)\n            .addClass(`${this.cssPrefix}`)\n            .attr('tabIndex', '0')\n            .setStyle('position', 'absolute')\n            .setStyle('top', '-1000px')\n            .setStyle('left', '-1000px')\n            .on('keydown', (ev) => {\n            if (ev.keyCode === 27) { // ESC is pressed\n                this.cancel();\n            }\n            else if (ev.keyCode === 13) { // Enter is pressed\n                this.apply(this.getDateTime());\n            }\n            return false;\n        });\n        if (this.options.zIndex) {\n            sb.setStyle('z-index', `${this.options.zIndex}`);\n        }\n        this.slot = sb.toDOM();\n        super.render();\n        this.renderButtons();\n        this.globalMouseDownHandler = (e) => {\n            let event = window.event || e;\n            event.srcElement || event.target;\n            let isOutside = !this.slot.contains(event.target);\n            if (isOutside) {\n                document.removeEventListener('mousedown', this.globalMouseDownHandler, true);\n                this.cancel();\n            }\n            return true;\n        };\n    }\n    renderButtons() {\n        const builder = domel('div', this.slot)\n            .addClass(`${this.cssPrefix}-buttons`)\n            .addChild('button', b => this.nowButton = b\n            .addClass(`${this.cssPrefix}-button ${this.cssPrefix}-button-now`)\n            .text(i18n.getText('ButtonNow'))\n            .on('click', () => {\n            this.setDateTime(new Date());\n            this.refresh();\n            this.dateTimeChanged();\n            return false;\n        })\n            .toDOM());\n        if (this.options.showTimePicker || !this.options.oneClickDateSelection) {\n            builder.addChild('button', b => this.submitButton = b\n                .addClass(`${this.cssPrefix}-button ${this.cssPrefix}-button-apply`)\n                .text(i18n.getText('ButtonApply'))\n                .on('click', () => {\n                this.apply(this.getDateTime());\n                return false;\n            })\n                .toDOM());\n        }\n        builder.addChild('button', b => this.submitButton = b\n            .addClass(`${this.cssPrefix}-button ${this.cssPrefix}-button-cancel`)\n            .text(i18n.getText('ButtonCancel'))\n            .on('click', () => {\n            this.cancel();\n            return false;\n        })\n            .toDOM());\n    }\n    createCalendar(options) {\n        this.calendarSlot =\n            domel('div', this.slot)\n                .addClass(`${this.cssPrefix}-cal`)\n                .toDOM();\n        return new DefaultCalendar(this.calendarSlot, options);\n    }\n    createTimePicker(options) {\n        this.timePickerSlot =\n            domel('div', this.slot)\n                .addClass(`${this.cssPrefix}-tp`)\n                .toDOM();\n        return new DefaultTimePicker(this.timePickerSlot, options);\n    }\n    show(anchor) {\n        if (this.options.showDateTimeInput) {\n            if (this.options.beforeShow) {\n                this.options.beforeShow();\n            }\n            const anchorPos = getElementAbsolutePos(anchor || document.body);\n            const parentPos = getElementAbsolutePos(anchor ? anchor.parentElement || anchor : document.body);\n            this.slot.style.top = parentPos.y + 'px';\n            this.slot.style.left = anchorPos.x + 'px';\n        }\n        else {\n            super.show(anchor);\n            this.slot.focus();\n        }\n        setTimeout(() => {\n            document.addEventListener('mousedown', this.globalMouseDownHandler, true);\n        }, 1);\n    }\n}\n\nvar DialogFooterAlignment;\n(function (DialogFooterAlignment) {\n    DialogFooterAlignment[DialogFooterAlignment[\"Left\"] = 1] = \"Left\";\n    DialogFooterAlignment[DialogFooterAlignment[\"Center\"] = 2] = \"Center\";\n    DialogFooterAlignment[DialogFooterAlignment[\"Right\"] = 3] = \"Right\";\n})(DialogFooterAlignment || (DialogFooterAlignment = {}));\n\nconst cssPrefix = \"kdlg\";\nclass DefaultDialogService {\n    openConfirm(title, content, callback) {\n        const template = `<div id=\"${cssPrefix}-dialog-confirm\">${content}</div>`;\n        const options = {\n            title: title,\n            closable: false,\n            submitable: true,\n            cancelable: true,\n            body: template\n        };\n        if (callback) {\n            options.onSubmit = () => {\n                callback(true);\n            };\n            options.onCancel = () => {\n                callback(false);\n            };\n            this.open(options);\n            return;\n        }\n        return new Promise((resolve) => {\n            options.onSubmit = () => {\n                resolve(true);\n            };\n            options.onCancel = () => {\n                resolve(false);\n            };\n            this.open(options);\n        });\n    }\n    openPrompt(title, content, defVal, callback) {\n        const template = `<div id=\"${cssPrefix}-dialog-form\" class=\"kfrm-form\">\r\n            <div class=\"kfrm-fields label-above\">\r\n                <label for=\"${cssPrefix}-dialog-form-input\" id=\"${cssPrefix}-dialog-form-content\">${content}</label>\r\n                <input type=\"text\" name=\"${cssPrefix}-dialog-form-input\" id=\"${cssPrefix}-dialog-form-input\" />\r\n            </div>\r\n        </div>`;\n        const options = {\n            title: title,\n            submitable: true,\n            closable: true,\n            cancelable: true,\n            submitOnEnter: true,\n            body: template,\n            arrangeParents: false,\n            beforeOpen: () => {\n                const input = document.getElementById(`${cssPrefix}-dialog-form-input`);\n                if (defVal) {\n                    input.value = defVal;\n                }\n                input.focus();\n            }\n        };\n        const processInput = (callback) => {\n            const input = document.getElementById(`${cssPrefix}-dialog-form-input`);\n            const result = input.value;\n            if (result && result.replace(/\\s/g, '').length > 0) {\n                callback(result);\n                return true;\n            }\n            input.classList.add('eqjs-invalid');\n            return false;\n        };\n        if (callback) {\n            options.onSubmit = () => {\n                return processInput(callback);\n            };\n            options.onCancel = () => {\n                callback(\"\");\n            };\n            this.open(options);\n            return;\n        }\n        return new Promise((resolve) => {\n            options.onSubmit = () => {\n                return processInput(resolve);\n            };\n            options.onCancel = () => {\n                resolve(\"\");\n            };\n            this.open(options);\n        });\n    }\n    open(options, data) {\n        const dialog = new DefaultDialog(options, data);\n        const onDestroy = options.onDestroy;\n        options.onDestroy = (dlg) => {\n            this.untrack(dlg);\n            onDestroy && onDestroy(dlg);\n        };\n        dialog.open();\n        this.track(dialog);\n        return dialog;\n    }\n    createSet(options) {\n        return new DefaultDialogSet(options, this);\n    }\n    untrack(dlg) {\n        const index = DefaultDialogService.openDialogs.indexOf(dlg);\n        if (index >= 0) {\n            DefaultDialogService.openDialogs.splice(index, 1);\n        }\n    }\n    track(dlg) {\n        DefaultDialogService.openDialogs.push(dlg);\n    }\n    openProgress(options) {\n        const dialog = new DefaultProgressDialog(options);\n        const onDestroy = options.onDestroy;\n        options.onDestroy = (dlg) => {\n            this.untrack(dlg);\n            onDestroy && onDestroy(dlg);\n        };\n        dialog.open();\n        this.track(dialog);\n        return dialog;\n    }\n    getAllDialogs() {\n        return Array.from(DefaultDialogService.openDialogs);\n    }\n    closeAllDialogs() {\n        for (const dialog of Array.from(DefaultDialogService.openDialogs)) {\n            dialog.close();\n        }\n    }\n}\nDefaultDialogService.openDialogs = [];\nclass DefaultDialog {\n    constructor(options, data) {\n        this.options = options;\n        this.submitHandler = (token) => {\n            if (this.options.onSubmit && this.options.onSubmit(this, token) === false) {\n                return false;\n            }\n            this.destroy();\n            return true;\n        };\n        this.cancelHandler = () => {\n            if (this.options.onCancel) {\n                this.options.onCancel(this);\n            }\n            this.destroy();\n        };\n        this.keydownHandler = (ev) => {\n            if (ev.keyCode == 13 && this.isActiveDialog()) {\n                ev.preventDefault();\n                ev.stopPropagation();\n                if (this.submitHandler()) {\n                    window.removeEventListener('keydown', this.keydownHandler, false);\n                    return false;\n                }\n            }\n            return true;\n        };\n        this.dialogId = utils.generateId('dlg');\n        this.data = data;\n        this.slot =\n            domel('div', document.body)\n                .attr('tab-index', '-1')\n                .data('dialog-id', this.dialogId)\n                .addClass(`${cssPrefix}-modal`, 'is-active')\n                .focus()\n                .addChild('div', b => b\n                .addClass('kdlg-modal-background'))\n                .addChild('div', b => this.windowElement = b\n                .addClass(`${cssPrefix}-modal-window`)\n                .addChild('header', b => {\n                this.headerElement = b\n                    .addClass(`${cssPrefix}-header`)\n                    .addChild('p', b => b\n                    .addClass(`${cssPrefix}-header-title`)\n                    .addText(options.title))\n                    .toDOM();\n                if (options.closable !== false)\n                    b.addChild('button', b => b\n                        .addClass(`${cssPrefix}-modal-close`)\n                        .on('click', () => {\n                        this.cancelHandler();\n                    })\n                        .focus());\n            })\n                .addChild('div', b => {\n                b.addClass(`${cssPrefix}-alert-container`);\n                this.alertElement = b.toDOM();\n            })\n                .addChild('section', b => {\n                this.bodyElement = b\n                    .addClass(`${cssPrefix}-body`)\n                    .toDOM();\n                if (typeof options.body === 'string') {\n                    const html = liquid.renderLiquidTemplate(options.body, data);\n                    b.addHtml(html);\n                }\n                else {\n                    b.addChildElement(options.body);\n                }\n            })\n                .addChild('footer', b => {\n                let alignClass = null;\n                if (options.footerAlignment && options.footerAlignment == DialogFooterAlignment.Center) {\n                    alignClass = 'align-center';\n                }\n                else {\n                    alignClass = 'align-right';\n                }\n                this.footerElement = b\n                    .addClass(`${cssPrefix}-footer`)\n                    .toDOM();\n                b.addClass(alignClass);\n                if (options.submitable === false)\n                    return;\n                b.addChild('button', bb => {\n                    bb.id(this.dialogId + '-btn-submit')\n                        .addClass('kfrm-button', 'is-info')\n                        .addText(options.submitButtonText || i18n.getText('ButtonOK'));\n                    if (options.recaptchaSiteKey) {\n                        bb.data('sitekey', options.recaptchaSiteKey);\n                        bb.addClass('g-recaptcha');\n                        bb.on('click', (e) => {\n                            if (grecaptcha) {\n                                grecaptcha.ready(() => {\n                                    grecaptcha.execute(options.recaptchaSiteKey, { action: 'submit' })\n                                        .then((token) => {\n                                        this.submitHandler(token);\n                                    });\n                                });\n                            }\n                            else {\n                                this.submitHandler();\n                            }\n                        });\n                    }\n                    else {\n                        bb.on('click', (e) => {\n                            this.submitHandler();\n                        });\n                    }\n                    bb.focus();\n                });\n                if (options.cancelable !== false)\n                    b.addChild('button', bb => bb\n                        .id(this.dialogId + '-btn-cancel')\n                        .addClass('kfrm-button')\n                        .addText(options.cancelButtonText || i18n.getText('ButtonCancel'))\n                        .on('click', (e) => {\n                        this.cancelHandler();\n                    }));\n            })\n                .toDOM())\n                .toDOM();\n    }\n    getData() {\n        return this.data;\n    }\n    getRootElement() {\n        return this.slot;\n    }\n    getSubmitButtonElement() {\n        return document.getElementById(this.dialogId + '-btn-submit');\n    }\n    getCancelButtonElement() {\n        return document.getElementById(this.dialogId + '-btn-cancel');\n    }\n    open() {\n        if (this.options.beforeOpen) {\n            this.options.beforeOpen(this);\n        }\n        domel(this.slot).show();\n        if (this.options.arrangeParents) {\n            this.arrangeParents(true);\n        }\n        const windowDiv = this.slot\n            .querySelector(`.${cssPrefix}-modal-window`);\n        if (this.options.height) {\n            windowDiv.style.height = typeof this.options.height === 'string'\n                ? this.options.height\n                : `${this.options.height}px`;\n        }\n        if (this.options.width) {\n            windowDiv.style.width = typeof this.options.width === 'string'\n                ? this.options.width\n                : `${this.options.width}px`;\n        }\n        if (this.options.submitOnEnter) {\n            window.addEventListener('keydown', this.keydownHandler, false);\n        }\n        //clear alert on change in any input element \n        this.slot.querySelectorAll('input')\n            .forEach(element => element.addEventListener('input', () => {\n            this.clearAlert();\n            if (this.options.onInput) {\n                this.options.onInput(this);\n            }\n        }));\n        if (this.options.onShow) {\n            this.options.onShow(this);\n        }\n    }\n    submit() {\n        this.submitHandler();\n    }\n    cancel() {\n        this.cancelHandler();\n    }\n    close() {\n        this.destroy();\n    }\n    disableButtons() {\n        const buttons = this.slot.querySelectorAll('button');\n        buttons.forEach(button => button.disabled = true);\n    }\n    enableButtons() {\n        const buttons = this.slot.querySelectorAll('button');\n        buttons.forEach(button => button.disabled = false);\n    }\n    showAlert(text, reason, replace) {\n        let alert = domel('div')\n            .addClass(`${cssPrefix}-alert ${reason || ''}`)\n            .addChild('span', b => b\n            .addClass(`${cssPrefix}-alert-closebtn`)\n            .text('')\n            .on('click', (ev) => {\n            const alert = ev.target.parentElement;\n            alert.parentElement.removeChild(alert);\n        }))\n            .addText(text)\n            .toDOM();\n        if (replace === true) {\n            this.clearAlert();\n        }\n        this.alertElement.appendChild(alert);\n    }\n    clearAlert() {\n        this.alertElement.innerHTML = '';\n    }\n    destroy() {\n        const elem = document.querySelectorAll(`[data-dialog-id=\"${this.dialogId}\"]`);\n        if (elem.length <= 0)\n            return;\n        if (this.options.arrangeParents) {\n            this.arrangeParents(false);\n        }\n        document.body.removeChild(this.slot);\n        if (this.options.submitOnEnter) {\n            window.removeEventListener('keydown', this.keydownHandler, false);\n        }\n        if (this.options.onDestroy) {\n            this.options.onDestroy(this);\n        }\n    }\n    isActiveDialog() {\n        const windowDivs = document.documentElement.querySelectorAll('.kdlg-modal');\n        return windowDivs[windowDivs.length - 1] === this.slot;\n    }\n    arrangeParents(turnOn) {\n        const windowDivs = document.documentElement.querySelectorAll('.kdlg-modal-window');\n        for (let i = 0; i < windowDivs.length - 1; i++) {\n            if (turnOn) {\n                const offset = i == 0 ? 20 : i * 40 + 20;\n                domel(windowDivs[i])\n                    .setStyle('margin-top', `${offset}px`)\n                    .setStyle('margin-left', `${offset}px`);\n            }\n            else {\n                domel(windowDivs[i])\n                    .removeStyle('margin-top')\n                    .removeStyle('margin-left');\n            }\n        }\n    }\n}\nclass DefaultProgressDialog extends DefaultDialog {\n    constructor(options, data) {\n        let contentElement;\n        let progressElement;\n        const body = domel('div')\n            .addChild('div', b => contentElement = b\n            .text(options.content || '')\n            .toDOM())\n            .addChild('div', b => {\n            b\n                .addClass(`${cssPrefix}-progress-line`)\n                .addChild('div', b => {\n                progressElement = b\n                    .addClass('fill')\n                    .toDOM();\n                if (options.determinated) {\n                    b.setStyle('width', '0%');\n                }\n                else {\n                    b.addClass('indeterminate');\n                }\n            });\n        })\n            .toDOM();\n        super({\n            title: options.title,\n            body: body,\n            beforeOpen: options.beforeOpen,\n            onSubmit: options.onSubmit,\n            width: options.width,\n            height: options.height,\n            submitable: false,\n            cancelable: false,\n            closable: false,\n            onDestroy: options.onDestroy\n        }, data);\n        this.contentElement = contentElement;\n        this.progressElement = progressElement;\n    }\n    updateContent(content) {\n        this.contentElement.innerText = content;\n    }\n    updateProgress(progress) {\n        progress = this.in01(progress);\n        this.progressElement.style.width = `${progress * 100}%`;\n        if (progress === 1) {\n            // postpone for 0.5s for smooth closing\n            setTimeout(() => {\n                this.submit();\n            }, 500);\n        }\n    }\n    in01(num) {\n        if (num > 1)\n            return 1;\n        if (num < 0)\n            return 0;\n        return num;\n    }\n}\nclass DefaultDialogSet {\n    constructor(options, dialogService) {\n        this.options = options;\n        this.dialogService = dialogService;\n        this.currentDialog = null;\n        this.currentIndex = 0;\n        this.options = options;\n        this.dialogService = dialogService;\n    }\n    getCurrent() {\n        return this.currentDialog;\n    }\n    openNext(data) {\n        return this.open(this.currentIndex + 1, data);\n    }\n    openPrev(data) {\n        return this.open(this.currentIndex - 1, data);\n    }\n    open(page, data) {\n        if (page < 0) {\n            this.currentIndex = 0;\n        }\n        else if (page >= this.options.length) {\n            this.currentIndex = this.options.length - 1;\n        }\n        else {\n            this.currentIndex = page;\n        }\n        if (this.currentDialog) {\n            try {\n                this.currentDialog.close();\n            }\n            catch (e) { }\n        }\n        const dlgOptions = this.options[this.currentIndex];\n        this.currentDialog = this.dialogService.open(dlgOptions, data);\n        return this.currentDialog;\n    }\n    close() {\n        if (this.currentDialog) {\n            this.currentDialog.close();\n            this.currentDialog = null;\n        }\n    }\n}\n\nfunction addEasyDataUITexts() {\n    i18n.updateDefaultTexts({\n        GridPageInfo: '{FirstPageRecordNum} - {LastPageRecordNum} of {Total} records',\n        GridItemsPerPage: 'items per page',\n        ButtonOK: \"OK\",\n        ButtonCancel: \"Cancel\",\n        ButtonApply: 'Apply',\n        ButtonNow: 'Now',\n        LblTotal: 'Total'\n    });\n}\naddEasyDataUITexts();\n\nvar PRE_SELECT;\n(function (PRE_SELECT) {\n    PRE_SELECT[PRE_SELECT[\"THIS_WEEK\"] = 0] = \"THIS_WEEK\";\n    PRE_SELECT[PRE_SELECT[\"LAST_WEEK\"] = 1] = \"LAST_WEEK\";\n    PRE_SELECT[PRE_SELECT[\"THIS_MONTH\"] = 2] = \"THIS_MONTH\";\n    PRE_SELECT[PRE_SELECT[\"FIRST_MONTH\"] = 3] = \"FIRST_MONTH\";\n    PRE_SELECT[PRE_SELECT[\"LAST_MONTH\"] = 4] = \"LAST_MONTH\";\n    PRE_SELECT[PRE_SELECT[\"THIS_YEAR\"] = 5] = \"THIS_YEAR\";\n    PRE_SELECT[PRE_SELECT[\"QUARTER_1\"] = 6] = \"QUARTER_1\";\n    PRE_SELECT[PRE_SELECT[\"QUARTER_2\"] = 7] = \"QUARTER_2\";\n    PRE_SELECT[PRE_SELECT[\"QUARTER_3\"] = 8] = \"QUARTER_3\";\n    PRE_SELECT[PRE_SELECT[\"QUARTER_4\"] = 9] = \"QUARTER_4\";\n})(PRE_SELECT || (PRE_SELECT = {}));\nvar JUMP_TO;\n(function (JUMP_TO) {\n    JUMP_TO[\"UNDEF\"] = \"-1\";\n    JUMP_TO[\"TODAY\"] = \"1\";\n    JUMP_TO[\"YESTERDAY\"] = \"2\";\n    JUMP_TO[\"TOMORROW\"] = \"3\";\n    JUMP_TO[\"WEEK_START\"] = \"4\";\n    JUMP_TO[\"WEEK_END\"] = \"5\";\n    JUMP_TO[\"MONTH_START\"] = \"6\";\n    JUMP_TO[\"MONTH_END\"] = \"7\";\n    JUMP_TO[\"YEAR_START\"] = \"8\";\n    JUMP_TO[\"YEAR_END\"] = \"9\";\n})(JUMP_TO || (JUMP_TO = {}));\nconst DEFAULT_WEEK_START = 0;\nclass TimeSpanPicker extends DefaultDialog {\n    constructor(options) {\n        super({\n            title: options.title || `Select a period`,\n            body: \"\",\n            submitButtonText: options.submitButtonText || `OK`,\n            cancelButtonText: options.cancelButtonText || `Cancel`,\n            submitable: true,\n            closable: true,\n            cancelable: true,\n            beforeOpen: (dlg) => {\n                this.setupDialog();\n            },\n            onSubmit: (dlg) => {\n                if (typeof options.onSubmit === \"function\") {\n                    options.onSubmit.apply(dlg, [this.result(this.from), this.result(this.to)]);\n                }\n            }\n        });\n        this.yearRange = options.yearRange;\n        this.weekStart = options.weekStart || DEFAULT_WEEK_START;\n        this.bodyElement.append(this.drawDialog());\n        this.calendar1.render();\n        this.calendar2.render();\n        this.from = this.alignDate(options.start ? options.start : new Date());\n        this.to = this.alignDate(options.finish && this.alignDate(options.finish) > this.from ? options.finish : new Date(this.from.getFullYear(), this.from.getMonth(), this.from.getDate() + 1));\n        this.represent();\n    }\n    alignDate(date) {\n        date.setHours(0);\n        date.setMinutes(0);\n        date.setSeconds(0);\n        date.setMilliseconds(0);\n        return date;\n    }\n    drawDialog() {\n        const body = domel('div')\n            .addClass('tsp__container')\n            .addChild('div', b => {\n            b\n                .addClass('tsp__intervals')\n                .addChild('button', b => b.addClass('tsp__button').addText('This Week').on('click', () => { this.select(PRE_SELECT.THIS_WEEK); }))\n                .addChild('button', b => b.addClass('tsp__button').addText('Last Week').on('click', () => { this.select(PRE_SELECT.LAST_WEEK); }))\n                .addChild('button', b => b.addClass('tsp__button').addText('This Month').on('click', () => { this.select(PRE_SELECT.THIS_MONTH); }))\n                .addChild('button', b => b.addClass('tsp__button').addText('First Month').on('click', () => { this.select(PRE_SELECT.FIRST_MONTH); }))\n                .addChild('button', b => b.addClass('tsp__button').addText('Last Month').on('click', () => { this.select(PRE_SELECT.LAST_MONTH); }))\n                .addChild('button', b => b.addClass('tsp__button').addText('This Year').on('click', () => { this.select(PRE_SELECT.THIS_YEAR); }))\n                .addChild('button', b => b.addClass('tsp__button').addText('Quarter 1').on('click', () => { this.select(PRE_SELECT.QUARTER_1); }))\n                .addChild('button', b => b.addClass('tsp__button').addText('Quarter 2').on('click', () => { this.select(PRE_SELECT.QUARTER_2); }))\n                .addChild('button', b => b.addClass('tsp__button').addText('Quarter 3').on('click', () => { this.select(PRE_SELECT.QUARTER_3); }))\n                .addChild('button', b => b.addClass('tsp__button').addText('Quarter 4').on('click', () => { this.select(PRE_SELECT.QUARTER_4); }));\n        })\n            .addChild('div', b => {\n            b\n                .addClass('tsp__form')\n                .addChild('div', b => {\n                b\n                    .addClass('tsp__date')\n                    .addChild('div', b => {\n                    b\n                        .addClass('tsp__label')\n                        .addChild('label', b => {\n                        b.addText('Start');\n                    })\n                        .addChild('select', b => {\n                        b\n                            .addOption({ value: JUMP_TO.UNDEF, title: 'Jump To' })\n                            .addOption({ value: JUMP_TO.TODAY, title: 'Today' })\n                            .addOption({ value: JUMP_TO.YESTERDAY, title: 'Yesterday' })\n                            .addOption({ value: JUMP_TO.TOMORROW, title: 'Tomorrow' })\n                            .addOption({ value: JUMP_TO.WEEK_START, title: 'Week Start' })\n                            .addOption({ value: JUMP_TO.WEEK_END, title: 'Week End' })\n                            .addOption({ value: JUMP_TO.MONTH_START, title: 'Month Start' })\n                            .addOption({ value: JUMP_TO.MONTH_END, title: 'Month End' })\n                            .addOption({ value: JUMP_TO.YEAR_START, title: 'Year Start' })\n                            .addOption({ value: JUMP_TO.YEAR_END, title: 'Year End' });\n                        b.on('change', (event) => {\n                            // @ts-ignore\n                            this.jump(1, event.target.value, event.target);\n                        });\n                    });\n                })\n                    .addChild('div', b => {\n                    b.addClass('tsp__calendar');\n                    this.calendar1 = new DefaultCalendar(b.toDOM(), {\n                        yearRange: this.yearRange,\n                        showDateTimeInput: true,\n                        onDateChanged: (date) => {\n                            this.from = this.alignDate(date);\n                            this.calendar1.setDate(this.from);\n                            if (this.to < this.from) {\n                                this.to = this.from;\n                            }\n                            this.represent();\n                        },\n                        onDrawDay: (cell, date) => {\n                            if (this.alignDate(date) >= this.from && this.alignDate(date) <= this.to) {\n                                cell.classList.add(\"day-in-range\");\n                            }\n                            else {\n                                cell.classList.remove(\"day-in-range\");\n                            }\n                        }\n                    });\n                });\n            })\n                .addChild('div', b => {\n                b\n                    .addClass('tsp__date')\n                    .addChild('div', b => {\n                    b\n                        .addClass('tsp__label')\n                        .addChild('label', b => {\n                        b.addText('Finish');\n                    })\n                        .addChild('select', b => {\n                        b\n                            .addOption({ value: JUMP_TO.UNDEF, title: 'Jump To' })\n                            .addOption({ value: JUMP_TO.TODAY, title: 'Today' })\n                            .addOption({ value: JUMP_TO.YESTERDAY, title: 'Yesterday' })\n                            .addOption({ value: JUMP_TO.TOMORROW, title: 'Tomorrow' })\n                            .addOption({ value: JUMP_TO.WEEK_START, title: 'Week Start' })\n                            .addOption({ value: JUMP_TO.WEEK_END, title: 'Week End' })\n                            .addOption({ value: JUMP_TO.MONTH_START, title: 'Month Start' })\n                            .addOption({ value: JUMP_TO.MONTH_END, title: 'Month End' })\n                            .addOption({ value: JUMP_TO.YEAR_START, title: 'Year Start' })\n                            .addOption({ value: JUMP_TO.YEAR_END, title: 'Year End' });\n                        b.on('change', (event) => {\n                            // @ts-ignore\n                            this.jump(2, event.target.value, event.target);\n                        });\n                    });\n                })\n                    .addChild('div', b => {\n                    b.addClass('tsp__calendar');\n                    this.calendar2 = new DefaultCalendar(b.toDOM(), {\n                        yearRange: this.yearRange,\n                        showDateTimeInput: true,\n                        onDateChanged: (date) => {\n                            if (this.alignDate(date) >= this.from) {\n                                this.to = this.alignDate(date);\n                            }\n                            else {\n                                this.calendar2.setDate(this.to);\n                            }\n                            this.represent();\n                        },\n                        onDrawDay: (cell, date) => {\n                            if (this.alignDate(date) >= this.from && this.alignDate(date) <= this.to) {\n                                cell.classList.add(\"day-in-range\");\n                            }\n                            else {\n                                cell.classList.remove(\"day-in-range\");\n                            }\n                        }\n                    });\n                });\n            });\n        })\n            .toDOM();\n        return body;\n    }\n    setupDialog() {\n    }\n    jump(cal, to, select) {\n        let target = cal === 1 ? 'from' : 'to';\n        let jumpTo;\n        const curr = new Date();\n        switch (to) {\n            case JUMP_TO.TODAY: {\n                jumpTo = curr;\n                break;\n            }\n            case JUMP_TO.YESTERDAY: {\n                jumpTo = new Date(curr.getFullYear(), curr.getMonth(), curr.getDate() - 1);\n                break;\n            }\n            case JUMP_TO.TOMORROW: {\n                jumpTo = new Date(curr.getFullYear(), curr.getMonth(), curr.getDate() + 1);\n                break;\n            }\n            case JUMP_TO.WEEK_START: {\n                jumpTo = new Date(curr.setDate(curr.getDate() - curr.getDay() + this.weekStart));\n                break;\n            }\n            case JUMP_TO.WEEK_END: {\n                jumpTo = new Date(curr.setDate(curr.getDate() - curr.getDay() + 6 + this.weekStart));\n                break;\n            }\n            case JUMP_TO.MONTH_START: {\n                jumpTo = new Date(curr.getFullYear(), curr.getMonth(), 1);\n                break;\n            }\n            case JUMP_TO.MONTH_END: {\n                jumpTo = new Date(curr.getFullYear(), curr.getMonth() + 1, 0);\n                break;\n            }\n            case JUMP_TO.YEAR_START: {\n                jumpTo = new Date(curr.getFullYear(), 0, 1);\n                break;\n            }\n            case JUMP_TO.YEAR_END: {\n                jumpTo = new Date(curr.getFullYear(), 12, 0);\n                break;\n            }\n        }\n        jumpTo = this.alignDate(jumpTo);\n        select.value = JUMP_TO.UNDEF;\n        if (target === \"from\") {\n            this.from = jumpTo;\n            if (this.to < this.from) {\n                this.to = this.from;\n            }\n        }\n        else {\n            if (jumpTo >= this.from) {\n                this[target] = jumpTo;\n            }\n        }\n        this.represent();\n    }\n    represent() {\n        this.calendar1.setDate(this.from);\n        this.calendar2.setDate(this.to);\n    }\n    select(interval) {\n        switch (interval) {\n            case PRE_SELECT.THIS_WEEK: {\n                const curr = new Date();\n                this.from = new Date(curr.getFullYear(), curr.getMonth(), curr.getDate() - curr.getDay());\n                this.to = new Date(this.from.getFullYear(), this.from.getMonth(), this.from.getDate() + 6);\n                break;\n            }\n            case PRE_SELECT.LAST_WEEK: {\n                const curr = new Date();\n                this.from = new Date(curr.getFullYear(), curr.getMonth(), curr.getDate() - curr.getDay() - 7);\n                this.to = new Date(this.from.getFullYear(), this.from.getMonth(), this.from.getDate() + 6);\n                break;\n            }\n            case PRE_SELECT.THIS_MONTH: {\n                const curr = new Date();\n                this.from = new Date(curr.getFullYear(), curr.getMonth(), 1);\n                this.to = new Date(curr.getFullYear(), curr.getMonth() + 1, 0);\n                break;\n            }\n            case PRE_SELECT.FIRST_MONTH: {\n                const curr = new Date();\n                this.from = new Date(curr.getFullYear(), 0, 1);\n                this.to = new Date(curr.getFullYear(), 1, 0);\n                break;\n            }\n            case PRE_SELECT.LAST_MONTH: {\n                const curr = new Date();\n                this.from = new Date(curr.getFullYear(), curr.getMonth() - 1, 1);\n                this.to = new Date(curr.getFullYear(), curr.getMonth(), 0);\n                break;\n            }\n            case PRE_SELECT.THIS_YEAR: {\n                const curr = new Date();\n                this.from = new Date(curr.getFullYear(), 0, 1);\n                this.to = new Date(curr.getFullYear(), 12, 0);\n                break;\n            }\n            case PRE_SELECT.QUARTER_1: {\n                const curr = new Date();\n                this.from = new Date(curr.getFullYear(), 0, 1);\n                this.to = new Date(curr.getFullYear(), 3, 0);\n                break;\n            }\n            case PRE_SELECT.QUARTER_2: {\n                const curr = new Date();\n                this.from = new Date(curr.getFullYear(), 3, 1);\n                this.to = new Date(curr.getFullYear(), 6, 0);\n                break;\n            }\n            case PRE_SELECT.QUARTER_3: {\n                const curr = new Date();\n                this.from = new Date(curr.getFullYear(), 6, 1);\n                this.to = new Date(curr.getFullYear(), 9, 0);\n                break;\n            }\n            case PRE_SELECT.QUARTER_4: {\n                const curr = new Date();\n                this.from = new Date(curr.getFullYear(), 9, 1);\n                this.to = new Date(curr.getFullYear(), 12, 0);\n                break;\n            }\n        }\n        this.represent();\n    }\n    result(date) {\n        const curr = this.alignDate(new Date());\n        const constants = {\n            \"Today\": this.alignDate(new Date()),\n            \"Yesterday\": this.alignDate(new Date(curr.getFullYear(), curr.getMonth(), curr.getDate() - 1)),\n            \"Tomorrow\": this.alignDate(new Date(curr.getFullYear(), curr.getMonth(), curr.getDate() + 1)),\n            \"FirstDayOfMonth\": this.alignDate(new Date(curr.getFullYear(), curr.getMonth(), 1)),\n            \"LastDayOfMonth\": this.alignDate(new Date(curr.getFullYear(), curr.getMonth() + 1, 0)),\n            \"FirstDayOfWeek\": this.alignDate(new Date(curr.setDate(curr.getDate() - curr.getDay() + this.weekStart))),\n            \"FirstDayOfYear\": this.alignDate(new Date(curr.getFullYear(), 0, 1)),\n            \"FirstDayOfNextWeek\": this.alignDate(new Date(curr.setDate(curr.getDate() - curr.getDay() + this.weekStart + 7))),\n            \"FirstDayOfNextMonth\": this.alignDate(new Date(curr.getFullYear(), curr.getMonth() + 1, 1)),\n            \"FirstDayOfNextYear\": this.alignDate(new Date(curr.getFullYear() + 1, 0, 1)),\n        };\n        for (let k in constants) {\n            console.log(constants[k], date);\n            if (constants[k].getTime() === date.getTime()) {\n                return `\\${{${k}}}`;\n            }\n        }\n        return i18n.dateTimeToStr(date, i18n.getLocaleSettings().editDateFormat);\n    }\n}\nconst showTimeSpanPicker = (options) => new TimeSpanPicker(options).open();\n\n// grid\n// export dialogs to use outside of context as global\nconst dialogs = new DefaultDialogService();\n\nexport { AutoResizeColumns, Calendar, CellRendererType, DFMT_REGEX, DateTimePicker, DefaultCalendar, DefaultDateTimePicker, DefaultDialog, DefaultDialogService, DefaultDialogSet, DefaultProgressDialog, DefaultTimePicker, DialogFooterAlignment, DomElementBuilder, DomInputElementBuilder, DomSelectElementBuilder, DomTextAreaElementBuilder, DragManager, DropEffect, EasyGrid, EqDragEvent, GridCellRendererStore, GridColumn, GridColumnAlign, GridColumnList, JUMP_TO, PRE_SELECT, TimePicker, TimeSpanPicker, addCssClass, addElement, browserUtils, createBrowserEvent, dateLikeToDate, dialogs, domel, eqCssMobile, eqCssPrefix, eqDragManager, getDocSize, getElementAbsolutePos, getMobileCssClass, getScrollPos, getViewportSize, getWinSize, hideElement, isVisible, mask, showElement, showTimeSpanPicker, slideDown, slideUp, toggleVisibility, wrapInner };\n","import { utils, i18n, DataType, EasyDataTable, AggregationSettings } from '@easydata/core';\nimport { Widget, WidgetGroup, QueryChangePart, QueryChangeAction, ExprTag, SortDirection, i18n as i18n$1, equtils, eqconsts, ConditionPart, DataKind, Query, Expression, CondTag, EqEditorTag, EqValueEditor, EqServiceProvider, createEqContext } from '@easyquery/core';\nimport { browserUtils, eqDragManager, getElementAbsolutePos, getScrollPos, getWinSize, getViewportSize, domel, DropEffect, createBrowserEvent, DomElementBuilder, DefaultDateTimePicker, dateLikeToDate, slideDown, slideUp, EasyGrid, addCssClass, hideElement, showElement, isVisible, toggleVisibility, addElement, DefaultDialogService } from '@easydata/ui';\n\nfunction findHighestZIndex(elem) {\n    let highest = 0;\n    while (elem !== null) {\n        const zindex = document.defaultView.getComputedStyle(elem, null)\n            .getPropertyValue(\"z-index\");\n        if (zindex != 'auto') {\n            const numZIndex = parseInt(zindex);\n            if (numZIndex > highest) {\n                highest = numZIndex;\n            }\n        }\n        elem = elem.parentElement;\n    }\n    return highest;\n}\n// simetimes setting focus in the main thread doesn't work correctly (in Firefox). So we need to 'hack' it.\nfunction safeFocus(element) {\n    setTimeout((el) => {\n        if (el && el.focus) {\n            el.focus();\n        }\n    }, 100, element);\n}\nconst eqCssPrefix = 'eqjs';\nconst eqCssMobile = 'eqjs-mobile';\nfunction getMobileCssClass() {\n    return browserUtils.isMobileMode() ? eqCssMobile : null;\n}\n\n/**\n * The entities panel wiget, implemented without JQuery.\n */\nclass EntitiesPanel extends Widget {\n    get cssPrefix() {\n        return 'eqjs-ep';\n    }\n    /**\n     * The default constructor.\n     * @param slot The html element.\n     */\n    constructor(slot) {\n        super(slot);\n        this.queryChangedCallbackId = null;\n        this.group = WidgetGroup.Model | WidgetGroup.Query;\n        this.panel = slot;\n    }\n    getWidgetType() {\n        return 'entitiesPanel';\n    }\n    /**\n     * Initialize widget.\n     * @param context The context.\n     * @param options The options.\n     */\n    init(context, options) {\n        super.init(context, options);\n        this.setOptions(options);\n        this.renderProgressBlock();\n    }\n    /**\n    * Refresh widget implementation\n    */\n    refreshCore() {\n        this.render();\n        if (this.options.syncWithColumns) {\n            this.refreshCheckedStateByColumns();\n        }\n    }\n    onProcessStartCore() {\n        if (this.options.showIndicatorOnLoad) {\n            if (!this.progressBlock.parentNode)\n                this.panel.appendChild(this.progressBlock);\n        }\n    }\n    onProcessEndCore() {\n        if (this.options.showIndicatorOnLoad) {\n            if (this.progressBlock.parentNode)\n                this.panel.removeChild(this.progressBlock);\n        }\n    }\n    destroyCore() {\n        this.slot.innerHTML = '';\n    }\n    setOptions(options) {\n        this.options = {\n            showToolbar: true,\n            syncWithColumns: false,\n            showSelectAllButton: false,\n            showClearSelectionButton: true,\n            showAddColumnButton: true,\n            showAddConditionButton: true,\n            showCheckboxes: true,\n            showTooltips: true,\n            draggableAttributes: true,\n            showAttributes: { useInConditions: true, useInResult: true, useInSorting: false },\n            showFilterBox: false,\n            filterBoxMode: 0,\n            showIndicatorOnLoad: true,\n            attrPlacement: 0,\n            sortEntities: false,\n            autoClearSelection: true,\n            entityRenderedCallback: null,\n            attributeRenderedCallback: null,\n        };\n        if (options) {\n            utils.assignDeep(this.options, options);\n        }\n        if (this.queryChangedCallbackId) {\n            const query = this.context.getQuery();\n            query.removeChangedCallback(this.queryChangedCallbackId);\n        }\n        if (this.options.syncWithColumns) {\n            const query = this.context.getQuery();\n            this.queryChangedCallbackId = query.addChangedCallback((ev) => {\n                const edata = ev.data;\n                if (!edata || (edata.part != QueryChangePart.Columns && edata.part != QueryChangePart.All)) {\n                    return;\n                }\n                this.refreshCheckedStateByColumns();\n            });\n        }\n    }\n    render() {\n        let model = this.context.getModel();\n        this.clear();\n        this.panel.classList.add(`${this.cssPrefix}-panel`);\n        this.panel.classList.add(getMobileCssClass());\n        this.rootEntityBlock = document.createElement('div');\n        if (model != null && !model.isEmpty()) {\n            let entTree = model.getEntitiesTree({\n                addUIC: this.options.showAttributes.useInConditions && !this.options.syncWithColumns,\n                addUIR: this.options.showAttributes.useInResult,\n                addUIS: this.options.showAttributes.useInSorting && !this.options.syncWithColumns,\n                attrPlacement: this.options.attrPlacement,\n                sortEntities: this.options.sortEntities,\n                includeRootData: true\n            });\n            this.entityTreeBlock = this.renderEntity(entTree, this.rootEntityBlock, 0);\n            this.panel.appendChild(this.entityTreeBlock);\n        }\n        if (this.options.showFilterBox) {\n            this.createFilterBox();\n        }\n        else {\n            this.rootEntityBlock.style.top = '0';\n        }\n        if (this.options.showToolbar && !this.options.syncWithColumns) {\n            this.createToolPanel();\n        }\n        else {\n            this.rootEntityBlock.style.bottom = '0';\n        }\n    }\n    renderEntity(entity, block, offset) {\n        let entityBlock;\n        let entityNode = document.createElement('div');\n        entityNode.classList.add(`${this.cssPrefix}-entity-node`);\n        entityNode.classList.add(getMobileCssClass());\n        let entityChildren = document.createElement('div');\n        entityChildren.classList.add(`${this.cssPrefix}-entity-children`);\n        entityChildren.classList.add(getMobileCssClass());\n        let nodeLabel = document.createElement('label');\n        nodeLabel.classList.add(`${this.cssPrefix}-entity-node-label`);\n        let nodeInput = document.createElement('input');\n        nodeInput.type = 'checkbox';\n        nodeInput.title = entity.text;\n        let nodeToggleButton = document.createElement('a');\n        nodeToggleButton.href = 'javascript:void(0)';\n        nodeToggleButton.title = `${i18n.getText(\"EntityToggle\")} ${entity.text}`;\n        nodeToggleButton.classList.add(`${this.cssPrefix}-entity-node-button`);\n        let attrNode, attrLabel, attrInput;\n        let currentOffset = offset;\n        let isAttributeInTree = (attrId, entityBlock) => {\n            let res = entityBlock.querySelectorAll(`.${this.cssPrefix}-entity-attr[data-id=\"${attrId}\"]`);\n            return res.length > 0;\n        };\n        if (block) {\n            entityBlock = block;\n            entityBlock.innerHTML = '';\n        }\n        else {\n            entityBlock = document.createElement('div');\n        }\n        entityBlock.classList.add(`${this.cssPrefix}-entity`);\n        entityBlock.classList.add(getMobileCssClass());\n        if (entity.id && entity.id != \"\") {\n            nodeLabel.innerText = entity.text;\n            entityNode.appendChild(nodeLabel); //caption\n            if (this.options.showCheckboxes) {\n                nodeLabel.insertBefore(nodeInput, nodeLabel.firstChild);\n            }\n            entityNode.insertBefore(nodeToggleButton, entityNode.firstChild);\n            if (this.options.showTooltips && entity.description) {\n                nodeLabel.setAttribute('title', entity.description);\n            }\n            for (let i = 0; i < currentOffset; i++) {\n                let divElem = document.createElement('div');\n                divElem.classList.add(`${this.cssPrefix}-entity-offset`);\n                entityNode.insertBefore(divElem, entityNode.firstChild);\n            }\n            entityBlock.appendChild(entityNode);\n            entityChildren.hidden = true;\n            currentOffset++;\n        }\n        let itemsLength = entity.items ? entity.items.length : 0;\n        for (let i = 0; i < itemsLength; i++) {\n            let item = entity.items[i];\n            if (item.isEntity) {\n                entityChildren.appendChild(this.renderEntity(item, null, currentOffset));\n            }\n            else {\n                if (!item.lookupAttr || !(isAttributeInTree(item.lookupAttr, entityChildren))) {\n                    attrLabel = document.createElement('label');\n                    attrLabel.innerText = item.text;\n                    attrLabel.classList.add(`${this.cssPrefix}-entity-attr-label`);\n                    if (this.options.showCheckboxes) {\n                        attrInput = document.createElement('input');\n                        attrInput.type = 'checkbox';\n                        attrInput.title = item.text;\n                        attrLabel.insertBefore(attrInput, attrLabel.firstChild);\n                        if (this.options.syncWithColumns) {\n                            attrInput.addEventListener('change', (ev) => {\n                                const model = this.context.getModel();\n                                const query = this.context.getQuery();\n                                const checkbox = ev.currentTarget;\n                                const attrId = checkbox.parentElement.parentElement.getAttribute('data-id');\n                                if (model.checkAttrProperty(attrId, \"useInResult\")) {\n                                    if (checkbox.checked) {\n                                        const attr = model.getAttributeById(attrId);\n                                        const column = query.addColumn({\n                                            attribute: attr\n                                        }, true);\n                                        query.fireColumnsChangedEvent(QueryChangeAction.Add, column);\n                                    }\n                                    else {\n                                        const columns = query.getColumns()\n                                            .filter(col => col.expr.tag === ExprTag.EntityAttribute\n                                            && col.expr.value === attrId);\n                                        if (columns.length > 0) {\n                                            query.removeColumn(columns[0]);\n                                            query.fireColumnsChangedEvent(QueryChangeAction.Delete, columns[0]);\n                                        }\n                                    }\n                                }\n                            });\n                        }\n                    }\n                    if (this.options.showTooltips && item.description) {\n                        attrLabel.setAttribute('title', item.description);\n                    }\n                    for (let j = 0; j < currentOffset + 1; j++) {\n                        let divElem = document.createElement('div');\n                        divElem.classList.add(`${this.cssPrefix}-entity-offset`);\n                        attrLabel.insertBefore(divElem, attrLabel.firstChild);\n                    }\n                    attrNode = document.createElement('div');\n                    attrNode.classList.add(`${this.cssPrefix}-entity-attr`);\n                    if (entityNode.innerHTML.length == 0) {\n                        attrNode.classList.add(`${this.cssPrefix}-entity-attr-root`);\n                    }\n                    attrNode.innerHTML = \"\";\n                    attrNode.appendChild(attrLabel);\n                    attrNode.setAttribute('data-id', item.id);\n                    if (this.options.draggableAttributes && !this.options.syncWithColumns) {\n                        eqDragManager.registerDraggableItem({\n                            element: attrNode,\n                            scope: \"entityAttr\",\n                            data: { attrId: item.id },\n                            renderer: (dragImage) => {\n                                dragImage.innerHTML = '';\n                                const attrLabel = document.createElement('span');\n                                attrLabel.innerText = item.text;\n                                dragImage.appendChild(attrLabel);\n                            }\n                        });\n                    }\n                    if (this.options.attributeRenderedCallback) {\n                        this.options.attributeRenderedCallback(attrNode);\n                    }\n                    entityChildren.appendChild(attrNode);\n                }\n            }\n        }\n        if (entityChildren.innerHTML.length) {\n            entityBlock.appendChild(entityChildren);\n            nodeToggleButton.addEventListener('click', (event) => {\n                entityChildren.hidden = !entityChildren.hidden;\n                let element = event.target;\n                let className = `${this.cssPrefix}-entity-node-button-open`;\n                if (element.classList.contains(className)) {\n                    element.classList.remove(className);\n                }\n                else {\n                    element.classList.add(className);\n                }\n                event.preventDefault();\n            });\n        }\n        if (entityChildren) {\n            const checkboxes = entityChildren.querySelectorAll(`.${this.cssPrefix}-entity-attr > label > input`);\n            for (let i = 0; i < checkboxes.length; i++) {\n                const checkbox = checkboxes[i];\n                checkbox.addEventListener('click', (event) => {\n                    let element = event.target;\n                    if (element.checked && !nodeInput.checked) {\n                        nodeInput.checked = true;\n                    }\n                    else if (entityChildren.querySelectorAll('input:checked').length === 0) {\n                        nodeInput.checked = false;\n                    }\n                    event.stopPropagation();\n                });\n            }\n        }\n        nodeInput.addEventListener('click', (event) => {\n            let element = event.target;\n            const entities = entityChildren.querySelectorAll('label input');\n            for (let i = 0; i < entities.length; i++) {\n                const entity = entities[i];\n                entity.checked = element.checked;\n            }\n            if (this.options.syncWithColumns) {\n                const query = this.context.getQuery();\n                const model = this.context.getModel();\n                const attrList = [];\n                const attrElems = Array.from(entityChildren.querySelectorAll(`.${this.cssPrefix}-entity-attr`));\n                for (const elem of attrElems) {\n                    const attrId = elem.getAttribute('data-id');\n                    if (model.checkAttrProperty(attrId, 'useInResult')) {\n                        attrList.push(attrId);\n                    }\n                }\n                if (element.checked) {\n                    for (const attrId of attrList) {\n                        query.addColumn({ attributeId: attrId }, true);\n                    }\n                }\n                else {\n                    const columns = query.getColumns()\n                        .filter(col => col.expr.tag === ExprTag.EntityAttribute\n                        && attrList.indexOf(col.expr.value) >= 0);\n                    query.removeColumns(columns, null);\n                }\n                query.fireColumnsChangedEvent();\n            }\n            event.stopPropagation();\n        });\n        if (block != this.rootEntityBlock && this.options.entityRenderedCallback) {\n            this.options.entityRenderedCallback(entityBlock);\n        }\n        return entityBlock;\n    }\n    createFilterBox() {\n        this.filterBoxBlock = document.createElement('div');\n        this.filterBoxBlock.classList.add(`${this.cssPrefix}-filter-box`);\n        this.filterBoxBlock.classList.add(getMobileCssClass());\n        this.filterBoxInput = document.createElement('input');\n        this.filterBoxInput.classList.add(`${this.cssPrefix}-filter-box-input`);\n        this.filterBoxInput.addEventListener('input', (e) => {\n            const attrs = this.panel.querySelectorAll(`.${this.cssPrefix}-entity-attr`);\n            for (let i = 0; i < attrs.length; i++) {\n                const attr = attrs[i];\n                attr.hidden = !this.checkFilterAttribute(attr);\n            }\n            const entities = this.panel.querySelectorAll(`:scope > .${this.cssPrefix}-entity`);\n            for (let i = 0; i < entities.length; i++) {\n                const entity = entities[i];\n                let attrs = entity.querySelectorAll(`.${this.cssPrefix}-entity-attr`);\n                let displayAttrCount = 0;\n                for (let i = 0; i < attrs.length; i++) {\n                    if (attrs[i].style.display !== 'None') {\n                        displayAttrCount++;\n                    }\n                }\n                entity.hidden = displayAttrCount === 0;\n            }\n            if (this.filterBoxInput.value === '')\n                this.collapseAll();\n            else\n                this.expandAll();\n        });\n        this.filterBoxBlock.appendChild(this.filterBoxInput);\n        this.panel.insertBefore(this.filterBoxBlock, this.panel.firstChild);\n    }\n    createToolPanel() {\n        let defClass = `${this.cssPrefix}-tool-panel`;\n        let toolPanelBlock = document.createElement('div');\n        toolPanelBlock.classList.add(defClass);\n        toolPanelBlock.classList.add(getMobileCssClass());\n        let toolSelectAll = document.createElement('div');\n        toolSelectAll.classList.add(`${defClass}-select-all`);\n        toolSelectAll.title = 'Select all';\n        let toolDeselectAll = document.createElement('div');\n        toolDeselectAll.classList.add(`${defClass}-deselect-all`);\n        toolDeselectAll.title = 'Clear selection';\n        let toolAddColumns = document.createElement('div');\n        toolAddColumns.classList.add(`${defClass}-add-columns`);\n        toolAddColumns.title = 'Add column';\n        let toolAddCond = document.createElement('div');\n        toolAddCond.classList.add(`${defClass}-add-cond`);\n        toolAddCond.title = 'Add condition';\n        let toolLeftBlock = document.createElement('div');\n        toolLeftBlock.classList.add(`${defClass}-left-side`);\n        let toolRightBlock = document.createElement('div');\n        toolRightBlock.classList.add(`${defClass}-right-side`);\n        let model = this.context.getModel();\n        if (this.options.showSelectAllButton) {\n            toolSelectAll.title = i18n.getText(\"ButtonSelectAll\");\n            toolLeftBlock.appendChild(toolSelectAll);\n            toolSelectAll.addEventListener('click', () => {\n                this.selectAll();\n            });\n        }\n        if (this.options.showClearSelectionButton) {\n            toolDeselectAll.title = i18n.getText(\"ButtonDeselectAll\");\n            toolLeftBlock.appendChild(toolDeselectAll);\n            toolDeselectAll.addEventListener('click', () => {\n                this.deselectAll();\n            });\n        }\n        if (this.options.showAddColumnButton) {\n            toolAddColumns.title = i18n.getText(\"ButtonAddColumns\");\n            toolRightBlock.appendChild(toolAddColumns);\n            toolAddColumns.addEventListener('click', () => {\n                const attrElements = this.panel.querySelectorAll(`.${this.cssPrefix}-entity-attr`);\n                let attrList = [];\n                let attrId;\n                const query = this.context.getQuery();\n                query.fireProcessEvent({\n                    source: self,\n                    status: \"start\"\n                });\n                for (let i = 0; i < attrElements.length; i++) {\n                    const attrElement = attrElements[i];\n                    let input = attrElement.getElementsByTagName('input')[0];\n                    if (input.checked) {\n                        attrId = attrElement.getAttribute('data-id');\n                        if (model.checkAttrProperty(attrId, \"useInResult\")) {\n                            attrList.push(attrId);\n                        }\n                    }\n                }\n                for (let attrId of attrList) {\n                    const attr = model.getAttributeById(attrId);\n                    query.addColumn({\n                        attribute: attr\n                    }, true);\n                }\n                query.fireChangedEvent();\n                if (this.options.autoClearSelection) {\n                    this.deselectAll();\n                }\n                query.fireProcessEvent({\n                    source: self,\n                    status: \"finish\"\n                });\n            });\n        }\n        if (this.options.showAddConditionButton) {\n            toolAddCond.title = i18n.getText(\"ButtonAddConditions\");\n            toolRightBlock.appendChild(toolAddCond);\n            toolAddCond.addEventListener('click', () => {\n                let attrElements = this.panel.querySelectorAll(`.${this.cssPrefix}-entity-attr`);\n                let attrList = [];\n                let attrId;\n                let query = this.context.getQuery();\n                query.fireProcessEvent({\n                    source: self,\n                    status: \"start\"\n                });\n                for (let i = 0; i < attrElements.length; i++) {\n                    const attrElement = attrElements[i];\n                    let input = attrElement.getElementsByTagName('input')[0];\n                    if (input.checked) {\n                        attrId = attrElement.getAttribute('data-id');\n                        if (model.checkAttrProperty(attrId, \"useInConditions\")) {\n                            attrList.push(attrId);\n                        }\n                    }\n                }\n                for (let attrId of attrList) {\n                    query.addSimpleCondition({\n                        attributeId: attrId\n                    });\n                }\n                query.fireChangedEvent();\n                if (this.options.autoClearSelection) {\n                    this.deselectAll();\n                }\n                query.fireProcessEvent({\n                    source: self,\n                    status: \"finish\"\n                });\n            });\n        }\n        toolPanelBlock.appendChild(toolLeftBlock);\n        toolPanelBlock.appendChild(toolRightBlock);\n        this.panel.appendChild(toolPanelBlock);\n    }\n    checkFilterAttribute(attr) {\n        const inputElem = attr.querySelector('label input');\n        if (inputElem.checked) {\n            return true;\n        }\n        const labelElem = attr.querySelector('label');\n        const attrCaption = labelElem.textContent;\n        if (this.checkFilterText(attrCaption)) {\n            return true;\n        }\n        const entityNode = attr.parentElement.parentElement.querySelector(`.${this.cssPrefix}-entity-node`);\n        const entityCaption = entityNode.querySelector('label').textContent;\n        if (this.checkFilterText(entityCaption)) {\n            return true;\n        }\n        return false;\n    }\n    checkFilterText(value) {\n        let filterText = this.filterBoxInput.value;\n        if (filterText == \"\")\n            return true;\n        if (this.options.filterBoxMode == 0 && value.toLowerCase().indexOf(filterText.toLowerCase()) >= 0)\n            return true;\n        if (this.options.filterBoxMode == 1 && value.toLowerCase().indexOf(filterText.toLowerCase()) == 0)\n            return true;\n        return false;\n    }\n    refreshCheckedStateByColumns() {\n        this.deselectAll();\n        const query = this.context.getQuery();\n        const exprColumns = query.getColumns()\n            .filter(col => col.expr.tag === ExprTag.EntityAttribute);\n        for (const column of exprColumns) {\n            const attrNode = this.rootEntityBlock\n                .querySelector(`.${this.cssPrefix}-entity-attr[data-id=\"${column.expr.value}\"]`);\n            let checkbox = attrNode.querySelector(`label > input`);\n            checkbox.checked = true;\n            let entChildren = attrNode.parentElement;\n            while (entChildren\n                && entChildren.classList\n                    .contains(`${this.cssPrefix}-entity-children`)) {\n                entChildren.hidden = false;\n                const entElem = entChildren.parentElement;\n                if (entElem && entChildren !== entElem.firstElementChild) {\n                    checkbox = entElem.firstElementChild\n                        .querySelector(`label > input`);\n                    checkbox.checked = true;\n                    entChildren = entElem.parentElement;\n                }\n                else {\n                    break;\n                }\n            }\n        }\n    }\n    expandAll() {\n        for (let i = 0; i < this.rootEntityBlock.childNodes.length; i++) {\n            const child = this.rootEntityBlock.childNodes[0];\n            const childs = child.querySelectorAll(`.${this.cssPrefix}-entity-children`);\n            for (let j = 0; j < childs.length; j++) {\n                const elem = childs[j];\n                elem.hidden = false;\n            }\n        }\n        const nodeButtons = this.rootEntityBlock.querySelectorAll(`.${this.cssPrefix}-entity-node-button`);\n        for (let i = 0; i < nodeButtons.length; i++) {\n            const elem = nodeButtons[i];\n            elem.classList.add(`${this.cssPrefix}-entity-node-button-open`);\n        }\n    }\n    collapseAll() {\n        for (let i = 0; i < this.rootEntityBlock.childNodes.length; i++) {\n            const child = this.rootEntityBlock.childNodes[0];\n            const childs = child.querySelectorAll(`.${this.cssPrefix}-entity-children`);\n            for (let j = 0; j < childs.length; j++) {\n                const elem = childs[j];\n                elem.hidden = true;\n            }\n        }\n        const nodeButtons = this.rootEntityBlock.querySelectorAll(`.${this.cssPrefix}-entity-node-button`);\n        for (let i = 0; i < nodeButtons.length; i++) {\n            const elem = nodeButtons[i];\n            elem.classList.remove(`${this.cssPrefix}-entity-node-button-open`);\n        }\n    }\n    selectAll() {\n        const inputs = this.entityTreeBlock.querySelectorAll('input');\n        for (let i = 0; i < inputs.length; i++) {\n            const input = inputs[i];\n            input.checked = true;\n        }\n    }\n    deselectAll() {\n        const inputs = this.entityTreeBlock.querySelectorAll('input');\n        for (let i = 0; i < inputs.length; i++) {\n            const input = inputs[i];\n            input.checked = false;\n        }\n    }\n    renderProgressBlock() {\n        this.progressBlock = document.createElement('div');\n        this.progressBlock.classList.add(`${eqCssPrefix}-progress-win8`);\n        this.progressBlock.classList.add(getMobileCssClass());\n        this.progressBlock.innerHTML = '<div class=\"wBall\" id=\"wBall_1\"><div class=\"wInnerBall\"></div></div><div class=\"wBall\" id=\"wBall_2\"><div class=\"wInnerBall\"></div></div><div class=\"wBall\" id=\"wBall_3\"><div class=\"wInnerBall\"></div></div><div class=\"wBall\" id=\"wBall_4\"><div class=\"wInnerBall\"></div></div><div class=\"wBall\" id=\"wBall_5\"><div class=\"wInnerBall\"></div></div>';\n    }\n    clear() {\n        this.panel.innerHTML = \"\";\n    }\n}\n\nvar ColumnsEditMode;\n(function (ColumnsEditMode) {\n    /**\n     * ReadOnly edit mode allows to view columns but doesn't allow to change them.\n     */\n    ColumnsEditMode[ColumnsEditMode[\"ReadOnly\"] = 0] = \"ReadOnly\";\n    /**\n     * FixedList edit mode allows to edit some columns parameters (formats, sorting) and change their order\n     * but doesn't allow to add or delete columns.\n     */\n    ColumnsEditMode[ColumnsEditMode[\"FixedList\"] = 16] = \"FixedList\";\n    /**\n     * Full edit mode allows to add, delete and change columns in any way.\n     */\n    ColumnsEditMode[ColumnsEditMode[\"Full\"] = 255] = \"Full\";\n})(ColumnsEditMode || (ColumnsEditMode = {}));\nvar ConditionsEditMode;\n(function (ConditionsEditMode) {\n    /**\n     * No edit mode means that conditions are not editable at all.\n     */\n    ConditionsEditMode[ConditionsEditMode[\"Default\"] = 0] = \"Default\";\n    /**\n     * ReadOnly edit mode allows to view conditions but doesn't allow to change them, including the condition type, operator, value, etc.\n     */\n    ConditionsEditMode[ConditionsEditMode[\"ReadOnly\"] = 1] = \"ReadOnly\";\n    /**\n     * FixedList edit mode allows to modify some parameters of conditions (like their operators or values) but doesn't allow to add or delete conditions.\n     */\n    ConditionsEditMode[ConditionsEditMode[\"FixedList\"] = 16] = \"FixedList\";\n    /**\n     * Full edit mode allows to add, delete and change conditions in any way.\n     */\n    ConditionsEditMode[ConditionsEditMode[\"Full\"] = 255] = \"Full\";\n})(ConditionsEditMode || (ConditionsEditMode = {}));\n\nclass MenuLevel {\n    get applyItem() {\n        return this._applyItem;\n    }\n    get cssPrefix() {\n        return 'eqjs-menu';\n    }\n    constructor(options) {\n        this.isFilteringMode = false;\n        this.showSelected = false;\n        //menu, items, levelIndex\n        this.parentMenu = options.menu || null;\n        this.parentLevel = options.parent || null;\n        this.parentElement = options.container || document.body;\n        this.levelIndex = options.levelIndex || 0;\n        this.levelDiv = null;\n        this.domWriteItemsId = options.domWriteItemsId || false;\n        this.menuId = options.menuId || '';\n        this.itemRenderedCallback = options.itemRenderedCallback || null;\n        //we need to define special \"apply\" item for this level\n        this._applyItem = { id: null, text: null, itemDiv: null };\n        this.items = options.items || [];\n        this.activeItem = null;\n        this.selectedItem = null;\n        this.initialized = false;\n        this.showSelected = options.showSelected;\n        this.updated = 0;\n        this.renderContent();\n    }\n    getItems() {\n        return this.items;\n    }\n    setItems(items) {\n        this.items = items;\n    }\n    renderContent() {\n        if (!this.items) {\n            return;\n        }\n        //define internal variables used in this function\n        const itemBgColor = this.parentMenu.style.colors.bgON || \"white\";\n        const itemFgColor = this.parentMenu.style.colors.fgON || \"black\";\n        this.parentMenu.style.colors.bgOVER || \"LightSteelBlue\";\n        const itemFontFamily = this.parentMenu.style.itemStyle.fontFamily || \"\";\n        const itemFontSize = this.parentMenu.style.itemStyle.fontSize || \"14px\";\n        const multiselect = this.parentMenu.options.multiselect;\n        const isSubQuery = this.parentMenu.options.isSubQuery;\n        //add base DIV element which is also used to show the shadow\n        const baseDivBuilder = domel('div')\n            .addClass(getMobileCssClass());\n        if (this.parentMenu.options.useDefaultStyles) {\n            baseDivBuilder\n                .setStyle('backgroundColor', itemBgColor)\n                .setStyle('border', '1px solid')\n                .setStyle('borderColor', itemBgColor)\n                .setStyle('backgroundColor', this.parentMenu.style.colors.border)\n                .setStyle('margin', '-2px 2px 2px -2px')\n                .setStyle('width', 'auto')\n                .setStyle('height', 'auto');\n        }\n        baseDivBuilder\n            .setStyle('z-index', this.parentMenu.zIndex)\n            .setStyle('position', 'absolute')\n            .setStyle('display', 'none');\n        let baseDiv = baseDivBuilder.toDOM();\n        baseDiv['menuLevel'] = this;\n        const applyItem = this._applyItem;\n        //if multiselect option is on - then we should add special \"apply\" item\n        if (multiselect && this.levelIndex === 0 && this.parentMenu.options.hideButtons !== true) {\n            this.applyDiv = document.createElement(\"div\");\n            this.applyDiv.classList.add(`${this.cssPrefix}-applyDiv`);\n            this.applyDiv['menuItem'] = applyItem;\n            this.applyBtn = document.createElement('button');\n            if (this.parentMenu.options.useDefaultStyles) {\n                this.applyDiv.style.borderBottom = '1px solid';\n                this.applyDiv.style.padding = '5px';\n                this.applyDiv.style.marginBottom = '5px';\n                this.applyBtn.style.padding = '0 5px';\n                this.applyBtn.style.cursor = \"pointer\";\n            }\n            const applyTextNode = document.createTextNode(this.parentMenu.options.buttons.submit);\n            this.applyBtn.appendChild(applyTextNode);\n            this.applyDiv.appendChild(this.applyBtn);\n            //cancel btn\n            const cancelBtn = document.createElement('button');\n            cancelBtn.classList.add(`${this.cssPrefix}-cancel`);\n            if (this.parentMenu.options.useDefaultStyles) {\n                cancelBtn.style.padding = '0 5px';\n                cancelBtn.style.cursor = 'pointer';\n                cancelBtn.style.marginLeft = '15px';\n            }\n            const cancelText = document.createTextNode(this.parentMenu.options.buttons.cancel);\n            cancelBtn.appendChild(cancelText);\n            this.applyDiv.appendChild(cancelBtn);\n            baseDiv.appendChild(this.applyDiv);\n            applyItem.itemDiv = this.applyDiv;\n            this.applyBtn.addEventListener('click', () => {\n                this.submit(this._applyItem);\n            });\n            cancelBtn.addEventListener('click', () => {\n                this.parentMenu.hideMenu();\n            });\n        }\n        // if too many items - then we add a special \"search\" item\n        // or there is an options to show always\n        if (this.parentLevel == null\n            && (this.parentMenu.options.searchBoxAlwaysShown || this.items.length >= this.parentMenu.options.showSearchBoxAfter)) {\n            const searchDivBuilder = domel('div')\n                .addClass(`${this.cssPrefix}-searchDiv`);\n            if (this.parentMenu.options.useDefaultStyles) {\n                searchDivBuilder\n                    .setStyle('border-bottom', '1px solid #666')\n                    .setStyle('background-color', itemBgColor)\n                    .setStyle('border-color', this.parentMenu.style.colors.border);\n                if (itemFontFamily != \"\") {\n                    searchDivBuilder.setStyle('font-family', itemFontFamily);\n                }\n                searchDivBuilder\n                    .setStyle('font-size', itemFontSize)\n                    .setStyle('color', itemFgColor)\n                    .setStyle('cursor', 'pointer')\n                    .setStyle('text-align', 'left')\n                    .setStyle('padding', '5px');\n            }\n            const searchEditBoxBuilder = domel('input')\n                .id('searchBox')\n                .name('searchBox')\n                .type('text')\n                .size(16)\n                .addClass(`${this.cssPrefix}-searchBox`)\n                .on('input', (ev) => {\n                this.deactivateItem(this.activeItem);\n                this.renderItems(this.searchBox.value);\n            })\n                .on('keydown', (ev) => {\n                let keyCode = ev.keyCode;\n                switch (keyCode) {\n                    case 13: //enter\n                        if (this.activeItem) {\n                            this.activeItem.itemDiv.click();\n                        }\n                        break;\n                    case 38: // up\n                        this.moveActiveItemUp();\n                        break;\n                    case 40: // down\n                        this.moveActiveItemDown();\n                        break;\n                    case 39: // right\n                        if (!this.searchBox.value) {\n                            this.openSubLevel(this.activeItem);\n                        }\n                        break;\n                }\n            });\n            if (this.parentMenu.options.useDefaultStyles) {\n                searchEditBoxBuilder\n                    .setStyle('font-family', 'monospace')\n                    .setStyle('font-size', '8pt')\n                    .setStyle('width', '100%');\n            }\n            if (isSubQuery) {\n                searchEditBoxBuilder.addClass('eqjs-dialog');\n            }\n            this.searchBox = searchEditBoxBuilder.toDOM();\n            this.searchDiv = searchDivBuilder.toDOM();\n            this.searchDiv.appendChild(this.searchBox);\n            baseDiv.appendChild(this.searchDiv);\n        }\n        const scrollDiv = document.createElement(\"div\");\n        scrollDiv.tabIndex = 1;\n        domel(scrollDiv)\n            .addClass(`${this.cssPrefix}-scrollDiv`)\n            .addClass(getMobileCssClass());\n        scrollDiv.style.overflowX = \"hidden\";\n        scrollDiv.style.overflowY = \"auto\";\n        scrollDiv.style.position = \"relative\";\n        baseDiv.appendChild(scrollDiv);\n        this.levelDiv = baseDiv;\n        this.scrollDiv = scrollDiv;\n        if (this.menuId) {\n            this.levelDiv.id = this.menuId;\n        }\n        if (this.parentLevel) {\n            this.levelDiv.style.zIndex\n                = this.parentLevel.levelDiv.style.zIndex;\n        }\n        this.renderItems();\n        const scrollDivKeyDownHandler = (event) => {\n            switch (event.which) {\n                case 13: // enter\n                    if (this.parentMenu.options.multiselect) {\n                        this.parentMenu.getRootLevel().applyBtn.click();\n                    }\n                    else {\n                        if (this.activeItem) {\n                            this.activeItem.itemDiv.click();\n                        }\n                    }\n                    break;\n                case 32: // space\n                    if (this.activeItem) {\n                        this.activeItem.itemDiv.click();\n                    }\n                    break;\n                case 37: // left\n                    if (this.parentLevel && !this.isFilteringMode) {\n                        this.deactivateItem(this.activeItem);\n                        this.parentLevel.focus();\n                    }\n                    break;\n                case 39: // right\n                    this.openSubLevel(this.activeItem);\n                    break;\n                case 38: // up\n                    this.moveActiveItemUp();\n                    break;\n                case 40: // down\n                    this.moveActiveItemDown();\n                    break;\n                default: return; // exit this handler for other keys\n            }\n            event.preventDefault(); // prevent the default action (scroll / move caret)            \n        };\n        scrollDiv.addEventListener(\"keydown\", scrollDivKeyDownHandler);\n        if (browserUtils.isMobileMode()) {\n            this.closeDiv =\n                domel('div', baseDiv)\n                    .addClass('eqjs-menu-close-btn')\n                    .addText(i18n.getText('ButtonClose'))\n                    .on('click', () => {\n                    this.parentMenu.hideMenu();\n                })\n                    .toDOM();\n        }\n    }\n    moveActiveItemDown() {\n        const items = this.isFilteringMode ? this.filteredItems : this.items;\n        if (this.activeItem) {\n            const idx = items.indexOf(this.activeItem);\n            if (idx < items.length - 1) {\n                this.activateItem(items[idx + 1], false);\n            }\n        }\n        else {\n            this.activateItem(items[0], false);\n        }\n    }\n    moveActiveItemUp() {\n        const items = this.isFilteringMode ? this.filteredItems : this.items;\n        if (this.activeItem) {\n            const idx = items.indexOf(this.activeItem);\n            if (idx > 0) {\n                this.activateItem(items[idx - 1], false);\n            }\n        }\n        else {\n            this.activateItem(items[items.length - 1], false);\n        }\n    }\n    openSubLevel(menuItem) {\n        if (menuItem && menuItem.items && !this.isFilteringMode) {\n            this.showSubLevel(menuItem);\n            menuItem.subLevel.activateItem(menuItem.subLevel.items[0]);\n        }\n    }\n    focusScrollDiv() {\n        this.scrollDiv.focus();\n    }\n    turnCheckboxes(items) {\n        //turn checkboxes on for selected items\n        for (let i = 0; i < items.length; i++) {\n            const item = items[i];\n            if (item.itemCheckbox)\n                item.itemCheckbox.checked = this.isItemSelected(item);\n            if (item.items) {\n                this.turnCheckboxes(item.items);\n            }\n        }\n    }\n    isItemSelected(item) {\n        if (item.items) {\n            for (var i = 0; i < item.items.length; i++) {\n                if (this.isItemSelected(item.items[i])) {\n                    return true;\n                }\n            }\n            return false;\n        }\n        else {\n            return item.selected;\n        }\n    }\n    setItemSelected(item, value) {\n        if (item.items) {\n            for (let i = 0; i < item.items.length; i++) {\n                this.setItemSelected(item.items[i], value);\n            }\n        }\n        else {\n            item.selected = value;\n        }\n    }\n    submitItems(items, selectedItems) {\n        for (let j = 0; j < items.length; j++) {\n            if (items[j].items) {\n                this.submitItems(items[j].items, selectedItems);\n            }\n            else {\n                if (items[j].selected) {\n                    selectedItems.push(items[j]);\n                }\n            }\n        }\n    }\n    allSubitemsAreFiltered(items, filterCallback) {\n        for (let i = 0; i < items.length; i++) {\n            if (filterCallback(items[i]))\n                return false;\n        }\n        return true;\n    }\n    isItemDiv(element) {\n        return element['menuItem'] ? true : false;\n    }\n    isLevelDiv(element) {\n        return element['menuLevel'] ? true : false;\n    }\n    getMenuItem(element) {\n        let el = element;\n        while (!this.isItemDiv(el)) {\n            if (this.isLevelDiv(el)) {\n                throw \"Can't get menu item\";\n            }\n            el = el.parentElement;\n        }\n        return el['menuItem'];\n    }\n    renderItemsWithoutFilter() {\n        this.isFilteringMode = false;\n        const scrollDiv = this.scrollDiv;\n        const multiselect = this.parentMenu.options.multiselect;\n        const activateOnMouseOver = this.parentMenu.options.activateOnMouseOver;\n        const itemFgColor = this.parentMenu.style.colors.fgON || 'black';\n        this.parentMenu.style.colors.bgOVER || 'LightSteelBlue';\n        const itemFontSize = this.parentMenu.style.itemStyle.fontSize || '14px';\n        const itemFilterCallback = this.parentMenu.getItemFilterCallback();\n        scrollDiv.innerHTML = \"\";\n        for (let i = 0; i < this.items.length; i++) {\n            const item = this.items[i];\n            if (!item || !item.text)\n                continue;\n            if (itemFilterCallback) {\n                if (!itemFilterCallback(item))\n                    continue;\n                if (item.items && this.allSubitemsAreFiltered(item.items, itemFilterCallback))\n                    continue;\n            }\n            item.data = (propName) => {\n                return this[propName];\n            };\n            if (typeof (item.selected) == \"undefined\") {\n                item.selected = false;\n            }\n            if (item.selected && this.selectedItem == null) {\n                this.selectedItem = item;\n            }\n            const itemDiv = document.createElement(\"div\");\n            domel(itemDiv)\n                .addClass(`${this.cssPrefix}-itemDiv`)\n                .addClass(getMobileCssClass());\n            if (item.selected && this.showSelected && !multiselect) {\n                itemDiv.classList.add(`${this.cssPrefix}-selected`);\n            }\n            if (this.domWriteItemsId && this.menuId) {\n                itemDiv.id = 'item-' + this.menuId + '-' + item.id;\n            }\n            scrollDiv.appendChild(itemDiv);\n            itemDiv['menuItem'] = item;\n            itemDiv['menuLevel'] = this;\n            item.itemDiv = itemDiv;\n            if (this.parentMenu.options.useDefaultStyles) {\n                itemDiv.style.fontSize = itemFontSize;\n                itemDiv.style.color = itemFgColor;\n                itemDiv.style.paddingLeft = \"15px\";\n                itemDiv.style.paddingRight = \"6px\";\n                itemDiv.style.cursor = \"pointer\";\n            }\n            if (item.text == '---') {\n                itemDiv.appendChild(document.createElement('hr'));\n            }\n            else {\n                if (multiselect) {\n                    var cb = document.createElement(\"input\");\n                    cb.type = \"checkbox\";\n                    cb.id = \"cb\" + item.id;\n                    cb.checked = this.isItemSelected(item);\n                    cb.defaultChecked = this.isItemSelected(item);\n                    itemDiv.appendChild(cb);\n                    item.itemCheckbox = cb;\n                    if (this.parentMenu.options.useDefaultStyles) {\n                        cb.style.margin = \"4px 10px 0 0\";\n                        cb.style.verticalAlign = \"top\";\n                    }\n                }\n                let itemText = item.text;\n                if (this.parentMenu.options.showItemIds) {\n                    itemText = item.id + ':' + itemText;\n                }\n                const itemTextNode = document.createTextNode(itemText);\n                itemDiv.appendChild(itemTextNode);\n                if (item.items && item.items.length > 0) {\n                    itemDiv.classList.add(`${this.cssPrefix}-itemDiv-hasChildren`);\n                    const arrowSpan = document.createElement('span');\n                    arrowSpan.classList.add(`${this.cssPrefix}-itemDiv-arrow`);\n                    itemDiv.appendChild(arrowSpan);\n                    const arrowText = document.createTextNode('>');\n                    arrowSpan.appendChild(arrowText);\n                }\n                const itemClickHandler = (ev) => {\n                    const menuItem = this.getMenuItem(ev.target);\n                    if (multiselect) {\n                        if (!menuItem.items || ev.target == menuItem.itemCheckbox) {\n                            const itemSelected = this.isItemSelected(menuItem);\n                            this.setItemSelected(menuItem, !itemSelected);\n                            menuItem.itemCheckbox.checked = !itemSelected;\n                            this.parentMenu.refreshCheckboxes();\n                        }\n                        else {\n                            this.activateItem(menuItem);\n                        }\n                    }\n                    else {\n                        this.activateItem(menuItem);\n                        this.submit(menuItem);\n                    }\n                    return false;\n                };\n                itemDiv.removeEventListener(\"click\", itemClickHandler);\n                itemDiv.addEventListener('click', itemClickHandler);\n                itemDiv.addEventListener('mouseenter', (ev) => {\n                    const item = this.getMenuItem(ev.target);\n                    this.parentMenu.isCursorInside = true;\n                    if (activateOnMouseOver) {\n                        this.activateItem(item);\n                    }\n                });\n                itemDiv.addEventListener('mouseleave', (ev) => {\n                    const item = this.getMenuItem(ev.target);\n                    this.parentMenu.isCursorInside = false;\n                    setTimeout(() => {\n                        if (!this.parentMenu.isCursorInside) {\n                            if (activateOnMouseOver && item == this.activeItem && !item.subLevel) {\n                                this.deactivateItem(item);\n                            }\n                        }\n                    }, 200);\n                });\n            }\n            if (this.itemRenderedCallback) {\n                this.itemRenderedCallback(this.menuId, itemDiv);\n            }\n        }\n    }\n    renderItemsWithFilter(filter) {\n        this.isFilteringMode = true;\n        const scrollDiv = this.scrollDiv;\n        scrollDiv.innerHTML = \"\";\n        const filterSections = filter.split('>');\n        const pureFilterTexts = filterSections.map(section => section.replace(/\\*/g, ''));\n        const items = this.filterItems(this.items, filterSections);\n        this.filteredItems = [];\n        for (let i = 0; i < items.length; i++) {\n            this.renderItemWithFilter(items[i], pureFilterTexts, 0);\n        }\n    }\n    matchesFilter(text, regexp) {\n        if (text && regexp) {\n            return regexp.test(text);\n        }\n        else {\n            return true;\n        }\n    }\n    filterItems(items, filterSections) {\n        const resultItems = [];\n        const filter = filterSections.length > 0 ? filterSections[0] : '';\n        const restFilterSections = filterSections.length > 1 ? filterSections.slice(1) : filterSections;\n        const filterRegexp = filter ? new RegExp(filter.replace(/\\*/g, '.+?'), 'i') : null;\n        for (let i = 0; i < items.length; i++) {\n            const item = items[i];\n            if (item.items) {\n                const groupItem = utils.assign({}, item);\n                const groupItemMatches = this.matchesFilter(item.text, filterRegexp);\n                //if we have only one filter section (or an empty filter)\n                if (filterSections.length < 2) {\n                    //if current group item matches the filter -> show all sub-items\n                    if (groupItemMatches && filterSections.length < 2) {\n                        groupItem.items = utils.createArrayFrom(item.items);\n                    }\n                    else {\n                        groupItem.items = this.filterItems(item.items, restFilterSections);\n                    }\n                }\n                //if we have more than 1 filter section and there is a match -> filter sub-items as well\n                else if (groupItemMatches) {\n                    groupItem.items = this.filterItems(item.items, restFilterSections);\n                }\n                //otherwise we skip this group at all\n                else {\n                    groupItem.items = [];\n                }\n                if (groupItem.items.length > 0) {\n                    resultItems.push(groupItem);\n                }\n            }\n            else {\n                if (this.matchesFilter(item.text, filterRegexp)) {\n                    resultItems.push(item);\n                }\n            }\n        }\n        return resultItems;\n    }\n    renderItemWithFilter(item, filterTexts, level) {\n        const scrollDiv = this.scrollDiv;\n        const levelFilterText = level < filterTexts.length ? filterTexts[level] : filterTexts[filterTexts.length - 1];\n        const multiselect = this.parentMenu.options.multiselect;\n        const activateOnMouseOver = this.parentMenu.options.activateOnMouseOver;\n        const itemFgColor = this.parentMenu.style.colors.fgON || 'black';\n        this.parentMenu.style.colors.bgOVER || 'LightSteelBlue';\n        const itemFontSize = this.parentMenu.style.itemStyle.fontSize || '14px';\n        const itemFilterCallback = this.parentMenu.getItemFilterCallback();\n        if (!item || !item.text)\n            return;\n        if (itemFilterCallback) {\n            if (!itemFilterCallback(item))\n                return;\n            if (item.items && this.allSubitemsAreFiltered(item.items, itemFilterCallback))\n                return;\n        }\n        item.data = function (propName) {\n            return this[propName];\n        };\n        if (typeof (item.selected) == \"undefined\") {\n            item.selected = false;\n        }\n        if (item.selected && this.selectedItem == null) {\n            this.selectedItem = item;\n        }\n        const itemDiv = document.createElement(\"div\");\n        domel(itemDiv)\n            .addClass(`${this.cssPrefix}-itemDiv`)\n            .addClass(getMobileCssClass());\n        itemDiv.style.marginLeft = `${level * 10}px`;\n        if (item.selected && !multiselect) {\n            itemDiv.classList.add(`${this.cssPrefix}-selected`);\n        }\n        if (this.domWriteItemsId && this.menuId) {\n            itemDiv.id = 'item-' + this.menuId + '-' + item.id;\n        }\n        scrollDiv.appendChild(itemDiv);\n        itemDiv['menuItem'] = item;\n        itemDiv['menuLevel'] = this;\n        item.itemDiv = itemDiv;\n        if (this.parentMenu.options.useDefaultStyles) {\n            itemDiv.style.fontSize = itemFontSize;\n            itemDiv.style.color = itemFgColor;\n            itemDiv.style.paddingLeft = \"15px\";\n            itemDiv.style.paddingRight = \"6px\";\n            itemDiv.style.cursor = \"pointer\";\n        }\n        if (item.text == '---') {\n            itemDiv.appendChild(document.createElement('hr'));\n        }\n        else {\n            if (multiselect) {\n                var cb = document.createElement(\"input\");\n                cb.type = \"checkbox\";\n                cb.id = \"cb\" + item.id;\n                cb.checked = this.isItemSelected(item);\n                cb.defaultChecked = this.isItemSelected(item);\n                itemDiv.appendChild(cb);\n                item.itemCheckbox = cb;\n                if (this.parentMenu.options.useDefaultStyles) {\n                    cb.style.margin = \"4px 10px 0 0\";\n                    cb.style.verticalAlign = \"top\";\n                }\n            }\n            const itemText = document.createElement('span');\n            itemText.innerHTML = this.highlightText(item.text, levelFilterText);\n            itemDiv.appendChild(itemText);\n            if (item.items && item.items.length > 0) {\n                itemDiv.classList.add(`${this.cssPrefix}-itemDiv-filter-hasChildren`);\n            }\n            else {\n                this.filteredItems.push(item);\n                const itemClickHandler = (event) => {\n                    if (multiselect) {\n                        if (!item.items || event.target == item.itemCheckbox) {\n                            const itemSelected = this.isItemSelected(item);\n                            this.setItemSelected(item, !itemSelected);\n                            item.itemCheckbox.checked = !itemSelected;\n                            this.parentMenu.refreshCheckboxes();\n                        }\n                        else {\n                            this.activateItem(item);\n                        }\n                    }\n                    else {\n                        this.activateItem(item);\n                        this.submit(item);\n                    }\n                    return false;\n                };\n                itemDiv.removeEventListener(\"click\", itemClickHandler);\n                itemDiv.addEventListener('click', itemClickHandler);\n                itemDiv.addEventListener('mouseenter', (ev) => {\n                    this.parentMenu.isCursorInside = true;\n                    if (activateOnMouseOver) {\n                        this.activateItem(item);\n                    }\n                });\n                itemDiv.addEventListener('mouseleave', (ev) => {\n                    this.parentMenu.isCursorInside = false;\n                    setTimeout(() => {\n                        if (!this.parentMenu.isCursorInside) {\n                            if (activateOnMouseOver && item == this.activeItem && !item.subLevel) {\n                                this.deactivateItem(item);\n                            }\n                        }\n                    }, 200);\n                });\n            }\n        }\n        if (item.items) {\n            for (let i = 0; i < item.items.length; i++) {\n                this.renderItemWithFilter(item.items[i], filterTexts, level + 1);\n            }\n        }\n        if (this.itemRenderedCallback) {\n            this.itemRenderedCallback(this.menuId, itemDiv);\n        }\n    }\n    highlightText(content, text) {\n        if (text && text.length > 0) {\n            const lowerText = text.toLowerCase();\n            const lowerContent = content.toLowerCase();\n            const insertValue1 = `<span class='eqjs-menu-itemDiv-highlight'>`;\n            const insertValue2 = `</span>`;\n            const startIndex = lowerContent.indexOf(lowerText);\n            if (startIndex >= 0) {\n                let pos = 0;\n                const value = content;\n                const indexInMas = [];\n                while (true) {\n                    const index = lowerContent.indexOf(lowerText, pos);\n                    if (index >= 0) {\n                        indexInMas.push(index);\n                        pos = index + text.length;\n                    }\n                    else {\n                        pos++;\n                    }\n                    if (pos >= value.length - 1) {\n                        break;\n                    }\n                }\n                if (indexInMas.length > 0) {\n                    content = '';\n                    for (let i = 0; i < indexInMas.length; i++) {\n                        if (i === 0) {\n                            content += value.substring(0, indexInMas[i]);\n                        }\n                        content += insertValue1 + value.substring(indexInMas[i], indexInMas[i] + text.length) + insertValue2;\n                        if (i < indexInMas.length - 1) {\n                            content += value.substring(indexInMas[i] + text.length, indexInMas[i + 1]);\n                        }\n                        else {\n                            content += value.substring(indexInMas[i] + text.length);\n                        }\n                    }\n                }\n            }\n        }\n        return content;\n    }\n    renderItems(filter) {\n        if (!filter && !browserUtils.isMobileMode()) {\n            this.renderItemsWithoutFilter();\n        }\n        else {\n            filter = filter || '';\n            this.renderItemsWithFilter(filter.toLowerCase());\n        }\n    }\n    activateItem(menuItem, openSubLevel = true) {\n        if (this.activeItem != null) {\n            this.deactivateItem(this.activeItem);\n        }\n        this.activeItem = menuItem;\n        const rowElement = menuItem.itemDiv;\n        rowElement.classList.add('active');\n        if (this.parentMenu.options.useDefaultStyles) {\n            this.parentMenu.style.colors.bgON;\n            this.parentMenu.style.colors.fgON;\n            const itemOverBgColor = this.parentMenu.style.colors.bgOVER;\n            const itemOverFgColor = this.parentMenu.style.colors.fgOVER || \"\";\n            this.parentMenu.style.itemClass || \"\";\n            const itemClassOver = this.parentMenu.style.itemClassOver || \"\";\n            if (itemClassOver != \"\") {\n                rowElement.style.backgroundColor = \"\";\n                rowElement.style.color = \"\";\n            }\n            else {\n                rowElement.style.backgroundColor = itemOverBgColor;\n                rowElement.style.color = itemOverFgColor;\n            }\n        }\n        if (menuItem.items && !this.isFilteringMode && openSubLevel) {\n            this.showSubLevel(menuItem);\n        }\n    }\n    deactivateItem(menuItem) {\n        if (!menuItem)\n            return;\n        const rowElement = menuItem.itemDiv;\n        rowElement.classList.remove('active');\n        if (this.parentMenu.options.useDefaultStyles) {\n            const itemBgColor = this.parentMenu.style.colors.bgON;\n            const itemFgColor = this.parentMenu.style.colors.fgON;\n            const itemClass = this.parentMenu.style.itemClass || \"\";\n            if (itemClass != \"\") {\n                rowElement.style.backgroundColor = \"\";\n                rowElement.style.color = \"\";\n            }\n            else {\n                rowElement.style.backgroundColor = itemBgColor;\n                rowElement.style.color = itemFgColor;\n            }\n        }\n        if (menuItem.subLevel) {\n            menuItem.subLevel.hide();\n        }\n        this.activeItem = null;\n    }\n    showSubLevel(menuItem) {\n        if (!menuItem.subLevel) {\n            let levelId = '';\n            if (this.menuId) {\n                levelId = this.menuId + \"-\" + menuItem.id;\n            }\n            menuItem.subLevel = new MenuLevel({\n                showSelected: this.showSelected,\n                menu: this.parentMenu,\n                parent: this,\n                container: this.parentElement,\n                items: menuItem.items,\n                levelIndex: this.levelIndex + 1,\n                domWriteItemsId: this.domWriteItemsId,\n                menuId: levelId,\n                itemRenderedCallback: this.itemRenderedCallback\n            });\n        }\n        const pos = getElementAbsolutePos(menuItem.itemDiv);\n        menuItem.itemDiv.getBoundingClientRect();\n        const scroll = getScrollPos();\n        const winSize = getWinSize();\n        //show menu to the side that have more space available\n        const leftSpace = pos.x - scroll.left;\n        const rightSpace = winSize.width - leftSpace - menuItem.itemDiv.offsetWidth;\n        pos.x += menuItem.itemDiv.offsetParent.offsetWidth;\n        pos.y -= 5;\n        menuItem.subLevel.showAt(pos.x, pos.y, true, true);\n        menuItem.subLevel.levelDiv.style.width = '';\n        menuItem.subLevel.levelDiv.style.right = '';\n        if ((rightSpace >= menuItem.subLevel.levelDiv.offsetWidth) || (rightSpace >= leftSpace)) { //show level to the right\n            if (rightSpace < menuItem.subLevel.levelDiv.offsetWidth) {\n                menuItem.subLevel.levelDiv.style.right = -scroll.left + 'px';\n            }\n        }\n        else { //show level to the left\n            if (leftSpace < menuItem.subLevel.levelDiv.offsetWidth) {\n                menuItem.subLevel.levelDiv.style.left = scroll.left + 4 + 'px';\n            }\n            else {\n                menuItem.subLevel.levelDiv.style.left = '';\n            }\n            menuItem.subLevel.levelDiv.style.right = getViewportSize().width - pos.x + menuItem.itemDiv.offsetWidth - 6 + 'px';\n        }\n        menuItem.subLevel.levelDiv.style.visibility = 'visible';\n        menuItem.subLevel.focus();\n    }\n    adjustTopPos(top) {\n        const winSize = getWinSize();\n        const levelBottom = top - getScrollPos().top + this.levelDiv.offsetHeight;\n        let res = top;\n        if (levelBottom > winSize.height - 5) {\n            res -= levelBottom - winSize.height + 5;\n            if (res < getScrollPos().top) {\n                res = getScrollPos().top + 10;\n            }\n        }\n        return res;\n    }\n    showAt(x, y, adjustTopPos, hidden, anchor) {\n        if (!this.items) {\n            return;\n        }\n        this.initLevelDiv();\n        //crocodile\n        this.turnCheckboxes(this.items);\n        this.renderItems();\n        getWinSize();\n        const levelStyle = this.levelDiv.style;\n        if (hidden) {\n            this.levelDiv.style.visibility = 'hidden';\n        }\n        levelStyle.display = 'block';\n        levelStyle.left = x + 'px';\n        levelStyle.top = y + 'px';\n        this.scrollDiv.style.width = \"auto\";\n        this.scrollDiv.style.height = \"auto\";\n        this.scrollDiv.style.maxHeight = null;\n        const useMaxSpace = this.parentMenu.options.useMaxSpace;\n        const viewportHeight = getViewportSize().height;\n        const anchorRect = anchor ? anchor.getBoundingClientRect() : null;\n        const anchorHeight = anchorRect ? anchorRect.height : 0;\n        const upperSpace = y - scrollY;\n        const lowerSpace = viewportHeight - upperSpace - anchorHeight;\n        const minOffset = 15;\n        //   \n        let levelDivRect = this.levelDiv.getBoundingClientRect();\n        if (this.levelIndex == 0 && levelDivRect.height < lowerSpace - minOffset) { //root level. Have enough space to drop down without scroll\n            levelStyle.top = (y + anchorHeight) + 'px';\n        }\n        else if (this.levelIndex == 0 && levelDivRect.height < upperSpace - minOffset) { //root level. Have enough space to drop up without scroll\n            levelStyle.top = (y - levelDivRect.height) + 'px';\n        }\n        else if (useMaxSpace || this.levelIndex > 0) { //sub-level or useMaxSpace option set. Use all the space\n            const outsideBottom = levelDivRect.bottom + minOffset - scrollY - viewportHeight;\n            if (outsideBottom > 0) {\n                levelStyle.top = levelDivRect.top - outsideBottom + 'px';\n            }\n            levelDivRect = this.levelDiv.getBoundingClientRect();\n            const outsideTop = scrollY + minOffset - levelDivRect.top;\n            if (outsideTop > 0) {\n                const scrollDivRect = this.scrollDiv.getBoundingClientRect();\n                this.scrollDiv.style.maxHeight = scrollDivRect.height - outsideTop + 'px';\n                levelStyle.top = levelDivRect.top + outsideTop + 'px';\n            }\n        }\n        else if (upperSpace <= lowerSpace) { //root level. Drop down with scroll\n            levelStyle.top = (y + anchorHeight) + 'px';\n            const outsideBottom = levelDivRect.height + minOffset - lowerSpace;\n            if (outsideBottom > 0) {\n                const scrollDivRect = this.scrollDiv.getBoundingClientRect();\n                this.scrollDiv.style.maxHeight = scrollDivRect.height - outsideBottom + 'px';\n            }\n        }\n        else { //root level. Drop up with scroll\n            y -= levelDivRect.height;\n            const outsideTop = scrollY + minOffset - y;\n            if (outsideTop > 0) {\n                const scrollDivRect = this.scrollDiv.getBoundingClientRect();\n                this.scrollDiv.style.maxHeight = scrollDivRect.height - outsideTop + 'px';\n                y += outsideTop;\n            }\n            levelStyle.top = y + 'px';\n        }\n        //setting minimal level width if it is defined\n        let minItemWidth = this.parentMenu.minItemWidth;\n        if (minItemWidth > 0 && this.scrollDiv.offsetWidth < minItemWidth) {\n            for (let i = 0; i < this.items.length; i++) {\n                this.items[i].itemDiv.style.width = minItemWidth + \"px\";\n            }\n        }\n        let maxItemWidth = this.parentMenu.maxItemWidth;\n        if (maxItemWidth > 0 && this.scrollDiv.offsetWidth > maxItemWidth) {\n            for (let i = 0; i < this.items.length; i++) {\n                this.items[i].itemDiv.style.width = maxItemWidth + \"px\";\n                this.items[i].itemDiv.style.overflowX = \"hidden\";\n            }\n        }\n        this.activeItem = null;\n    }\n    focus() {\n        window.setTimeout(() => {\n            this.scrollDiv.focus();\n            if (this.searchBox != null) {\n                if (this.parentMenu.options.searchBoxAutoFocus) {\n                    this.searchBox.focus();\n                }\n                this.searchBox.value = \"\";\n            }\n        }, 100);\n    }\n    hide() {\n        if (this.activeItem !== null) {\n            if (this.activeItem.subLevel) {\n                this.activeItem.subLevel.hide();\n            }\n        }\n        if (this.levelDiv) {\n            var levelStyle = this.levelDiv.style;\n            levelStyle.display = 'none';\n            if (this.initialized) {\n                this.parentElement.removeChild(this.levelDiv);\n                this.initialized = false;\n            }\n        }\n    }\n    initLevelDiv() {\n        if (!this.initialized) {\n            this.parentElement.appendChild(this.levelDiv);\n            domel(this.levelDiv)\n                .addClass(`${this.cssPrefix}-levelDiv`)\n                .addClass(getMobileCssClass());\n            this.initialized = true;\n        }\n    }\n    submit(menuItem) {\n        if (menuItem != null) {\n            if (!menuItem.items) {\n                this.parentMenu.hideMenu();\n                let selectedItems = [];\n                if (menuItem == this._applyItem) {\n                    this.submitItems(this.items, selectedItems);\n                }\n                this.parentMenu.submitMenu(menuItem, selectedItems);\n            }\n        }\n    }\n    remove() {\n        //remove old level elements\n        for (let i = 0; i < this.items.length; i++) {\n            let item = this.items[i];\n            if (item.subLevel) {\n                item.subLevel.remove();\n            }\n        }\n        if (this.levelDiv) {\n            this.levelDiv.innerHTML = \"\";\n            const parentNode = this.levelDiv.parentNode;\n            if (parentNode != null) {\n                parentNode.removeChild(this.levelDiv);\n            }\n        }\n        this.levelDiv = null;\n    }\n    update(newItems) {\n        this.remove();\n        //create new level\n        this.items = newItems;\n        this.activeItem = null;\n        this.selectedItem = null;\n        this._applyItem.itemDiv = null;\n        this.initialized = false;\n        this.updated++;\n        this.renderContent();\n    }\n    refreshCheckboxes() {\n        for (var i = 0; i < this.items.length; i++) {\n            var item = this.items[i];\n            if (item.itemCheckbox) {\n                item.itemCheckbox.checked = this.isItemSelected(item);\n            }\n            if (item.subLevel) {\n                item.subLevel.refreshCheckboxes();\n            }\n        }\n    }\n    refreshItems() {\n        for (let i = 0; i < this.items.length; i++) {\n            const item = this.items[i];\n            if (item.itemDiv) {\n                if (item.hidden) {\n                    item.itemDiv.style.display = \"none\";\n                }\n                else {\n                    item.itemDiv.style.display = \"block\";\n                }\n            }\n            if (item.subLevel) {\n                item.subLevel.refreshItems();\n            }\n        }\n    }\n    findItem(searchedText) {\n        const txt = searchedText.toLowerCase();\n        for (let i = 0; i < this.items.length; i++) {\n            const item = this.items[i];\n            if (item.text.toLowerCase().indexOf(txt) == 0) {\n                return item;\n            }\n        }\n        return null;\n    }\n}\nclass PopupMenu {\n    get cssPrefix() {\n        return 'eqjs-menu';\n    }\n    constructor(options) {\n        this.isCursorInside = false;\n        this.mouseIsOverBlock = false;\n        this.mouseIsOverLink = false;\n        this.toId = null;\n        this.active = false;\n        this.ancorFocused = null;\n        this.options = {\n            items: [],\n            buttons: {\n                submit: i18n.getText('ButtonApply'),\n                cancel: i18n.getText('ButtonCancel')\n            },\n            itemFilterCallback: null,\n            useDefaultStyles: false,\n            multiselect: false,\n            adjustHeight: true,\n            showSearchBoxAfter: 30,\n            activateOnMouseOver: true,\n            container: document.body,\n            domWriteItemsId: false,\n            itemRenderedCallback: null,\n            showItemIds: false,\n            useMaxSpace: true,\n        };\n        if (options) {\n            utils.assign(this.options, options);\n            utils.assign(this.options.buttons, options.buttons);\n        }\n        if (this.options.hideButtons) {\n            this.options.submitOnBlur = true;\n        }\n        this.menuId = PopupMenu.lastMenuID++;\n        this.updateProps();\n        this.rootLevel = new MenuLevel({\n            menu: this,\n            items: this.options.items,\n            levelIndex: 0,\n            container: this.options.container,\n            domWriteItemsId: this.options.domWriteItemsId,\n            menuId: this.options.id,\n            itemRenderedCallback: this.options.itemRenderedCallback,\n            showSelected: this.options.showSelected,\n        });\n        this.rootLevel.levelDiv.classList.add(`${this.cssPrefix}-rootLevel`);\n        if (this.options.zIndex)\n            this.rootLevel.levelDiv.style.zIndex = `${this.options.zIndex}`;\n        this.menuKeyUpHandler = (e) => {\n            if (e.which == 27) {\n                this.hideMenu();\n                e.stopImmediatePropagation();\n            }\n        };\n        this.globalMouseDownHandler = (e) => {\n            if (!this.active)\n                return true;\n            let event = window.event || e;\n            let o = event.srcElement || event.target;\n            let isOutside = true;\n            while (o) {\n                if (o.tagName && o.tagName.toLowerCase() == 'div') {\n                    // it is added in renderContent of MenuLevel class\n                    if (o.menuLevel) {\n                        if (o.menuLevel.parentMenu == this) {\n                            isOutside = false;\n                            break;\n                        }\n                    }\n                }\n                o = o.parentNode || o.parentElement;\n            }\n            if (isOutside) {\n                if (this.options.submitOnBlur) {\n                    this.rootLevel.submit(this.rootLevel.applyItem);\n                }\n                this.hideMenu();\n            }\n            return true;\n        };\n        this.render();\n    }\n    getItems() {\n        return this.rootLevel.getItems();\n    }\n    updateProps() {\n        this.style = {};\n        this.style.colors = { border: \"#666666\", shadow: \"#888888\", bgON: \"white\", fgON: \"black\", bgOVER: \"#B6BDD2\", fgOVER: \"black\" };\n        this.style.itemStyle = { fontSize: \"14px\" };\n        this.minItemWidth = 0;\n        this.maxItemWidth = 0;\n        this.maxHeight = 0;\n        this.zIndex = `${this.options.zIndex}`;\n        this.commandTemplate = \"\";\n        this.args = [];\n        this.active = false;\n    }\n    render() {\n    }\n    clearItemsMenuProps(items) {\n        if (!items)\n            return;\n        for (var i = 0; i < items.length; i++) {\n            this.clearItemMenuProps(items[i]);\n        }\n    }\n    clearItemMenuProps(item) {\n        //don't clear properties they belong this menu\n        if (item.subLevel && item.subLevel.parentMenu == this)\n            return;\n        if (item.subLevel) {\n            item.subLevel.remove();\n            item.subLevel = null;\n        }\n        if (item.itemDiv) {\n            item.itemDiv = null;\n        }\n        if (item.items) {\n            this.clearItemsMenuProps(item.items);\n        }\n    }\n    setSelectedItems(items, selectedIds) {\n        const itemsLength = items ? items.length : 0;\n        for (let i = 0; i < itemsLength; i++) {\n            const item = items[i];\n            if (item.items) {\n                this.setSelectedItems(item.items, selectedIds);\n            }\n            else {\n                item.selected = selectedIds.indexOf(item.id) >= 0;\n            }\n        }\n    }\n    getRootLevel() {\n        return this.rootLevel;\n    }\n    getItemFilterCallback() {\n        return this.itemFilterCallback;\n    }\n    showMenu(options) {\n        this.ancorFocused = options.anchor == document.activeElement ? options.anchor : null;\n        this.clearItemsMenuProps(this.options.items);\n        this.itemSelectedCallback = options.itemSelectedCallback || null;\n        this.menuClosedCallback = options.menuClosedCallback || null;\n        this.itemFilterCallback = options.itemFilterCallback || null;\n        if (options.items) {\n            this.options.items = options.items;\n            this.rootLevel.setItems(options.items);\n        }\n        if (options.onMenuItemSelected) {\n            this.options.onMenuItemSelected = options.onMenuItemSelected;\n        }\n        let selectedIds = options.selectedIds || null;\n        if (selectedIds) {\n            if (typeof selectedIds === \"string\") {\n                selectedIds = selectedIds.split(\",\");\n            }\n        }\n        else {\n            selectedIds = [];\n        }\n        this.active = true;\n        this.setSelectedItems(this.options.items, selectedIds);\n        if (browserUtils.isMobileMode()) {\n            this.rootLevel.initLevelDiv();\n            this.rootLevel.levelDiv.style.top = '0px';\n            this.rootLevel.levelDiv.style.bottom = '0px';\n            this.rootLevel.levelDiv.style.right = '0px';\n            this.rootLevel.levelDiv.style.position = 'fixed';\n            this.rootLevel.levelDiv.style.fontSize = '20px';\n            this.rootLevel.showAt(0, 0, true, true);\n        }\n        else {\n            const anchor = options.anchor || document.documentElement;\n            const srcPos = getElementAbsolutePos(anchor);\n            anchor.offsetHeight;\n            const anchorWidth = anchor.offsetWidth;\n            const pos = {\n                x: srcPos.x,\n                y: srcPos.y // + anchorHeight + 2\n            };\n            const scroll = getScrollPos();\n            const winSize = getWinSize();\n            //show menu to the side that have more space available\n            const leftSpace = pos.x + anchorWidth - scroll.left;\n            const rightSpace = winSize.width - leftSpace + anchorWidth;\n            pos.x += 2;\n            this.rootLevel.initLevelDiv();\n            this.rootLevel.levelDiv.style.width = '';\n            this.rootLevel.levelDiv.style.right = '';\n            this.rootLevel.levelDiv.style.bottom = '';\n            this.rootLevel.levelDiv.style.position = 'absolute';\n            this.rootLevel.levelDiv.style.fontSize = '14px';\n            this.rootLevel.showAt(pos.x, pos.y, true, true, anchor);\n            if (!this.rootLevel.levelDiv.style.zIndex) {\n                // z-index is at least 10000 and more if anchor has bigger\n                this.rootLevel.levelDiv.style.zIndex = `${Math.max(10000, findHighestZIndex(anchor) + 1)}`;\n            }\n            if ((rightSpace >= this.rootLevel.levelDiv.offsetWidth) || (rightSpace >= leftSpace)) {\n                //show level to the right\n                if (rightSpace < this.rootLevel.levelDiv.offsetWidth) {\n                    this.rootLevel.levelDiv.style.right = -scroll.left + 'px';\n                }\n            }\n            else {\n                //show level to the left\n                if (leftSpace < this.rootLevel.levelDiv.offsetWidth) {\n                    this.rootLevel.levelDiv.style.left = scroll.left + 4 + 'px';\n                }\n                else {\n                    this.rootLevel.levelDiv.style.left = '';\n                }\n                this.rootLevel.levelDiv.style.right = getViewportSize().width - pos.x - anchorWidth + 'px';\n            }\n        }\n        this.rootLevel.levelDiv.style.visibility = 'visible';\n        this.rootLevel.focus();\n        document.addEventListener('keyup', this.menuKeyUpHandler);\n        document.addEventListener('mousedown', this.globalMouseDownHandler, true);\n    }\n    hideMenu() {\n        document.removeEventListener('mousedown', this.globalMouseDownHandler, true);\n        document.removeEventListener('keyup', this.menuKeyUpHandler);\n        this.rootLevel.hide();\n        if (this.ancorFocused) {\n            this.ancorFocused.focus();\n        }\n        if (this.menuClosedCallback) {\n            this.menuClosedCallback();\n        }\n    }\n    submitMenu(menuItem, selectedItems) {\n        if (this.itemSelectedCallback) {\n            this.itemSelectedCallback(menuItem, selectedItems);\n        }\n    }\n    knockMenuStyle(menu) {\n        menu.removeAttribute('style');\n        const ul = menu.querySelectorAll('ul').item(0);\n        var hasUlStyle = ul && ul.style ? true : false;\n        if (hasUlStyle !== false) {\n            ul.setAttribute('style', '');\n        }\n    }\n    refreshItems() {\n        this.rootLevel.refreshItems();\n    }\n    refreshCheckboxes() {\n        this.rootLevel.refreshCheckboxes();\n    }\n}\nPopupMenu.lastMenuID = 0;\n\nclass DisplayFormatParser {\n    constructor() {\n        this.formatStr = '';\n        this.pos = 0;\n        this.token = 'text';\n        this.tokenText = '';\n    }\n    start(s) {\n        this.formatStr = s;\n        this.pos = 0;\n        this.tokenText = '';\n    }\n    skipSpaces() {\n        while (this.pos < this.formatStr.length && this.formatStr.charAt(this.pos) === ' ')\n            this.pos++;\n    }\n    getToken() {\n        return this.token;\n    }\n    getTokenText() {\n        return this.tokenText;\n    }\n    next() {\n        this.skipSpaces();\n        if (this.pos >= this.formatStr.length)\n            return false;\n        let npos = 0;\n        if (this.formatStr.charAt(this.pos) === '{') {\n            npos = this.formatStr.indexOf('}', this.pos);\n            if (npos < 0)\n                return false;\n            this.tokenText = this.formatStr.substring(this.pos, npos + 1);\n            if (this.tokenText.indexOf('{expr') === 0 || this.tokenText.indexOf('{attr') === 0) {\n                this.token = 'expression';\n            }\n            this.pos = npos + 1;\n        }\n        else if (this.formatStr.charAt(this.pos) === '[' && this.pos < this.formatStr.length - 1 && this.formatStr.charAt(this.pos + 1) === '[') {\n            this.pos += 2;\n            npos = this.formatStr.indexOf(']]', this.pos);\n            this.token = 'function';\n            this.tokenText = this.formatStr.substring(this.pos, npos);\n            this.pos = npos + 2;\n        }\n        else {\n            this.token = 'text';\n            let npos1 = this.formatStr.indexOf('{', this.pos);\n            if (npos1 < 0)\n                npos1 = this.formatStr.length;\n            let npos2 = this.formatStr.indexOf('[[', this.pos);\n            if (npos2 < 0)\n                npos2 = this.formatStr.length;\n            npos = Math.min(npos1, npos2);\n            this.tokenText = this.formatStr.substring(this.pos, npos).trim();\n            this.pos = npos;\n        }\n        return true;\n    }\n}\n\nvar ColumnAction;\n(function (ColumnAction) {\n    ColumnAction[ColumnAction[\"Enable\"] = 0] = \"Enable\";\n    ColumnAction[ColumnAction[\"Delete\"] = 1] = \"Delete\";\n    ColumnAction[ColumnAction[\"Hidden\"] = 2] = \"Hidden\";\n    ColumnAction[ColumnAction[\"SortingNone\"] = 3] = \"SortingNone\";\n    ColumnAction[ColumnAction[\"SortingAsc\"] = 4] = \"SortingAsc\";\n    ColumnAction[ColumnAction[\"SortingDesc\"] = 5] = \"SortingDesc\";\n    ColumnAction[ColumnAction[\"MoveTop\"] = 6] = \"MoveTop\";\n    ColumnAction[ColumnAction[\"MoveUp\"] = 7] = \"MoveUp\";\n    ColumnAction[ColumnAction[\"MoveDown\"] = 8] = \"MoveDown\";\n    ColumnAction[ColumnAction[\"MoveBottom\"] = 9] = \"MoveBottom\";\n    ColumnAction[ColumnAction[\"Menu\"] = 10] = \"Menu\";\n    ColumnAction[ColumnAction[\"Type\"] = 11] = \"Type\";\n    ColumnAction[ColumnAction[\"Format\"] = 12] = \"Format\";\n})(ColumnAction || (ColumnAction = {}));\nclass ColumnRendererCP {\n    constructor(panel, column, slot) {\n        this.functionMenu = null;\n        this.formatsMenu = null;\n        this.buttonMenu = null;\n        this.isMouseOverBlock = false;\n        this.keepShowingButtons = false;\n        this.panel = panel;\n        this.column = column;\n        this.element = slot;\n    }\n    get cssPrefix() {\n        return 'eqjs-qc';\n    }\n    get columnEnabled() {\n        return this.column.enabled;\n    }\n    set columnEnabled(value) {\n        this.column.enabled = value;\n    }\n    render() {\n        if (this.getButtonsToShow().indexOf(\"sorting\") >= 0 && this.columnEnabled) {\n            this.sortingButton = this.renderSoringButton(this.column.sorting);\n            if (this.column.sorting !== SortDirection.None) {\n                this.sortingButton.style.display = 'block';\n            }\n        }\n        const builder = domel('div');\n        builder.data('id', this.column.id);\n        if (this.element) {\n            this.element.parentNode\n                .replaceChild(builder.toDOM(), this.element);\n        }\n        this.element = builder.toDOM();\n        if (this.panel.options.allowDragDrop && !browserUtils.isMobileMode()) {\n            eqDragManager.registerDraggableItem({\n                element: this.element,\n                scope: \"entityAttrSort\",\n                data: { column: this.column },\n                beforeDragStart: () => {\n                    this.hideButtons();\n                },\n                renderer: (dragImage) => {\n                    dragImage.innerHTML = '';\n                    const attrLabel = document.createElement('span');\n                    attrLabel.innerText = this.column.caption;\n                    dragImage.classList.add('eqjs-sortable-helper');\n                    dragImage.appendChild(attrLabel);\n                },\n                onDragStart: (ev) => {\n                    this.element.style.display = 'none';\n                    ev.dropEffect = DropEffect.Allow;\n                },\n                onDragEnd: (ev) => {\n                    if (!ev.data.finishedSuccessfully) {\n                        this.element.style.removeProperty('display');\n                    }\n                }\n            });\n        }\n        if (this.isEditable()) {\n            this.createFunctionMenu();\n            this.createFormatsMenu();\n        }\n        this.createButtonMenu();\n        const isFullMode = this.panel.options.editMode === ColumnsEditMode.Full;\n        const isReadOnlyMode = this.panel.options.editMode === ColumnsEditMode.ReadOnly;\n        const showCheckboxes = this.panel.options.showCheckboxes !== false;\n        builder\n            .addClass(this.getClassesToAdd())\n            .addClass(getMobileCssClass());\n        if (showCheckboxes && !isReadOnlyMode && !this.column.isReadOnly()) {\n            builder.addChildElement(this.renderCheckbox());\n        }\n        if (!isReadOnlyMode) {\n            //start sort button\n            builder.addChild('div', builder => builder\n                .addClass(`${eqCssPrefix}-button-placeholder`, `${this.cssPrefix}-button-placeholder`, `${this.cssPrefix}-colelement`, `${this.cssPrefix}-sortbutton-placeholder`)\n                .addChildElement(this.sortingButton));\n            // end sort button\n        }\n        builder.addChildElement(this.renderExpressionBlock());\n        if (this.panel.options.showColumnTitles !== false && !browserUtils.isMobileMode()) {\n            builder\n                .addChildElement(this.renderCaptionBlock());\n        }\n        let buttonsIndex = 0;\n        let buttonsList = '';\n        builder\n            //start buttons\n            .addChild('div', builder => {\n            builder\n                .addClass(`${eqCssPrefix}-column-buttonsBlock`, `${this.cssPrefix}-buttonsBlock`)\n                .addClass(getMobileCssClass());\n            const buttonsToShow = this.getButtonsToShow();\n            //start enable button\n            if (buttonsToShow.indexOf(\"enable\") >= 0 && isFullMode && !showCheckboxes && !this.column.isReadOnly()) {\n                builder.addChildElement(this.renderEnabledButton());\n                buttonsIndex++;\n                buttonsList += 'Enable';\n            }\n            //end enable button\n            //start aggr func button\n            if (buttonsToShow.indexOf(\"type\") >= 0 && this.columnEnabled && isFullMode) {\n                builder.addChildElement(this.renderColumnTypeButton());\n                buttonsIndex++;\n                buttonsList += 'Type';\n            }\n            //end aggr func button\n            //start format selector button\n            if (buttonsToShow.indexOf(\"format\") >= 0 && this.columnEnabled && !isReadOnlyMode) {\n                builder.addChildElement(this.renderColumnFormatButton());\n                buttonsIndex++;\n                buttonsList += 'Format';\n            }\n            //end format selector button\n            //start delete button\n            if (buttonsToShow.indexOf(\"delete\") >= 0 && isFullMode && !this.column.isReadOnly()) {\n                builder.addChildElement(this.renderDeleteButton());\n                buttonsIndex++;\n                buttonsList += 'Delete';\n            }\n            //end delete button\n            //start menu button\n            if (buttonsToShow.indexOf(\"menu\") >= 0 && !(this.column.isReadOnly() || isReadOnlyMode)) {\n                builder.addChildElement(this.renderMenuButton());\n                buttonsIndex++;\n                buttonsList += 'Menu';\n            }\n            //end menu button\n        });\n        //end buttons\n        builder.addClass(`eqjs-buttons-in-block-${buttonsIndex}`);\n        builder.addClass(`eqjs-buttons-in-block-${buttonsList}`);\n        if (!browserUtils.isMobileMode()) {\n            //start event listeners\n            builder\n                .on('mouseenter', this.onMouseEnter.bind(this))\n                .on('mouseleave', this.onMouseLeave.bind(this));\n            //end event listeners\n        }\n        if (this.panel.options.accentActiveColumn || browserUtils.isMobileMode()) {\n            builder\n                .on('click', this.onMouseClick.bind(this)); //touchstart\n        }\n        if (this.panel.options.alwaysShowButtons) {\n            this.showButtons();\n        }\n        if (!showCheckboxes) {\n            builder.addClass(\"eqjs-no-checkbox\");\n        }\n        return this.element;\n    }\n    onMouseClick(ev) {\n        ev.stopPropagation();\n        this.activate();\n        return false;\n    }\n    activate() {\n        this.panel.toggleColumnPicked(this.column);\n        this.adjustButtonsVisibility();\n        if (!browserUtils.isMobileMode()) {\n            this.element.dispatchEvent(createBrowserEvent(\"mouseenter\"));\n        }\n    }\n    fireColumnChanged() {\n        this.column.fireChangedEvent();\n    }\n    refresh() {\n        this.render();\n    }\n    renderCaptionBlock() {\n        const builder = domel('div')\n            .addClass(`${this.cssPrefix}-colelement`, `${this.cssPrefix}-captionelement`)\n            .addClass(getMobileCssClass());\n        if (this.isEditable()) {\n            builder\n                .addChild('a', builder => builder\n                .attr('href', 'javascript:void(0)')\n                .title(this.column.caption)\n                .text(this.column.caption)\n                .on('click', (ev) => {\n                ev.stopPropagation();\n                this.activate();\n                const element = ev.target;\n                const inputEl = element.parentElement.querySelector('input');\n                if (inputEl) {\n                    element.style.display = 'none';\n                    inputEl.style.removeProperty('display');\n                    inputEl.style.minWidth = `${element.clientWidth}`;\n                    inputEl.focus();\n                    this.element.setAttribute(eqDragManager.DRAG_DISABLED_ATTR, '');\n                }\n                return false;\n            }) //TO DO:add localization and input field\n            )\n                .addChild('input', builder => builder\n                .hide()\n                .value(this.column.caption)\n                .on('blur keydown', (ev) => {\n                let isEndEvent = false;\n                let save = true;\n                if (ev instanceof KeyboardEvent) {\n                    // Enter\n                    if (ev.keyCode === 13) {\n                        isEndEvent = true;\n                        //ESC\n                    }\n                    else if (ev.keyCode === 27) {\n                        isEndEvent = true;\n                        save = false;\n                    }\n                }\n                else if (ev instanceof FocusEvent) {\n                    isEndEvent = true;\n                }\n                if (isEndEvent) {\n                    const inputEl = ev.target;\n                    const aEl = inputEl.parentElement.querySelector('a');\n                    if (aEl) {\n                        aEl.style.removeProperty('display');\n                        inputEl.style.display = 'none';\n                    }\n                    if (save && this.column.caption !== inputEl.value) {\n                        this.column.caption = inputEl.value;\n                        this.fireColumnChanged();\n                    }\n                    else {\n                        inputEl.value = this.column.caption;\n                        safeFocus(aEl);\n                    }\n                    this.element.removeAttribute(eqDragManager.DRAG_DISABLED_ATTR);\n                }\n                return true;\n            }));\n        }\n        else {\n            builder.addChild('span', b => {\n                b.text(this.column.caption)\n                    .title(this.column.caption);\n            });\n        }\n        return builder.toDOM();\n    }\n    renderSoringButton(sorting) {\n        const sortButtonCssClass = `${eqCssPrefix}-column-sortbutton`;\n        let sortButtonDirectionCssClass;\n        switch (sorting) {\n            case SortDirection.Ascending:\n                sortButtonDirectionCssClass = `${sortButtonCssClass}-asc`;\n                break;\n            case SortDirection.Descending:\n                sortButtonDirectionCssClass = `${sortButtonCssClass}-desc`;\n                break;\n            default:\n                sortButtonDirectionCssClass = `${sortButtonCssClass}-none`;\n                break;\n        }\n        if (!this.isEditable() || browserUtils.isMobileMode()) {\n            if (sorting === SortDirection.Ascending\n                || sorting === SortDirection.Descending)\n                return domel('div')\n                    .addClass(sortButtonCssClass, `${eqCssPrefix}-button`, sortButtonDirectionCssClass)\n                    .title(i18n$1.getText('ButtonSorting'))\n                    .toDOM();\n            return null;\n        }\n        return domel('div')\n            .addClass(sortButtonCssClass, `${eqCssPrefix}-button`, sortButtonDirectionCssClass)\n            .data(\"btnplaceholder\", \"\")\n            .title(i18n$1.getText('ButtonSorting'))\n            .attr('tabIndex', '0')\n            .on('click', (ev) => {\n            ev.stopPropagation();\n            this.activate();\n            this.keepShowingButtons = true;\n            const menu = this.getUIS() ? this.panel.sortMenu || this.panel.moveMenu : this.panel.moveMenu;\n            menu.showMenu({\n                anchor: this.sortingButton,\n                selectedIds: this.getButtonMenuSelectedItems(), // this.column.isHidden() ? ['IsHidden'] : null,\n                itemSelectedCallback: (data, items) => {\n                    let action;\n                    switch (data.id) {\n                        case \"IsHidden\":\n                            action = ColumnAction.Hidden;\n                            break;\n                        case \"MoveTop\":\n                            action = ColumnAction.MoveTop;\n                            break;\n                        case \"MoveDown\":\n                            action = ColumnAction.MoveDown;\n                            break;\n                        case \"MoveUp\":\n                            action = ColumnAction.MoveUp;\n                            break;\n                        case \"MoveBottom\":\n                            action = ColumnAction.MoveBottom;\n                            break;\n                        case \"None\":\n                            action = ColumnAction.SortingNone;\n                            break;\n                        case \"Ascending\":\n                            action = ColumnAction.SortingAsc;\n                            break;\n                        case \"Descending\":\n                            action = ColumnAction.SortingDesc;\n                            break;\n                    }\n                    this.buttonMenuHandler(action, null);\n                },\n                menuClosedCallback: () => {\n                    this.keepShowingButtons = false;\n                    if (!this.isMouseOverBlock) {\n                        this.leaveButtonBlock();\n                    }\n                }\n            });\n        })\n            .on('keypress', evt => { if (evt.keyCode == 13) {\n            evt.target.click();\n        } })\n            .toDOM();\n    }\n    renderCheckbox() {\n        return domel(\"div\")\n            .title(i18n$1.getText('CmdToggleEnable'))\n            .attr('tabIndex', '0')\n            .addClass(`${this.cssPrefix}-colelement ${this.cssPrefix}-column-checkbox`)\n            .addClass(`${this.columnEnabled ? 'enabled' : ''}`)\n            .on('click', () => {\n            this.columnEnabled = !this.columnEnabled;\n            this.column.fireChangedEvent();\n            return false;\n        })\n            .on('keypress', evt => { if ([13, 32].includes(evt.keyCode)) {\n            evt.target.click();\n        } })\n            .toDOM();\n    }\n    renderDeleteButton() {\n        return domel('div')\n            .addClass(`${eqCssPrefix}-button-placeholder`, `${this.cssPrefix}-button-placeholder`, `${this.cssPrefix}-deletebutton-placeholder`)\n            .data(\"btnplaceholder\", \"\")\n            .addChild('div', b => b\n            .addClass(`${eqCssPrefix}-button`, `${eqCssPrefix}-column-button`, `${eqCssPrefix}-column-button-delete`)\n            .title(i18n$1.getText('CmdDelete'))\n            .attr('tabIndex', '0')\n            .on('click', ev => this.buttonMenuHandler(ColumnAction.Delete, ev)) //touchstart\n            .on('keypress', evt => { if (evt.keyCode == 13) {\n            evt.target.click();\n        } }))\n            .toDOM();\n    }\n    renderMenuButton() {\n        return domel('div')\n            .addClass(`${eqCssPrefix}-button-placeholder`, `${this.cssPrefix}-button-placeholder`, `${this.cssPrefix}-menubutton-placeholder`)\n            .data(\"btnplaceholder\", \"\")\n            .addChild('div', b => b\n            .addClass(`${eqCssPrefix}-button`, `${eqCssPrefix}-column-button`, `${eqCssPrefix}-column-button-menu`)\n            .title(i18n$1.getText('ButtonMenu'))\n            .attr('tabIndex', '0')\n            .on('click', evt => this.buttonMenuHandler(ColumnAction.Menu, evt)) //touchstart\n            .on('keypress', evt => { if (evt.keyCode == 13) {\n            evt.target.click();\n        } }))\n            .toDOM();\n    }\n    getClassesToAdd() {\n        let result = \"\";\n        result += this.columnEnabled ? '' : ` ${this.cssPrefix}-disabled`;\n        if (this.columnEnabled) {\n            result += this.column.isReadOnly() ? ` ${this.cssPrefix}-readonly` : '';\n        }\n        result += this.column.isHidden() ? ` ${this.cssPrefix}-hidden` : '';\n        return result;\n    }\n    renderColumnTypeButton() {\n        return (this.isEditable() && this.panel.options.allowAggrColumns !== false)\n            ? domel('div')\n                .addClass(`${eqCssPrefix}-button-placeholder`, `${this.cssPrefix}-button-placeholder`, `${this.cssPrefix}-typebutton-placeholder`, `${this.cssPrefix}-button-active`)\n                .data(\"btnplaceholder\", \"\")\n                .addChild('div', b => b\n                .addClass(`${eqCssPrefix}-button`, `${eqCssPrefix}-column-button`, `${eqCssPrefix}-column-button-type`)\n                .title(i18n$1.getText('ButtonToAggr'))\n                .attr('tabIndex', '0')\n                .on('click', (ev) => {\n                ev.stopPropagation();\n                this.activate();\n                this.keepShowingButtons = true;\n                this.changeTypeHandler(ev);\n            })\n                .on('keypress', evt => { if (evt.keyCode == 13) {\n                evt.target.click();\n            } }))\n                .toDOM()\n            : null;\n    }\n    renderColumnFormatButton() {\n        const formatItems = this.getFormatsMenuItems();\n        return (this.isEditable() && this.panel.options.allowDisplayFormatChange !== false && formatItems.length > 1)\n            ? domel('div')\n                .addClass(`${eqCssPrefix}-button-placeholder`, `${this.cssPrefix}-button-placeholder`, `${this.cssPrefix}-formatbutton-placeholder`, `${this.cssPrefix}-button-active`)\n                .data(\"btnplaceholder\", \"\")\n                .addChild('div', b => b\n                .addClass(`${eqCssPrefix}-button`, `${eqCssPrefix}-column-button`, `${eqCssPrefix}-column-button-format`)\n                .title(i18n$1.getText('ButtonFormat'))\n                .attr('tabIndex', '0')\n                .on('click', (ev) => {\n                ev.stopPropagation();\n                this.keepShowingButtons = true;\n                this.changeFormatHandler(ev);\n            })\n                .on('keypress', evt => { if (evt.keyCode == 13) {\n                evt.target.click();\n            } }))\n                .toDOM()\n            : null;\n    }\n    renderEnabledButton() {\n        return domel('div')\n            .addClass(`${eqCssPrefix}-button-placeholder`, `${this.cssPrefix}-button-placeholder`, `${this.cssPrefix}-enablebutton-placeholder`, `${this.cssPrefix}-button-active`)\n            .data(\"btnplaceholder\", \"\")\n            .addChild('div', b => b\n            .addClass(`${eqCssPrefix}-button`, `${eqCssPrefix}-column-button`, `${eqCssPrefix}-column-button-enable`)\n            .title(i18n$1.getText('CmdToggleEnable'))\n            .addClass(this.columnEnabled ? 'enabled' : '')\n            .attr('tabIndex', '0')\n            .on('click', evt => this.buttonMenuHandler(ColumnAction.Enable, evt)) //touchstart\n            .on('keypress', evt => { if (evt.keyCode == 13) {\n            evt.target.click();\n        } })).toDOM();\n    }\n    isEditable() {\n        // Allow editing (title/sort/order) in Full or FixedList mode only\n        switch (this.panel.options.editMode) {\n            case ColumnsEditMode.ReadOnly:\n                return false;\n            default:\n                return this.column.enabled && !this.column.isReadOnly();\n        }\n    }\n    changeFormatHandler(ev) {\n        const formats = this.panel\n            .getContext()\n            .getModel()\n            .getDisplayFormatsForType(this.column.getDataType());\n        let itemId = '{0:__default}';\n        if (formats.filter(f => f.format == this.column.displayFormat).length > 0) {\n            itemId = this.column.displayFormat;\n        }\n        this.formatsMenu.showMenu({\n            anchor: ev.target,\n            selectedIds: itemId,\n            itemSelectedCallback: (data, items) => {\n                if (data.id != itemId) {\n                    if (data.id == '{0:__default}') {\n                        this.column.displayFormat = '';\n                    }\n                    else {\n                        this.column.displayFormat = data.id;\n                    }\n                    this.column.fireChangedEvent();\n                }\n                return false;\n            },\n            menuClosedCallback: () => {\n                this.keepShowingButtons = false;\n                if (!this.isMouseOverBlock) {\n                    this.element.dispatchEvent(createBrowserEvent('mouseleave'));\n                }\n            }\n        });\n    }\n    getUIS() {\n        return this.panel\n            .getContext().getModel()\n            .checkAttrProperty(this.column.expr.value, \"useInSorting\");\n    }\n    onMouseEnter(e) {\n        this.isMouseOverBlock = true;\n        this.enterButtonBlock();\n        e.stopPropagation();\n        return false;\n    }\n    onMouseLeave(e) {\n        this.isMouseOverBlock = false;\n        this.leaveButtonBlock();\n        e.stopPropagation();\n        return false;\n    }\n    isColumnActive() {\n        return this.element.classList.contains(\"active\");\n    }\n    hideButtons() {\n        domel(this.element).data(\"show-buttons\", null);\n    }\n    showButtons() {\n        domel(this.element).data(\"show-buttons\", \"\");\n    }\n    adjustButtonsVisibility() {\n        if (this.panel.options.alwaysShowButtons ||\n            ((this.panel.options.accentActiveColumn || browserUtils.isMobileMode())\n                && this.isColumnActive())) {\n            this.showButtons();\n        }\n    }\n    enterButtonBlock() {\n        this.showButtons();\n    }\n    leaveButtonBlock() {\n        if (!this.keepShowingButtons && this.panel.options.alwaysShowButtons !== true && (!this.isColumnActive() || this.panel.options.accentActiveColumn != true)) {\n            this.hideButtons();\n        }\n    }\n    createFunctionMenu() {\n        const items = [];\n        const funcs = this.panel.getContext().getModel().getAggrFunctions();\n        let funcAllowed = true;\n        let item = null;\n        const colDataType = this.column.getDataType();\n        let funcCaption;\n        for (const func of funcs) {\n            if (!func)\n                continue;\n            const toInclude = func.getAppliedTypesOrDefault().indexOf(colDataType) >= 0;\n            if (this.column.expr.func === func.id && !toInclude) {\n                funcAllowed = false;\n            }\n            if (toInclude) {\n                funcCaption = this.panel.getContext().getModel()\n                    .getAggrFunctionCaption(func.id);\n                item = {\n                    id: func.id,\n                    text: funcCaption\n                };\n                items.push(item);\n            }\n        }\n        if (!funcAllowed && items.length > 0) {\n            this.column.expr.func = items[0].id;\n        }\n        //Add \"Custom Expression\" menu\n        const columnsPanel = this.panel;\n        if (columnsPanel.areCustomExpressionsAllowed()) {\n            item = {\n                id: 'CustomSqlDivider',\n                text: '---'\n            };\n            items.push(item);\n            funcCaption = i18n$1.getText('CustomExpression');\n            item = {\n                id: 'CUSTOMSQL',\n                text: funcCaption\n            };\n            items.push(item);\n        }\n        let menuId = this.column.id;\n        if (menuId) {\n            menuId += '-FunctionsMenu';\n        }\n        const menuOptions = {\n            items: items,\n            id: menuId,\n            searchBoxAlwaysShown: false,\n            domWriteItemsId: true //this.panel.options.domWriteItemsId\n        };\n        this.functionMenu = new PopupMenu(menuOptions);\n    }\n    createFormatsMenu() {\n        if (this.panel.options.allowDisplayFormatChange == false)\n            return;\n        let menuId = this.column.id;\n        if (menuId) {\n            menuId += '-FormatsMenu';\n        }\n        const items = this.getFormatsMenuItems();\n        const menuOptions = {\n            items: items,\n            id: menuId,\n            searchBoxAlwaysShown: false,\n            showSelected: true,\n            domWriteItemsId: true //this.panel.options.domWriteItemsId\n        };\n        this.formatsMenu = new PopupMenu(menuOptions);\n    }\n    getFormatsMenuItems() {\n        const formats = this.panel.getContext().getModel()\n            .getDisplayFormatsForType(this.column.getDataType());\n        return [{ id: '{0:__default}', text: \"Default\" }]\n            .concat(formats.map(format => ({ id: format.format, text: i18n$1.getText(\"DisplayFormats\", format.name) || format.name })));\n    }\n    getButtonsToShow() {\n        // In ReadOnly mode, no buttons\n        if (this.panel.options.editMode === ColumnsEditMode.ReadOnly) {\n            return [];\n        }\n        // In FixedList mode, only allow sorting and caption editing\n        if (this.panel.options.editMode === ColumnsEditMode.FixedList) {\n            return [\"sorting\", \"format\"];\n        }\n        // Default (Full)\n        return this.panel.options.buttons && Array.isArray(this.panel.options.buttons)\n            ? this.panel.options.buttons\n            : [\"enable\", \"delete\", \"type\", \"sorting\", \"format\"];\n    }\n    buttonMenuHandler(action, evt) {\n        switch (action) {\n            case ColumnAction.Delete:\n                const curQuery = this.column.getQuery();\n                curQuery.removeColumn(this.column);\n                curQuery.fireColumnsChangedEvent(QueryChangeAction.Delete, this.column);\n                break;\n            case ColumnAction.Enable:\n                this.activate();\n                this.columnEnabled = !this.columnEnabled;\n                this.fireColumnChanged();\n                break;\n            case ColumnAction.Hidden:\n                this.column.setHidden(!this.column.isHidden());\n                this.fireColumnChanged();\n                break;\n            case ColumnAction.MoveTop:\n                this.panel.moveColumn(this.column, \"MoveTop\");\n                break;\n            case ColumnAction.MoveBottom:\n                this.panel.moveColumn(this.column, \"MoveBottom\");\n                break;\n            case ColumnAction.MoveUp:\n                this.panel.moveColumn(this.column, \"MoveUp\");\n                break;\n            case ColumnAction.MoveDown:\n                this.panel.moveColumn(this.column, \"MoveDown\");\n                break;\n            case ColumnAction.SortingAsc:\n                this.column.sorting = SortDirection.Ascending;\n                this.column.fireChangedEvent();\n                break;\n            case ColumnAction.SortingDesc:\n                this.column.sorting = SortDirection.Descending;\n                this.column.fireChangedEvent();\n                break;\n            case ColumnAction.SortingNone:\n                this.column.sorting = SortDirection.None;\n                this.column.fireChangedEvent();\n                break;\n            case ColumnAction.Menu:\n                const colMenu = this.buttonMenu;\n                this.keepShowingButtons = true;\n                this.activate();\n                colMenu.showMenu({\n                    anchor: evt ? evt.target : null,\n                    selectedIds: this.getButtonMenuSelectedItems(),\n                    itemSelectedCallback: (item) => {\n                        let action = item.id;\n                        switch (item.id) {\n                            case \"enable\":\n                                action = ColumnAction.Enable;\n                                break;\n                            case \"delete\":\n                                action = ColumnAction.Delete;\n                                break;\n                            case \"hidden\":\n                                action = ColumnAction.Hidden;\n                                break;\n                            case \"MoveTop\":\n                                action = ColumnAction.MoveTop;\n                                break;\n                            case \"MoveBottom\":\n                                action = ColumnAction.MoveBottom;\n                                break;\n                            case \"MoveUp\":\n                                action = ColumnAction.MoveUp;\n                                break;\n                            case \"MoveDown\":\n                                action = ColumnAction.MoveDown;\n                                break;\n                            case \"None\":\n                                action = ColumnAction.SortingNone;\n                                break;\n                            case \"Ascending\":\n                                action = ColumnAction.SortingAsc;\n                                break;\n                            case \"Descending\":\n                                action = ColumnAction.SortingDesc;\n                                break;\n                        }\n                        this.buttonMenuHandler(action, evt);\n                    },\n                    itemFilterCallback: (item) => {\n                        let result = this.columnEnabled || item.id === \"__group\" || item.id === \"enable\" || item.id === \"delete\";\n                        return result;\n                    },\n                    menuClosedCallback: () => {\n                        this.keepShowingButtons = false;\n                        if (!this.isMouseOverBlock)\n                            this.leaveButtonBlock();\n                    }\n                });\n                break;\n            default:\n                if (!this.processFormatsButtonMenuItems(action, evt))\n                    this.processExtraButtonMenuItems(action, evt);\n                break;\n        }\n        evt && evt.stopPropagation();\n        return false;\n    }\n    createButtonMenu() {\n        if (!this.buttonMenu) {\n            let menuId = this.column.id;\n            if (menuId) {\n                menuId += '-ButtonMenu';\n            }\n            const Appearance = [];\n            Appearance.push({\n                id: \"enable\",\n                text: i18n$1.getText('MenuEnable')\n            });\n            if (this.panel.options.allowHiddenColumns) {\n                Appearance.push({\n                    id: \"hidden\",\n                    text: i18n$1.getText('CmdHiddenColumn')\n                });\n            }\n            Appearance.push({\n                id: \"delete\",\n                text: i18n$1.getText('CmdDelete')\n            });\n            let items = [];\n            items.push({\n                id: '__group',\n                text: i18n$1.getText('CmdGroupAppearance'),\n                items: Appearance\n            });\n            const sortItems = this.panel.options.allowSorting ?\n                [\n                    ...this.panel.getSortMenuList(),\n                    ...this.panel.getMoveMenuList()\n                ] :\n                this.panel.getMoveMenuList();\n            items.push({\n                id: '__group',\n                text: i18n$1.getText('CmdGroupSort'),\n                items: sortItems\n            });\n            const extra = this.getExtraButtonMenuItems();\n            if (extra && Array.isArray(extra)) {\n                items = [...items, ...extra];\n            }\n            const formatItems = this.getFormatsMenuItems();\n            if (formatItems.length > 1) {\n                items.push({\n                    id: '__group',\n                    text: i18n$1.getText('CmdGroupFormat'),\n                    items: formatItems\n                });\n            }\n            const menuOptions = {\n                items: items,\n                id: menuId,\n                searchBoxAlwaysShown: false,\n                domWriteItemsId: true, //this.panel.options.domWriteItemsId\n                showSelected: true\n            };\n            this.buttonMenu = new PopupMenu(menuOptions);\n        }\n    }\n    processFormatsButtonMenuItems(action, evt) {\n        const formats = this.panel\n            .getContext().getModel()\n            .getDisplayFormatsForType(this.column.getDataType());\n        if (action == '{0:__default}') {\n            this.column.displayFormat = '';\n        }\n        else if (formats.filter(f => f.format == action).length > 0) {\n            this.column.displayFormat = action;\n        }\n        else {\n            return false;\n        }\n        this.column.fireChangedEvent();\n        return true;\n    }\n    getButtonMenuSelectedItems() {\n        let arrSelected = [];\n        if (this.columnEnabled) {\n            arrSelected.push(\"enable\");\n        }\n        if (this.column.isHidden()) {\n            arrSelected.push(\"hidden\");\n        }\n        switch (this.column.sorting) {\n            case SortDirection.None:\n                arrSelected.push(\"None\");\n                break;\n            case SortDirection.Ascending:\n                arrSelected.push(\"Ascending\");\n                break;\n            case SortDirection.Descending:\n                arrSelected.push(\"Descending\");\n                break;\n        }\n        const formats = this.panel\n            .getContext()\n            .getModel()\n            .getDisplayFormatsForType(this.column.getDataType());\n        let formatId = '{0:__default}';\n        if (formats.filter(f => f.format == this.column.displayFormat).length > 0) {\n            formatId = this.column.displayFormat;\n        }\n        arrSelected.push(formatId);\n        return arrSelected;\n    }\n}\n\nclass AttrColumnRendererCP extends ColumnRendererCP {\n    getClassesToAdd() {\n        return `${super.getClassesToAdd()} ${this.cssPrefix}-row ${this.cssPrefix}-row-column-entattr`;\n    }\n    renderExpressionBlock() {\n        return domel(\"div\")\n            .addClass(`${this.cssPrefix}-expr-block`)\n            .addClass(getMobileCssClass())\n            .addChild('div', builder => builder\n            .addClass(`${this.cssPrefix}-colelement`, `${this.cssPrefix}-attrelement`)\n            .addClass(getMobileCssClass())\n            .addChildElement(this.renderBaseExpression()))\n            .toDOM();\n    }\n    getAttribute() {\n        const model = this.panel.getContext().getModel();\n        return model.getAttributeByIdSafe(this.column.expr.value);\n    }\n    renderBaseExpression() {\n        const baseAttr = this.getAttribute();\n        const attrCaption = this.panel.getContext().getAttributeTitle(baseAttr);\n        if (this.isEditable() && this.panel.options.editMode === ColumnsEditMode.Full) {\n            return domel('a')\n                .attr('href', 'javascript:void(0)')\n                .title(attrCaption)\n                .text(attrCaption) //TO DO:add localization\n                .on('click', (ev) => {\n                ev.stopPropagation();\n                this.activate();\n                this.panel.showEntitiesMenu({\n                    anchor: ev.target,\n                    selectedIds: null,\n                    itemSelectedCallback: this.baseExpressionItemSelectedCallback.bind(this),\n                    itemFilterCallback: item => item.id !== '__AddAll__'\n                });\n                return false;\n            })\n                .toDOM();\n        }\n        else {\n            return domel('span')\n                .text(attrCaption)\n                .title(attrCaption)\n                .toDOM();\n        }\n    }\n    baseExpressionItemSelectedCallback(data, item) {\n        const attrid = data.id;\n        const context = this.panel.getContext();\n        var attr = context.getModel().getAttributeById(attrid);\n        this.updateBaseAttr(attr);\n        this.column.caption = context.getDefaultColumnCaption(this.column);\n        this.fireColumnChanged();\n        return false;\n    }\n    updateBaseAttr(attr) {\n        this.column.expr.setValue(attr.id, true);\n        this.column.expr.baseAttrId = attr.id;\n        this.column.expr.dataType = attr.dataType;\n    }\n    getUIS() {\n        const arg = this.column.expr.args[0];\n        if (arg) {\n            const model = this.panel.getContext().getModel();\n            return model.checkAttrProperty(arg.value, \"useInSorting\");\n        }\n        else {\n            return true;\n        }\n    }\n    changeTypeHandler(ev) {\n        this.keepShowingButtons = true;\n        this.functionMenu.showMenu({\n            anchor: ev.target,\n            selectedIds: null,\n            itemSelectedCallback: (data, items) => {\n                this.processExtraButtonMenuItems(data.id, null);\n                return false;\n            },\n            menuClosedCallback: () => {\n                this.keepShowingButtons = false;\n                if (!this.isMouseOverBlock) {\n                    this.element.dispatchEvent(createBrowserEvent('mouseleave'));\n                }\n            }\n        });\n    }\n    changeTypeToCustomSql() {\n        const query = this.column.getQuery();\n        query.changeColumnType(this.column, ExprTag.CustomSql);\n        const parentElement = this.element.parentElement;\n        setTimeout(() => {\n            //focus CustomSQL Edit\n            const newElement = parentElement.querySelector(`div[data-id='${this.column.id}']  div[class*='${this.cssPrefix}-expr-block']  div[class*='${this.cssPrefix}-colelement']  a`);\n            if (newElement)\n                newElement.click();\n        }, 500);\n        this.fireColumnChanged();\n    }\n    changeTypeToAggr(funcId) {\n        const query = this.column.getQuery();\n        query.changeColumnType(this.column, ExprTag.AggregateFunction, { funcId: funcId });\n        this.fireColumnChanged();\n    }\n    processExtraButtonMenuItems(action, evt) {\n        if (action === \"CUSTOMSQL\") {\n            this.changeTypeToCustomSql();\n        }\n        else {\n            this.changeTypeToAggr(action);\n        }\n        return true;\n    }\n    getExtraButtonMenuItems() {\n        const items = [];\n        const funcs = this.panel.getContext().getModel().getAggrFunctions();\n        let toInclude = true;\n        let funcAllowed = true;\n        var item = null;\n        const attribute = this.getAttribute();\n        let funcCaption;\n        for (const func of funcs) {\n            toInclude = func.getAppliedTypesOrDefault().indexOf(attribute.dataType) >= 0;\n            if (this.column.expr.func === func.id && !toInclude) {\n                funcAllowed = false;\n            }\n            if (toInclude) {\n                funcCaption = this.panel.getContext().getModel().getAggrFunctionCaption(func.id);\n                item = {\n                    id: func.id,\n                    text: funcCaption\n                };\n                items.push(item);\n            }\n        }\n        for (let idx = 0; idx < funcs.length; idx++) {\n            if (!funcs[idx])\n                continue;\n        }\n        if (!funcAllowed && items.length > 0) {\n            this.column.expr.func = items[0].id;\n        }\n        //Add \"Custom Expression\" menu\n        const columnsPanel = this.panel;\n        if (columnsPanel.areCustomExpressionsAllowed()) {\n            item = {\n                id: 'CustomSqlDivider',\n                text: '---'\n            };\n            items.push(item);\n            funcCaption = i18n.getText('CustomExpression');\n            item = {\n                id: 'CUSTOMSQL',\n                text: funcCaption\n            };\n            items.push(item);\n        }\n        return [{\n                id: '__group',\n                text: i18n.getText('ColTypeGroup'),\n                items: items\n            }];\n    }\n}\n\nclass AggrFuncColumnRendererCP extends AttrColumnRendererCP {\n    constructor() {\n        super(...arguments);\n        this.displayFormatParser = new DisplayFormatParser();\n    }\n    getClassesToAdd() {\n        return `${super.getClassesToAdd()} ${this.cssPrefix}-row ${this.cssPrefix}-row-column-aggr`;\n    }\n    getAttribute() {\n        return this.panel\n            .getContext()\n            .getModel()\n            .getAttributeByIdSafe(this.column.expr.args[0].value);\n    }\n    renderExpressionBlock() {\n        const model = this.panel.getContext().getModel();\n        const exprBlockBuilder = domel(\"div\")\n            .addClass(`${this.cssPrefix}-expr-block`, `${this.cssPrefix}-expr-block-aggr`)\n            .addClass(getMobileCssClass());\n        const format = model.getAggrFunctionFormat(this.column.expr.func);\n        if (!format || format === '')\n            return;\n        const arrFormat = this.parseDisplayFormat(format);\n        if (arrFormat.length === 0)\n            return;\n        let item = null;\n        const arrLength = arrFormat.length;\n        for (let idx = 0; idx < arrLength; idx++) {\n            item = arrFormat[idx];\n            if (item.type === 1) {\n                // Only allow function/type change in Full mode\n                if (this.panel.options.editMode === ColumnsEditMode.Full && this.isEditable()) {\n                    const functionLink = domel('a')\n                        .attr('href', 'javascript:void(0)')\n                        .text(item.text)\n                        .on('click', (ev) => {\n                        ev.stopPropagation();\n                        this.activate();\n                        this.functionMenu.showMenu({\n                            anchor: functionLink.toDOM(),\n                            selectedIds: null,\n                            itemSelectedCallback: (data, items) => {\n                                if (data.id === \"CUSTOMSQL\") {\n                                    this.changeTypeToCustomSql();\n                                }\n                                else {\n                                    this.column.expr.func = data.id;\n                                    this.column.caption = '';\n                                    this.fireColumnChanged();\n                                }\n                            }\n                        });\n                    });\n                    exprBlockBuilder\n                        .addChild('div', builder => builder\n                        .addClass(`${this.cssPrefix}-colelement`, `${this.cssPrefix}-aggrfuncelement`)\n                        .addClass(getMobileCssClass())\n                        .addChildElement(functionLink.toDOM()));\n                }\n                else {\n                    exprBlockBuilder\n                        .addChild('div', b => b\n                        .addClass(`${this.cssPrefix}-colelement`, `${this.cssPrefix}-aggrfuncelement`)\n                        .addClass(getMobileCssClass())\n                        .addChild('span', b => b\n                        .text(item.text)\n                        .title(item.text)));\n                }\n            }\n            else if (item.type === 2) {\n                exprBlockBuilder\n                    .addChild('div', builder => builder\n                    .addClass(`${this.cssPrefix}-colelement`, `${this.cssPrefix}-attrelement`)\n                    .addClass(getMobileCssClass())\n                    .addChildElement(this.renderBaseExpression()));\n            }\n            else if (item.type === 3) {\n                exprBlockBuilder\n                    .addChild('span', builder => builder\n                    .addClass(`${this.cssPrefix}-colelement`)\n                    .addClass(getMobileCssClass())\n                    .text(item.text)\n                    .title(item.text));\n            }\n        }\n        return exprBlockBuilder.toDOM();\n    }\n    renderColumnTypeButton() {\n        const button = super.renderColumnTypeButton();\n        if (button) {\n            button.firstElementChild.classList.add('aggregated');\n            button.firstElementChild.setAttribute('title', i18n.getText('ButtonToSimple'));\n        }\n        return button;\n    }\n    changeTypeToSimple() {\n        const query = this.column.getQuery();\n        query.changeColumnType(this.column, ExprTag.EntityAttribute);\n        this.fireColumnChanged();\n    }\n    parseDisplayFormat(format) {\n        if (!format)\n            return [];\n        let result = [];\n        const parser = this.displayFormatParser;\n        parser.start(format);\n        while (parser.next()) {\n            const token = parser.getToken();\n            const tokenText = parser.getTokenText();\n            if (token === 'function') {\n                result.push({ type: 1, text: tokenText });\n            }\n            else if (token === 'expression') {\n                result.push({ type: 2 });\n            }\n            else if (token === 'text') {\n                result.push({ type: 3, text: tokenText });\n            }\n        }\n        return result;\n    }\n    updateBaseAttr(attr) {\n        this.column.expr.args[0].setValue(attr.id, true);\n        this.column.expr.baseAttrId = attr.id;\n    }\n    changeTypeHandler(ev) {\n        this.changeTypeToSimple();\n    }\n    processExtraButtonMenuItems(action, evt) {\n        this.changeTypeToSimple();\n        return true;\n    }\n    getExtraButtonMenuItems() {\n        return [{\n                id: '__group',\n                text: i18n.getText('ColTypeGroup'),\n                items: [{\n                        id: 'type',\n                        text: i18n.getText('ColTypeSimple')\n                    }]\n            }];\n    }\n}\n\nclass EditableColumnRendererCP extends AttrColumnRendererCP {\n    constructor() {\n        super(...arguments);\n        this.dataTypeMenu = null;\n    }\n    renderEnabledButton() {\n        const elem = super.renderEnabledButton();\n        const child = elem.children[0];\n        child.title = i18n.getText('CmdToggleEnableCustom');\n        return elem;\n    }\n    ;\n    getClassesToAdd() {\n        return `${this.cssPrefix}-row ${this.cssPrefix}-row-column-entattr` + super.getClassesToAdd();\n    }\n    renderExpressionBlock() {\n        const exprBlock = domel(\"div\")\n            .addClass(`${this.cssPrefix}-expr-block`)\n            .addClass(getMobileCssClass())\n            .toDOM();\n        //Attribute element\n        let builder = domel('div', exprBlock)\n            .addClass(`${this.cssPrefix}-colelement`, `${this.cssPrefix}-attrelement`)\n            .addClass(getMobileCssClass());\n        if (this.isEditable() && this.panel.options.editMode === ColumnsEditMode.Full) {\n            builder\n                .addChild('a', b => b\n                .attr('href', 'javascript:void(0)')\n                .title(this.column.caption)\n                .text(this.column.caption)\n                .on('touchstart click', (ev) => {\n                ev.stopPropagation();\n                const element = ev.target;\n                const inputEl = element.parentElement.querySelector('input');\n                if (inputEl) {\n                    element.style.display = 'none';\n                    inputEl.style.removeProperty('display');\n                    inputEl.style.width = `100%`;\n                    inputEl.focus();\n                    this.element.setAttribute(eqDragManager.DRAG_DISABLED_ATTR, '');\n                }\n            }) //TO DO:add localization and input field\n            )\n                .addChild('input', b => b\n                .hide()\n                .value(this.getColumnValue())\n                .on('blur keydown', (ev) => {\n                let isEndEvent = false;\n                let save = true;\n                if (ev instanceof KeyboardEvent) {\n                    // Enter\n                    if (ev.keyCode === 13) {\n                        isEndEvent = true;\n                        //ESC\n                    }\n                    else if (ev.keyCode === 27) {\n                        isEndEvent = true;\n                        save = false;\n                    }\n                }\n                else if (ev instanceof FocusEvent) {\n                    isEndEvent = true;\n                }\n                if (isEndEvent) {\n                    const inputEl = ev.target;\n                    const aEl = inputEl.parentElement.querySelector('a');\n                    if (aEl) {\n                        aEl.style.removeProperty('display');\n                        inputEl.style.display = 'none';\n                    }\n                    const colVal = this.getColumnValue();\n                    if (save && colVal !== inputEl.value) {\n                        this.setColumnValue(inputEl.value);\n                        this.fireColumnChanged();\n                    }\n                    else {\n                        inputEl.value = colVal;\n                    }\n                    this.element.removeAttribute(eqDragManager.DRAG_DISABLED_ATTR);\n                }\n            }));\n        }\n        else {\n            builder\n                .addChild('span', b => {\n                b.text(this.column.caption)\n                    .title(this.column.caption);\n            });\n        }\n        // Colon element\n        builder = domel('div', exprBlock)\n            .addClass(`${this.cssPrefix}-colelement`)\n            .addChild('span', b => {\n            b.text(':')\n                .title(':');\n        });\n        // DataType element\n        builder = domel('div', exprBlock)\n            .addClass(`${this.cssPrefix}-colelement`, `${this.cssPrefix}-attrelement`)\n            .addClass(getMobileCssClass());\n        // Only allow data type change in Full mode\n        if (this.panel.options.editMode === ColumnsEditMode.Full && this.isEditable()) {\n            this.createDataTypeMenu();\n            builder\n                .addChild('a', dataTypeLink => dataTypeLink\n                .attr('href', 'javascript:void(0)')\n                .title(DataType[this.column.expr.dataType])\n                .text(DataType[this.column.expr.dataType])\n                .on('touchstart click', (ev) => {\n                ev.stopPropagation();\n                this.dataTypeMenu.showMenu({\n                    anchor: dataTypeLink.toDOM(),\n                    selectedIds: null,\n                    itemSelectedCallback: (data, items) => {\n                        this.column.expr.dataType = data.id;\n                        this.fireColumnChanged();\n                    }\n                });\n            }));\n        }\n        else {\n            builder\n                .addChild('span', b => {\n                b.text(DataType[this.column.expr.dataType])\n                    .title(DataType[this.column.expr.dataType]);\n            });\n        }\n        return exprBlock;\n    }\n    changeTypeToSimple() {\n        const query = this.column.getQuery();\n        query.changeColumnType(this.column, ExprTag.EntityAttribute);\n        this.fireColumnChanged();\n    }\n    getColumnValue() {\n        return '';\n    }\n    setColumnValue(value) {\n    }\n    getUIS() {\n        return true;\n    }\n    changeTypeHandler(ev) {\n        this.changeTypeToSimple();\n    }\n    processExtraButtonMenuItems(action, evt) {\n        this.changeTypeToSimple();\n        return true;\n    }\n    createFunctionMenu() {\n        // Nothing TO DO\n    }\n    getExtraButtonMenuItems() {\n        return [{\n                id: '__group',\n                text: i18n.getText('ColTypeGroup'),\n                items: [{\n                        id: 'type',\n                        text: i18n.getText('ColTypeSimple')\n                    }]\n            }];\n    }\n    createDataTypeMenu() {\n        const items = [];\n        for (let typeItem in DataType) {\n            if (!isNaN(Number(typeItem))) {\n                const item = {\n                    id: typeItem,\n                    text: DataType[typeItem]\n                };\n                items.push(item);\n            }\n        }\n        let menuId = this.column.id;\n        if (menuId) {\n            menuId += '-DataTypeMenu';\n        }\n        const menuOptions = {\n            items: items,\n            id: menuId,\n            searchBoxAlwaysShown: false,\n            domWriteItemsId: true\n        };\n        this.dataTypeMenu = new PopupMenu(menuOptions);\n    }\n}\nclass CustomSqlColumnRendererCP extends EditableColumnRendererCP {\n    get columnEnabled() {\n        return this.panel.areCustomExpressionsAllowed() ? this.column.enabled : false;\n    }\n    set columnEnabled(value) {\n        if (this.panel.areCustomExpressionsAllowed()) {\n            this.column.enabled = value;\n        }\n        else {\n            this.column.enabled = false;\n        }\n    }\n    renderColumnTypeButton() {\n        const button = super.renderColumnTypeButton();\n        if (button) {\n            button.firstElementChild.classList.add('aggregated');\n            button.firstElementChild.setAttribute('title', i18n.getText('ButtonToSimple'));\n        }\n        return button;\n    }\n    getColumnValue() {\n        return this.column.expr.sql;\n    }\n    setColumnValue(value) {\n        this.column.expr.sql = value;\n    }\n    getDefaultValue() {\n        return this.column.expr.sql;\n    }\n}\nclass ConstColumnRendererCP extends EditableColumnRendererCP {\n    renderColumnTypeButton() {\n        const button = super.renderColumnTypeButton();\n        if (button) {\n            button.firstElementChild.classList.add('aggregated');\n            button.firstElementChild.setAttribute('title', i18n.getText('ButtonToSimple'));\n        }\n        return button;\n    }\n    getColumnValue() {\n        return this.column.expr.value;\n    }\n    setColumnValue(value) {\n        this.column.expr.setValue(value);\n    }\n    getDefaultValue() {\n        return this.column.expr.value;\n    }\n}\n\nclass ColumnsPanel extends Widget {\n    get cssPrefix() {\n        return 'eqjs-qc';\n    }\n    constructor(slot) {\n        super(slot);\n        this.options = {\n            isSubQuery: false,\n            activeColumn: null,\n            showAddRow: true,\n            showHeader: true,\n            showColumnTitles: true,\n            allowAggrColumns: true,\n            allowDuplicates: true,\n            allowCustomExpressions: false,\n            allowSorting: true,\n            attrElementFormat: '{entity} {attr}',\n            titleElementFormat: null,\n            buttons: null,\n            alwaysShowButtons: false,\n            accentActiveColumn: true,\n            allowDragDrop: true,\n            menuOptions: {\n                showSearchBoxAfter: 30,\n                searchBoxAutoFocus: true,\n                activateOnMouseOver: true,\n                adjustHeight: true,\n                itemRenderedCallback: null\n            },\n            attrPlacement: 0,\n            sortEntities: false,\n            columnRenderedCallback: null,\n            customExpressionText: 0,\n            allowHiddenColumns: false,\n            showAddAllForEntity: false,\n            showIndicatorOnLoad: true,\n            editMode: ColumnsEditMode.Full\n        };\n        this.landingSlot = domel('div')\n            .addClass(`${this.cssPrefix}-col-landing-slot`)\n            .addChildElement(domel('div')\n            .toDOM())\n            .toDOM();\n        this.landingIndex = -1;\n        this.slot.classList.add(`${this.cssPrefix}-panel`);\n        this.group = WidgetGroup.Query;\n    }\n    getWidgetType() {\n        return 'columnsPanel';\n    }\n    /**\n     * Gets or sets the current edit mode. When setting, automatically refreshes the widget.\n     */\n    get editMode() {\n        return this.options.editMode || ColumnsEditMode.Full;\n    }\n    set editMode(value) {\n        if (this.options.editMode !== value) {\n            this.options.editMode = value;\n            this.refresh();\n        }\n    }\n    init(context, options) {\n        super.init(context, options);\n        this.setOptions(options);\n        this.renderProgressBlock();\n        const model = context.getModel();\n        this.detachQueryObserver();\n        this.attachQueryObserver();\n        eqDragManager.removeDropContainer(this.slot);\n        if (this.options.allowDragDrop) {\n            eqDragManager.registerDropContainer({\n                element: this.slot,\n                scopes: [\"entityAttr\", \"entityAttrSort\"],\n                onDragEnter: (container, ev) => {\n                    this.slot.classList.add(`${eqCssPrefix}-drophover`);\n                    if (ev.item.scope === \"entityAttrSort\") {\n                        this.showLandingSlot(ev.pageX, ev.pageY);\n                    }\n                    else {\n                        const attrId = ev.data.attrId;\n                        if (!model.checkAttrProperty(attrId, \"useInResult\")) {\n                            ev.dropEffect = DropEffect.Forbid;\n                        }\n                        ev.dragImage.classList.add('eqjs-sortable-helper');\n                    }\n                },\n                onDragOver: (container, ev) => {\n                    const attrId = ev.data.attrId;\n                    if (ev.item.scope === \"entityAttrSort\" ||\n                        model.checkAttrProperty(attrId, \"useInResult\")) {\n                        this.showLandingSlot(ev.pageX, ev.pageY);\n                    }\n                },\n                onDragLeave: (container, ev) => {\n                    if (ev.item.scope === \"entityAttrSort\") {\n                        ev.dropEffect = DropEffect.Forbid;\n                    }\n                    else {\n                        ev.dragImage.classList.remove('eqjs-sortable-helper');\n                        ev.dragImage.style.removeProperty('width');\n                    }\n                    this.slot.classList.remove(`${eqCssPrefix}-drophover`);\n                    this.hideLandingSlot();\n                },\n                onDrop: (container, ev) => {\n                    if (ev.item.scope == \"entityAttrSort\") {\n                        const query = this.getQuery();\n                        const columns = query.getColumns();\n                        const index = columns.indexOf(ev.data.column);\n                        this.moveColumnCore(index, this.landingIndex);\n                    }\n                    else {\n                        const attrId = ev.data.attrId;\n                        this.addNewColumn(attrId, this.landingIndex);\n                    }\n                }\n            });\n        }\n    }\n    renderBaseElements() {\n        let minusHeight = 0;\n        if (this.options.showHeader) {\n            const headerBuilder = domel('div', this.slot)\n                .hide()\n                .addClass(`${this.cssPrefix}-header`)\n                .addClass(getMobileCssClass());\n            if (!this.options.alwaysShowButtons) {\n                headerBuilder.addClass(\"eqjs-no-buttons\");\n            }\n            if (this.options.showCheckboxes) {\n                headerBuilder.addChild('div', builder => builder\n                    .setStyle('margin-left', '30px')); //quick fix to adjust title column header when showCheckboxes is on\n            }\n            else {\n                headerBuilder.addClass(\"eqjs-no-checkbox\");\n            }\n            headerBuilder.addChild('div', builder => builder\n                .addClass(`${this.cssPrefix}-header-expression`)\n                .text(i18n.getText('HeaderExpression')));\n            if (this.options.showColumnTitles !== false) {\n                headerBuilder\n                    .addChild('div', builder => builder\n                    .addClass(`${this.cssPrefix}-header-title`)\n                    .text(i18n.getText('HeaderTitle')));\n            }\n            this.headerElement = headerBuilder.toDOM();\n            minusHeight += this.headerElement.offsetHeight;\n        }\n        this.columnsBlock =\n            domel('div', this.slot)\n                .addClass(`${this.cssPrefix}-columns`)\n                .addClass(getMobileCssClass())\n                .toDOM();\n        // Only show add row in Full edit mode\n        if (this.options.showAddRow && this.options.editMode === ColumnsEditMode.Full) {\n            this.addRowElement =\n                domel('div', this.slot)\n                    .addClass(`${eqCssPrefix}-addrow`, `${this.cssPrefix}-addrow`, `${eqCssPrefix}-addrow-empty`)\n                    .addClass(getMobileCssClass())\n                    .addChild('a', builder => builder\n                    .attr('href', 'javascript:void(0)')\n                    .text(i18n.getText('CmdClickToAddColumn'))\n                    .on('click', (e) => {\n                    e.preventDefault();\n                    this.showEntitiesMenu({\n                        anchor: e.target,\n                        selectedIds: null,\n                        itemSelectedCallback: (data, items) => {\n                            if (data.id === '__AddAll__' && data.extra && Array.isArray(data.extra.ids)) {\n                                data.extra.ids.forEach(attrId => this.addNewColumn(attrId));\n                            }\n                            else {\n                                const attrid = data.id;\n                                this.addNewColumn(attrid);\n                            }\n                            return false;\n                        }\n                    });\n                }))\n                    .toDOM();\n            minusHeight += this.addRowElement.offsetHeight;\n        }\n        this.columnsBlock.style.maxHeight = `${this.slot.offsetHeight - minusHeight - 25}px`;\n    }\n    destroyCore() {\n        eqDragManager.removeDropContainer(this.slot);\n        this.detachQueryObserver();\n        this.slot.innerHTML = '';\n    }\n    attachQueryObserver() {\n        const query = this.getQuery();\n        this.queryEventCallbackId = query.addChangedCallback(event => {\n            //if something has changed, and that change is related to columns\n            const edata = event.data;\n            if (!edata || (edata.part != QueryChangePart.Columns\n                && edata.part != QueryChangePart.Aggregation\n                && edata.part != QueryChangePart.All)) {\n                return;\n            }\n            const focusedBefore = document.activeElement;\n            const isFocusInside = this.slot.contains(focusedBefore) || focusedBefore == document.body;\n            switch (edata.action) {\n                case QueryChangeAction.Modify: {\n                    const columns = edata.changee;\n                    const modifyColumn = (column) => {\n                        const colEl = this.columnsBlock.querySelector(`div[data-id='${column.id}']`);\n                        if (colEl) {\n                            const renderer = this.getColumnRenderer(column, colEl);\n                            if (renderer) {\n                                const newEl = renderer.render();\n                                if (isFocusInside) {\n                                    const focusElem = newEl.querySelector('a') || newEl.querySelector('.eqjs-column-button');\n                                    if (focusElem) {\n                                        focusElem.focus();\n                                    }\n                                }\n                            }\n                        }\n                    };\n                    if (Array.isArray(columns)) {\n                        columns.forEach((col) => modifyColumn(col));\n                    }\n                    else {\n                        modifyColumn(columns);\n                    }\n                    this.agjustHeaderVisibility();\n                    break;\n                }\n                case QueryChangeAction.Add: {\n                    const columns = edata.changee;\n                    const addColumn = (column) => {\n                        const index = query.getColumns().indexOf(column);\n                        const newEl = this.addColumnElement(column, index);\n                        if (isFocusInside) {\n                            const focusElem = newEl.querySelector('a');\n                            if (focusElem) {\n                                try {\n                                    focusElem.focus();\n                                }\n                                catch (_a) {\n                                    //do nothing\n                                }\n                            }\n                        }\n                    };\n                    if (Array.isArray(columns)) {\n                        columns.forEach((col) => addColumn(col));\n                    }\n                    else {\n                        addColumn(columns);\n                    }\n                    this.agjustHeaderVisibility();\n                    break;\n                }\n                case QueryChangeAction.Delete: {\n                    const columns = edata.changee;\n                    const deleteColumn = (column) => {\n                        const colEl = this.columnsBlock.querySelector(`div[data-id='${column.id}']`);\n                        if (colEl) {\n                            const next = colEl.nextSibling;\n                            const prev = colEl.previousSibling;\n                            this.columnsBlock.removeChild(colEl);\n                            if (isFocusInside) {\n                                const focusCond = next || prev || this.addRowElement;\n                                const focusElem = focusCond.querySelector('a') || focusCond.querySelector('.eqjs-column-button');\n                                if (focusElem) {\n                                    focusElem.focus();\n                                }\n                            }\n                        }\n                    };\n                    this.agjustHeaderVisibility();\n                    if (Array.isArray(columns)) {\n                        columns.forEach((col) => deleteColumn(col));\n                    }\n                    else {\n                        deleteColumn(columns);\n                    }\n                    break;\n                }\n                default:\n                    this.refresh();\n                    break;\n            }\n        });\n    }\n    detachQueryObserver() {\n        if (this.queryEventCallbackId) {\n            const query = this.getQuery();\n            query.removeChangedCallback(this.queryEventCallbackId);\n        }\n    }\n    getQuery() {\n        return this.getContext().getQuery();\n    }\n    showLandingSlot(pageX, pageY) {\n        const rowElems = this.columnsBlock.querySelectorAll(`[class*=${this.cssPrefix}-row]`);\n        const rows = [];\n        for (let i = 0; i < rowElems.length; i++) {\n            const rowElem = rowElems[i];\n            if (rowElem.style.display === 'none')\n                continue;\n            rows.push(rowElem);\n        }\n        if (rows.length === 0) {\n            this.landingIndex = 0;\n            this.columnsBlock.appendChild(this.landingSlot);\n            return;\n        }\n        const landingPos = getElementAbsolutePos(this.landingSlot);\n        if (pageY >= landingPos.y && pageY <= landingPos.y + this.landingSlot.offsetHeight) {\n            return;\n        }\n        const firstRow = rows[0];\n        const rowHeight = firstRow.offsetHeight;\n        const absPos = getElementAbsolutePos(firstRow);\n        let newLandingIndex = (pageY > absPos.y + rowHeight / 2) ? Math.round((pageY - absPos.y + rowHeight / 2) / rowHeight) : 0;\n        if (newLandingIndex > rows.length) {\n            newLandingIndex = rows.length;\n        }\n        if (newLandingIndex != this.landingIndex) {\n            this.landingIndex = newLandingIndex;\n            if (this.landingIndex < rows.length) {\n                this.columnsBlock.insertBefore(this.landingSlot, rows[this.landingIndex]);\n            }\n            else {\n                this.columnsBlock.appendChild(this.landingSlot);\n            }\n            this.landingSlot.scrollIntoView({ block: \"center\", behavior: \"smooth\" });\n        }\n    }\n    hideLandingSlot() {\n        this.landingIndex = -1;\n        setTimeout(() => {\n            if (this.landingSlot.parentElement) {\n                this.landingSlot.parentElement.removeChild(this.landingSlot);\n            }\n        }, 10);\n    }\n    setOptions(options) {\n        utils.assignDeep(this.options, options);\n        if (typeof options.allowCustomExpressions !== 'undefined') {\n            this.context.options.allowCustomExpressions = options.allowCustomExpressions;\n        }\n        if (options.attrElementFormat) {\n            this.context.options.attributeFormat = options.attrElementFormat;\n        }\n        if (options.titleElementFormat) {\n            this.context.options.columnTitleFormat = options.titleElementFormat;\n        }\n        if (browserUtils.isMobileMode()) {\n            this.options.buttons = [\"menu\", \"sorting\"];\n            this.options.showHeader = false;\n        }\n    }\n    onProcessStartCore() {\n        if (this.options.showIndicatorOnLoad) {\n            if (!this.progressBlock.parentNode)\n                this.slot.appendChild(this.progressBlock);\n        }\n    }\n    onProcessEndCore() {\n        if (this.options.showIndicatorOnLoad) {\n            if (this.progressBlock.parentNode)\n                this.slot.removeChild(this.progressBlock);\n        }\n    }\n    refreshCore() {\n        this.clear();\n        this.render();\n    }\n    clear() {\n        this.slot.innerHTML = \"\";\n    }\n    render() {\n        try {\n            this.renderBaseElements();\n            this.createEntitiesMenu();\n            this.createColumnMenus();\n            this.agjustHeaderVisibility();\n            domel(this.slot)\n                .removeClass(eqCssMobile)\n                .addClass(getMobileCssClass());\n            const query = this.context.getQuery();\n            const columns = query.getColumns();\n            for (let column of columns) {\n                this.columnsBlock.appendChild(this.renderColumn(column));\n            }\n        }\n        catch (err) {\n            let error = err;\n            this.context.throwError({\n                action: \"ColumnsPanel rendering\",\n                text: error.message,\n                sourceError: error\n            });\n        }\n    }\n    agjustHeaderVisibility() {\n        if (this.headerElement) {\n            const query = this.context.getQuery();\n            const columns = query.getColumns();\n            this.headerElement.style.display = (columns.length) ? '' : 'none';\n        }\n    }\n    renderColumn(column) {\n        const renderer = this.getColumnRenderer(column);\n        if (renderer)\n            return renderer.render();\n        return null;\n    }\n    toggleColumnPicked(column) {\n        let el;\n        let isActive;\n        if (column) {\n            el = this.columnsBlock.querySelector(`div[data-id=${column.id}]`);\n            if (el) {\n                isActive = el.classList.contains('active');\n            }\n        }\n        //clear 'active' in all rows\n        const rows = this.columnsBlock.querySelectorAll(`.${this.cssPrefix}-row`);\n        for (let i = 0; i < rows.length; i++) {\n            const row = rows[i];\n            domel(row)\n                .removeClass('active');\n            if (!this.options.alwaysShowButtons) {\n                domel(row)\n                    .data(\"show-buttons\", null);\n            }\n        }\n        if (el && !isActive) {\n            domel(el)\n                .addClass('active')\n                .data(\"show-buttons\", \"\");\n        }\n    }\n    addNewColumn(attrs, index) {\n        // Only allow adding columns in Full edit mode\n        if (this.options.editMode !== ColumnsEditMode.Full) {\n            return null;\n        }\n        this.getContext().getModel();\n        const query = this.getQuery();\n        if (Array.isArray(attrs)) {\n            let col = null;\n            let cols = [];\n            for (let i = 0; i < attrs.length; i++) {\n                col = query.addColumn({\n                    attributeId: attrs[i],\n                    index: index\n                }, true);\n                if (col) {\n                    cols.push(col);\n                }\n            }\n            query.fireChangedEvent({\n                part: QueryChangePart.Columns,\n                action: QueryChangeAction.Add,\n                changee: cols,\n                source: this\n            });\n            return cols;\n        }\n        else {\n            const col = query.addColumn({\n                attributeId: attrs,\n                index: index\n            });\n            return col;\n        }\n    }\n    //adds one column to the panel on the specified position\n    addColumnElement(column, index) {\n        const rows = this.columnsBlock.querySelectorAll(`[class*=${this.cssPrefix}-row]`);\n        const newColBlock = this.renderColumn(column);\n        if (rows.length > 0) {\n            if (index < rows.length) {\n                this.columnsBlock.insertBefore(newColBlock, rows[index]);\n            }\n            else {\n                this.columnsBlock.appendChild(newColBlock);\n                this.scrollToBottom();\n            }\n        }\n        else {\n            this.columnsBlock.appendChild(newColBlock);\n            this.scrollToBottom();\n        }\n        if (this.options.columnRenderedCallback) {\n            this.options.columnRenderedCallback(newColBlock);\n        }\n        return newColBlock;\n    }\n    scrollToBottom() {\n        this.columnsBlock.scrollTop = this.columnsBlock.scrollHeight - this.columnsBlock.clientHeight;\n    }\n    checkColumnsArray(cols) {\n        let len = cols.length;\n        const result = [];\n        for (let i = 0; i < len; i++) {\n            if (this.checkColumn(cols[i]))\n                result.push(cols[i]);\n        }\n        return result;\n    }\n    checkColumn(col) {\n        if (!this.options.allowDuplicates) {\n            const query = this.getQuery();\n            const columns = query.getColumns();\n            for (let i = 0; i < columns.length; i++) {\n                if ((col.expr.tag === ExprTag.EntityAttribute && columns[i].expr.tag === ExprTag.EntityAttribute\n                    || col.expr.tag === ExprTag.ParentEntityAttribute && columns[i].expr.tag === ExprTag.ParentEntityAttribute)\n                    && col.expr.value === columns[i].expr.value) {\n                    return null;\n                }\n            }\n        }\n        return col;\n    }\n    getColumnsBlock() {\n        return this.columnsBlock;\n    }\n    getColumnRenderer(column, slot) {\n        switch (column.expr.tag) {\n            case ExprTag.Constant:\n                return new ConstColumnRendererCP(this, column, slot);\n            case ExprTag.AggregateFunction:\n                return new AggrFuncColumnRendererCP(this, column, slot);\n            case ExprTag.CustomSql:\n                return new CustomSqlColumnRendererCP(this, column, slot);\n            default:\n                return new AttrColumnRendererCP(this, column, slot);\n        }\n    }\n    areCustomExpressionsAllowed() {\n        const query = this.getQuery();\n        return query.isEx() && this.getContext().options.allowCustomExpressions;\n    }\n    addAllColumnsToEntitiesList(list) {\n        const attrIds = list.filter(item => !item.isEntity).map(item => item.id);\n        if (attrIds.length > 0) {\n            list.unshift({\n                id: '__AddAll__',\n                text: i18n.getText('AddAllForEntityText'),\n                extra: {\n                    ids: attrIds\n                }\n            });\n        }\n        list.forEach(item => {\n            if (item.items) {\n                this.addAllColumnsToEntitiesList(item.items);\n            }\n        });\n    }\n    createEntitiesMenu() {\n        const model = this.getContext().getModel();\n        if (!model || model.isEmpty())\n            return null;\n        let menuId = this.slot.id;\n        if (menuId) {\n            menuId += '-EntitiesMenu';\n        }\n        const entitiesList = model.getEntitiesTree({ addUIC: false, addUIR: true, addUIS: false, attrPlacement: this.options.attrPlacement, sortEntities: this.options.sortEntities });\n        // add [Add all columns] items\n        if (this.options.showAddAllForEntity) {\n            this.addAllColumnsToEntitiesList(entitiesList);\n        }\n        const options = {\n            id: menuId,\n            items: entitiesList,\n            adjustHeight: this.options.adjustEntitiesMenuHeight,\n            domWriteItemsId: this.options.domWriteItemsId\n        };\n        utils.assign(options, this.options.menuOptions);\n        this.entitiesMenu = new PopupMenu(options);\n    }\n    getSortMenuList() {\n        return [\n            { id: 'None', text: i18n.getText('CmdNotSorted') },\n            { id: 'Ascending', text: i18n.getText('CmdAscending') },\n            { id: 'Descending', text: i18n.getText('CmdDescending') },\n            { id: '---', text: '---' }\n        ];\n    }\n    getMoveMenuList() {\n        return [\n            { id: 'MoveTop', text: i18n.getText('CmdMoveToFirst') },\n            { id: 'MoveUp', text: i18n.getText('CmdMoveToPrev') },\n            { id: 'MoveDown', text: i18n.getText('CmdMoveToNext') },\n            { id: 'MoveBottom', text: i18n.getText('CmdMoveToLast') }\n        ];\n    }\n    createSortMenu() {\n        const model = this.getContext().getModel();\n        if (!model || model.isEmpty())\n            return null;\n        let menuId = this.slot.id;\n        if (menuId) {\n            menuId += '-SortMenu';\n        }\n        const items = this.getSortMenuList().concat(this.moveMenu.getItems());\n        const menuOptions = {\n            id: menuId,\n            \"items\": items,\n            domWriteItemsId: this.options.domWriteItemsId,\n            showSelected: true\n        };\n        utils.assign(menuOptions, this.options.menuOptions);\n        menuOptions.searchBoxAlwaysShown = false;\n        this.sortMenu = new PopupMenu(menuOptions);\n    }\n    createMoveMenu() {\n        const model = this.getContext().getModel();\n        if (!model || model.isEmpty())\n            return null;\n        let menuId = this.slot.id;\n        if (menuId) {\n            menuId += '-MoveMenu';\n        }\n        const items = utils.createArrayFrom(this.getMoveMenuList());\n        if (this.options.allowHiddenColumns) {\n            items.push({ id: '---', text: '---' });\n            items.push({ id: 'IsHidden', text: i18n.getText('CmdHiddenColumn') });\n        }\n        const menuOptions = {\n            \"items\": items,\n            id: menuId,\n            domWriteItemsId: this.options.domWriteItemsId,\n            showSelected: true\n        };\n        utils.assign(menuOptions, this.options.menuOptions);\n        this.moveMenu = new PopupMenu(menuOptions);\n        menuOptions.searchBoxAlwaysShown = false;\n    }\n    showEntitiesMenu(menuOptions) {\n        this.entitiesMenu.showMenu(menuOptions);\n    }\n    moveColumn(column, direction) {\n        // Only allow moving columns in Full or FixedList edit mode\n        if (this.options.editMode !== ColumnsEditMode.Full && this.options.editMode !== ColumnsEditMode.FixedList) {\n            return;\n        }\n        const query = this.getQuery();\n        const columns = query.getColumns();\n        const index = columns.indexOf(column);\n        if (index >= 0) {\n            switch (direction) {\n                case 'MoveTop':\n                    if (index == 0) {\n                        return;\n                    }\n                    this.moveColumnCore(index, 0);\n                    break;\n                case 'MoveUp':\n                    if (index == 0) {\n                        return;\n                    }\n                    this.moveColumnCore(index, index - 1);\n                    break;\n                case 'MoveDown':\n                    if (index == columns.length - 1) {\n                        return;\n                    }\n                    this.moveColumnCore(index, index + 1);\n                    break;\n                case 'MoveBottom':\n                    if (index == columns.length - 1) {\n                        return;\n                    }\n                    this.moveColumnCore(index, columns.length - 1);\n                    break;\n            }\n        }\n    }\n    moveColumnCore(index1, index2) {\n        const query = this.getQuery();\n        if (!query)\n            return;\n        const rows = this.columnsBlock.querySelectorAll(`[class*=${this.cssPrefix}-row]`);\n        const colToMove = rows[index1];\n        if (index2 == 0) {\n            this.columnsBlock.insertBefore(colToMove, this.columnsBlock[0]);\n        }\n        else if (index2 > 0 && index2 < rows.length - 1) {\n            if (index1 < index2) {\n                this.columnsBlock.insertBefore(colToMove, rows[index2 + 1]);\n            }\n            else {\n                this.columnsBlock.insertBefore(colToMove, rows[index2]);\n            }\n        }\n        else {\n            this.columnsBlock.appendChild(colToMove);\n        }\n        query.moveColumn(index1, index2);\n        query.fireColumnsChangedEvent();\n    }\n    createColumnMenus() {\n        this.createMoveMenu();\n        if (this.options.allowSorting) {\n            this.createSortMenu();\n        }\n    }\n    renderProgressBlock() {\n        this.progressBlock = document.createElement('div');\n        this.progressBlock.classList.add(`${eqCssPrefix}-progress-win8`);\n        this.progressBlock.classList.add(getMobileCssClass());\n        this.progressBlock.innerHTML = '<div class=\"wBall\" id=\"wBall_1\"><div class=\"wInnerBall\"></div></div><div class=\"wBall\" id=\"wBall_2\"><div class=\"wInnerBall\"></div></div><div class=\"wBall\" id=\"wBall_3\"><div class=\"wInnerBall\"></div></div><div class=\"wBall\" id=\"wBall_4\"><div class=\"wInnerBall\"></div></div><div class=\"wBall\" id=\"wBall_5\"><div class=\"wInnerBall\"></div></div>';\n    }\n}\n\nclass ColumnRendererCB {\n    constructor(panel, column, slot) {\n        this.functionMenu = null;\n        this.formatsMenu = null;\n        this.isMouseOverBlock = false;\n        this.keepShowingButtons = false;\n        this.tapedTwice = false;\n        this.bar = panel;\n        this.column = column;\n        this.element = slot;\n    }\n    get cssPrefix() {\n        return 'eqjs-cb';\n    }\n    render() {\n        const builder = domel('div');\n        builder.data('id', this.column.id);\n        if (this.element) {\n            //to remove all event listeners\n            this.element.parentNode\n                .replaceChild(builder.toDOM(), this.element);\n        }\n        this.element = builder.toDOM();\n        if (this.bar.isDraggable()) {\n            eqDragManager.registerDraggableItem({\n                element: this.element,\n                scope: \"entityAttrSort\",\n                beforeDragStart: () => this.element.dispatchEvent(createBrowserEvent('mouseleave')),\n                onDragStart: (ev) => {\n                    this.hideButtons();\n                    this.element.style.display = 'none';\n                    ev.dropEffect = DropEffect.Allow;\n                },\n                onDragEnd: (ev) => {\n                    this.element.removeAttribute('style');\n                },\n                data: { column: this.column }\n            });\n        }\n        if (!this.column.isReadOnly()) {\n            this.createFunctionMenu();\n            this.createFormatsMenu();\n        }\n        builder\n            .addClass(this.getClassesToAdd())\n            .addClass(getMobileCssClass())\n            .addChildElement(this.renderCaptionBlock())\n            .addChildElement(this.renderSortingImage());\n        if (!browserUtils.isMobileMode()) {\n            builder\n                .addChildElement(this.renderButtonsBlock());\n        }\n        //start event listeners\n        builder\n            .on('mouseenter', this.onMouseEnter.bind(this))\n            .on('mouseleave', this.onMouseLeave.bind(this));\n        //end event listeners\n        if (this.bar.options.accentActiveColumn || browserUtils.isMobileMode()) {\n            builder\n                .on('touchstart click', this.onMouseClick.bind(this));\n        }\n        return this.element;\n    }\n    fireColumnChanged() {\n        this.column.fireChangedEvent();\n    }\n    refresh() {\n        this.render();\n    }\n    isEditable() {\n        // Editable if enabled, not read-only, and editMode is All or FixedList (for title/sort/order)\n        return this.column.enabled && !this.column.isReadOnly() && (this.bar.options.editMode === ColumnsEditMode.Full || this.bar.options.editMode === ColumnsEditMode.FixedList);\n    }\n    renderButtonsBlock() {\n        // Only show delete/type buttons in All mode\n        const showDelete = this.bar.options.editMode === ColumnsEditMode.Full;\n        const showType = this.bar.options.editMode === ColumnsEditMode.Full;\n        return domel('div', this.element)\n            .addClass(`${eqCssPrefix}-column-buttonsBlock`, `${this.cssPrefix}-buttonsBlock`)\n            .addChildElement(this.renderSortingButton())\n            .addChildElement(showType ? this.renderColumnTypeButton() : null)\n            .addChildElement(this.renderColumnFormatButton())\n            .addChildElement(showDelete ? this.renderDeleteButton() : null)\n            .toDOM();\n    }\n    renderCaptionBlock() {\n        const caption = this.column.caption;\n        if (!this.isEditable()) {\n            return domel('div')\n                .addClass(`${this.cssPrefix}-colelement`, `${this.cssPrefix}-captionelement`)\n                .addClass(getMobileCssClass())\n                .addChild('div', b => b\n                .title(caption)\n                .text(caption)\n                .attr('tabIndex', '0'))\n                .toDOM();\n        }\n        const tapHandler = (ev) => {\n            if (!this.tapedTwice) {\n                this.tapedTwice = true;\n                setTimeout(() => { this.tapedTwice = false; }, 300);\n            }\n        };\n        let isFocused = false;\n        domel(this.element).on('touchstart dblclick', ev => {\n            if (ev instanceof TouchEvent && !this.tapedTwice) {\n                tapHandler();\n                return true;\n            }\n            ev.stopPropagation();\n            isFocused = this.element.querySelector('a') == document.activeElement;\n            const inputEl = this.element.querySelector(`.${this.cssPrefix}-captionelement input`);\n            const aEl = this.element.querySelector(`.${this.cssPrefix}-captionelement a`);\n            if (inputEl) {\n                inputEl.style.width = `${this.element.clientWidth}px`;\n                aEl.style.display = 'none';\n                inputEl.style.removeProperty('display');\n                inputEl.focus();\n                this.element.setAttribute(eqDragManager.DRAG_DISABLED_ATTR, '');\n            }\n            return false;\n        }); //TO DO:add localization and input field);\n        return domel('div')\n            .addClass(`${this.cssPrefix}-colelement`, `${this.cssPrefix}-captionelement`)\n            .addClass(getMobileCssClass())\n            .addChild('a', builder => builder\n            .attr('href', 'javascript:void(0)')\n            .title(this.column.caption)\n            .text(caption)\n            .on('keydown', e => {\n            const evt = e;\n            const isCtrlEnter = (evt.ctrlKey || evt.metaKey) && (evt.keyCode == 13 || evt.keyCode == 10);\n            if (isCtrlEnter && this.isColumnActive()) {\n                const clickEvent = document.createEvent('MouseEvents');\n                clickEvent.initEvent('dblclick', true, true);\n                this.element.dispatchEvent(clickEvent);\n                evt.stopPropagation();\n                return false;\n            }\n            return true;\n        }))\n            .addChild('input', builder => builder\n            .hide()\n            .value(this.column.caption)\n            .on('blur keydown', (ev) => {\n            let isEndEvent = false;\n            let save = true;\n            if (ev instanceof KeyboardEvent) {\n                // Enter\n                if (ev.keyCode === 13) {\n                    isEndEvent = true;\n                    //ESC\n                }\n                else if (ev.keyCode === 27) {\n                    isEndEvent = true;\n                    save = false;\n                }\n            }\n            else if (ev instanceof FocusEvent) {\n                isEndEvent = true;\n            }\n            if (isEndEvent) {\n                const inputEl = ev.target;\n                const aEl = inputEl.parentElement.querySelector('a');\n                if (aEl) {\n                    aEl.style.removeProperty('display');\n                    inputEl.style.display = 'none';\n                }\n                if (save && this.column.caption !== inputEl.value) {\n                    this.column.caption = inputEl.value;\n                    this.fireColumnChanged();\n                }\n                else {\n                    inputEl.value = this.column.caption;\n                }\n                this.element.removeAttribute(eqDragManager.DRAG_DISABLED_ATTR);\n                if (isFocused) {\n                    this.element.querySelector('a').focus();\n                }\n            }\n        }))\n            .toDOM();\n    }\n    renderSortingImage() {\n        const sortButtonCssClass = `${eqCssPrefix}-column-sortbutton`;\n        let sortButtonDirectionCssClass = sortButtonCssClass;\n        switch (this.column.sorting) {\n            case SortDirection.Ascending:\n                sortButtonDirectionCssClass = `${sortButtonCssClass}-asc`;\n                break;\n            case SortDirection.Descending:\n                sortButtonDirectionCssClass = `${sortButtonCssClass}-desc`;\n                break;\n        }\n        if (this.column.sorting == SortDirection.None) {\n            return null;\n        }\n        else {\n            return domel('div')\n                .addClass(`${this.cssPrefix}-colelement`, `${this.cssPrefix}-sortimage-placeholder`)\n                .addClass(getMobileCssClass())\n                .addChild('div', builder => builder\n                .addClass(`${this.cssPrefix}-img-sorting`, sortButtonDirectionCssClass)\n                .title(i18n.getText('ButtonSorting')))\n                .toDOM();\n        }\n    }\n    buttonSortingClickHandler(ev, anchor) {\n        ev.stopPropagation();\n        this.keepShowingButtons = true;\n        const menu = this.getUIS() ? this.bar.sortMenu || this.bar.moveMenu : this.bar.moveMenu;\n        menu.showMenu({\n            anchor: anchor,\n            selectedIds: null,\n            itemSelectedCallback: (data, items) => {\n                const strToSortDirection = (str) => {\n                    if (str == 'None') {\n                        return SortDirection.None;\n                    }\n                    else if (str == \"Ascending\") {\n                        return SortDirection.Ascending;\n                    }\n                    else if (str == \"Descending\") {\n                        return SortDirection.Descending;\n                    }\n                };\n                if (data.id == 'None' || data.id == \"Ascending\" || data.id == \"Descending\") {\n                    const query = this.bar.getQuery();\n                    this.column.sorting = strToSortDirection(data.id);\n                    this.column._sortIndex = query.getColumnSortIndex(this.column);\n                    this.fireColumnChanged();\n                }\n                else {\n                    this.bar.moveColumn(this.column, data.id);\n                }\n            },\n            menuClosedCallback: () => {\n                this.keepShowingButtons = false;\n                if (!this.isMouseOverBlock) {\n                    this.leaveButtonBlock();\n                }\n            }\n        });\n        return false;\n    }\n    renderSortingButton() {\n        if (!this.isEditable()) {\n            return null;\n        }\n        const builder = domel('div')\n            .addClass(`${eqCssPrefix}-column-button`, `${eqCssPrefix}-column-sortbutton`, `${eqCssPrefix}-column-sortbutton-none`)\n            .title(i18n.getText('ButtonSorting'))\n            .attr('tabIndex', '0')\n            .on('touchstart click', (ev) => this.buttonSortingClickHandler(ev, builder.toDOM()))\n            .on('keypress', evt => { if (evt.keyCode == 13) {\n            evt.target.click();\n        } });\n        return builder.toDOM();\n    }\n    buttonDeleteClickHandler(ev) {\n        ev.stopPropagation();\n        const query = this.bar.getQuery();\n        query.removeColumn(this.column);\n        query.fireColumnsChangedEvent(QueryChangeAction.Delete, this.column);\n        return false;\n    }\n    renderDeleteButton() {\n        // Only show delete in All mode\n        if (this.column.isReadOnly() || this.bar.options.editMode !== ColumnsEditMode.Full) {\n            return null;\n        }\n        return domel('div')\n            .addClass(`${eqCssPrefix}-column-button`, `${eqCssPrefix}-column-button-delete`)\n            .title(i18n.getText('CmdDelete'))\n            .attr('tabIndex', '0')\n            .on('touchstart click', (ev) => this.buttonDeleteClickHandler(ev))\n            .on('keypress', evt => { if (evt.keyCode == 13) {\n            evt.target.click();\n        } })\n            .toDOM();\n    }\n    getClassesToAdd() {\n        let result = \"\";\n        result += this.column.enabled ? '' : ` ${this.cssPrefix}-disabled`;\n        if (this.column.enabled) {\n            result += this.column.isReadOnly() ? ` ${this.cssPrefix}-readonly` : '';\n        }\n        return result;\n    }\n    buttonTypeClickHandler(ev) {\n        ev.stopPropagation();\n        this.keepShowingButtons = true;\n        this.changeColumnTypeHandler(ev);\n        return false;\n    }\n    buttonFormatClickHandler(ev) {\n        ev.stopPropagation();\n        this.keepShowingButtons = true;\n        this.changeFormatHandler(ev);\n        return false;\n    }\n    formatButtonIsShown() {\n        return this.bar.options.allowDisplayFormatChange !== false &&\n            this.bar\n                .getContext()\n                .getModel()\n                .getDisplayFormatsForType(this.column.getDataType()).length > 0;\n    }\n    changeFormatHandler(ev) {\n        const formats = this.bar\n            .getContext()\n            .getModel()\n            .getDisplayFormatsForType(this.column.getDataType());\n        let itemId = '{0:__default}';\n        if (formats.filter(f => f.format == this.column.displayFormat).length > 0) {\n            itemId = this.column.displayFormat;\n        }\n        this.formatsMenu.showMenu({\n            anchor: ev.target,\n            selectedIds: itemId,\n            itemSelectedCallback: (data, items) => {\n                if (data.id != itemId) {\n                    if (data.id == '{0:__default}') {\n                        this.column.displayFormat = '';\n                    }\n                    else {\n                        this.column.displayFormat = data.id;\n                    }\n                    this.column.fireChangedEvent();\n                }\n                return false;\n            },\n            menuClosedCallback: () => {\n                this.keepShowingButtons = false;\n                if (!this.isMouseOverBlock) {\n                    this.element.dispatchEvent(createBrowserEvent('mouseleave'));\n                }\n            }\n        });\n    }\n    renderColumnTypeButton() {\n        // Only show type button in All mode\n        if (!this.isEditable() || this.bar.options.allowAggrColumns === false || this.bar.options.editMode !== ColumnsEditMode.Full) {\n            return null;\n        }\n        return domel('div')\n            .addClass(`${eqCssPrefix}-column-button`, `${eqCssPrefix}-column-button-type`)\n            .title(i18n.getText('ButtonToAggr'))\n            .attr('tabIndex', '0')\n            .on('touchstart click', (ev) => this.buttonTypeClickHandler(ev))\n            .on('keypress', evt => { if (evt.keyCode == 13) {\n            evt.target.click();\n        } })\n            .toDOM();\n    }\n    renderColumnFormatButton() {\n        if (!this.isEditable() || !this.formatButtonIsShown()) {\n            return null;\n        }\n        return domel('div')\n            .addClass(`${eqCssPrefix}-column-button`, `${eqCssPrefix}-column-button-format`)\n            .title(i18n.getText('ButtonFormat'))\n            .attr('tabIndex', '0')\n            .on('touchstart click', (ev) => this.buttonFormatClickHandler(ev))\n            .on('keypress', evt => { if (evt.keyCode == 13) {\n            evt.target.click();\n        } })\n            .toDOM();\n    }\n    getUIS() {\n        return this.bar\n            .getContext().getModel()\n            .checkAttrProperty(this.column.expr.value, \"useInSorting\");\n    }\n    onMouseClick(ev) {\n        this.bar.toggleColumnPicked(this.column);\n        this.adjustButtonsVisibility();\n    }\n    onMouseEnter(e) {\n        if (browserUtils.isMobileMode())\n            return;\n        this.isMouseOverBlock = true;\n        this.enterButtonBlock();\n        e.stopPropagation();\n        return false;\n    }\n    onMouseLeave(e) {\n        if (browserUtils.isMobileMode())\n            return;\n        this.isMouseOverBlock = false;\n        this.leaveButtonBlock();\n        e.stopPropagation();\n        return false;\n    }\n    isColumnActive() {\n        return this.element.classList.contains(\"active\");\n    }\n    hideButtons() {\n        if (browserUtils.isMobileMode()) {\n            if (this.onHideButtonsMobile) {\n                this.onHideButtonsMobile();\n            }\n        }\n        else {\n            domel(this.element).data(\"show-buttons\", null);\n        }\n    }\n    showButtons() {\n        if (browserUtils.isMobileMode()) {\n            if (this.onShowButtonsMobile) {\n                this.onShowButtonsMobile();\n            }\n        }\n        else {\n            domel(this.element).data(\"show-buttons\", \"\");\n        }\n    }\n    adjustButtonsVisibility() {\n        if (this.bar.options.alwaysShowButtons\n            || ((this.bar.options.accentActiveColumn || browserUtils.isMobileMode())\n                && this.isColumnActive())) {\n            this.showButtons();\n        }\n        else {\n            this.hideButtons();\n        }\n    }\n    enterButtonBlock() {\n        this.showButtons();\n    }\n    leaveButtonBlock() {\n        if (this.bar.options.alwaysShowButtons != true && (!this.isColumnActive() || this.bar.options.accentActiveColumn != true)) {\n            this.hideButtons();\n        }\n    }\n    createFunctionMenu() {\n        const items = [];\n        const funcs = this.bar.getContext().getModel().getAggrFunctions();\n        let funcAllowed = true;\n        let item = null;\n        const colDataType = this.column.getDataType();\n        let funcCaption;\n        for (const func of funcs) {\n            if (!func)\n                continue;\n            const toInclude = func.getAppliedTypesOrDefault().indexOf(colDataType) >= 0;\n            if (this.column.expr.func === func.id && !toInclude) {\n                funcAllowed = false;\n            }\n            if (toInclude) {\n                funcCaption = this.bar.getContext().getModel()\n                    .getAggrFunctionCaption(func.id);\n                item = {\n                    id: func.id,\n                    text: funcCaption\n                };\n                items.push(item);\n            }\n        }\n        if (!funcAllowed && items.length > 0) {\n            this.column.expr.func = items[0].id;\n        }\n        //Add \"Custom Expression\" menu\n        const columnsPanel = this.bar;\n        if (columnsPanel.areCustomExpressionsAllowed()) {\n            item = {\n                id: 'CustomSqlDivider',\n                text: '---'\n            };\n            items.push(item);\n            funcCaption = i18n.getText('CustomExpression');\n            item = {\n                id: 'CUSTOMSQL',\n                text: funcCaption\n            };\n            items.push(item);\n        }\n        let menuId = this.element.id;\n        if (menuId) {\n            menuId += '-FunctionsMenu';\n        }\n        const menuOptions = {\n            items: items,\n            id: menuId,\n            searchBoxAlwaysShown: false,\n            domWriteItemsId: true //this.panel.options.domWriteItemsId\n        };\n        this.functionMenu = new PopupMenu(menuOptions);\n    }\n    createFormatsMenu() {\n        if (this.bar.options.allowDisplayFormatChange == false)\n            return;\n        let menuId = this.column.id;\n        if (menuId) {\n            menuId += '-FormatsMenu';\n        }\n        const items = this.getFormatsMenuItems();\n        const menuOptions = {\n            items: items,\n            id: menuId,\n            searchBoxAlwaysShown: false,\n            showSelected: true,\n            domWriteItemsId: true //this.panel.options.domWriteItemsId\n        };\n        this.formatsMenu = new PopupMenu(menuOptions);\n    }\n    getFormatsMenuItems() {\n        const formats = this.bar.getContext().getModel()\n            .getDisplayFormatsForType(this.column.getDataType());\n        return [{ id: '{0:__default}', text: \"Default\" }]\n            .concat(formats.map(format => ({ id: format.format, text: i18n.getText(\"DisplayFormats\", format.name) || format.name })));\n    }\n}\n\nclass AttrColumnRendererCB extends ColumnRendererCB {\n    getClassesToAdd() {\n        return `${super.getClassesToAdd()} ${this.cssPrefix}-row ${this.cssPrefix}-row-column-entattr`;\n    }\n    baseExpressionItemSelectedCallback(data, item) {\n        const attrid = data.id;\n        const context = this.bar.getContext();\n        var attr = context.getModel().getAttributeById(attrid);\n        this.updateBaseAttr(attr);\n        this.column.caption = context.getDefaultColumnCaption(this.column);\n        this.fireColumnChanged();\n        return false;\n    }\n    updateBaseAttr(attr) {\n        this.column.expr.setValue(attr.id, true);\n        this.column.expr.baseAttrId = attr.id;\n        this.column.expr.dataType = attr.dataType;\n    }\n    getUIS() {\n        const arg = this.column.expr.args[0];\n        if (arg) {\n            const model = this.bar.getContext().getModel();\n            return model.checkAttrProperty(arg.value, \"useInSorting\");\n        }\n        else {\n            return true;\n        }\n    }\n    changeTypeToCustomSql() {\n        const query = this.column.getQuery();\n        query.changeColumnType(this.column, ExprTag.CustomSql);\n        this.fireColumnChanged();\n    }\n    changeTypeToAggr(funcId) {\n        const query = this.column.getQuery();\n        query.changeColumnType(this.column, ExprTag.AggregateFunction, { funcId: funcId });\n        this.fireColumnChanged();\n    }\n    changeColumnTypeHandler(ev) {\n        // Only allow type change in All mode\n        if (this.bar.options.editMode !== ColumnsEditMode.Full)\n            return;\n        this.functionMenu.showMenu({\n            anchor: ev.target,\n            selectedIds: null,\n            itemSelectedCallback: (data, items) => {\n                if (data.id == \"CUSTOMSQL\") {\n                    this.changeTypeToCustomSql();\n                }\n                else {\n                    this.changeTypeToAggr(data.id);\n                }\n                return false;\n            },\n            menuClosedCallback: () => {\n                this.keepShowingButtons = false;\n                if (!this.isMouseOverBlock) {\n                    this.element.dispatchEvent(createBrowserEvent('mouseleave'));\n                }\n            }\n        });\n    }\n}\n\nclass AggrFuncColumnRendererCB extends AttrColumnRendererCB {\n    getClassesToAdd() {\n        return `${super.getClassesToAdd()} ${this.cssPrefix}-row ${this.cssPrefix}-row-column-aggr`;\n    }\n    renderColumnTypeButton() {\n        const button = super.renderColumnTypeButton();\n        if (button) {\n            button.classList.add('aggregated');\n            button.title = i18n.getText('ButtonToSimple');\n        }\n        return button;\n    }\n    updateBaseAttr(attr) {\n        this.column.expr.args[0].setValue(attr.id, true);\n        this.column.expr.baseAttrId = attr.id;\n    }\n    changeTypeToSimple() {\n        const query = this.column.getQuery();\n        query.changeColumnType(this.column, ExprTag.EntityAttribute);\n        this.fireColumnChanged();\n    }\n    changeColumnTypeHandler(ev) {\n        // Only allow type change in All mode\n        if (this.bar.options.editMode !== ColumnsEditMode.Full)\n            return;\n        this.changeTypeToSimple();\n    }\n}\n\n/**\n * Base class for editable column renderers for the ColumnsBar widgets.\n * It provides common functionality for rendering editable columns,\n * including handling column type changes and rendering buttons.\n */\nclass EditableColumnRendererCB extends ColumnRendererCB {\n    getClassesToAdd() {\n        return `${this.cssPrefix}-row ${this.cssPrefix}-row-column-entattr` + super.getClassesToAdd();\n    }\n    renderColumnTypeButton() {\n        const button = super.renderColumnTypeButton();\n        if (button) {\n            button.classList.add('aggregated');\n            button.title = i18n$1.getText('ButtonToSimple');\n        }\n        return button;\n    }\n    changeTypeToSimple() {\n        const query = this.column.getQuery();\n        query.changeColumnType(this.column, ExprTag.EntityAttribute);\n        this.fireColumnChanged();\n    }\n    getColumnValue() {\n        return '';\n    }\n    setColumnValue(value) {\n    }\n    getUIS() {\n        return true;\n    }\n    changeColumnTypeHandler(ev) {\n        // Only allow type change in All mode\n        if (this.bar.options.editMode !== ColumnsEditMode.Full)\n            return;\n        this.changeTypeToSimple();\n    }\n}\nclass CustomSqlColumnRendererCB extends EditableColumnRendererCB {\n    get columnEnabled() {\n        return this.bar.areCustomExpressionsAllowed() ? this.column.enabled : false;\n    }\n    set columnEnabled(value) {\n        if (this.bar.areCustomExpressionsAllowed()) {\n            this.column.enabled = value;\n        }\n        else {\n            this.column.enabled = false;\n        }\n    }\n    getColumnValue() {\n        return this.column.expr.sql;\n    }\n    setColumnValue(value) {\n        this.column.expr.sql = value;\n    }\n    getDefaultValue() {\n        return this.column.expr.sql;\n    }\n}\nclass ConstColumnRendererCB extends EditableColumnRendererCB {\n    getColumnValue() {\n        return this.column.expr.value;\n    }\n    setColumnValue(value) {\n        this.column.expr.setValue(value);\n    }\n    getDefaultValue() {\n        return this.column.expr.value;\n    }\n}\n\nclass ColumnsBar extends Widget {\n    get cssPrefix() {\n        return \"eqjs-cb\";\n    }\n    constructor(slot, customQuery) {\n        super(slot);\n        this.options = {\n            isSubQuery: false,\n            activeColumn: null,\n            showAddRow: true,\n            showHeader: true,\n            showColumnTitles: true,\n            allowAggrColumns: true,\n            allowDuplicates: true,\n            allowCustomExpressions: false,\n            allowSorting: true,\n            alwaysShowButtons: false,\n            accentActiveColumn: true,\n            allowDragDrop: true,\n            menuOptions: {\n                showSearchBoxAfter: 30,\n                searchBoxAutoFocus: true,\n                activateOnMouseOver: true,\n                adjustHeight: true,\n                itemRenderedCallback: null\n            },\n            attrPlacement: 0,\n            sortEntities: false,\n            columnRenderedCallback: null,\n            customExpressionText: 0,\n            showAddAllForEntity: false,\n            editMode: ColumnsEditMode.Full\n        };\n        this.landingSlot = domel('div')\n            .addClass(`${eqCssPrefix}-highlight`)\n            .toDOM();\n        this.landingIndex = -1;\n        this.sortMenuList = [\n            { id: 'None', text: i18n.getText('CmdNotSorted') },\n            { id: 'Ascending', text: i18n.getText('CmdAscending') },\n            { id: 'Descending', text: i18n.getText('CmdDescending') },\n            { id: '---', text: '---' }\n        ];\n        this.moveMenuList = [\n            { id: 'MoveTop', text: i18n.getText('CmdMoveToFirst') },\n            { id: 'MoveUp', text: i18n.getText('CmdMoveToPrev') },\n            { id: 'MoveDown', text: i18n.getText('CmdMoveToNext') },\n            { id: 'MoveBottom', text: i18n.getText('CmdMoveToLast') }\n        ];\n        domel(this.slot)\n            .addClass(`${this.cssPrefix}-panel`)\n            .addClass(getMobileCssClass());\n        this.group = WidgetGroup.Query;\n        this.customQuery = customQuery;\n    }\n    getWidgetType() {\n        return 'columnsBar';\n    }\n    isDraggable() {\n        // Only allow drag-drop in All and FixedList modes\n        return this.options.allowDragDrop && this.options.editMode > ColumnsEditMode.ReadOnly;\n    }\n    /**\n     * Gets or sets the current edit mode. When setting, automatically refreshes the widget.\n     */\n    get editMode() {\n        return this.options.editMode || ColumnsEditMode.Full;\n    }\n    set editMode(value) {\n        if (this.options.editMode !== value) {\n            this.options.editMode = value;\n            this.refresh();\n        }\n    }\n    init(context, options) {\n        super.init(context, options);\n        this.setOptions(options);\n        if (options.attrElementFormat) {\n            this.context.options.attributeFormat = options.attrElementFormat;\n        }\n        if (options.titleElementFormat) {\n            this.context.options.columnTitleFormat = options.titleElementFormat;\n        }\n        this.detachQueryObserver();\n        this.attachQueryObserver();\n        eqDragManager.removeDropContainer(this.slot);\n        // Only allow drag-drop in All and FixedList modes\n        if (this.isDraggable()) {\n            eqDragManager.registerDropContainer({\n                element: this.slot,\n                scopes: [\"entityAttrSort\"],\n                onDragEnter: (container, ev) => {\n                    this.showLandingSlot(ev.pageX, ev.pageY);\n                },\n                onDragOver: (container, ev) => {\n                    this.showLandingSlot(ev.pageX, ev.pageY);\n                },\n                onDragLeave: (container, ev) => {\n                    ev.dropEffect = DropEffect.Forbid;\n                    this.hideLandingSlot();\n                },\n                onDrop: (container, ev) => {\n                    if (this.landingIndex >= 0) {\n                        const query = this.getQuery();\n                        const columns = query.getColumns();\n                        const index = columns.indexOf(ev.data.column);\n                        this.moveColumnCore(index, this.landingIndex);\n                    }\n                    else {\n                        ev.item.element.removeAttribute('style');\n                    }\n                }\n            });\n        }\n    }\n    attachQueryObserver() {\n        const query = this.getQuery();\n        this.queryEventCallbackId = query.addChangedCallback(event => {\n            //if something has changed, and that change is related to columns\n            const edata = event.data;\n            if (!edata || (edata.part != QueryChangePart.Columns\n                && edata.part != QueryChangePart.Aggregation\n                && edata.part != QueryChangePart.All)) {\n                return;\n            }\n            const focusedBefore = document.activeElement;\n            const isFocusInside = this.slot.contains(focusedBefore) || focusedBefore == document.body;\n            switch (edata.action) {\n                case QueryChangeAction.Modify: {\n                    const columns = edata.changee;\n                    const modifyColumn = (column) => {\n                        const colEl = this.columnsBlock.querySelector(`div[data-id='${column.id}']`);\n                        if (colEl) {\n                            const newEl = this.renderColumn(column, colEl);\n                            if (isFocusInside) {\n                                const focusElem = newEl.querySelector('a');\n                                if (focusElem) {\n                                    focusElem.focus();\n                                }\n                            }\n                        }\n                    };\n                    if (Array.isArray(columns)) {\n                        columns.forEach((col) => modifyColumn(col));\n                    }\n                    else {\n                        modifyColumn(columns);\n                    }\n                    break;\n                }\n                case QueryChangeAction.Add: {\n                    const columns = edata.changee;\n                    const addColumn = (column) => {\n                        const index = query.getColumns().indexOf(column);\n                        this.addColumnElement(column, index);\n                    };\n                    if (Array.isArray(columns)) {\n                        columns.forEach((col) => addColumn(col));\n                    }\n                    else {\n                        addColumn(columns);\n                    }\n                    break;\n                }\n                case QueryChangeAction.Delete: {\n                    const columns = edata.changee;\n                    const deleteColumn = (column) => {\n                        const colEl = this.columnsBlock.querySelector(`div[data-id='${column.id}']`);\n                        if (colEl) {\n                            const next = colEl.nextSibling;\n                            const prev = colEl.previousSibling;\n                            this.columnsBlock.removeChild(colEl);\n                            if (isFocusInside) {\n                                const focusCond = next || prev || this.addRowButton;\n                                const focusElem = focusCond.querySelector('a');\n                                if (focusElem) {\n                                    focusElem.focus();\n                                }\n                            }\n                        }\n                    };\n                    if (Array.isArray(columns)) {\n                        columns.forEach((col) => deleteColumn(col));\n                    }\n                    else {\n                        deleteColumn(columns);\n                    }\n                    break;\n                }\n                default:\n                    this.refresh();\n                    break;\n            }\n        });\n    }\n    getQuery() {\n        return this.customQuery\n            ? this.customQuery\n            : this.getContext().getQuery();\n    }\n    destroyCore() {\n        eqDragManager.removeDropContainer(this.slot);\n        this.detachQueryObserver();\n        this.slot.innerHTML = '';\n    }\n    detachQueryObserver() {\n        if (this.queryEventCallbackId) {\n            const query = this.getQuery();\n            query.removeChangedCallback(this.queryEventCallbackId);\n        }\n    }\n    setOptions(options) {\n        this.options = utils.assignDeep(this.options, options);\n        if (typeof options.allowCustomExpressions !== 'undefined') {\n            this.context.options.allowCustomExpressions = options.allowCustomExpressions;\n        }\n    }\n    showLandingSlot(pageX, pageY) {\n        const elements = this.columnsBlock.querySelectorAll(`[class*=${this.cssPrefix}-row]`);\n        const columnSlots = [];\n        for (let i = 0; i < elements.length; i++) {\n            if (elements[i].style.display !== 'none') {\n                columnSlots.push(elements[i]);\n            }\n        }\n        if (columnSlots.length === 0) {\n            this.landingIndex = 0;\n            return;\n        }\n        const landingPos = getElementAbsolutePos(this.landingSlot);\n        if (pageX >= landingPos.x && pageX <= landingPos.x + this.landingSlot.offsetWidth\n            && pageY >= landingPos.y && pageY <= landingPos.y + this.landingSlot.offsetHeight) {\n            return;\n        }\n        let newLandingIndex = this.landingIndex;\n        for (let i = 0; i < columnSlots.length; i++) {\n            const colSlot = columnSlots[i];\n            const absPos = getElementAbsolutePos(colSlot);\n            const colWidth = colSlot.offsetWidth;\n            const colHeight = colSlot.offsetHeight;\n            const paddingWidth = 0.2 * colWidth;\n            const paddingHeight = 2;\n            if (pageX >= absPos.x + paddingWidth && pageX <= absPos.x + colWidth - paddingWidth\n                && pageY >= absPos.y + paddingHeight && pageY <= absPos.y + colHeight - paddingHeight) {\n                if (pageX > landingPos.x)\n                    newLandingIndex = i + 1;\n                else\n                    newLandingIndex = i;\n                break;\n            }\n        }\n        if (newLandingIndex != this.landingIndex || this.landingSlot.parentElement) {\n            this.landingIndex = newLandingIndex;\n            if (this.landingIndex <= 0) {\n                this.columnsBlock.insertBefore(this.landingSlot, columnSlots[0]);\n            }\n            if (this.landingIndex < columnSlots.length) {\n                this.columnsBlock.insertBefore(this.landingSlot, columnSlots[this.landingIndex]);\n            }\n            else {\n                this.columnsBlock.appendChild(this.landingSlot);\n            }\n        }\n    }\n    hideLandingSlot() {\n        this.landingIndex = -1;\n        if (this.landingSlot.parentElement) {\n            this.landingSlot.parentElement.removeChild(this.landingSlot);\n        }\n    }\n    onProcessStartCore() {\n    }\n    onProcessEndCore() {\n    }\n    refreshCore() {\n        this.clear();\n        this.render();\n    }\n    clear() {\n        // if (this.addRowButton) {\n        //     this.addRowButton.innerHTML = \"\";\n        //     this.addRowButton.className = \"\";\n        // }\n        // this.columnsBlock.innerHTML = \"\";\n        this.slot.innerHTML = '';\n    }\n    renderAddRowButton() {\n        domel(this.addRowButton)\n            .addClass(`${eqCssPrefix}-addrow`, `${this.cssPrefix}-addrow`, `${eqCssPrefix}-addrow-empty`)\n            .addClass(getMobileCssClass())\n            .title(i18n.getText('CmdClickToAddColumn'))\n            .addChild('a', builder => builder\n            .attr('href', 'javascript:void(0)')\n            .on('click', (e) => {\n            e.preventDefault();\n            this.showEntitiesMenu({\n                anchor: e.target,\n                selectedIds: null,\n                itemSelectedCallback: (data, items) => {\n                    if (data.id === '__AddAll__' && data.extra && Array.isArray(data.extra.ids)) {\n                        data.extra.ids.forEach(attrId => this.addNewColumn(attrId));\n                    }\n                    else {\n                        const attrid = data.id;\n                        this.addNewColumn(attrid);\n                    }\n                    return false;\n                }\n            });\n        }));\n        if (browserUtils.isMobileMode()) {\n            domel(this.columnsBlock)\n                .addChildElement(this.addRowButton);\n        }\n    }\n    render() {\n        this.createEntitiesMenu();\n        if (this.options.allowSorting) {\n            this.createSortMenu();\n        }\n        this.createMoveMenu();\n        this.columnsBlock =\n            domel('div')\n                .addClass(`${this.cssPrefix}-columns`)\n                .addClass(getMobileCssClass())\n                .toDOM();\n        // Only show add row in All mode\n        if (this.options.showAddRow && this.options.editMode === ColumnsEditMode.Full) {\n            this.addRowButton =\n                domel('div')\n                    .toDOM();\n            if (browserUtils.isMobileMode()) {\n                domel(this.columnsBlock)\n                    .addChildElement(this.addRowButton);\n            }\n            else {\n                domel(this.slot)\n                    .addChildElement(this.addRowButton);\n            }\n            this.renderAddRowButton();\n        }\n        domel(this.slot)\n            .addChildElement(this.columnsBlock)\n            .addChildElement(this.renderColumnButtonsBlockMobile());\n        const query = this.getQuery();\n        const columns = query.getColumns();\n        columns.forEach((column, index) => {\n            const slot = this.renderColumn(column);\n            this.columnsBlock.appendChild(slot);\n        });\n    }\n    renderColumnButtonsBlockMobile() {\n        this.columnButtonsBlockMobileArrow = domel('i').toDOM();\n        this.columnButtonsBlockMobile = domel('div')\n            .addClass(`${this.cssPrefix}-column-buttonsBlock`)\n            .addClass(getMobileCssClass())\n            .addChildElement(this.columnButtonsBlockMobileArrow)\n            .hide()\n            .toDOM();\n        this.buttonsBlockSortingButton = domel('div', this.columnButtonsBlockMobile)\n            .addClass(`${this.cssPrefix}-column-button`, `${this.cssPrefix}-column-sortbutton-none`)\n            .toDOM();\n        domel(this.buttonsBlockSortingButton)\n            .on('touchstart click', (ev) => {\n            ev.stopPropagation();\n            this.currentColumnRenderer.buttonSortingClickHandler.call(this.currentColumnRenderer, ev, this.buttonsBlockSortingButton);\n            this.toggleColumnPicked(null);\n            this.hideColumnButtonsMobile();\n            return false;\n        });\n        this.buttonsBlockTypeButton = domel('div', this.columnButtonsBlockMobile)\n            .addClass(`${this.cssPrefix}-column-button`, `${this.cssPrefix}-column-button-type`)\n            .on('touchstart click', (ev) => {\n            ev.stopPropagation();\n            this.currentColumnRenderer.buttonTypeClickHandler.call(this.currentColumnRenderer, ev);\n            this.toggleColumnPicked(null);\n            this.hideColumnButtonsMobile();\n            return false;\n        })\n            .toDOM();\n        this.buttonsBlockFormatButton = domel('div', this.columnButtonsBlockMobile)\n            .addClass(`${this.cssPrefix}-column-button`, `${this.cssPrefix}-column-button-format`)\n            .on('touchstart click', (ev) => {\n            ev.stopPropagation();\n            this.currentColumnRenderer.buttonFormatClickHandler.call(this.currentColumnRenderer, ev);\n            this.toggleColumnPicked(null);\n            this.hideColumnButtonsMobile();\n            return false;\n        })\n            .toDOM();\n        if (this.options.editMode == ColumnsEditMode.Full) {\n            this.buttonsBlockDeleteButton = domel('div', this.columnButtonsBlockMobile)\n                .addClass(`${this.cssPrefix}-column-button`, `${this.cssPrefix}-column-button-delete`)\n                .on('touchstart click', (ev) => {\n                ev.stopPropagation();\n                this.currentColumnRenderer.buttonDeleteClickHandler.call(this.currentColumnRenderer, ev);\n                this.toggleColumnPicked(null);\n                this.hideColumnButtonsMobile();\n                return false;\n            })\n                .toDOM();\n        }\n        domel('div', this.columnButtonsBlockMobile)\n            .addClass(`${this.cssPrefix}-column-button-close-block`)\n            .on('touchstart click', () => {\n            this.toggleColumnPicked(null);\n            this.hideColumnButtonsMobile();\n        });\n        return this.columnButtonsBlockMobile;\n    }\n    showColumnButtonsMobile(column, columnRenderer, columnElement) {\n        this.currentActiveColumn = column;\n        this.currentColumnRenderer = columnRenderer;\n        //calculate coordinates\n        const rect = columnElement.getBoundingClientRect();\n        const top = columnElement.offsetTop;\n        const left = columnElement.offsetLeft;\n        domel(this.columnButtonsBlockMobileArrow)\n            .setStyle('left', (left + rect.width / 2).toString() + 'px');\n        if (rect.top > 100) {\n            domel(this.columnButtonsBlockMobile)\n                .removeClass('show-below')\n                .setStyle('top', (top - rect.height).toString() + 'px');\n        }\n        else {\n            domel(this.columnButtonsBlockMobile)\n                .addClass('show-below')\n                .setStyle('top', (top + rect.height).toString() + 'px');\n        }\n        //show/hide separate buttons\n        if (column.enabled && !column.isReadOnly() && this.options.editMode > ColumnsEditMode.ReadOnly) {\n            domel(this.buttonsBlockSortingButton).show();\n            domel(this.buttonsBlockTypeButton).show();\n            if (columnRenderer.formatButtonIsShown()) {\n                domel(this.buttonsBlockFormatButton).show();\n            }\n            else {\n                domel(this.buttonsBlockFormatButton).hide();\n            }\n        }\n        else {\n            domel(this.buttonsBlockSortingButton).hide();\n            domel(this.buttonsBlockTypeButton).hide();\n        }\n        //show\n        if (column.isReadOnly() || this.options.editMode == ColumnsEditMode.ReadOnly) {\n            domel(this.columnButtonsBlockMobile).hide();\n        }\n        else {\n            domel(this.columnButtonsBlockMobile).show();\n        }\n    }\n    hideColumnButtonsMobile() {\n        domel(this.columnButtonsBlockMobile).hide();\n    }\n    renderColumn(column, elem) {\n        const renderer = this.getColumnRenderer(column, elem);\n        if (renderer) {\n            const columnSlot = renderer.render();\n            renderer.onShowButtonsMobile = () => {\n                this.showColumnButtonsMobile(column, renderer, columnSlot);\n            };\n            renderer.onHideButtonsMobile = () => {\n                this.hideColumnButtonsMobile();\n            };\n            return columnSlot;\n        }\n        return null;\n    }\n    getColumnRenderer(column, slot) {\n        switch (column.expr.tag) {\n            case ExprTag.Constant:\n                return new ConstColumnRendererCB(this, column, slot);\n            case ExprTag.AggregateFunction:\n                return new AggrFuncColumnRendererCB(this, column, slot);\n            case ExprTag.CustomSql:\n                return new CustomSqlColumnRendererCB(this, column, slot);\n            default:\n                return new AttrColumnRendererCB(this, column, slot);\n        }\n    }\n    addNewColumn(attrs, index) {\n        this.getContext().getModel();\n        const query = this.getQuery();\n        if (Array.isArray(attrs)) {\n            let col = null;\n            let cols = [];\n            for (let i = 0; i < attrs.length; i++) {\n                col = query.addColumn({\n                    attributeId: attrs[i],\n                    index: index\n                }, true);\n                if (col) {\n                    cols.push(col);\n                }\n            }\n            return cols;\n        }\n        else {\n            const col = query.addColumn({\n                attributeId: attrs,\n                index: index\n            });\n            return col;\n        }\n    }\n    toggleColumnPicked(column) {\n        let el;\n        let isActive;\n        if (column) {\n            el = this.columnsBlock.querySelector(`div[data-id=${column.id}]`);\n            if (el) {\n                isActive = el.classList.contains('active');\n            }\n        }\n        //clear 'active' in all rows\n        const rows = this.columnsBlock.querySelectorAll(`.${this.cssPrefix}-row`);\n        for (let i = 0; i < rows.length; i++) {\n            const row = rows[i];\n            domel(row)\n                .removeClass('active')\n                .data(\"show-buttons\", null);\n        }\n        if (el && !isActive) {\n            domel(el)\n                .addClass('active')\n                .data(\"show-buttons\", \"\");\n        }\n    }\n    //adds one column to the bar on the specified position\n    addColumnElement(column, index) {\n        const rows = this.columnsBlock.querySelectorAll(`[class*=${this.cssPrefix}-row]`);\n        const newColBlock = this.renderColumn(column);\n        if (rows.length > 0) {\n            if (index < rows.length - 1) {\n                this.columnsBlock.insertBefore(newColBlock, rows[index]);\n            }\n            else {\n                this.columnsBlock.appendChild(newColBlock);\n            }\n        }\n        else {\n            this.columnsBlock.appendChild(newColBlock);\n        }\n        if (this.options.columnRenderedCallback) {\n            this.options.columnRenderedCallback(newColBlock);\n        }\n    }\n    checkColumnsArray(cols) {\n        let len = cols.length;\n        const result = [];\n        for (let i = 0; i < len; i++) {\n            if (this.checkColumn(cols[i]))\n                result.push(cols[i]);\n        }\n        return result;\n    }\n    checkColumn(col) {\n        if (!this.options.allowDuplicates) {\n            const query = this.getQuery();\n            const columns = query.getColumns();\n            const colJson = JSON.stringify(col.expr);\n            for (let i = 0; i < columns.length; i++) {\n                const qcolJson = JSON.stringify(columns[i].expr);\n                if (qcolJson === colJson) {\n                    return null;\n                }\n            }\n        }\n        return col;\n    }\n    getColumnsBlock() {\n        return this.columnsBlock;\n    }\n    showEntitiesMenu(menuOptions) {\n        this.entitiesMenu && this.entitiesMenu.showMenu(menuOptions);\n    }\n    addAllColumnsToEntitiesList(list) {\n        const attrIds = list.filter(item => !item.isEntity).map(item => item.id);\n        if (attrIds.length > 0) {\n            list.unshift({\n                id: '__AddAll__',\n                text: i18n.getText('AddAllForEntityText'),\n                extra: {\n                    ids: attrIds\n                }\n            });\n        }\n        list.forEach(item => {\n            if (item.items) {\n                this.addAllColumnsToEntitiesList(item.items);\n            }\n        });\n    }\n    createEntitiesMenu() {\n        const model = this.getContext().getModel();\n        if (!model || model.isEmpty())\n            return null;\n        let menuId = this.slot.id;\n        if (menuId) {\n            menuId += '-EntitiesMenu';\n        }\n        const entitiesList = model.getEntitiesTree({ addUIC: false, addUIR: true, addUIS: false, attrPlacement: this.options.attrPlacement, sortEntities: this.options.sortEntities });\n        // add [Add all columns] items\n        if (this.options.showAddAllForEntity) {\n            this.addAllColumnsToEntitiesList(entitiesList);\n        }\n        const options = { items: entitiesList, adjustHeight: this.options.adjustEntitiesMenuHeight, id: menuId, domWriteItemsId: this.options.domWriteItemsId };\n        utils.assign(options, this.options.menuOptions);\n        this.entitiesMenu = new PopupMenu(options);\n    }\n    createSortMenu() {\n        const model = this.getContext().getModel();\n        if (!model || model.isEmpty())\n            return null;\n        let menuId = this.slot.id;\n        if (menuId) {\n            menuId += '-SortMenu';\n        }\n        const items = this.sortMenuList.concat(this.moveMenuList);\n        const menuOptions = { \"items\": items, id: menuId, domWriteItemsId: this.options.domWriteItemsId };\n        utils.assign(menuOptions, this.options.menuOptions);\n        menuOptions.searchBoxAlwaysShown = false;\n        this.sortMenu = new PopupMenu(menuOptions);\n    }\n    createMoveMenu() {\n        const model = this.getContext().getModel();\n        if (!model || model.isEmpty())\n            return null;\n        let menuId = this.slot.id;\n        if (menuId) {\n            menuId += '-MoveMenu';\n        }\n        const items = this.moveMenuList;\n        const menuOptions = { \"items\": items, id: menuId, domWriteItemsId: this.options.domWriteItemsId };\n        utils.assign(menuOptions, this.options.menuOptions);\n        this.moveMenu = new PopupMenu(menuOptions);\n        menuOptions.searchBoxAlwaysShown = false;\n    }\n    moveColumn(column, direction) {\n        const query = this.getQuery();\n        const columns = query.getColumns();\n        const index = columns.indexOf(column);\n        if (index >= 0) {\n            switch (direction) {\n                case 'MoveTop':\n                    if (index == 0) {\n                        return;\n                    }\n                    this.moveColumnCore(index, 0);\n                    break;\n                case 'MoveUp':\n                    if (index == 0) {\n                        return;\n                    }\n                    this.moveColumnCore(index, index - 1);\n                    break;\n                case 'MoveDown':\n                    if (index == columns.length - 1) {\n                        return;\n                    }\n                    this.moveColumnCore(index, index + 1);\n                    break;\n                case 'MoveBottom':\n                    if (index == columns.length - 1) {\n                        return;\n                    }\n                    this.moveColumnCore(index, columns.length - 1);\n                    break;\n            }\n        }\n    }\n    moveColumnCore(index1, index2) {\n        const query = this.getQuery();\n        if (!query)\n            return;\n        const rows = this.columnsBlock.querySelectorAll(`[class*=${this.cssPrefix}-row]`);\n        const colToMove = rows[index1];\n        if (index2 <= 0) {\n            this.columnsBlock.insertBefore(colToMove, this.columnsBlock[0]);\n        }\n        else if (index2 < rows.length) {\n            this.columnsBlock.insertBefore(colToMove, rows[index2]);\n        }\n        else {\n            this.columnsBlock.appendChild(colToMove);\n        }\n        query.moveColumn(index1, index2);\n        query.fireColumnsChangedEvent(QueryChangeAction.All);\n    }\n    areCustomExpressionsAllowed() {\n        const query = this.getQuery();\n        return query.isEx() && this.getContext().options.allowCustomExpressions;\n    }\n}\nColumnsBar.globalCounter = 0;\n\nclass ColumnRendererSB {\n    constructor(bar, column, slot) {\n        this.functionMenu = null;\n        this.isMouseOverBlock = false;\n        this.keepShowingButtons = false;\n        this.bar = bar;\n        this.column = column;\n        this.element = slot;\n    }\n    get cssPrefix() {\n        return 'eqjs-sb';\n    }\n    render() {\n        const builder = domel('div');\n        builder.data('id', this.column.id);\n        if (this.element) {\n            //to remove all event listeners\n            this.element.parentNode\n                .replaceChild(builder.toDOM(), this.element);\n        }\n        this.element = builder.toDOM();\n        if (this.bar.options.allowDragDrop) {\n            eqDragManager.registerDraggableItem({\n                element: this.element,\n                scope: \"entityAttrSortSB\",\n                beforeDragStart: () => this.element.dispatchEvent(createBrowserEvent('mouseleave')),\n                onDragStart: (ev) => {\n                    this.element.style.display = 'none';\n                    ev.dropEffect = DropEffect.Allow;\n                },\n                onDragEnd: (ev) => {\n                    this.element.removeAttribute('style');\n                },\n                data: { column: this.column }\n            });\n        }\n        builder\n            .addClass(this.getClassesToAdd())\n            .addClass(getMobileCssClass())\n            .addChildElement(this.renderCaptionBlock());\n        if (this.isEditable()) {\n            builder\n                .addChildElement(this.renderSortingButton());\n        }\n        return this.element;\n    }\n    fireColumnChanged() {\n        this.column.fireChangedEvent();\n    }\n    refresh() {\n        this.render();\n    }\n    getAttribute() {\n        const model = this.bar.getContext().getModel();\n        return model.getAttributeById(this.column.expr.value);\n    }\n    isEditable() {\n        return this.column.enabled && !this.column.isReadOnly();\n    }\n    renderCaptionBlock() {\n        function getArrow(sd) {\n            switch (sd) {\n                case SortDirection.Ascending:\n                    return ' ';\n                case SortDirection.Descending:\n                    return ' ';\n                default:\n                    return '';\n            }\n        }\n        let text = this.column.caption;\n        if (!this.isEditable()) {\n            text += getArrow(this.column.sorting);\n        }\n        return domel('div')\n            .addClass(`${this.cssPrefix}-colelement`, `${this.cssPrefix}-captionelement`)\n            .addClass(getMobileCssClass())\n            .addChild('div', b => b\n            .title(this.column.caption)\n            .text(text))\n            .toDOM();\n    }\n    renderSortingButton() {\n        const sortButtonCssClass = `${eqCssPrefix}-column-sortbutton`;\n        let sortButtonDirectionCssClass = sortButtonCssClass;\n        switch (this.column.sorting) {\n            case SortDirection.None:\n                sortButtonDirectionCssClass = `${sortButtonCssClass}-none`;\n                break;\n            case SortDirection.Ascending:\n                sortButtonDirectionCssClass = `${sortButtonCssClass}-asc`;\n                break;\n            case SortDirection.Descending:\n                sortButtonDirectionCssClass = `${sortButtonCssClass}-desc`;\n                break;\n        }\n        const builder = domel('div')\n            .addClass(`${this.cssPrefix}-colelement`, `${this.cssPrefix}-sortimage-placeholder`)\n            .addClass(getMobileCssClass())\n            .addChild('div', builder => builder\n            .addClass(`${this.cssPrefix}-img-sorting`, sortButtonDirectionCssClass)\n            .title(i18n.getText('ButtonSorting')))\n            .on('touchstart click', (ev) => this.buttonSortingClickHandler(ev, builder.toDOM()));\n        return builder.toDOM();\n    }\n    buttonSortingClickHandler(ev, anchor) {\n        ev.stopPropagation();\n        this.keepShowingButtons = true;\n        const menu = this.bar.sortMenu;\n        menu.showMenu({\n            anchor: anchor,\n            selectedIds: null,\n            itemSelectedCallback: (data, items) => {\n                const strToSortDirection = (str) => {\n                    if (str == 'None') {\n                        return SortDirection.None;\n                    }\n                    else if (str == \"Ascending\") {\n                        return SortDirection.Ascending;\n                    }\n                    else if (str == \"Descending\") {\n                        return SortDirection.Descending;\n                    }\n                };\n                if (data.id == 'None' || data.id == \"Ascending\" || data.id == \"Descending\") {\n                    const query = this.bar.getContext().getQuery();\n                    if (this.column.isJustSorted() && data.id == 'None') {\n                        query.removeColumn(this.column);\n                        query.fireColumnsChangedEvent(QueryChangeAction.Delete, this.column, true);\n                    }\n                    else {\n                        this.column.sorting = strToSortDirection(data.id);\n                        this.column._sortIndex = query.getColumnSortIndex(this.column);\n                        this.fireColumnChanged();\n                    }\n                }\n                else {\n                    this.bar.moveColumn(this.column, data.id);\n                }\n            },\n            menuClosedCallback: () => {\n                this.keepShowingButtons = false;\n            }\n        });\n        return false;\n    }\n    getClassesToAdd() {\n        return `${this.cssPrefix}-row ${this.cssPrefix}-row-column-entattr`;\n    }\n    getUIS() {\n        return this.bar\n            .getContext().getModel()\n            .checkAttrProperty(this.column.expr.value, \"useInSorting\");\n    }\n}\n\nclass SortingBar extends Widget {\n    get cssPrefix() {\n        return \"eqjs-sb\";\n    }\n    constructor(slot) {\n        super(slot);\n        this.options = {\n            showAddRow: true,\n            allowDragDrop: true,\n            menuOptions: {\n                showSearchBoxAfter: 30,\n                searchBoxAutoFocus: true,\n                activateOnMouseOver: true,\n                adjustHeight: true,\n                itemRenderedCallback: null\n            },\n        };\n        this.sortMenuList = [\n            { id: 'None', text: i18n.getText('CmdNotSorted') },\n            { id: 'Ascending', text: i18n.getText('CmdAscending') },\n            { id: 'Descending', text: i18n.getText('CmdDescending') },\n            { id: '---', text: '---' },\n            { id: 'MoveTop', text: i18n.getText('CmdMoveToFirst') },\n            { id: 'MoveUp', text: i18n.getText('CmdMoveToPrev') },\n            { id: 'MoveDown', text: i18n.getText('CmdMoveToNext') },\n            { id: 'MoveBottom', text: i18n.getText('CmdMoveToLast') }\n        ];\n        this.landingSlot = domel('div')\n            .addClass(`${eqCssPrefix}-highlight`)\n            .toDOM();\n        this.landingIndex = -1;\n        domel(this.slot)\n            .addClass(`${this.cssPrefix}-panel`)\n            .addClass(getMobileCssClass());\n        this.group = WidgetGroup.Query;\n    }\n    getWidgetType() {\n        return 'sortingBar';\n    }\n    init(context, options) {\n        super.init(context, options);\n        this.setOptions(options);\n        if (options.attrElementFormat) {\n            this.context.options.attributeFormat = options.attrElementFormat;\n        }\n        if (options.titleElementFormat) {\n            this.context.options.columnTitleFormat = options.titleElementFormat;\n        }\n        this.destroyCore();\n        this.attachQueryObserver();\n        eqDragManager.removeDropContainer(this.slot);\n        if (this.options.allowDragDrop) {\n            eqDragManager.registerDropContainer({\n                element: this.slot,\n                scopes: [\"entityAttrSortSB\"],\n                onDragEnter: (container, ev) => {\n                    this.showLandingSlot(ev.pageX, ev.pageY);\n                },\n                onDragOver: (container, ev) => {\n                    this.showLandingSlot(ev.pageX, ev.pageY);\n                },\n                onDragLeave: (container, ev) => {\n                    ev.dropEffect = DropEffect.Forbid;\n                    this.hideLandingSlot();\n                },\n                onDrop: (container, ev) => {\n                    if (this.landingIndex >= 0) {\n                        const query = this.getQuery();\n                        query.setColumnSortIndex(ev.data.column, this.landingIndex);\n                        query.fireColumnsChangedEvent(QueryChangeAction.All);\n                    }\n                    else {\n                        ev.item.element.removeAttribute('style');\n                    }\n                }\n            });\n        }\n    }\n    setOptions(options) {\n        utils.assignDeep(this.options, options);\n    }\n    attachQueryObserver() {\n        const query = this.getQuery();\n        this.queryEventCallbackId = query.addChangedCallback(event => {\n            //if something has changed, and that change is related to columns\n            const edata = event.data;\n            if (!edata || (edata.part != QueryChangePart.SortingColumns\n                && edata.part != QueryChangePart.Columns && edata.part != QueryChangePart.All)) {\n                return;\n            }\n            this.refresh();\n        });\n    }\n    detachQueryObserver() {\n        if (this.queryEventCallbackId) {\n            const query = this.getQuery();\n            query.removeChangedCallback(this.queryEventCallbackId);\n        }\n    }\n    getQuery() {\n        return this.getContext().getQuery();\n    }\n    getModel() {\n        return this.getContext().getModel();\n    }\n    destroyCore() {\n        this.detachQueryObserver();\n        this.clear();\n    }\n    refreshCore() {\n        this.clear();\n        this.render();\n    }\n    renderAddRowButton() {\n        domel(this.addRowButton)\n            .addClass(`${eqCssPrefix}-addrow`, `${this.cssPrefix}-addrow`, `${eqCssPrefix}-addrow-empty`)\n            .addClass(getMobileCssClass())\n            .title(i18n.getText('CmdClickToAddColumn'))\n            .addChild('a', builder => builder\n            .attr('href', 'javascript:void(0)')\n            .on('click', (e) => {\n            e.preventDefault();\n            this.showEntitiesMenu({\n                anchor: e.target,\n                selectedIds: null,\n                itemSelectedCallback: (data, items) => {\n                    const attrid = data.id;\n                    this.addNewColumn(attrid);\n                    return false;\n                }\n            });\n        }));\n        if (browserUtils.isMobileMode()) {\n            domel(this.columnsBlock)\n                .addChildElement(this.addRowButton);\n        }\n    }\n    showEntitiesMenu(menuOptions) {\n        this.entitiesMenu.showMenu(menuOptions);\n    }\n    createEntitiesMenu() {\n        const model = this.getModel();\n        if (!model || model.isEmpty())\n            return null;\n        let menuId = this.slot.id;\n        if (menuId) {\n            menuId += '-EntitiesMenu';\n        }\n        const entitiesList = model.getEntitiesTree({ addUIC: false, addUIR: false, addUIS: true });\n        const options = { items: entitiesList,\n            adjustHeight: this.options.adjustEntitiesMenuHeight, id: menuId, domWriteItemsId: this.options.domWriteItemsId };\n        this.entitiesMenu = new PopupMenu(options);\n    }\n    createSortMenu() {\n        const model = this.getModel();\n        if (!model || model.isEmpty())\n            return null;\n        let menuId = this.slot.id;\n        if (menuId) {\n            menuId += '-SortMenu';\n        }\n        const items = this.sortMenuList;\n        const menuOptions = { \"items\": items, id: menuId };\n        menuOptions.searchBoxAlwaysShown = false;\n        this.sortMenu = new PopupMenu(menuOptions);\n    }\n    render() {\n        this.createEntitiesMenu();\n        this.createSortMenu();\n        this.columnsBlock =\n            domel('div')\n                .addClass(`${this.cssPrefix}-columns`)\n                .addClass(getMobileCssClass())\n                .toDOM();\n        if (this.options.showAddRow) {\n            this.addRowButton =\n                domel('div')\n                    .toDOM();\n            if (browserUtils.isMobileMode()) {\n                domel(this.columnsBlock)\n                    .addChildElement(this.addRowButton);\n            }\n            else {\n                domel(this.slot)\n                    .addChildElement(this.addRowButton);\n            }\n            this.renderAddRowButton();\n        }\n        domel(this.slot)\n            .addChildElement(this.columnsBlock);\n        const query = this.getQuery();\n        const columns = query.getSortedColumns(); // .getColumns().concat(query.getJustSortedColumns());\n        columns.forEach((column, index) => {\n            const slot = this.renderColumn(column);\n            this.columnsBlock.appendChild(slot);\n        });\n    }\n    addNewColumn(attrId) {\n        this.getModel();\n        const query = this.getQuery();\n        const col = query.addColumn({\n            attributeId: attrId,\n            justsorted: true,\n            sorting: SortDirection.Ascending\n        }, true);\n        query.fireChangedEvent({\n            part: QueryChangePart.SortingColumns,\n            action: QueryChangeAction.Add,\n            changee: col,\n            source: this\n        });\n        return col;\n    }\n    renderColumn(column, elem) {\n        const renderer = new ColumnRendererSB(this, column, elem);\n        if (renderer) {\n            const columnSlot = renderer.render();\n            return columnSlot;\n        }\n        return null;\n    }\n    clear() {\n        this.slot.innerHTML = '';\n    }\n    moveColumn(column, direction) {\n        const query = this.getQuery();\n        const columns = query.getSortedColumns();\n        const index = query.getColumnSortIndex(column);\n        if (index >= 0) {\n            switch (direction) {\n                case 'MoveTop':\n                    query.setColumnSortIndex(column, 0);\n                    query.fireChangedEvent({\n                        part: QueryChangePart.SortingColumns,\n                        action: QueryChangeAction.Modify,\n                        source: this\n                    });\n                    break;\n                case 'MoveUp':\n                    query.setColumnSortIndex(column, index > 0 ? index - 1 : 0);\n                    query.fireChangedEvent({\n                        part: QueryChangePart.SortingColumns,\n                        action: QueryChangeAction.Modify,\n                        source: this\n                    });\n                    break;\n                case 'MoveDown':\n                    query.setColumnSortIndex(column, index < columns.length - 1 ? index + 1 : columns.length - 1);\n                    query.fireChangedEvent({\n                        part: QueryChangePart.SortingColumns,\n                        action: QueryChangeAction.Modify,\n                        source: this\n                    });\n                    break;\n                case 'MoveBottom':\n                    query.setColumnSortIndex(column, columns.length - 1);\n                    query.fireChangedEvent({\n                        part: QueryChangePart.SortingColumns,\n                        action: QueryChangeAction.Modify,\n                        source: this\n                    });\n                    break;\n            }\n        }\n    }\n    showLandingSlot(pageX, pageY) {\n        const elements = this.columnsBlock.querySelectorAll(`[class*=${this.cssPrefix}-row]`);\n        const columnSlots = [];\n        for (let i = 0; i < elements.length; i++) {\n            if (elements[i].style.display !== 'none') {\n                columnSlots.push(elements[i]);\n            }\n        }\n        if (columnSlots.length === 0) {\n            this.landingIndex = 0;\n            return;\n        }\n        const landingPos = getElementAbsolutePos(this.landingSlot);\n        if (pageX >= landingPos.x && pageX <= landingPos.x + this.landingSlot.offsetWidth\n            && pageY >= landingPos.y && pageY <= landingPos.y + this.landingSlot.offsetHeight) {\n            return;\n        }\n        let newLandingIndex = this.landingIndex;\n        for (let i = 0; i < columnSlots.length; i++) {\n            const colSlot = columnSlots[i];\n            const absPos = getElementAbsolutePos(colSlot);\n            const colWidth = colSlot.offsetWidth;\n            const colHeight = colSlot.offsetHeight;\n            const paddingWidth = 0.2 * colWidth;\n            const paddingHeight = 2;\n            if (pageX >= absPos.x + paddingWidth && pageX <= absPos.x + colWidth - paddingWidth\n                && pageY >= absPos.y + paddingHeight && pageY <= absPos.y + colHeight - paddingHeight) {\n                if (pageX > landingPos.x)\n                    newLandingIndex = i + 1;\n                else\n                    newLandingIndex = i;\n                break;\n            }\n        }\n        if (newLandingIndex != this.landingIndex || this.landingSlot.parentElement) {\n            this.landingIndex = newLandingIndex;\n            if (this.landingIndex <= 0) {\n                this.columnsBlock.insertBefore(this.landingSlot, columnSlots[0]);\n            }\n            if (this.landingIndex < columnSlots.length) {\n                this.columnsBlock.insertBefore(this.landingSlot, columnSlots[this.landingIndex]);\n            }\n            else {\n                this.columnsBlock.appendChild(this.landingSlot);\n            }\n        }\n    }\n    hideLandingSlot() {\n        this.landingIndex = -1;\n        if (this.landingSlot.parentElement) {\n            this.landingSlot.parentElement.removeChild(this.landingSlot);\n        }\n    }\n}\n\n/**\n * Represents parts of Query Panel which can be editable\n */\nvar QPEditablePart;\n(function (QPEditablePart) {\n    QPEditablePart[QPEditablePart[\"None\"] = 0] = \"None\";\n    QPEditablePart[QPEditablePart[\"Value\"] = 1] = \"Value\";\n    QPEditablePart[QPEditablePart[\"Operator\"] = 2] = \"Operator\";\n    QPEditablePart[QPEditablePart[\"Attribute\"] = 4] = \"Attribute\";\n    QPEditablePart[QPEditablePart[\"Addition\"] = 8] = \"Addition\";\n    QPEditablePart[QPEditablePart[\"Removal\"] = 16] = \"Removal\";\n    QPEditablePart[QPEditablePart[\"All\"] = 255] = \"All\";\n    QPEditablePart[QPEditablePart[\"NoAddition\"] = -9] = \"NoAddition\";\n    QPEditablePart[QPEditablePart[\"NoRemoval\"] = -17] = \"NoRemoval\";\n    QPEditablePart[QPEditablePart[\"FixedConditionList\"] = 3] = \"FixedConditionList\";\n})(QPEditablePart || (QPEditablePart = {}));\n\nclass TextRenderer {\n    get cssPrefix() {\n        return 'eqjs-qp';\n    }\n    constructor(panel, text, slot) {\n        this.panel = panel;\n        this.text = text;\n        this.element = slot || domel('div').toDOM();\n    }\n    refresh() {\n        this.render();\n    }\n    render() {\n        domel(this.element)\n            .html('')\n            .addClass(this.getClassesToAdd())\n            .addClass(getMobileCssClass())\n            .addChild('span', builder => builder\n            .text(this.text)\n            .title(this.text))\n            .toDOM();\n        return this.element;\n    }\n    getClassesToAdd() {\n        return `${this.cssPrefix}-condelement`;\n    }\n}\n\nvar ConditionAction;\n(function (ConditionAction) {\n    ConditionAction[ConditionAction[\"AddCondition\"] = 0] = \"AddCondition\";\n    ConditionAction[ConditionAction[\"AddGroup\"] = 1] = \"AddGroup\";\n    ConditionAction[ConditionAction[\"Enable\"] = 2] = \"Enable\";\n    ConditionAction[ConditionAction[\"Delete\"] = 4] = \"Delete\";\n    ConditionAction[ConditionAction[\"Menu\"] = 5] = \"Menu\";\n    ConditionAction[ConditionAction[\"Parameterized\"] = 6] = \"Parameterized\";\n    ConditionAction[ConditionAction[\"InJoin\"] = 7] = \"InJoin\";\n})(ConditionAction || (ConditionAction = {}));\nclass ConditionRenderer {\n    constructor(panel, condition, slot) {\n        this.panel = panel;\n        this.condition = condition;\n        this.element = slot || domel('div').toDOM();\n    }\n    get cssPrefix() {\n        return 'eqjs-qp';\n    }\n    refresh() {\n        this.render();\n    }\n    clear() {\n        if (this.element) {\n            this.element.className = '';\n            this.element.removeAttribute('data-id');\n            this.element.removeAttribute('style');\n            domel(this.element)\n                .html('');\n        }\n    }\n    render(autoAppear) {\n        this.clear();\n        //this.preRender();\n        this.coreRender(autoAppear);\n        if (this.panel.options.onConditionRendered) {\n            this.panel.options.onConditionRendered(this.condition, this.element);\n        }\n        return this.element;\n    }\n    isEditable() {\n        return this.condition.enabled && !this.condition.isReadOnly()\n            && !(this.condition.isGroup() && this.panel.isFixed());\n    }\n}\nclass SimpleConditionRenderer extends ConditionRenderer {\n    getClassesToAdd() {\n        let result = `${this.cssPrefix}-row ${this.cssPrefix}-row-condition`;\n        result += this.condition.isInJoin() ? ` ${this.cssPrefix}-condition-injoin` : '';\n        result += this.condition.isParameterized() ? ` ${this.cssPrefix}-condition-parameterized` : '';\n        if (!browserUtils.isMobileMode()) {\n            const level = this.condition.getLevel();\n            if (level > 0)\n                result += ` ${this.cssPrefix}-level-${level}`;\n        }\n        result += this.condition.enabled ? '' : ` ${this.cssPrefix}-disabled`;\n        if (this.condition.enabled) {\n            result += this.condition.isReadOnly() ? ` ${this.cssPrefix}-readonly` : '';\n        }\n        return result;\n    }\n    coreRender(autoAppear) {\n        const model = this.panel.getContext().getModel();\n        const operator = model.getOperatorById(this.condition.getOperatorId());\n        const arrFormat = equtils.parseOperatorFormat(operator);\n        let item = null;\n        const arrLength = arrFormat.length;\n        const builder = domel('div');\n        if (this.element && this.element.parentNode) {\n            this.element.parentNode\n                .replaceChild(builder.toDOM(), this.element);\n        }\n        this.element = builder.toDOM();\n        builder\n            .addClass(this.getClassesToAdd())\n            .addClass(getMobileCssClass())\n            .data('id', this.condition.id)\n            .data('condrow', '')\n            .addChildElement(this.renderCheckbox())\n            .addChildElement(this.renderConjunction());\n        let mayAppear = autoAppear;\n        const minLength = operator == model.nullOperator\n            ? Math.min(arrLength, this.condition.expressions.length + 1)\n            : arrLength;\n        for (let idx = 0; idx < minLength; idx++) {\n            item = arrFormat[idx];\n            if (item.type === 'operator') {\n                const renderer = this.panel.getOperatorRenderer(this.condition, item.text);\n                if (renderer) {\n                    builder.addChildElement(renderer.render());\n                }\n            }\n            else if (item.type === 'expression') {\n                const toAppear = mayAppear && (item.index > 0);\n                const exprRenderer = this.panel.getExpressionRenderer(this.condition.expressions[item.index]);\n                if (exprRenderer) {\n                    const el = exprRenderer.render(toAppear);\n                    builder.addChildElement(el);\n                    setTimeout(() => {\n                        exprRenderer.adjustWidth();\n                    }, 100);\n                }\n                mayAppear = mayAppear && !toAppear;\n            }\n            else if (item.type === 'text') {\n                builder.addChildElement(new TextRenderer(this.panel, item.text).render());\n            }\n        }\n        if (this.panel.options.accentActiveCondition || browserUtils.isMobileMode()) {\n            builder.on('click', ev => {\n                ev.stopPropagation();\n                this.panel.toggleConditionPicked(this.condition);\n                this.adjustButtonsVisibility();\n                if (!browserUtils.isMobileMode()) {\n                    this.element.dispatchEvent(createBrowserEvent(\"mouseenter\"));\n                }\n                return false;\n            });\n        }\n        builder\n            .addChildElement(this.renderButtonsBlock());\n        if (!browserUtils.isMobileMode()) {\n            builder\n                .on('mouseenter', event => {\n                this.isMouseOverBlock = true;\n                this.enterButtonBlock();\n                event.stopPropagation();\n                return false;\n            })\n                .on('mouseleave', event => {\n                this.isMouseOverBlock = false;\n                if (!this.keepShowingButtons && domel(this.buttonsBlock).isVisible()) {\n                    this.leaveButtonBlock();\n                }\n                event.stopPropagation();\n                return false;\n            });\n        }\n    }\n    setConditionParameterized(value) {\n        this.condition.setParameterized(value);\n        this.condition.fireChangedEvent();\n    }\n    setConditionInJoin(value) {\n        this.condition.setInJoin(value);\n        this.condition.fireChangedEvent();\n    }\n    getConditionMenu() {\n        return this.panel.getConditionMenu();\n    }\n    renderConjunction() {\n        const parent = this.condition.getParent();\n        if (!parent)\n            return null;\n        const isFirstConditionInGroup = utils.findItemIndexById(parent.getConditions(), this.condition.id) == 0;\n        if (this.panel.options.showConjunctions && !isFirstConditionInGroup) {\n            const linkTypeStr = equtils.linkTypeToStr(this.condition.getParent().linkType);\n            const conjuctionText = i18n.getText(\"Conj\" + linkTypeStr);\n            return domel(\"span\")\n                .text(conjuctionText)\n                .title(conjuctionText)\n                .addClass(`${this.cssPrefix}-condelement ${this.cssPrefix}-condition-conjuction`)\n                .toDOM();\n        }\n        return null;\n    }\n    renderCheckbox() {\n        if (this.panel.options.showCheckboxes && !this.condition.isReadOnly() && !this.panel.isFixed()) {\n            return domel(\"div\")\n                .title(i18n.getText('CmdToggleEnable'))\n                .attr('tabIndex', '0')\n                .addClass(`${this.cssPrefix}-condelement ${this.cssPrefix}-condition-checkbox`)\n                .addClass(`${this.condition.enabled ? 'enabled' : ''}`)\n                .on('click', () => {\n                this.condition.enabled = !this.condition.enabled;\n                this.condition.fireChangedEvent();\n                return false;\n            })\n                .on('keypress', evt => { if ([13, 32].includes(evt.keyCode)) {\n                evt.target.click();\n            } })\n                .toDOM();\n        }\n        else {\n            return null;\n        }\n    }\n    isConditionActive() {\n        return this.element.classList.contains(\"active\");\n    }\n    hideButtons() {\n        domel(this.element).data(\"show-buttons\", null);\n    }\n    showButtons() {\n        domel(this.element).data(\"show-buttons\", \"\");\n    }\n    adjustButtonsVisibility() {\n        if (this.panel.options.alwaysShowButtonsInConditions\n            || (this.panel.options.accentActiveCondition && this.isConditionActive())) {\n            this.showButtons();\n        }\n    }\n    enterButtonBlock() {\n        this.showButtons();\n    }\n    leaveButtonBlock() {\n        if (!this.panel.options.alwaysShowButtonsInConditions\n            && (!this.isConditionActive() || !this.panel.options.accentActiveCondition)) {\n            this.hideButtons();\n        }\n    }\n    conditionMenuHandler(action, evt) {\n        switch (action) {\n            case ConditionAction.AddCondition:\n                if (!this.condition.isGroup())\n                    return;\n                const entMenu = this.panel.getEntitiesMenu();\n                if (entMenu) {\n                    entMenu.showMenu({\n                        anchor: evt.target,\n                        itemSelectedCallback: item => {\n                            const query = this.panel.getQuery();\n                            const descr = {\n                                parent: this.condition,\n                                attributeId: item.id\n                            };\n                            const cond = query.addSimpleCondition(descr);\n                            if (cond) {\n                                query.fireConditionsChangedEvent(QueryChangeAction.Add, cond);\n                            }\n                            return false;\n                        }\n                    });\n                }\n                break;\n            case ConditionAction.AddGroup:\n                if (!this.condition.isGroup())\n                    return;\n                const query = this.panel.getQuery();\n                const descr = {\n                    parent: this.condition\n                };\n                const group = this.panel.getQuery().addConditionGroup(descr);\n                if (group) {\n                    query.fireConditionsChangedEvent(QueryChangeAction.Add, group);\n                }\n                break;\n            case ConditionAction.Enable:\n                this.condition.enabled = !this.condition.enabled;\n                this.condition.fireChangedEvent();\n                break;\n            case ConditionAction.Delete:\n                const parent = this.condition.getParent();\n                if (!parent)\n                    return;\n                const conditions = parent.getConditions();\n                const idx = conditions.indexOf(this.condition);\n                if (idx >= 0) {\n                    conditions.splice(idx, 1);\n                    this.condition.getQuery().fireConditionsChangedEvent(QueryChangeAction.Delete, this.condition);\n                }\n                break;\n            case ConditionAction.Menu:\n                const condMenu = this.getConditionMenu();\n                this.keepShowingButtons = true;\n                condMenu.showMenu({\n                    anchor: evt.target,\n                    selectedIds: this.getConditionMenuSelectedItems(),\n                    itemSelectedCallback: (item) => {\n                        let action;\n                        switch (item.id) {\n                            case \"enable\":\n                                action = ConditionAction.Enable;\n                                break;\n                            case \"delete\":\n                                action = ConditionAction.Delete;\n                                break;\n                            case \"param\":\n                                action = ConditionAction.Parameterized;\n                                break;\n                            case \"inJoin\":\n                                action = ConditionAction.InJoin;\n                                break;\n                            case \"addCondition\":\n                                action = ConditionAction.AddCondition;\n                                break;\n                            case \"addGroup\":\n                                action = ConditionAction.AddGroup;\n                                break;\n                        }\n                        this.conditionMenuHandler(action, evt);\n                    },\n                    itemFilterCallback: (item) => {\n                        let result = this.condition.enabled || item.id === \"enable\" || item.id === \"delete\";\n                        if (item.id === \"enable\") {\n                            const parent = this.condition.getParent();\n                            result = result && parent && parent.enabled;\n                        }\n                        else if (item.id === \"delete\") {\n                            result = result && ((this.panel.options.editableParts & QPEditablePart.Removal) === QPEditablePart.Removal);\n                        }\n                        else if (item.id === \"addGroup\" || item.id === \"addCondition\") {\n                            result = result && ((this.panel.options.editableParts & QPEditablePart.Addition) === QPEditablePart.Addition);\n                        }\n                        return result;\n                    },\n                    menuClosedCallback: () => {\n                        this.keepShowingButtons = false;\n                        if (!this.isMouseOverBlock)\n                            this.leaveButtonBlock();\n                    }\n                });\n                break;\n            case ConditionAction.Parameterized:\n                this.condition.setParameterized(!this.condition.isParameterized());\n                this.condition.fireChangedEvent();\n                break;\n            case ConditionAction.InJoin:\n                this.condition.setInJoin(!this.condition.isInJoin());\n                this.condition.fireChangedEvent();\n                break;\n        }\n        evt.stopPropagation();\n        return false;\n    }\n    getConditionMenuSelectedItems() {\n        let arrSelected = [];\n        if (this.condition.enabled) {\n            arrSelected.push(\"enable\");\n        }\n        if (this.condition.isParameterized()) {\n            arrSelected.push(\"param\");\n        }\n        if (this.condition.isInJoin()) {\n            arrSelected.push(\"inJoin\");\n        }\n        return arrSelected;\n    }\n    renderButtonsBlock() {\n        const onButtonMouseEnter = (evt) => {\n            domel(evt.target)\n                .addClass(`${this.cssPrefix}-condition-button-active`);\n        };\n        const onButtonMouseLeave = (evt) => {\n            domel(evt.target)\n                .removeClass(`${this.cssPrefix}-condition-button-active`);\n        };\n        const builder = domel(\"div\")\n            .addClass(`${this.cssPrefix}-condition-buttonsBlock`)\n            .addClass(getMobileCssClass());\n        this.buttonsBlock = builder.toDOM();\n        if (this.condition.isReadOnly()) {\n            return this.buttonsBlock;\n        }\n        const buttonsToShow = this.getButtonsToShow();\n        if (buttonsToShow.indexOf(\"addCondition\") >= 0 && this.condition.enabled\n            && ((this.panel.options.editableParts & QPEditablePart.Addition) == QPEditablePart.Addition)) {\n            builder.addChild(\"div\", b => {\n                b.addClass(`${this.cssPrefix}-button-placeholder`)\n                    .data(\"btnplaceholder\", \"\")\n                    .addChild(\"div\", b => {\n                    b.addClass(`${this.cssPrefix}-condition-button ${this.cssPrefix}-condition-button-addCondition`)\n                        .attr('tabIndex', '0')\n                        .data(\"button\", \"\")\n                        .title(i18n.getText('CmdAddCondition'))\n                        .on('click', evt => this.conditionMenuHandler(ConditionAction.AddCondition, evt))\n                        .on('keypress', evt => { if (evt.keyCode == 13) {\n                        evt.target.click();\n                    } })\n                        .on('mouseenter', onButtonMouseEnter)\n                        .on('mouseleave', onButtonMouseLeave);\n                });\n            });\n        }\n        const showAddGroupBtn = buttonsToShow.indexOf(\"addGroup\") >= 0 || buttonsToShow.indexOf(\"addPredicate\") >= 0;\n        if (showAddGroupBtn && this.condition.enabled\n            && ((this.panel.options.editableParts & QPEditablePart.Addition) == QPEditablePart.Addition)) {\n            builder.addChild(\"div\", b => {\n                b.addClass(`${this.cssPrefix}-button-placeholder`)\n                    .data(\"btnplaceholder\", \"\")\n                    .addChild(\"div\", b => {\n                    b.addClass(`${this.cssPrefix}-condition-button ${this.cssPrefix}-condition-button-addPredicate`)\n                        .attr('tabIndex', '0')\n                        .data(\"button\", \"\")\n                        .title(i18n.getText('CmdAddCondGroup'))\n                        .on('click', evt => this.conditionMenuHandler(ConditionAction.AddGroup, evt))\n                        .on('keypress', evt => { if (evt.keyCode == 13) {\n                        evt.target.click();\n                    } })\n                        .on('mouseenter', onButtonMouseEnter)\n                        .on('mouseleave', onButtonMouseLeave);\n                });\n            });\n        }\n        if (this.getButtonsToShow().indexOf(\"enable\") >= 0 && this.condition.getParent() && this.condition.getParent().enabled\n            && !this.panel.options.showCheckboxes && !this.panel.isFixed()) {\n            builder.addChild(\"div\", b => {\n                b.addClass(`${this.cssPrefix}-button-placeholder`)\n                    .data(\"btnplaceholder\", \"\")\n                    .addChild(\"div\", b => {\n                    b.addClass(`${this.cssPrefix}-condition-button ${this.cssPrefix}-condition-button-enable`)\n                        .attr('tabIndex', '0')\n                        .data(\"button\", \"\")\n                        .title(i18n.getText('CmdToggleEnable'))\n                        .addClass(this.condition.enabled ? 'enabled' : '')\n                        .on('click', evt => this.conditionMenuHandler(ConditionAction.Enable, evt))\n                        .on('keypress', evt => { if (evt.keyCode == 13) {\n                        evt.target.click();\n                    } })\n                        .on('mouseenter', onButtonMouseEnter)\n                        .on('mouseleave', onButtonMouseLeave);\n                });\n            });\n        }\n        if (this.getButtonsToShow().indexOf(\"delete\") >= 0 && this.condition.getParent()\n            && ((this.panel.options.editableParts & QPEditablePart.Removal) == QPEditablePart.Removal)) {\n            builder.addChild(\"div\", b => {\n                b.addClass(`${this.cssPrefix}-button-placeholder`)\n                    .data(\"btnplaceholder\", \"\")\n                    .addChild(\"div\", b => {\n                    b.addClass(`${this.cssPrefix}-condition-button ${this.cssPrefix}-condition-button-delete`)\n                        .attr('tabIndex', '0')\n                        .data(\"button\", \"\")\n                        .title(i18n.getText('CmdDelete'))\n                        .on('click', evt => this.conditionMenuHandler(ConditionAction.Delete, evt))\n                        .on('keypress', evt => { if (evt.keyCode == 13) {\n                        evt.target.click();\n                    } })\n                        .on('mouseenter', onButtonMouseEnter)\n                        .on('mouseleave', onButtonMouseLeave);\n                });\n            });\n        }\n        if (this.getButtonsToShow().indexOf(\"menu\") >= 0 && !this.panel.isFixed()) {\n            builder.addChild(\"div\", b => {\n                b.addClass(`${this.cssPrefix}-button-placeholder`)\n                    .data(\"btnplaceholder\", \"\")\n                    .addChild(\"div\", b => {\n                    b.addClass(`${this.cssPrefix}-condition-button ${this.cssPrefix}-condition-button-menu`)\n                        .attr('tabIndex', '0')\n                        .data(\"button\", \"\")\n                        .title(i18n.getText('ButtonMenu'))\n                        .on('click', evt => this.conditionMenuHandler(ConditionAction.Menu, evt));\n                    if (!browserUtils.isMobileMode()) {\n                        b\n                            .on('keypress', evt => { if (evt.keyCode == 13) {\n                            evt.target.click();\n                        } })\n                            .on('mouseenter', onButtonMouseEnter)\n                            .on('mouseleave', onButtonMouseLeave);\n                    }\n                });\n            });\n        }\n        this.adjustButtonsVisibility();\n        return this.buttonsBlock;\n    }\n    getButtonsToShow() {\n        return this.panel.options.buttons && this.panel.options.buttons.condition && Array.isArray(this.panel.options.buttons.condition) ? this.panel.options.buttons.condition : [\"enable\", \"delete\"];\n    }\n}\n\nclass DomDropDownElementBuilder extends DomElementBuilder {\n    constructor(parent) {\n        super('a', parent);\n        this.attr('href', 'javascript:void(0)');\n        this.on('click', ev => {\n            ev.preventDefault();\n            this.appear();\n            return false;\n        });\n    }\n    onGetMenu(onGetMenu) {\n        this._onGetMenu = onGetMenu;\n        return this;\n    }\n    onItemSelected(onItemSelected) {\n        this._onItemSelected = onItemSelected;\n        return this;\n    }\n    appear() {\n        const menu = this._onGetMenu ? this._onGetMenu() : null;\n        if (menu) {\n            menu.showMenu({\n                anchor: this.element,\n                itemSelectedCallback: item => {\n                    if (this._onItemSelected) {\n                        this._onItemSelected(item.id);\n                    }\n                    return false;\n                }\n            });\n        }\n    }\n}\nfunction dropdown(parent) {\n    return new DomDropDownElementBuilder(parent);\n}\n\nclass ConditionGroupRenderer extends ConditionRenderer {\n    constructor(panel, condition, slot) {\n        super(panel, condition, slot);\n        this.isRoot = !condition.getParent();\n    }\n    getClassesToAdd() {\n        let result = `${this.cssPrefix}-group`;\n        if (this.isRoot) {\n            result += ` ${this.cssPrefix}-group-root`;\n        }\n        return result;\n    }\n    coreRender(autoAppear) {\n        domel(this.element)\n            .addClass(this.getClassesToAdd())\n            .addClass(getMobileCssClass())\n            .addChildElement(this.renderGroupRow())\n            .addChildElement(this.renderConditions(autoAppear))\n            .data('id', this.condition.id)\n            .data('group', '');\n    }\n    renderGroupRow() {\n        if (this.isRoot && !this.panel.options.showRootRow) {\n            return null;\n        }\n        else {\n            return new ConditionGroupRowRenderer(this.panel, this.condition).render();\n        }\n    }\n    renderConditions(autoAppear) {\n        const builder = domel('div');\n        builder\n            .addClass(`${this.cssPrefix}-conditions`)\n            .addClass(`${getMobileCssClass()}`)\n            .data('conditions', '');\n        if (this.isRoot) {\n            builder.addClass(`${this.cssPrefix}-conditions-root`);\n        }\n        this.condition.getConditions().forEach((condition, index, array) => {\n            const renderer = this.panel.getConditionRenderer(condition);\n            if (renderer) {\n                builder.addChildElement(renderer.render(autoAppear && index == array.length - 1));\n            }\n        });\n        return builder.toDOM();\n    }\n}\nclass ConditionGroupRowRenderer extends SimpleConditionRenderer {\n    constructor(panel, condition, slot) {\n        super(panel, condition, slot);\n        this.isRoot = !this.condition.getParent();\n    }\n    getButtonsToShow() {\n        return this.panel.options.buttons && this.panel.options.buttons.group && Array.isArray(this.panel.options.buttons.group) ? this.panel.options.buttons.group : [\"addCondition\", \"addGroup\", \"enable\", \"delete\"];\n    }\n    getClassesToAdd() {\n        let result;\n        if (this.isRoot) {\n            result = `${this.cssPrefix}-row ${this.cssPrefix}-row-group ${this.cssPrefix}-row-group-root`;\n        }\n        else {\n            result = `${this.cssPrefix}-row ${this.cssPrefix}-row-group`;\n            const level = this.condition.getLevel();\n            if (level > 0)\n                result += ` ${this.cssPrefix}-level-${level}`;\n            result += this.condition.enabled ? '' : ` ${this.cssPrefix}-disabled`;\n            if (this.condition.enabled) {\n                result += this.condition.isReadOnly() ? ` ${this.cssPrefix}-readonly` : '';\n            }\n        }\n        return result;\n    }\n    coreRender(autoAppear) {\n        const builder = domel(this.element)\n            .addClass(this.getClassesToAdd())\n            .addClass(getMobileCssClass())\n            .data('group-row', '')\n            .addChildElement(this.renderCheckbox())\n            .addChildElement(this.renderConjunction());\n        const level = this.condition.getLevel();\n        if (level > 0)\n            builder.addClass(`${this.cssPrefix}-level-${level}`);\n        this.buildGroupElements(builder, this.getGroupTitle());\n        if (this.panel.options.accentActiveCondition) {\n            builder.on('click', ev => {\n                this.panel.toggleConditionPicked(this.condition);\n                this.adjustButtonsVisibility();\n                if (!browserUtils.isMobileMode()) {\n                    builder.toDOM().dispatchEvent(createBrowserEvent(\"mouseenter\"));\n                }\n            });\n        }\n        builder\n            .addChildElement(this.renderButtonsBlock());\n        if (!browserUtils.isMobileMode()) {\n            builder\n                .on('mouseenter', event => {\n                this.isMouseOverBlock = true;\n                this.enterButtonBlock();\n                event.stopPropagation();\n                return false;\n            })\n                .on('mouseleave', event => {\n                this.isMouseOverBlock = false;\n                if (!this.keepShowingButtons && domel(this.buttonsBlock).isVisible()) {\n                    this.leaveButtonBlock();\n                }\n                event.stopPropagation();\n                return false;\n            });\n        }\n    }\n    getGroupTitle() {\n        let result;\n        if (this.isRoot && !browserUtils.isMobileMode()) {\n            result = i18n.getText('RootConditionGroupTitle');\n            if (!result) {\n                //to support old text key\n                result = i18n.getText('RootPredicateTitle');\n            }\n        }\n        else {\n            result = i18n.getText('ConditionGroupTitle');\n            if (!result) {\n                //to support old text key\n                result = i18n.getText('PredicateTitle');\n            }\n        }\n        return result;\n    }\n    buildGroupElements(builder, groupTitle) {\n        const pos = groupTitle.indexOf('{lt}');\n        if (pos < 0) {\n            //invalid format\n            builder.addText(i18n.getText('ErrIncorrectGroupTitleFormat'));\n            builder.addClass(`${this.cssPrefix}-error`);\n        }\n        else {\n            if (pos > 0) {\n                builder.addChild('span', b => {\n                    b.addClass(`${this.cssPrefix}-grelement`)\n                        .addText(groupTitle.substring(0, pos));\n                });\n            }\n            const linkTypeStr = equtils.linkTypeToStr(this.condition.linkType);\n            let curType = utils.findItemById(eqconsts.predicateLinkTypeList, linkTypeStr);\n            if (!curType) {\n                curType = eqconsts.predicateLinkTypeList[0];\n            }\n            if (this.isEditable()) {\n                dropdown(builder.toDOM())\n                    .onGetMenu(() => this.getLinkTypeMenu())\n                    .onItemSelected(id => {\n                    this.condition.linkType = equtils.strToLinkType(id);\n                    this.condition.fireChangedEvent();\n                })\n                    .addText(i18n.getText(curType.key))\n                    .title(i18n.getText(curType.key))\n                    .addClass(`${this.cssPrefix}-grelement`);\n            }\n            else {\n                builder.addChild('span', b => {\n                    b.text(i18n.getText(curType.key))\n                        .title(i18n.getText(curType.key))\n                        .addClass(`${this.cssPrefix}-grelement`);\n                });\n            }\n            builder.addChild('span', b => {\n                b.addClass(`${this.cssPrefix}-grelement`)\n                    .addText(groupTitle.substring(pos + 4));\n            });\n        }\n    }\n    getConditionMenu() {\n        return this.panel.getConditionGroupMenu(this.condition.getParent() == null);\n    }\n    getLinkTypeMenu() {\n        return this.panel.getLinkTypeMenu();\n    }\n    renderConjunction() {\n        return this.isRoot ? null : super.renderConjunction();\n    }\n    renderCheckbox() {\n        return this.isRoot ? null : super.renderCheckbox();\n    }\n    leaveButtonBlock() {\n        if (!this.panel.options.alwaysShowButtonsInGroups\n            && (!this.isConditionActive() || !this.panel.options.accentActiveCondition)) {\n            this.hideButtons();\n        }\n    }\n    adjustButtonsVisibility() {\n        if (this.panel.options.alwaysShowButtonsInGroups\n            || (this.panel.options.accentActiveCondition && this.isConditionActive())) {\n            this.showButtons();\n        }\n    }\n}\n\nclass BaseElementRenderer {\n    constructor(slot) {\n        this.element = slot || domel('div').toDOM();\n    }\n    refresh() {\n        this.render();\n    }\n    render(isEditMode = false) {\n        this.labelElement = this.renderLabelElement();\n        domel(this.element)\n            .html('')\n            .addClass(this.getClassesToAdd())\n            .addClass(getMobileCssClass())\n            .addChildElement(this.labelElement);\n        if (this.isEditable()) {\n            this.renderEditor();\n            if (isEditMode) {\n                setTimeout(() => this.showEditor(), 50);\n            }\n        }\n        return this.element;\n    }\n    isEditable() {\n        return true;\n    }\n    renderLabelElement() {\n        const displayedText = this.getLabelText();\n        if (this.isEditable()) {\n            return domel('a')\n                .attr('href', 'javascript:void(0)')\n                .title(displayedText)\n                .text(displayedText)\n                .on('click', (ev) => {\n                ev.preventDefault();\n                this.showEditor();\n                return false;\n            })\n                .toDOM();\n        }\n        else {\n            return domel('span')\n                .title(displayedText)\n                .text(displayedText)\n                .toDOM();\n        }\n    }\n    getClassesToAdd() {\n        return '';\n    }\n    getLabelText() {\n        return this.getEmptyText();\n    }\n    getEmptyText() {\n        return '<empty>';\n    }\n}\n\nclass ExpressionRenderer extends BaseElementRenderer {\n    get cssPrefix() {\n        return 'eqjs-qp';\n    }\n    constructor(panel, expression, valueEditor, slot) {\n        super(slot);\n        this.panel = panel;\n        this.expression = expression;\n        this.valueEditor = valueEditor;\n    }\n    render(isEditMode = false) {\n        super.render(isEditMode);\n        if (this.panel.options.onExpressionRendered) {\n            this.panel.options.onExpressionRendered(this.expression, this.element);\n        }\n        return this.element;\n    }\n    getContext() {\n        return this.panel.getContext();\n    }\n    isReadOnly() {\n        const parent = this.expression.getParent();\n        return !parent.enabled || parent.isReadOnly();\n    }\n    isEditable() {\n        return !this.isReadOnly();\n    }\n    getClassesToAdd() {\n        return `${this.cssPrefix}-condelement ${this.cssPrefix}-valueelement`;\n    }\n    getLabelText() {\n        let result = !this.expression.isEmpty()\n            ? this.expression.value\n            : this.getEmptyText();\n        return result;\n    }\n    getEmptyText() {\n        return this.panel.options.emptyTextValue || i18n.getText('MsgEmptyScalarValue'); //'[enter value]';\n    }\n    setValue(value, silent) {\n        this.expression.setValue(value);\n        if (!silent) {\n            this.expression.getParent().fireChangedEvent(ConditionPart.Value);\n        }\n    }\n    getValue() {\n        return this.expression.value;\n    }\n    validateInput(value) {\n        return { success: true, value: value };\n    }\n    showValidationError(message, target) {\n        this.getContext().throwError({\n            action: \"ui.validation\",\n            \"text\": message\n        });\n    }\n    isEmptyValue() {\n        let v = this.getValue();\n        return (typeof (v) === \"undefined\" || v === null || !v);\n    }\n    adjustWidth() {\n    }\n}\n\nclass InputExpressionRenderer extends ExpressionRenderer {\n    renderEditor() {\n        this.inputBuilder = domel(\"input\")\n            .hide()\n            .addClass(`${this.cssPrefix}-ve-editbox`)\n            .type('text')\n            .on('blur', (ev) => {\n            if (this.inputBuilder.isVisible() && !this.dontProcessBlur) {\n                const validationResult = this.validateInput(this.inputElement.value);\n                if (validationResult.success) {\n                    this.setValue(this.inputElement.value);\n                    this.closeEditor();\n                }\n                else {\n                    this.dontProcessBlur = true;\n                    this.inputElement.focus();\n                    setTimeout(() => { this.dontProcessBlur = false; }, 200);\n                    this.showValidationError(validationResult.message, ev.target);\n                }\n                ev.stopPropagation();\n                return false;\n            }\n        })\n            .on('keydown', (ev) => {\n            if (ev.keyCode === 27) { // ESC is pressed\n                this.closeEditor();\n                ev.stopPropagation();\n                return false;\n            }\n            else if (ev.keyCode === 13) { // Enter is pressed\n                if (this.inputBuilder.isVisible()) {\n                    this.dontProcessBlur = true;\n                    const validationResult = this.validateInput(this.inputElement.value);\n                    if (validationResult.success) {\n                        this.setValue(this.inputElement.value);\n                        this.closeEditor();\n                        this.dontProcessBlur = false;\n                    }\n                    else {\n                        this.inputElement.focus();\n                        this.showValidationError(validationResult.message, ev.target);\n                        setTimeout(() => { this.dontProcessBlur = false; }, 200);\n                    }\n                    ev.stopPropagation();\n                    return false;\n                }\n            }\n        });\n        this.inputElement = this.inputBuilder.toDOM();\n        domel(this.element)\n            .addChildElement(this.inputElement);\n    }\n    showEditor() {\n        const MIN_WIDTH = 200;\n        if (!browserUtils.isMobileMode()) {\n            let left = this.element.offsetLeft;\n            let width = this.element.offsetWidth > MIN_WIDTH ? this.element.offsetWidth : MIN_WIDTH;\n            let maxWidth = this.element.parentElement.clientWidth - left - 55;\n            this.inputBuilder\n                .removeStyle('left')\n                .removeStyle('right');\n            if (maxWidth < MIN_WIDTH) {\n                this.inputBuilder\n                    .setStyle('right', '55px')\n                    .setStyle('width', `${MIN_WIDTH}px`);\n            }\n            else if (maxWidth < width) {\n                this.inputBuilder\n                    .setStyle('left', `${left}px`)\n                    .setStyle('width', `${maxWidth}px`);\n            }\n            else {\n                this.inputBuilder\n                    .setStyle('left', `${left}px`)\n                    .setStyle('width', `${width}px`);\n            }\n        }\n        domel(this.labelElement).hide();\n        this.inputBuilder\n            .value(this.getValue())\n            .show();\n        this.inputElement.focus();\n    }\n    closeEditor() {\n        this.inputBuilder.hide();\n        domel(this.labelElement).show();\n        this.labelElement.focus();\n    }\n    validateInput(inputValue) {\n        this.inputBuilder.removeClass(\"eqjs-invalid\");\n        const result = {\n            success: true,\n            value: inputValue\n        };\n        if (this.expression.kind == DataKind.List) {\n            this.validateListInput(inputValue, result);\n        }\n        else {\n            this.validateScalarInput(inputValue, result);\n        }\n        return result;\n    }\n    validateListInput(inputValue, result) {\n        let inputValues = inputValue.split(/\\s*,\\s*/);\n        for (let val of inputValues) {\n            this.validateScalarInput(val, result);\n            if (!result.success) {\n                return;\n            }\n        }\n    }\n    validateScalarInput(inputValue, result) {\n        if (!inputValue)\n            return;\n        if (utils.isNumericType(this.expression.dataType)) {\n            let parsedVal = +inputValue;\n            if (isNaN(parsedVal)) {\n                result.success = false;\n                result.message = '\"' + inputValue + '\" ' + i18n.getText('ErrNotNumber');\n            }\n            if (utils.isIntType(this.expression.dataType) && parsedVal != parseInt(inputValue, 10)) {\n                result.success = false;\n                result.message = '\"' + inputValue + '\" ' + i18n.getText('ErrIncorrectInteger');\n            }\n        }\n    }\n    showValidationError(message, target) {\n        super.showValidationError(message, target);\n        this.inputBuilder.addClass(\"eqjs-invalid\");\n    }\n    isEditable() {\n        return super.isEditable()\n            && ((this.panel.options.editableParts & QPEditablePart.Value) === QPEditablePart.Value);\n    }\n}\n\nclass ListExpressionRenderer extends ExpressionRenderer {\n    constructor() {\n        super(...arguments);\n        this.menuItemsList = [];\n        this.showWhenReady = false;\n    }\n    isEditable() {\n        return !this.isReadOnly()\n            && ((this.panel.options.editableParts & QPEditablePart.Value) === QPEditablePart.Value);\n    }\n    setValue(value, silent = false) {\n        const newValue = this.adjustNewValue(value);\n        if (value !== this.expression.value) {\n            const text = this.getValueText(value);\n            this.expression.setContent(newValue, text);\n            if (!silent) {\n                this.expression.getParent().fireChangedEvent(ConditionPart.Value);\n            }\n        }\n        return true;\n    }\n    getValueText(value) {\n        let result = \"\";\n        if (Array.isArray(value)) {\n            for (let item of this.menuItemsList) {\n                if (value.indexOf(item.id) >= 0) {\n                    result += item.text + ',';\n                }\n            }\n        }\n        else {\n            for (let item of this.menuItemsList) {\n                if (item.id === value) {\n                    result += item.text + ',';\n                }\n            }\n        }\n        if (result) {\n            result = result.substring(0, result.length - 1);\n        }\n        return result;\n    }\n    getEmptyText() {\n        return this.panel.options.emptyTextList || i18n.getText('MsgEmptyListValue');\n    }\n    getListName() {\n        return this.valueEditor.name;\n    }\n    renderEditor() {\n        this.fillMenuItemsList(() => {\n            this.renderMenuBlock();\n        });\n    }\n    getLabelText() {\n        if (!this.expression.isEmpty()) {\n            return this.expression.getText();\n        }\n        else {\n            return this.getEmptyText();\n        }\n    }\n    showLoader() {\n        //NOTHING TO DO\n    }\n    hideLoader() {\n        //NOTHING TO DO\n    }\n    showEditor() {\n        if (this.menu) {\n            this.menu.showMenu({\n                anchor: this.labelElement,\n                selectedIds: this.getValuesAsArray(),\n                itemSelectedCallback: (item, selectedItems) => {\n                    if (!this.menu.options.multiselect) {\n                        this.setValue(item.id);\n                    }\n                    else if (selectedItems) {\n                        let selectedIds = [];\n                        let selLength = selectedItems.length;\n                        for (let i = 0; i < selLength; i++)\n                            selectedIds.push(selectedItems[i].id);\n                        this.setValue(selectedIds);\n                    }\n                    return false;\n                }\n            });\n        }\n        else {\n            this.showWhenReady = true;\n            this.showLoader();\n        }\n    }\n    closeEditor() {\n        this.menu.hideMenu();\n    }\n    renderMenuBlock() {\n        let multiSelect = false;\n        if (this.expression) {\n            multiSelect = this.expression.kind === DataKind.List;\n        }\n        const queryPanel = this.panel;\n        const options = {\n            items: this.menuItemsList,\n            multiselect: multiSelect,\n            container: queryPanel ? queryPanel.options.menuContainer : null,\n            showSelected: true,\n            showItemIds: queryPanel ? queryPanel.options.showIdsForListItems : false\n        };\n        if (queryPanel) {\n            utils.assignDeep(options, queryPanel.options.menuOptions);\n        }\n        let menuId = this.element.id;\n        if (menuId) {\n            options.id = menuId + '-EditorMenu';\n        }\n        if (queryPanel) {\n            options.domWriteItemsId = queryPanel.options.domWriteItemsId;\n        }\n        options.buttons = {\n            submit: i18n.getText('ButtonApply'),\n            cancel: i18n.getText('ButtonCancel')\n        };\n        this.menu = new PopupMenu(options);\n    }\n    getValuesAsArray() {\n        if (this.expression.kind !== DataKind.List) {\n            return [this.expression.value];\n        }\n        else {\n            if (this.expression.value) {\n                //splits value by ',' \n                const res = this.expression.value.match(/\"[^\"\\\\]*(?:\\\\.[^\"\\\\]*)*\"|[^,]+/g);\n                return res\n                    ? res.map(a => {\n                        if (a.charAt(0) == '\"' && a.charAt(a.length - 1) == '\"') {\n                            a = a.substring(1, a.length - 1);\n                            return a.replace(/\\\"/g, '\"');\n                        }\n                        else {\n                            return a;\n                        }\n                    })\n                    : [];\n            }\n            else\n                return [];\n        }\n    }\n    adjustNewValue(newValue) {\n        if (Array.isArray(newValue)) {\n            return newValue.map((a) => {\n                if (a.indexOf(',') >= 0) {\n                    a = a.replace(/\"/g, '\\\"');\n                    return '\"' + a + '\"';\n                }\n                else {\n                    return a;\n                }\n            }).join(',');\n        }\n        else {\n            return newValue;\n        }\n    }\n    fillMenuItemsList(onComplete) {\n        this.menuItemsList = this.valueEditor.values;\n        if (onComplete) {\n            onComplete();\n        }\n    }\n    takeDefaultValue() {\n        if (!this.menuItemsList)\n            return;\n        let itemLen = this.menuItemsList.length;\n        let defValue = this.valueEditor.defValue;\n        for (let i = 0; i < itemLen; i++) {\n            let item = this.menuItemsList[i];\n            if (item.isDefault || defValue == item.id) {\n                this.setValue(item.id, true);\n                break;\n            }\n        }\n    }\n}\nclass CustomListExpressionRenderer extends ListExpressionRenderer {\n    constructor() {\n        super(...arguments);\n        this.isLoading = false;\n        this.onClickTemp = null;\n    }\n    renderEditor() {\n        if (this.isLoading)\n            return;\n        this.isLoading = true;\n        this.fillMenuItemsList(() => {\n            this.isLoading = false;\n            if (this.isEmptyValue()) {\n                this.takeDefaultValue();\n            }\n            if (!this.expression.isEmpty() && this.expression._isDefaultValue) {\n                const text = this.getValueText(this.expression.value);\n                this.expression.setContent(this.expression.value, text);\n                this.expression.getParent().fireChangedEvent();\n            }\n            this.renderMenuBlock();\n            if (this.showWhenReady) {\n                this.showWhenReady = false;\n                this.hideLoader();\n                this.showEditor();\n            }\n        });\n    }\n    showLoader() {\n        this.labelElement.style.display = 'none';\n        if (!this.loaderElement) {\n            this.loaderElement = domel('div', this.element)\n                .addClass(`${this.cssPrefix}-ve-loader`)\n                .toDOM();\n        }\n        this.loaderElement.style.display = 'block';\n    }\n    hideLoader() {\n        this.loaderElement.style.display = 'none';\n        this.labelElement.removeAttribute('style');\n    }\n    fillMenuItemsList(onComplete) {\n        const listName = this.getListName();\n        const listRequestHandler = this.panel.getContext().getListRequestHandler();\n        if (eqconsts.constLists[listName]) {\n            this.menuItemsList = eqconsts.constLists[listName];\n            if (onComplete) {\n                onComplete();\n            }\n        }\n        else if (listRequestHandler) {\n            listRequestHandler({\n                listName: listName,\n                editorId: this.valueEditor.id,\n                editorParams: this.valueEditor.extraParams,\n                value: this.getValue()\n            }, (list) => {\n                this.menuItemsList = list;\n                if (onComplete) {\n                    onComplete();\n                }\n            });\n        }\n    }\n}\nclass SqlListExpressionRenderer extends CustomListExpressionRenderer {\n    fillMenuItemsList(onComplete) {\n        const context = this.panel.getContext();\n        this.valueEditor;\n        const listRequestHandler = context.getListRequestHandler();\n        if (listRequestHandler) {\n            let requestData = {\n                listName: \"SQL\",\n                editorId: this.valueEditor.id,\n                editorParams: this.valueEditor.extraParams,\n                value: this.getValue()\n            };\n            //requestData.sql = editor.sql;\n            listRequestHandler(requestData, (list) => {\n                this.menuItemsList = list;\n                if (onComplete) {\n                    onComplete();\n                }\n            });\n        }\n    }\n}\n\nclass AttributeExpressionRenderer extends ListExpressionRenderer {\n    constructor(panel, expression, entitiesMenu, slot) {\n        super(panel, expression, null, slot);\n        this.menu = entitiesMenu;\n    }\n    renderEditor() {\n        //create menu\n    }\n    getLabelText() {\n        const model = this.panel.getContext().getModel();\n        const attrId = this.expression.value;\n        const attrObj = attrId ? model.getAttributeByIdSafe(attrId) : null;\n        const attrFormat = this.panel.options.attrElementFormat;\n        return attrObj ? model.getAttributeText(attrObj, attrFormat) : this.getEmptyText();\n    }\n    setValue(value, silent = false) {\n        silent = silent && value !== this.expression.value;\n        const result = super.setValue(value, true);\n        if (!silent) {\n            this.expression.getParent().fireChangedEvent(ConditionPart.EntityAttr | ConditionPart.Operator);\n        }\n        return result;\n    }\n    isEditable() {\n        return !this.isReadOnly()\n            && ((this.panel.options.editableParts & QPEditablePart.Attribute) === QPEditablePart.Attribute);\n    }\n    getEmptyText() {\n        return this.panel.options.emptyTextAttribute || i18n.getText('MsgEmptyAttrValue');\n    }\n    getClassesToAdd() {\n        return `${this.cssPrefix}-condelement ${this.cssPrefix}-attrelement`;\n    }\n    adjustWidth() {\n        if (browserUtils.isMobileMode()) {\n            return;\n        }\n        const elWidth = this.element.clientWidth;\n        const parWidth = this.element.parentElement.clientWidth;\n        if (elWidth > parWidth / 2) {\n            domel(this.element)\n                .addClass(`${this.cssPrefix}-attrelement-wide`);\n        }\n    }\n}\n\nclass DropDownRenderer extends BaseElementRenderer {\n    constructor(slot) {\n        super(slot);\n    }\n    showEditor() {\n        const menu = this.getMenu();\n        if (menu) {\n            menu.showMenu({\n                anchor: this.labelElement,\n                itemSelectedCallback: item => {\n                    this.itemSelected(item.id);\n                    return false;\n                }\n            });\n        }\n    }\n    closeEditor() {\n        const menu = this.getMenu();\n        if (menu)\n            menu.hideMenu();\n    }\n}\n\nclass AddRowRenderer extends DropDownRenderer {\n    constructor(panel, entitiesMenu, slot) {\n        super(slot);\n        this.panel = panel;\n        this.menu = entitiesMenu;\n    }\n    get cssPrefix() {\n        return 'eqjs-qp';\n    }\n    getLabelText() {\n        return i18n.getText('CmdClickToAddCondition');\n    }\n    getClassesToAdd() {\n        return `${eqCssPrefix}-addrow ${this.cssPrefix}-addrow`;\n    }\n    isEditable() {\n        return super.isEditable()\n            && ((this.panel.options.editableParts & QPEditablePart.Addition) === QPEditablePart.Addition);\n    }\n    renderLabelElement() {\n        const displayedText = this.getLabelText();\n        if (this.isEditable()) {\n            this.labelElement = domel('a')\n                .attr('href', 'javascript:void(0)')\n                .title(displayedText)\n                .text(displayedText)\n                .on('click', (ev) => {\n                ev.preventDefault();\n                this.showEditor();\n                return false;\n            })\n                .toDOM();\n        }\n        else {\n            this.labelElement = domel('div')\n                .toDOM();\n        }\n        return this.labelElement;\n    }\n    renderEditor() {\n        // do nothing - the menu is alredy created\n    }\n    itemSelected(id) {\n        const query = this.panel.getQuery();\n        const descr = {\n            parent: query.getRootCondition(),\n            attributeId: id\n        };\n        const cond = query.addSimpleCondition(descr);\n        if (cond) {\n            query.fireConditionsChangedEvent(QueryChangeAction.Add, cond);\n        }\n    }\n    getMenu() {\n        return this.menu;\n    }\n}\n\nclass OperatorRenderer extends DropDownRenderer {\n    get cssPrefix() {\n        return 'eqjs-qp';\n    }\n    constructor(panel, condition, text, slot) {\n        super(slot);\n        this.panel = panel;\n        this.condition = condition;\n        this.displayedText = text;\n    }\n    renderEditor() {\n        //create menu\n        const model = this.panel.getContext().getModel();\n        const query = this.panel.getQuery();\n        const items = [];\n        const isRelatedToSubQuery = (operator) => {\n            return operator.defaultOperand.kind == DataKind.Query;\n        };\n        const attrId = (this.condition && this.condition.expressions && this.condition.expressions[0]) ? this.condition.expressions[0].value : null;\n        const attr = attrId ? model.getAttributeById(this.condition.expressions[0].value) : null;\n        if (attr && attr.operators) {\n            attr.operators.forEach(operId => {\n                const operator = model.getOperatorById(operId);\n                const related = isRelatedToSubQuery(operator);\n                if (!query.isEx() && related) {\n                    return;\n                }\n                if (operator && !(this.panel.options.isSubQuery && related)) {\n                    items.push({\n                        id: operId,\n                        text: i18n.getText('Operators', operId, 'caption') || operator.caption\n                    });\n                }\n            });\n        }\n        const options = {\n            items: items,\n            adjustHeight: this.panel.options.adjustEntitiesMenuHeight,\n            id: utils.generateId('opmn'),\n            domWriteItemsId: this.panel.options.domWriteItemsId\n        };\n        utils.assign(options, this.panel.options.menuOptions);\n        this.menu = new PopupMenu(options);\n    }\n    getLabelText() {\n        return this.displayedText;\n    }\n    getEmptyText() {\n        return this.panel.options.emptyTextOperator || i18n.getText('MsgEmptyOperator');\n    }\n    getClassesToAdd() {\n        return `${this.cssPrefix}-condelement ${this.cssPrefix}-operelement`;\n    }\n    isEditable() {\n        return this.condition.enabled && !this.condition.isReadOnly()\n            && ((this.panel.options.editableParts & QPEditablePart.Operator) === QPEditablePart.Operator);\n    }\n    itemSelected(id) {\n        this.condition.setOperatorId(id);\n        this.condition.fireChangedEvent(ConditionPart.Operator);\n    }\n    getMenu() {\n        return this.menu;\n    }\n}\n\nclass DateTimeExpressionRenderer extends ExpressionRenderer {\n    constructor() {\n        super(...arguments);\n        this.dtp = null;\n        this.internalDateFormat = 'yyyy-MM-dd';\n        this.internalTimeFormat = 'HH:mm';\n    }\n    renderEditor() {\n    }\n    showEditor() {\n        if (this.dtp)\n            return;\n        const pickerOptions = {\n            yearRange: this.panel.options.yearRange,\n            showCalendar: this.expression.dataType !== DataType.Time,\n            showTimePicker: this.expression.dataType !== DataType.Date,\n            oneClickDateSelection: this.panel.options.oneClickDateSelection,\n            showDateTimeInput: this.panel.options.showDateTimeInput,\n            minDate: this.panel.options.minDate,\n            maxDate: this.panel.options.maxDate,\n            defaultDate: this.panel.options.defaultDate,\n            onApply: (dateTime) => {\n                const value = this.convertToInternalFormat(dateTime);\n                this.setValue(value);\n                this.dtp = null;\n                setTimeout(() => this.labelElement.focus(), 100);\n            },\n            onCancel: () => {\n                this.labelElement.innerText = this.getLabelText();\n                this.dtp = null;\n                setTimeout(() => this.labelElement.focus(), 100);\n            },\n            onDateTimeChanged: (dateTime) => {\n                const value = i18n.dateTimeToStrEx(dateTime, this.expression.dataType);\n                this.labelElement.innerText = value;\n            }\n        };\n        this.dtp = this.panel.options.dateTimePickerResolver\n            ? this.panel.options.dateTimePickerResolver(pickerOptions)\n            : new DefaultDateTimePicker(pickerOptions);\n        const model = this.expression.getModel();\n        const value = this.expression.value;\n        let dt;\n        if (this.expression.dataType != DataType.Time && model.isDateMacro(value)) {\n            dt = model.getDateMacroValue(value);\n        }\n        else if (this.expression.dataType == DataType.Time && model.isTimeMacro(value)) {\n            dt = model.getTimeMacroValue(value);\n        }\n        else {\n            const defaultDate = this.panel.options.defaultDate\n                ? dateLikeToDate(this.panel.options.defaultDate)\n                : new Date();\n            dt = this.convertFromInternalFormat(value, defaultDate);\n        }\n        this.dtp.setDateTime(dt);\n        this.dtp.show(this.element);\n    }\n    closeEditor() {\n        this.dtp.cancel();\n        this.dtp = null;\n    }\n    getLabelText() {\n        if (!this.expression.value)\n            return this.getEmptyText();\n        const defValue = '${{Today}}';\n        const value = this.expression.value;\n        const model = this.expression.getModel();\n        if (!model) {\n            throw new Error('DataModel is not defined for ' + this.expression.value);\n        }\n        if (model.isDateMacro(value) || model.isTimeMacro(value)) {\n            let macroText = value.substring(3, value.length - 2);\n            let res = i18n.getText(macroText);\n            return res ? res : defValue;\n        }\n        const result = i18n.dateTimeToStrEx(this.convertFromInternalFormat(value), this.expression.dataType);\n        return result;\n    }\n    isEditable() {\n        return super.isEditable()\n            && ((this.panel.options.editableParts & QPEditablePart.Value) === QPEditablePart.Value);\n    }\n    convertFromInternalFormat(dateTimeStr, defautValue) {\n        if (!dateTimeStr)\n            return defautValue || new Date();\n        try {\n            return utils.strToDateTime(dateTimeStr, this.internalDateFormat + ' ' + this.internalTimeFormat);\n        }\n        catch (_a) {\n            return defautValue || new Date();\n        }\n    }\n    convertToInternalFormat(dateTime) {\n        return i18n.dateTimeToStr(dateTime, this.internalDateFormat + ' ' + this.internalTimeFormat);\n    }\n}\n\nclass SubQueryExpressionRenderer extends ExpressionRenderer {\n    renderEditor() {\n        this.dialogBlockBody = domel('div')\n            .addClass(`kfrm-form`)\n            //.setStyle('height', '100%')\n            .toDOM();\n        this.createEntitiesMenu();\n        this.renderColumnBlock();\n        this.renderQueryPanelBlock();\n    }\n    isEditable() {\n        return super.isEditable()\n            && ((this.panel.options.editableParts & QPEditablePart.Value) === QPEditablePart.Value);\n    }\n    setValue(value, silent) {\n        if (value instanceof Query) {\n            this.expression.subQuery = value;\n            if (!silent) {\n                this.expression.getParent().fireChangedEvent(ConditionPart.Value);\n            }\n        }\n    }\n    createEntitiesMenu() {\n        const model = this.getContext().getModel();\n        const exprType = this.expression.dataType;\n        this.colEntitiesList = model.getEntitiesTreeWithFilter((ent, attr) => {\n            if (attr) {\n                return attr.useInConditions && attr.dataType === exprType;\n            }\n            else {\n                //if it's entity\n                return ent.attributes && ent.useInConditions;\n            }\n        });\n        if (!model || model.isEmpty())\n            return null;\n        let menuId = this.element.getAttribute('data-id');\n        if (menuId) {\n            menuId += '-SubColumnMenu';\n        }\n        const options = {\n            items: this.colEntitiesList,\n            adjustHeight: this.panel.options.adjustEntitiesMenuHeight,\n            id: menuId,\n            isSubQuery: true,\n            domWriteItemsId: this.panel.options.domWriteItemsId\n        };\n        utils.assign(options, this.panel.options.menuOptions);\n        this.colEntitiesMenu = new PopupMenu(options);\n    }\n    renderColumnBlock() {\n        this.columnBlock = domel('div', this.dialogBlockBody)\n            .addClass(`kfrm-field`)\n            .addChild('label', b => b\n            .addText(i18n.getText('SubQueryColumnTitle')))\n            .addChild('a', b => this.columnElement = b\n            .attr('href', 'javascript:void(0)')\n            .on('click', (e) => {\n            this.colEntitiesMenu.showMenu({\n                anchor: this.columnElement,\n                selectedIds: null,\n                itemSelectedCallback: (data, items) => {\n                    const attrId = data.id;\n                    this.setResultAttributeId(attrId);\n                    return false;\n                }\n            });\n        })\n            .toDOM())\n            .toDOM();\n    }\n    getEmptyText() {\n        return this.panel.options.emptyTextValue || i18n.getText('MsgSubQueryValue');\n    }\n    renderQueryPanelBlock() {\n        const parentEl = domel('div', this.dialogBlockBody)\n            .addClass(`kfrm-field`)\n            .addChild('label', b => b\n            .addText(i18n.getText('SubQueryQueryPanelCaption')))\n            .toDOM();\n        this.subQueryPanelBlock =\n            domel('div', parentEl)\n                .toDOM();\n        let qpId = this.element.getAttribute('data-id');\n        if (qpId) {\n            this.subQueryPanelBlock.id = qpId + '-SubQueryPanel';\n        }\n    }\n    setResultAttributeId(attrId) {\n        let attrObj = this.getContext().getModel().getAttributeById(attrId);\n        if (attrObj && this.subQuery) {\n            let cols = this.subQuery.getColumns();\n            let column;\n            if (cols.length > 0) {\n                column = cols[0];\n                column.expr.setValue(attrId);\n                column.expr.dataType = attrObj.dataType;\n                column.fireChangedEvent();\n            }\n            else {\n                column = this.subQuery.createColumn();\n                column.sorting = SortDirection.None;\n                column.sortIndex = -1;\n                let expr = new Expression(column);\n                expr.setValue(attrId);\n                expr.tag = ExprTag.EntityAttribute;\n                expr.kind = DataKind.Attribute;\n                expr.dataType = attrObj.dataType;\n                column.expr = expr;\n                cols.push(column);\n                this.subQuery.fireColumnsChangedEvent(QueryChangeAction.Add, column);\n            }\n            this.columnElement.innerText = this.getAttributeText(attrObj);\n        }\n    }\n    getAttributeText(attribute) {\n        if (!attribute)\n            return i18n.getText('SubQueryEmptyColumn');\n        let attrText = i18n.getText('Attributes', attribute.id);\n        if (!attrText)\n            attrText = attribute.caption;\n        let format = this.panel.options.attrElementFormat;\n        if (!format)\n            return attrText;\n        let result = format.replace(new RegExp(\"{attr}\", 'g'), attrText);\n        let entityPath = this.getContext()\n            .getModel()\n            .getFullEntityPathByAttr(attribute.id, '.');\n        return result.replace(new RegExp(\"{entity}\", 'g'), entityPath);\n    }\n    showEditor() {\n        const parentPanel = this.panel;\n        const context = this.getContext();\n        this.subQueryPanelBlock.innerHTML = \"\";\n        this.subQuery = context.createQuery();\n        if (this.expression.subQuery) {\n            this.subQuery.loadFromData(this.expression.subQuery.toJSONData());\n        }\n        let subOptions = utils.assign({}, parentPanel.options);\n        subOptions.isSubQuery = true;\n        subOptions.showAddRow = true;\n        subOptions.menuContainer = document.body;\n        subOptions.menuOptions.isSubQuery = true;\n        subOptions.entitiesListFilter = (listItems, listOptions) => {\n            if (parentPanel.options.entitiesListFilter) {\n                let subQueryPanelListOptions = listOptions || {};\n                subQueryPanelListOptions.isSubQuery = true;\n                parentPanel.options.entitiesListFilter(listItems, subQueryPanelListOptions);\n            }\n        };\n        let subQueryPanel = this.panel.clonePanel(this.subQueryPanelBlock, this.subQuery);\n        subQueryPanel.init(this.panel.getContext(), subOptions);\n        let attrId = null;\n        let cols = this.subQuery.getColumns();\n        if (cols.length == 0) {\n            let condition = this.expression.getParent();\n            if (condition.expressions.length > 0) {\n                let attrExpr = condition.expressions[0];\n                attrId = (attrExpr.tag == ExprTag.EntityAttribute\n                    || attrExpr.kind == DataKind.Attribute) ? attrExpr.value : null;\n            }\n        }\n        else {\n            attrId = cols[0].expr.value;\n        }\n        if (attrId) {\n            this.setResultAttributeId(attrId);\n        }\n        else {\n            this.columnElement.innerText = i18n.getText(\"SubQueryEmptyColumn\");\n        }\n        subQueryPanel.refresh();\n        const rootCondEl = this.subQueryPanelBlock.querySelector('.eqjs-qp-conditions-root');\n        if (rootCondEl) {\n            rootCondEl.style.minHeight = '100px';\n        }\n        const dialogService = this.panel\n            .getContext()\n            .getServices()\n            .getService('DialogService');\n        dialogService.open({\n            title: i18n.getText('SubQueryDialogTitle'),\n            body: this.dialogBlockBody,\n            width: this.panel.options.subQueryDialogWidth,\n            //height: this.panel.options.subQueryDialogHeight,\n            closable: true,\n            cancelable: true,\n            onSubmit: () => {\n                const value = this.subQuery;\n                // validate subquery\n                if (value.tryValidate({ checkExpressions: true })) {\n                    this.setValue(value);\n                    return true;\n                }\n                return false;\n            }\n        });\n    }\n    closeEditor() {\n    }\n}\n\nclass BindToParentColumnExpressionRenderer extends CustomListExpressionRenderer {\n    constructor(panel, expression, editor, slot) {\n        super(panel, expression, editor, slot);\n        this.expression.tag = ExprTag.ParentColumn;\n    }\n    fillMenuItemsList(onComplete) {\n        const query = this.panel.getQuery().getParentQuery();\n        const parent = this.expression.getParent();\n        const attrDataType = parent.expressions[0].dataType;\n        this.menuItemsList = query\n            .getColumns()\n            .filter(col => col.expr.dataType == attrDataType)\n            .map(col => {\n            return { id: col.id, text: col.caption };\n        });\n        if (onComplete) {\n            onComplete();\n        }\n    }\n}\n\n/**\n * The query panel wiget, implemented without JQuery.\n */\nclass QueryPanel extends Widget {\n    get cssPrefix() {\n        return 'eqjs-qp';\n    }\n    /**\n     * The default constructor.\n     * @param slot The html element.\n     */\n    constructor(slot, customQuery) {\n        super(slot);\n        this.options = {\n            editableParts: QPEditablePart.All,\n            isSubQuery: false,\n            activeCondition: null,\n            entitiesPopupHandler: null,\n            entitiesListFilter: null,\n            menuContainer: document.body,\n            showRootRow: true,\n            showAddRow: true,\n            showCheckboxes: false,\n            allowParameterization: false,\n            allowInJoinConditions: false,\n            showPoweredBy: false,\n            buttons: {\n                condition: null,\n                group: null\n            },\n            alwaysShowButtonsInGroups: false,\n            alwaysShowButtonsInConditions: false,\n            showConjunctions: true,\n            accentActiveCondition: true,\n            activateRootOnStart: true,\n            yearRange: 'c-10:c+10',\n            oneClickDateSelection: true,\n            showDateTimeInput: false,\n            attrElementFormat: '{entity} {attr}',\n            menuOptions: {\n                showSearchBoxAfter: 30,\n                searchBoxAutoFocus: true,\n                activateOnMouseOver: true,\n                itemRenderedCallback: null\n            },\n            allowDragDrop: true,\n            attrPlacement: 0,\n            sortEntities: false,\n            subQueryDialogWidth: 600,\n            subQueryDialogHeight: 300,\n            dialogZIndex: 100000,\n            numberListSeparators: [',', ';'],\n            autoEditNewCondition: false,\n            onConditionRendered: null,\n            onGetConditionRenderer: null,\n            onGetExpressionRenderer: null,\n            onGetOperatorRenderer: null,\n            onOperatorRendered: null,\n            onGetAddRowRenderer: null,\n            defaultQuery: null,\n            showIndicatorOnLoad: true,\n            editMode: ConditionsEditMode.Default\n        };\n        this.customQuery = null;\n        this.landingSlot = domel('div')\n            .addClass(`${this.cssPrefix}-cond-landing-slot`)\n            .addChildElement(domel('div')\n            .toDOM())\n            .toDOM();\n        if (!this.slot.classList.contains(`${this.cssPrefix}-panel`)) {\n            this.slot.classList.add(`${this.cssPrefix}-panel`);\n        }\n        this.group = WidgetGroup.Query;\n        if (customQuery) {\n            this.customQuery = customQuery;\n        }\n    }\n    getWidgetType() {\n        return 'queryPanel';\n    }\n    /**\n     * Initialize widget.\n     * @param context The context.\n     * @param options The options.\n     */\n    init(context, options) {\n        super.init(context, options);\n        this.setOptions(options);\n        this.renderProgressBlock();\n        //detach previously defined query observer (if any)\n        this.detachQueryObserver();\n        this.attachQueryObserver();\n        this.convertEditModelToEditableParts();\n        eqDragManager.removeDropContainer(this.slot);\n        if (this.options.allowDragDrop && (this.options.editableParts & QPEditablePart.Addition) == QPEditablePart.Addition) {\n            const model = this.getContext().getModel();\n            eqDragManager.registerDropContainer({\n                element: this.slot,\n                scopes: [\"entityAttr\"],\n                onDragEnter: (container, ev) => {\n                    this.slot.classList.add(`${eqCssPrefix}-drophover`);\n                    ev.dragImage.classList.add('eqjs-sortable-helper');\n                    this.showLandingSlot();\n                    const attrId = ev.data.attrId;\n                    if (!model.checkAttrProperty(attrId, \"useInConditions\")) {\n                        ev.dropEffect = DropEffect.Forbid;\n                    }\n                },\n                onDragOver: (container, ev) => {\n                },\n                onDragLeave: (container, ev) => {\n                    ev.dragImage.classList.remove('eqjs-sortable-helper');\n                    ev.dragImage.style.removeProperty('width');\n                    this.slot.classList.remove(`${eqCssPrefix}-drophover`);\n                    this.hideLangindSlot();\n                },\n                onDrop: (container, ev) => {\n                    const query = this.getQuery();\n                    const descr = {\n                        parent: query.getRootCondition(),\n                        attributeId: ev.data.attrId\n                    };\n                    const cond = query.addSimpleCondition(descr);\n                    if (cond) {\n                        query.fireConditionsChangedEvent(QueryChangeAction.Add, cond);\n                    }\n                }\n            });\n        }\n    }\n    convertEditModelToEditableParts() {\n        // Convert editMode to editableParts for backward compatibility\n        if (this.options.editMode !== ConditionsEditMode.Default) {\n            switch (this.options.editMode) {\n                case ConditionsEditMode.ReadOnly:\n                    this.options.editableParts = QPEditablePart.None;\n                    break;\n                case ConditionsEditMode.FixedList:\n                    this.options.editableParts = QPEditablePart.FixedConditionList;\n                    break;\n                default:\n                    this.options.editableParts = QPEditablePart.All;\n                    break;\n            }\n        }\n    }\n    destroyCore() {\n        eqDragManager.removeDropContainer(this.slot);\n        this.detachQueryObserver();\n        this.slot.innerHTML = '';\n    }\n    getEntitiesMenu() {\n        this.checkEntitiesMenu();\n        return this.entitiesMenu;\n    }\n    getConditionMenu() {\n        return this.conditionMenu;\n    }\n    getLinkTypeMenu() {\n        return this.linkTypeMenu;\n    }\n    getConditionGroupMenu(isRoot = false) {\n        return isRoot ? this.rootGroupMenu : this.groupMenu;\n    }\n    attachQueryObserver() {\n        const query = this.getQuery();\n        this.queryEventCallbackId = query.addChangedCallback(event => {\n            //if something has changed, and that change is related to conditions\n            const edata = event.data;\n            if (!edata || (edata.part != QueryChangePart.Conditions && edata.part != QueryChangePart.All)) {\n                return;\n            }\n            const focusedBefore = document.activeElement;\n            const isFocusInside = this.slot.contains(focusedBefore) || focusedBefore == document.body;\n            switch (edata.action) {\n                case QueryChangeAction.Modify: {\n                    const conds = edata.changee;\n                    const modifyCondition = (cond, autoEdit) => {\n                        const el = this.slot.querySelector(`div[data-id=${cond.id}]`);\n                        if (el) {\n                            autoEdit = autoEdit\n                                && ((edata.condPart & ConditionPart.Operator) === ConditionPart.Operator)\n                                && cond.expressions.length > 1\n                                && (cond.expressions[1]._isDefaultValue || cond.expressions[1].value == '' ||\n                                    cond.expressions[1].value == null);\n                            const isActive = el.classList.contains('active');\n                            const renderer = this.getConditionRenderer(cond, el);\n                            if (renderer) {\n                                const newEl = renderer.render(autoEdit);\n                                if (isActive) {\n                                    this.toggleConditionPicked(cond);\n                                }\n                                if (isFocusInside && !autoEdit) {\n                                    const focusElem = newEl.querySelector('a') || newEl.querySelector('.eqjs-qp-condition-button');\n                                    if (focusElem) {\n                                        safeFocus(focusElem);\n                                    }\n                                }\n                            }\n                        }\n                    };\n                    let autoEdit = this.options.autoEditNewCondition && !browserUtils.isMobileMode();\n                    if (Array.isArray(conds)) {\n                        conds.forEach((cond) => modifyCondition(cond, autoEdit));\n                        autoEdit = false;\n                    }\n                    else {\n                        modifyCondition(conds, autoEdit);\n                    }\n                    break;\n                }\n                case QueryChangeAction.Add: {\n                    const conds = edata.changee;\n                    const addCondition = (cond) => {\n                        const renderer = this.getConditionRenderer(cond);\n                        if (renderer) {\n                            const parent = cond.getParent();\n                            const parentEl = this.slot.querySelector(`div[data-id=${parent.id}]`);\n                            if (parentEl) {\n                                const newCondContainer = parentEl.lastChild;\n                                if (newCondContainer) {\n                                    const el = renderer.render(this.options.autoEditNewCondition && !browserUtils.isMobileMode());\n                                    newCondContainer.appendChild(el);\n                                    el.scrollIntoView(false);\n                                    if (isFocusInside && (!this.options.autoEditNewCondition || browserUtils.isMobileMode())) {\n                                        el.querySelector(`a`).focus();\n                                    }\n                                }\n                            }\n                        }\n                    };\n                    if (Array.isArray(conds)) {\n                        conds.forEach((cond) => addCondition(cond));\n                    }\n                    else {\n                        addCondition(conds);\n                    }\n                    break;\n                }\n                case QueryChangeAction.Delete: {\n                    const conds = edata.changee;\n                    const deleteCondition = (cond) => {\n                        const el = this.slot.querySelector(`div[data-id=${cond.id}]`);\n                        if (el) {\n                            const parent = this.slot.querySelector(`div[data-id=${cond.getParent().id}] > .eqjs-qp-row-group`);\n                            const next = el.nextSibling;\n                            const prev = el.previousSibling;\n                            el.parentElement.removeChild(el);\n                            if (isFocusInside) {\n                                const focusCond = next || prev || parent;\n                                const focusElem = focusCond.querySelector('a') || focusCond.querySelector('.eqjs-qp-condition-button');\n                                if (focusElem) {\n                                    focusElem.focus();\n                                }\n                            }\n                        }\n                    };\n                    if (Array.isArray(conds)) {\n                        conds.forEach((cond) => deleteCondition(cond));\n                    }\n                    else {\n                        deleteCondition(conds);\n                    }\n                    break;\n                }\n                default:\n                    this.refresh();\n                    break;\n            }\n        });\n    }\n    detachQueryObserver() {\n        if (this.queryEventCallbackId) {\n            const query = this.getQuery();\n            query.removeChangedCallback(this.queryEventCallbackId);\n        }\n    }\n    getQuery() {\n        if (this.customQuery) {\n            return this.customQuery;\n        }\n        return this.context.getQuery();\n    }\n    /**\n     * Gets `true` if the query panel is in read-only mode. Otherwise - `false`.\n     */\n    isReadOnly() {\n        return (this.options.editableParts == QPEditablePart.None);\n    }\n    /**\n     * Gets `true` if the query panel is in FixedList edit mode. Otherwise - `false`.\n     */\n    isFixed() {\n        return this.options.editableParts < QPEditablePart.Attribute;\n    }\n    /**\n     * Gets or sets the current edit mode. When setting, automatically refreshes the widget.\n     */\n    get editMode() {\n        return this.options.editMode || ConditionsEditMode.Default;\n    }\n    set editMode(value) {\n        if (this.options.editMode !== value) {\n            this.options.editMode = value;\n            this.convertEditModelToEditableParts();\n            this.refresh();\n        }\n    }\n    refreshCore() {\n        this.clear();\n        this.render();\n    }\n    setOptions(options) {\n        utils.assignDeep(this.options, options);\n        // dateFormatValue & dateFormatDisplay back compatibility\n        if (this.options.dateFormatValue) {\n            i18n.updateLocaleSettings({\n                editDateFormat: this.options.dateFormatValue\n            });\n        }\n        if (this.options.dateFormatDisplay) {\n            i18n.updateLocaleSettings({\n                shortDateFormat: this.options.dateFormatDisplay\n            });\n        }\n        if (typeof this.options.editableParts === \"undefined\") {\n            this.options.editableParts = QPEditablePart.All;\n        }\n        if (browserUtils.isMobileMode()) {\n            this.options.buttons = this.options.buttons || {};\n            this.options.buttons.condition = [\"menu\"];\n            this.options.buttons.group = [\"menu\"];\n        }\n    }\n    clear() {\n        this.slot.innerHTML = \"\";\n    }\n    render() {\n        try {\n            this.checkEntitiesMenu();\n            this.createConditionMenus();\n            this.createLinkTypeMenu();\n            this.rootContainer = domel('div', this.slot)\n                .toDOM();\n            domel(this.slot)\n                .removeClass(eqCssMobile)\n                .addClass(getMobileCssClass());\n            const query = this.getQuery();\n            const root = query.getRootCondition();\n            const renderer = this.getConditionRenderer(root, this.rootContainer);\n            if (renderer) {\n                renderer.render();\n            }\n            if (this.options.showAddRow && (this.options.editableParts & QPEditablePart.Addition) == QPEditablePart.Addition) {\n                this.addRowElement = domel('div', this.slot)\n                    .toDOM();\n                const addrowRenderer = this.getAddRowRenderer(this.addRowElement);\n                if (addrowRenderer)\n                    addrowRenderer.render();\n            }\n        }\n        catch (err) {\n            const error = err;\n            this.context.throwError({\n                action: \"QueryPanel rendering\",\n                text: error.message,\n                sourceError: error\n            });\n        }\n    }\n    getConditionRenderer(condition, slot) {\n        let renderer;\n        if (this.options.onGetConditionRenderer) {\n            renderer = this.options.onGetConditionRenderer(condition, slot);\n            if (renderer) {\n                return renderer;\n            }\n        }\n        switch (condition.tag) {\n            case CondTag.Simple:\n                return new SimpleConditionRenderer(this, condition, slot);\n            case CondTag.Group:\n                return new ConditionGroupRenderer(this, condition, slot);\n        }\n        return null;\n    }\n    getExpressionRenderer(expression, slot) {\n        if (!expression) {\n            throw 'Expression is not defined in the condition';\n        }\n        const model = this.getContext().getModel();\n        const condition = expression.getParent();\n        const operator = model.getOperatorById(condition.getOperatorId());\n        const attribute = model.getAttributeByIdSafe(condition.expressions[0].value);\n        const operand = model.getOperand(attribute, operator, expression.getIndex());\n        let editor;\n        let tag;\n        if (operand && operand.editor && operand.editor.tag !== EqEditorTag.Unknown) {\n            editor = operand.editor;\n        }\n        else if (attribute && attribute.defaultEditor) {\n            editor = attribute.defaultEditor;\n        }\n        else {\n            editor = new EqValueEditor();\n        }\n        tag = editor.tag;\n        let exprType = expression.dataType;\n        if (exprType == DataType.Unknown) {\n            exprType = attribute.dataType;\n        }\n        if (expression.kind === DataKind.Attribute) {\n            if (expression.getIndex() === 0) { // Base attribute expression\n                return new AttributeExpressionRenderer(this, expression, this.entitiesMenu, slot);\n            }\n            else {\n                let attributeMenu = this.createEntitiesMenu((ent, attr) => {\n                    if (attr) {\n                        return attr.useInConditions && attr.dataType === exprType;\n                    }\n                    return true;\n                });\n                return new AttributeExpressionRenderer(this, expression, attributeMenu, slot);\n            }\n        }\n        else if (expression.kind === DataKind.Query) {\n            tag = EqEditorTag.SubQuery;\n        }\n        else if (expression.kind === DataKind.Scalar) {\n            if (tag == EqEditorTag.Unknown && (expression.dataType === DataType.Date\n                || expression.dataType === DataType.DateTime || expression.dataType === DataType.Time)) {\n                tag = EqEditorTag.DateTime;\n            }\n        }\n        else if (expression.kind == DataKind.ParentColumn) {\n            tag = EqEditorTag.BindToParentColumn;\n        }\n        if (this.options.onGetExpressionRenderer) {\n            let renderer = this.options.onGetExpressionRenderer(this, expression, editor, slot);\n            if (renderer) {\n                return renderer;\n            }\n        }\n        switch (tag) {\n            case EqEditorTag.List:\n                return new ListExpressionRenderer(this, expression, editor, slot);\n            case EqEditorTag.SqlList:\n                return new SqlListExpressionRenderer(this, expression, editor, slot);\n            case EqEditorTag.CustomList:\n                return new CustomListExpressionRenderer(this, expression, editor, slot);\n            case EqEditorTag.DateTime:\n                return new DateTimeExpressionRenderer(this, expression, editor, slot);\n            case EqEditorTag.SubQuery:\n                return new SubQueryExpressionRenderer(this, expression, editor, slot);\n            //move to ERS later\n            case EqEditorTag.BindToParentColumn:\n                return new BindToParentColumnExpressionRenderer(this, expression, editor, slot);\n            default:\n                return new InputExpressionRenderer(this, expression, editor, slot);\n        }\n    }\n    getOperatorRenderer(condition, text, slot) {\n        let renderer;\n        if (this.options.onGetOperatorRenderer)\n            renderer = this.options.onGetOperatorRenderer(condition, text, slot);\n        if (renderer)\n            return renderer;\n        return new OperatorRenderer(this, condition, text, slot);\n    }\n    getAddRowRenderer(slot) {\n        let renderer;\n        if (this.options.onGetAddRowRenderer)\n            renderer = this.options.onGetAddRowRenderer(slot);\n        if (renderer)\n            return renderer;\n        return new AddRowRenderer(this, this.entitiesMenu, slot);\n    }\n    createEntitiesMenu(filterFunc) {\n        const model = this.getContext().getModel();\n        if (!model || model.isEmpty())\n            return null;\n        let menuId = this.slot.id || \"eq-querypanel\";\n        menuId += '-EntitiesMenu';\n        const entitiesList = model.getEntitiesTree({\n            addUIC: true,\n            addUIR: false,\n            addUIS: false,\n            attrPlacement: this.options.attrPlacement,\n            sortEntities: this.options.sortEntities\n        }, filterFunc);\n        const options = {\n            items: entitiesList,\n            adjustHeight: this.options.adjustEntitiesMenuHeight,\n            id: menuId,\n            domWriteItemsId: this.options.domWriteItemsId\n        };\n        utils.assign(options, this.options.menuOptions);\n        return new PopupMenu(options);\n    }\n    checkEntitiesMenu() {\n        if (!this.entitiesMenu) {\n            this.entitiesMenu = this.createEntitiesMenu();\n        }\n    }\n    showEntitiesMenu(options) {\n        this.checkEntitiesMenu();\n        this.entitiesMenu.showMenu(Object.assign({}, this.options.menuOptions, options));\n    }\n    createConditionMenus() {\n        //ConditionMenu\n        {\n            const query = this.getQuery();\n            let menuId = this.slot.id || \"eq-querypanel\";\n            menuId += '-ConditionMenu';\n            const items = [\n                {\n                    id: \"enable\",\n                    text: i18n.getText('MenuEnable')\n                },\n                {\n                    id: \"delete\",\n                    text: i18n.getText('CmdDelete')\n                }\n            ];\n            if (query.isEx()) {\n                if (this.options.allowParameterization || this.options.allowInJoinConditions) {\n                    items.push({ id: \"delimiter\", text: \"---\" });\n                }\n                if (this.options.allowParameterization) {\n                    items.push({\n                        id: \"param\",\n                        text: i18n.getText('MenuParameterization')\n                    });\n                }\n                if (this.options.allowInJoinConditions) {\n                    items.push({\n                        id: \"inJoin\",\n                        text: i18n.getText('MenuJoinCond')\n                    });\n                }\n            }\n            const options = { items: items, adjustHeight: this.options.adjustEntitiesMenuHeight, id: menuId, domWriteItemsId: this.options.domWriteItemsId, showSearchBoxAfter: 100, showSelected: true };\n            utils.assign(options, this.options.menuOptions);\n            this.conditionMenu = new PopupMenu(options);\n        }\n        //groupMenu\n        {\n            let menuId = this.slot.id || \"eq-querypanel\";\n            menuId += '-GroupMenu';\n            const items = [\n                {\n                    id: \"enable\",\n                    text: i18n.getText('MenuEnable')\n                },\n                {\n                    id: \"delete\",\n                    text: i18n.getText('CmdDelete')\n                },\n                {\n                    id: \"delimiter\",\n                    text: \"---\"\n                },\n                {\n                    id: \"addCondition\",\n                    text: i18n.getText('CmdAddCondition')\n                },\n                {\n                    id: \"addGroup\",\n                    text: i18n.getText('CmdAddCondGroup')\n                }\n            ];\n            const options = { items: items, adjustHeight: this.options.adjustEntitiesMenuHeight, id: menuId, domWriteItemsId: this.options.domWriteItemsId, showSearchBoxAfter: 100, showSelected: true };\n            utils.assign(options, this.options.menuOptions);\n            this.groupMenu = new PopupMenu(options);\n        }\n        //rootGroupMenu\n        {\n            let menuId = this.slot.id || \"eq-querypanel\";\n            menuId += '-RootGroupMenu';\n            const items = [\n                {\n                    id: \"addCondition\",\n                    text: i18n.getText('CmdAddCondition')\n                },\n                {\n                    id: \"addGroup\",\n                    text: i18n.getText('CmdAddCondGroup')\n                }\n            ];\n            const options = { items: items, adjustHeight: this.options.adjustEntitiesMenuHeight, id: menuId, domWriteItemsId: this.options.domWriteItemsId, showSearchBoxAfter: 100, showSelected: true };\n            utils.assign(options, this.options.menuOptions);\n            this.rootGroupMenu = new PopupMenu(options);\n        }\n    }\n    createLinkTypeMenu() {\n        let menuId = this.slot.id;\n        if (menuId) {\n            menuId += '-LinkTypeMenu';\n        }\n        const typeList = eqconsts.predicateLinkTypeList;\n        const itemList = typeList.map((item) => {\n            return {\n                id: item.id,\n                text: i18n.getText(item.key)\n            };\n        });\n        const options = { items: itemList, adjustHeight: this.options.adjustEntitiesMenuHeight, id: menuId, domWriteItemsId: this.options.domWriteItemsId };\n        utils.assign(options, this.options.menuOptions);\n        this.linkTypeMenu = new PopupMenu(options);\n    }\n    toggleConditionPicked(condition, force = undefined) {\n        let el;\n        let isActive;\n        if (condition) {\n            el = this.slot.querySelector(`div[data-id=${condition.id}][data-condrow], div[data-id=${condition.id}] > div[data-group-row]`);\n            if (el) {\n                isActive = el.classList.contains('active');\n            }\n        }\n        //clear 'active' in all rows\n        const rows = this.slot.querySelectorAll(`.${this.cssPrefix}-row`);\n        for (let i = 0; i < rows.length; i++) {\n            const row = rows[i];\n            if (row.hasAttribute('data-group-row')) {\n                if (!this.options.alwaysShowButtonsInGroups) {\n                    domel(row)\n                        .data(\"show-buttons\", null);\n                }\n            }\n            else {\n                if (!this.options.alwaysShowButtonsInConditions) {\n                    domel(row)\n                        .data(\"show-buttons\", null);\n                }\n            }\n            domel(row)\n                .removeClass('active');\n        }\n        if (el && !isActive) {\n            domel(el)\n                .addClass('active')\n                .data(\"show-buttons\", \"\");\n        }\n    }\n    showLandingSlot() {\n        const container = this.slot.querySelector('.eqjs-qp-conditions-root');\n        if (container) {\n            container.appendChild(this.landingSlot);\n            this.landingSlot.scrollIntoView({ block: \"center\", behavior: \"smooth\" });\n        }\n    }\n    hideLangindSlot() {\n        if (this.landingSlot.parentElement) {\n            this.landingSlot.parentElement.removeChild(this.landingSlot);\n        }\n    }\n    onProcessStartCore() {\n        if (this.options.showIndicatorOnLoad) {\n            if (!this.progressBlock.parentNode)\n                this.slot.appendChild(this.progressBlock);\n        }\n    }\n    onProcessEndCore() {\n        if (this.options.showIndicatorOnLoad) {\n            if (this.progressBlock.parentNode)\n                this.slot.removeChild(this.progressBlock);\n        }\n    }\n    renderProgressBlock() {\n        this.progressBlock = document.createElement('div');\n        this.progressBlock.classList.add(`${eqCssPrefix}-progress-win8`);\n        this.progressBlock.classList.add(getMobileCssClass());\n        this.progressBlock.innerHTML = '<div class=\"wBall\" id=\"wBall_1\"><div class=\"wInnerBall\"></div></div><div class=\"wBall\" id=\"wBall_2\"><div class=\"wInnerBall\"></div></div><div class=\"wBall\" id=\"wBall_3\"><div class=\"wInnerBall\"></div></div><div class=\"wBall\" id=\"wBall_4\"><div class=\"wInnerBall\"></div></div><div class=\"wBall\" id=\"wBall_5\"><div class=\"wInnerBall\"></div></div>';\n    }\n    clonePanel(slot, query) {\n        return new QueryPanel(slot, query);\n    }\n}\n\nclass FilterBar extends Widget {\n    constructor(slot) {\n        super(slot);\n        this.options = {\n            applyOnClose: true,\n            showApplyButton: true,\n            showClearButton: true,\n            queryPanel: {\n                showAddRow: true,\n                showCheckboxes: true,\n                alwaysShowButtonsInGroups: true\n            }\n        };\n        this.headerClickListener = this.headerClickHandler.bind(this);\n        this.group = WidgetGroup.Query;\n    }\n    getWidgetType() {\n        return 'filterBar';\n    }\n    get cssPrefix() {\n        return 'eqjs-fb';\n    }\n    init(context, options) {\n        super.init(context, options);\n        this.setOptions(options);\n        this.destroyCore();\n        this.qpElement = domel('div')\n            .addClass(`${this.cssPrefix}-querypanel`)\n            .toDOM();\n        this.queryPanel = new QueryPanel(this.qpElement);\n        this.queryPanel.init(context, this.options.queryPanel || {});\n        this.attachQueryObserver();\n    }\n    setOptions(options) {\n        this.options = utils.assignDeep(this.options, options);\n    }\n    applyBtnClick(ev) {\n        this.applyFilter();\n    }\n    clearBtnClick(ev) {\n        this.clearFilter();\n    }\n    showQueryPanel(callback) {\n        slideDown(this.qpBlock, 200, () => {\n            this.updateHeader();\n            if (callback)\n                callback();\n        });\n    }\n    hideQueryPanel() {\n        slideUp(this.qpBlock, 200, () => {\n            this.updateHeader();\n            if (this.options.applyOnClose) {\n                this.applyFilter();\n            }\n        });\n    }\n    headerClickHandler(ev) {\n        ev.preventDefault();\n        if (domel(this.qpBlock).isVisible()) { // close query panel\n            this.hideQueryPanel();\n        }\n        else { //open query panel\n            this.showQueryPanel();\n        }\n    }\n    updateHeader() {\n        if (!this.headerTextElement)\n            return;\n        let text = '';\n        const query = this.getContext().getQuery();\n        if (query) {\n            text = query.getConditionsText();\n        }\n        if (text == '') {\n            text = i18n.getText('StrNoFilterDefined');\n        }\n        domel(this.headerTextElement)\n            .text(text)\n            .attr('title', text);\n        if (!query || query.isEmptyConditions()) { //empty query, don't show query panel and arrow, show a link in the header\n            domel(this.headerTextElement).hide();\n            domel(this.headerLinkElement).show();\n            if (!domel(this.qpBlock).isVisible()) {\n                domel(this.headerArrowBlock).hide();\n                this.headerElement.style.cursor = '';\n                this.headerElement.removeEventListener('click', this.headerClickListener);\n            }\n        }\n        else {\n            this.headerElement.style.cursor = 'pointer';\n            this.headerElement.removeEventListener('click', this.headerClickListener);\n            this.headerElement.addEventListener('click', this.headerClickListener);\n            domel(this.headerTextElement).show();\n            domel(this.headerLinkElement).hide();\n            domel(this.headerArrowBlock).show();\n        }\n        if (domel(this.qpBlock).isVisible()) { // close query panel\n            this.headerArrowElement.classList.add(`${this.cssPrefix}-header-arrowUp`);\n        }\n        else {\n            this.headerArrowElement.classList.remove(`${this.cssPrefix}-header-arrowUp`);\n        }\n        this.textResize();\n    }\n    render() {\n        this.slot.innerHTML = '';\n        domel(this.slot)\n            .addClass(`${this.cssPrefix}-container`)\n            .addClass(getMobileCssClass())\n            .addChild('div', builder => this.headerElement = builder\n            .addClass(`${this.cssPrefix}-header`)\n            .addChild('div', builder => this.headerIconElement = builder\n            .addClass(`${this.cssPrefix}-header-icon`)\n            .toDOM())\n            .addChild('div', builder => this.headerTextBlock = builder\n            .addClass(`${this.cssPrefix}-header-textblock`)\n            .addChild('div', builder => this.headerTextElement = builder\n            .addClass(`${this.cssPrefix}-header-text`)\n            .toDOM())\n            .addChild('div', builder => this.headerLinkElement = builder\n            .addClass(`${this.cssPrefix}-header-text ${this.cssPrefix}-header-link`)\n            .text(i18n.getText('StrNoFilterClickToAdd'))\n            .hide()\n            .on('click', () => {\n            this.queryPanel.showEntitiesMenu({\n                anchor: this.headerLinkElement,\n                selectedIds: null,\n                itemSelectedCallback: (item, items) => {\n                    const attrid = item.id;\n                    this.showQueryPanel(() => {\n                        const query = this.getContext().getQuery();\n                        const descr = {\n                            parent: query.getRootCondition(),\n                            attributeId: attrid\n                        };\n                        const cond = query.addSimpleCondition(descr);\n                        if (cond) {\n                            query.fireConditionsChangedEvent(QueryChangeAction.Add, cond);\n                        }\n                    });\n                }\n            });\n        })\n            .toDOM())\n            .toDOM())\n            .addChild('div', builder => this.headerArrowBlock = builder\n            .addClass(`${this.cssPrefix}-header-arrowblock`)\n            .addChild('div', builder => this.headerArrowElement = builder\n            .addClass(`${this.cssPrefix}-header-arrow`)\n            .toDOM())\n            .toDOM())\n            .toDOM())\n            .addChild('div', builder => this.qpBlock = builder\n            .addClass(`${this.cssPrefix}-querypanelblock`)\n            .addClass(getMobileCssClass())\n            .hide()\n            .addChildElement(this.qpElement)\n            .toDOM());\n        if (this.options.showApplyButton || this.options.showClearButton) {\n            this.buttonsBlock = domel('div', this.qpBlock)\n                .addClass(`${this.cssPrefix}-buttonsblock`)\n                .addClass(getMobileCssClass())\n                .toDOM();\n        }\n        if (this.options.showApplyButton) {\n            domel('a', this.buttonsBlock)\n                .attr('href', 'javascript:void(0)')\n                .addClass(`${this.cssPrefix}-button ${this.cssPrefix}-button-apply`)\n                .text(i18n.getText('ButtonApply'))\n                .on('click', this.applyBtnClick.bind(this));\n        }\n        if (this.options.showClearButton) {\n            domel('a', this.buttonsBlock)\n                .attr('href', 'javascript:void(0)')\n                .addClass(`${this.cssPrefix}-button ${this.cssPrefix}-button-clear`)\n                .text(i18n.getText('CmdClear'))\n                .on('click', this.clearBtnClick.bind(this));\n        }\n        window.addEventListener('resize', () => {\n            this.textResize();\n        });\n        this.updateHeader();\n        this.queryPanel.refresh();\n    }\n    refreshCore() {\n        this.clear();\n        this.render();\n    }\n    clear() {\n        this.slot.innerHTML = '';\n    }\n    applyFilter() {\n        if (this.options.applyFilterCallback) {\n            this.options.applyFilterCallback();\n        }\n    }\n    clearFilter() {\n        const query = this.getContext().getQuery();\n        if (query) {\n            query.clearConditions();\n            query.fireConditionsChangedEvent(QueryChangeAction.All);\n        }\n    }\n    textResize() {\n        // this.headerTextBlock.style.width = (this.slot.clientWidth - this.headerIconElement.offsetWidth \n        // - (domel(this.headerArrowBlock).isVisible() ? this.headerArrowBlock.offsetWidth : 0)) + \"px\";\n    }\n    destroyCore() {\n        if (this.queryPanel)\n            this.queryPanel.destroy();\n        this.detachQueryObserver();\n        this.slot.innerHTML = '';\n    }\n    attachQueryObserver() {\n        const query = this.getContext().getQuery();\n        this.queryEventCallbackId = query.addChangedCallback(event => {\n            if (this.headerElement) {\n                this.updateHeader();\n            }\n            else {\n                this.render();\n            }\n        });\n    }\n    detachQueryObserver() {\n        const query = this.getContext().getQuery();\n        if (query)\n            query.removeChangedCallback(this.queryEventCallbackId);\n    }\n}\n\n/**\n * The widget responsed for rendering html content\n */\nclass HtmlContentWidget extends Widget {\n    /**\n     * The default constructor.\n     * @param slot The html element.\n     */\n    constructor(slot) {\n        super(slot);\n        this.contentElement = slot;\n        this.group = WidgetGroup.Result;\n    }\n    getWidgetType() {\n        return 'htmlContent';\n    }\n    /**\n     * Initialize widget.\n     * @param context The context.\n     * @param options The options.\n     */\n    init(context, options) {\n        super.init(context, options);\n    }\n    /**\n     * Refresh widget implementation\n     */\n    refreshCore() {\n        this.clear();\n        if (!this.context.resultContent)\n            return;\n        this.render();\n    }\n    /**\n     * Renders widget\n     */\n    render() {\n        if (this.context.resultContent) {\n            this.contentElement.innerHTML += this.context.resultContent;\n        }\n    }\n    /**\n     * Clears content.\n     */\n    clear() {\n        this.contentElement.innerHTML = \"\";\n    }\n    destroyCore() {\n        this.clear();\n    }\n}\n\n/**\n * The widget responsed for rendering html grid.\n */\nclass EqHtmlGrid extends HtmlContentWidget {\n    /**\n    * The default constructor.\n    * @param slot The html element.\n    */\n    constructor(slot) {\n        super(slot);\n        this.options = {\n            maxButtonCount: 10,\n            useBootstrap: false\n        };\n    }\n    getWidgetType() {\n        return 'eqHtmlGrid';\n    }\n    /**\n     * Initialize widget.\n     * @param context The context.\n     * @param options The options.\n     */\n    init(context, options) {\n        super.init(context, options);\n        this.setOptions(options);\n    }\n    setOptions(options) {\n        utils.assignDeep(this.options, options);\n    }\n    /**\n     * Refresh widget implementation\n     */\n    refreshCore() {\n        super.refreshCore();\n        this.renderPageNavigator();\n    }\n    destroyCore() {\n        this.slot.innerHTML = '';\n    }\n    /**\n     * Renders page navigator.\n     */\n    renderPageNavigator() {\n        const pageNavigatorPlaceholder = document.getElementById(\"PageNavigator\");\n        if (!pageNavigatorPlaceholder) {\n            return;\n        }\n        const pageCount = parseInt(pageNavigatorPlaceholder.getAttribute('data-pagecount'));\n        const pageIndex = parseInt(pageNavigatorPlaceholder.getAttribute('data-pageindex'));\n        if (pageCount > 1) {\n            let buttonClick = (ev) => {\n                let element = ev.target;\n                if (element.hasAttribute('data-page')) {\n                    const pageNum = parseInt(element.getAttribute('data-page'));\n                    this.context.fetchDataChunk({\n                        chunk: {\n                            page: pageNum\n                        },\n                        success: () => {\n                            this.context.refreshWidgets(WidgetGroup.Result);\n                        }\n                    });\n                }\n            };\n            const maxButtonCount = this.options.maxButtonCount || 10;\n            const zeroBasedIndex = pageIndex - 1;\n            let firstPageIndex = zeroBasedIndex - (zeroBasedIndex % maxButtonCount) + 1;\n            let lastPageIndex = firstPageIndex + maxButtonCount - 1;\n            if (lastPageIndex > pageCount) {\n                lastPageIndex = pageCount;\n            }\n            let ul = document.createElement('ul');\n            if (this.options.useBootstrap) {\n                ul.className = \"pagination\";\n            }\n            else {\n                ul.className = \"eqv-pagination\";\n            }\n            if (this.options.pageItemCssClass) {\n                ul.className += \" \" + (this.options.pageItemCssClass);\n            }\n            let li = document.createElement('li');\n            if (this.options.useBootstrap) {\n                li.className = \"page-item\";\n            }\n            let a = document.createElement('span');\n            a.setAttribute(\"aria-hidden\", 'true');\n            if (this.options.useBootstrap) {\n                a.className = \"page-link\";\n            }\n            if (firstPageIndex == 1) {\n                li.className += \" disabled\";\n            }\n            else {\n                if (this.options.useBootstrap) {\n                    a = document.createElement('a');\n                    a.setAttribute('href', 'javascript:void(0)');\n                    a.setAttribute(\"data-page\", `${firstPageIndex - 1}`);\n                    a.className = \"page-link\";\n                }\n                else {\n                    let newA = document.createElement('a');\n                    newA.setAttribute('href', 'javascript:void(0)');\n                    newA.setAttribute(\"data-page\", `${firstPageIndex - 1}`);\n                    a = newA;\n                }\n                a.addEventListener(\"click\", buttonClick);\n            }\n            a.innerHTML = \"&laquo;\";\n            li.appendChild(a);\n            ul.appendChild(li);\n            for (let i = firstPageIndex; i <= lastPageIndex; i++) {\n                li = document.createElement('li');\n                if (this.options.useBootstrap) {\n                    li.className = \"page-item\";\n                }\n                if (i == pageIndex)\n                    li.className += \" active\";\n                a = document.createElement('a');\n                a.setAttribute('href', 'javascript:void(0)');\n                a.innerHTML = i.toString();\n                a.setAttribute('data-page', i.toString());\n                a.className = \"page-link\";\n                a.addEventListener(\"click\", buttonClick);\n                li.appendChild(a);\n                ul.appendChild(li);\n            }\n            li = document.createElement('li');\n            if (this.options.useBootstrap) {\n                li.className = \"page-item\";\n            }\n            a = document.createElement(\"span\");\n            a.setAttribute('aria-hidden', 'true');\n            if (this.options.useBootstrap) {\n                a.className = \"page-link\";\n            }\n            if (lastPageIndex == pageCount) {\n                li.className += \"disabled\";\n            }\n            else {\n                if (this.options.useBootstrap) {\n                    a = document.createElement('a');\n                    a.setAttribute('href', 'javascript:void(0)');\n                    a.setAttribute(\"data-page\", `${lastPageIndex + 1}`);\n                    a.className += \" page-link\";\n                }\n                else {\n                    let newA = document.createElement('a');\n                    newA.setAttribute('href', 'javascript:void(0)');\n                    newA.setAttribute(\"data-page\", `${lastPageIndex + 1}`);\n                    a = newA;\n                }\n                a.addEventListener(\"click\", buttonClick);\n            }\n            a.innerHTML = \"&raquo;\";\n            li.appendChild(a);\n            ul.appendChild(li);\n            pageNavigatorPlaceholder.appendChild(ul);\n        }\n    }\n}\n\n/**\n * Base class for GRID.\n */\nclass Grid extends Widget {\n    /**\n     * The default constructor.\n     * @param slot The html element.\n     */\n    constructor(slot) {\n        super(slot);\n        this.options = {\n            useCustomLocaleSettings: false\n        };\n        this.slot = slot;\n        this.group = WidgetGroup.Result;\n    }\n    getWidgetType() {\n        return 'grid';\n    }\n    /**\n     * Initialize widget.\n     * @param context The context.\n     * @param options The options.\n     */\n    init(context, options) {\n        super.init(context, options);\n        if (options) {\n            utils.assignDeep(this.options, options);\n        }\n    }\n    /**\n     * Refresh widget implementation\n     */\n    refreshCore() {\n        this.clear();\n        if (!this.context.resultTable) {\n            return;\n        }\n        this.render();\n    }\n    /**\n     * Renders widget\n     */\n    render() {\n        if (this.options.beforeTableRendering) {\n            this.options.beforeTableRendering(this.context.resultTable);\n        }\n        this.applyDisplayFormats();\n    }\n    applyDisplayFormats() {\n    }\n    /**\n     * Clears GRID.\n     */\n    clear() {\n        this.slot.innerHTML = \"\";\n    }\n}\n\nclass EasyGridWidget extends Grid {\n    /**\n     * The default constructor.\n     * @param slot The html element.\n     */\n    constructor(slot) {\n        super(slot);\n        this.hasCustomTotalsSettings = false;\n        //!!!! DO NOT forget to add types for options\n        this.options = { autoRefresh: true };\n        this.group = WidgetGroup.Result;\n    }\n    getWidgetType() {\n        return 'easyGrid';\n    }\n    /**\n     * Initialize widget.\n     * @param context The context.\n     * @param options The options.\n     */\n    init(context, options) {\n        var _a, _b;\n        super.init(context, options);\n        const gridOptions = Object.assign(Object.assign(Object.assign(Object.assign({}, (_a = context.options.widgets) === null || _a === void 0 ? void 0 : _a.resultGrid), (_b = context.options.widgets) === null || _b === void 0 ? void 0 : _b.easyGrid), options), { slot: this.slot, dataTable: context.resultTable });\n        this.options = utils.assign(this.options, gridOptions);\n        gridOptions.onPlusButtonClick = (ev) => this.addColumnClickHandler(ev);\n        gridOptions.onColumnMoved = (ev) => this.columnMovedHandler(ev);\n        if (gridOptions.aggregates) {\n            this.hasCustomTotalsSettings = true;\n        }\n        else {\n            gridOptions.aggregates = { settings: context.getQuery().getAggregationSettings(), calculatorRef: null };\n        }\n        gridOptions.aggregates.calculatorRef = this.context.getAggregatesCalculator();\n        this.destroy();\n        this.grid = new EasyGrid(gridOptions);\n        if (this.options.autoRefresh) {\n            this.attachQueryObserver();\n        }\n    }\n    refreshCore() {\n        this.clear();\n        this.updateTotalsSettings();\n        this.render();\n    }\n    render() {\n        this.createEntitiesMenu();\n        this.grid.refresh();\n    }\n    attachQueryObserver() {\n    }\n    destroyCore() {\n        this.detachQueryObserver();\n        if (this.grid)\n            this.grid.destroy();\n        this.slot.innerHTML = '';\n    }\n    detachQueryObserver() {\n        if (this.queryEventCallbackId) {\n            const query = this.getContext().getQuery();\n            query.removeChangedCallback(this.queryEventCallbackId);\n        }\n    }\n    updateTotalsSettings() {\n        const context = this.getContext();\n        if (!this.hasCustomTotalsSettings) {\n            const settings = context.getQuery().getAggregationSettings();\n            this.grid.options.aggregates.settings = settings;\n        }\n    }\n    createEntitiesMenu() {\n        const model = this.getContext().getModel();\n        if (!model || model.isEmpty())\n            return;\n        let menuId = this.slot.id;\n        if (menuId) {\n            menuId += '-EntitiesMenu';\n        }\n        const entitiesList = model.getEntitiesTree({ addUIC: false, addUIR: true, addUIS: false });\n        const options = { items: entitiesList, id: menuId };\n        utils.assign(options, this.options.menuOptions);\n        this.entitiesMenu = new PopupMenu(options);\n    }\n    getModel() {\n        return this.context.getModel();\n    }\n    getQuery() {\n        return this.context.getQuery();\n    }\n    clear() {\n        if (this.grid)\n            this.grid.clear();\n    }\n    addColumnClickHandler(ev) {\n        this.entitiesMenu.showMenu({\n            anchor: ev.sourceEvent.target,\n            selectedIds: null,\n            itemSelectedCallback: (data, items) => {\n                const attrid = data.id;\n                this.addNewColumn(attrid);\n                return false;\n            }\n        });\n    }\n    columnMovedHandler(ev) {\n        const query = this.getQuery();\n        const oldIndex = utils.findItemIndexById(query.getColumns(), ev.columnId);\n        if (oldIndex >= 0) {\n            query.moveColumn(oldIndex, ev.newIndex);\n            query.fireChangedEvent({\n                part: QueryChangePart.Columns,\n                action: QueryChangeAction.All,\n                source: this\n            });\n        }\n    }\n    addNewColumn(attrId) {\n        this.getContext().getModel();\n        const query = this.getContext().getQuery();\n        const col = query.addColumn({\n            attributeId: attrId\n        }, true);\n        query.fireChangedEvent({\n            part: QueryChangePart.Columns,\n            action: QueryChangeAction.Add,\n            changee: col,\n            source: this\n        });\n        return col;\n    }\n}\n\n/**\n * The widget responsed for rendering statement.\n * It's usually added for demonstration purposes only.\n */\nclass StatementPanel extends Widget {\n    /**\n     * The  default constructor.\n     * @param slot The html element.\n     */\n    constructor(slot) {\n        super(slot);\n        this.panel = slot;\n        this.group = WidgetGroup.Statement;\n        if (this.panel.tagName !== \"TEXTAREA\") {\n            this.panel.innerHTML = '<div class=\"eqv-sql-panel-result\"></div>';\n            this.panel = this.panel.querySelector('div');\n        }\n    }\n    getWidgetType() {\n        return 'statementPanel';\n    }\n    /**\n     * Refresh widget implementation\n     */\n    refreshCore() {\n        this.clear();\n        this.render();\n    }\n    render() {\n        this.panel.textContent = this.context.resultStatement ? this.context.resultStatement : \"\";\n        var statementText = this.panel.innerHTML.replace(/\\r\\n/g, \"<br />\").replace(/  /g, \"&nbsp;&nbsp;\");\n        this.panel.innerHTML = statementText;\n    }\n    destroyCore() {\n        this.clear();\n    }\n    clear() {\n        this.panel.innerHTML = \"\";\n    }\n}\n\n/**\n * The widget responsed for rendering process bar.\n */\nclass ProcessWidget extends Widget {\n    /**\n     * The default constructor.\n     * @param slot The html element.\n     */\n    constructor(slot) {\n        super(slot);\n        this.element = slot;\n        this.element.style.display = 'none';\n        this.group = WidgetGroup.All;\n    }\n    getWidgetType() {\n        return 'processIndicator';\n    }\n    /**\n     * On process start implementation\n     */\n    onProcessStartCore() {\n        this.element.style.display = '';\n    }\n    /**\n    * On process end implementation\n    */\n    onProcessEndCore() {\n        this.element.style.display = 'none';\n    }\n}\n\nclass ManageDrillDownWidget extends Widget {\n    constructor(slot) {\n        super(slot);\n        this.clickHandler = () => this.openDialog();\n        this.columnsBar = null;\n        this.queryPanel = null;\n        this.ddQuery = null;\n        this.cssPrefix = eqCssPrefix;\n        this.group = WidgetGroup.None;\n    }\n    getWidgetType() {\n        return 'manageDrillDown';\n    }\n    init(context, options) {\n        super.init(context, options);\n        this.options = options;\n        this.refresh();\n        this.slot.addEventListener('click', this.clickHandler);\n    }\n    destroyCore() {\n        this.slot.removeEventListener('click', this.clickHandler);\n    }\n    openDialog() {\n        const dialogService = this.context.getServices().getService('DialogService');\n        const query = this.context.getQuery();\n        const model = this.context.getModel();\n        const dialogBody = domel('div')\n            .addClass(`${this.cssPrefix}-manage-drilldown`)\n            .addChildElement(this.renderColumnsBarBlock())\n            .addChildElement(this.renderQueryPanelBlock())\n            .toDOM();\n        let op = model.addOrUpdateOperator({\n            id: 'BindToParentColumn',\n            caption: 'is bound to',\n            format: '{expr1} [[is bound to]] {expr2}',\n            paramCount: 2,\n            kind: DataKind.ParentColumn,\n            appliedTypes: [DataType.String, DataType.Bool, DataType.Float, DataType.Int32, DataType.Int64, DataType.Word]\n        });\n        op.defaultOperand.dataType = DataType.String;\n        op.defaultOperand.kind = DataKind.ParentColumn;\n        model.runThroughEntities(attr => {\n            const opIdx = attr.operators.indexOf(op.id);\n            if (opIdx > 0) {\n                utils.moveArrayItem(attr.operators, opIdx, 0);\n            }\n        }, null);\n        this.ddQuery = query.createSubQuery();\n        const dds = this.context.getQuery().getDrillDowns();\n        if (dds.length) {\n            const dd = dds[0];\n            this.ddQuery.loadFromData(dd.toJSONData());\n        }\n        dialogService.open({\n            title: 'Manage Drill Down',\n            body: dialogBody,\n            cancelable: true,\n            closable: false,\n            beforeOpen: () => {\n                const columnsBarSlot = dialogBody.getElementsByClassName(`${this.cssPrefix}-columnsbar-slot`)[0];\n                this.columnsBar = new ColumnsBar(columnsBarSlot, this.ddQuery);\n                this.columnsBar.init(this.context, this.options.columnsBar);\n                const queryPanelSlot = dialogBody.getElementsByClassName(`${this.cssPrefix}-querypanel-slot`)[0];\n                this.queryPanel = new QueryPanel(queryPanelSlot, this.ddQuery);\n                this.queryPanel.init(this.context, this.options.queryPanel);\n                this.columnsBar.refresh();\n                this.queryPanel.refresh();\n            },\n            onSubmit: () => {\n                return this.submitDialog();\n            },\n            onDestroy: () => {\n                this.destroyDialog();\n            }\n        });\n    }\n    renderQueryPanelBlock() {\n        return domel('div')\n            .addClass(`${this.cssPrefix}-querypanel-block`)\n            .addChild('div', b => b\n            .addClass(`${this.cssPrefix}-querypanel-caption`))\n            .addChild('div', b => b\n            .addClass(`${this.cssPrefix}-querypanel-slot`))\n            .toDOM();\n    }\n    renderColumnsBarBlock() {\n        return domel('div')\n            .addClass(`${this.cssPrefix}-columnsbar-block`)\n            .addChild('div', b => b\n            .addClass(`${this.cssPrefix}-columnsbar-caption`))\n            .addChild('div', b => b\n            .addClass(`${this.cssPrefix}-columnsbar-slot`))\n            .toDOM();\n    }\n    submitDialog() {\n        if (this.ddQuery.tryValidate({\n            checkExpressions: true\n        })) {\n            const dds = this.context.getQuery().getDrillDowns();\n            if (dds.length) {\n                dds[0].loadFromData(this.ddQuery.toJSONData());\n                this.context.getQuery().fireChangedEvent();\n            }\n            else {\n                if (!this.ddQuery.isEmpty()) {\n                    const dd = this.context.getQuery().addDrillDown();\n                    dd.loadFromData(this.ddQuery.toJSONData());\n                    this.context.getQuery().fireChangedEvent();\n                }\n            }\n            return true;\n        }\n        return false;\n    }\n    destroyDialog() {\n        const model = this.context.getModel();\n        model.removeOperator('BindToParentColumn', true);\n        this.ddQuery = null;\n        this.columnsBar && this.columnsBar.destroy();\n        this.columnsBar = null;\n        this.queryPanel && this.queryPanel.destroy();\n        this.queryPanel = null;\n    }\n}\n\nvar FacetType;\n(function (FacetType) {\n    FacetType[\"DataGrid\"] = \"DATA_GRID\";\n    FacetType[\"Chart\"] = \"CHART\";\n    FacetType[\"PivotTable\"] = \"PIVOT_TABLE\";\n})(FacetType || (FacetType = {}));\n\nfunction __awaiter(thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n}\ntypeof SuppressedError === \"function\" ? SuppressedError : function (error, suppressed, message) {\n    var e = new Error(message);\n    return e.name = \"SuppressedError\", e.error = error, e.suppressed = suppressed, e;\n};\n\nclass ResultFacet {\n    constructor(container, options) {\n        this.container = container;\n        this.title = i18n.getText('Facets', 'DefaultFacetTitle');\n        this.cssPrefix = 'eqjs-facet';\n        this.dialogTitle = i18n.getText('Facets', 'DefaultDlgTitle');\n        this.options = {};\n        this.canDisplayFlag = true;\n        this.downloadAllClickHandler = () => {\n            const resultTable = this.getContext().resultTable;\n            if (!resultTable.elasticChunks) {\n                const nextChunkStart = resultTable.getCachedRows().length;\n                const recordsToLoad = resultTable.getTotal() - resultTable.getCachedCount();\n                const ds = this.getDialogService();\n                const dlg = ds.openProgress({\n                    title: i18n.getText('Facets', 'LoadDataDlgTitle'),\n                    content: i18n.getText('Facets', 'LoadDataDlgContent')\n                        .replace('{loadedRecs}', '0')\n                        .replace('{totalRecs}', `${recordsToLoad}`),\n                    onSubmit: () => this.refresh(),\n                    determinated: true\n                });\n                let loadedRecords = 0;\n                setTimeout(() => {\n                    resultTable.getRows({ offset: nextChunkStart, limit: recordsToLoad })\n                        .then(_ => {\n                        loadedRecords += _.length;\n                        const progress = loadedRecords / recordsToLoad;\n                        dlg.updateContent(i18n.getText('Facets', 'LoadDataDlgContent')\n                            .replace('{loadedRecs}', `${loadedRecords}`)\n                            .replace('{totalRecs}', `${recordsToLoad}`));\n                        dlg.updateProgress(progress);\n                    })\n                        .catch(error => {\n                        dlg.submit();\n                        this.getContext().throwError(error);\n                    });\n                }, 10);\n            }\n            else {\n                const ds = this.getDialogService();\n                const dlg = ds.openProgress({\n                    title: i18n.getText('Facets', 'LoadDataDlgTitle'),\n                    onSubmit: () => this.refresh(),\n                    determinated: false\n                });\n                this.loadElasticChunk()\n                    .then(_ => {\n                    dlg.submit();\n                })\n                    .catch(error => {\n                    dlg.submit();\n                    this.getContext().throwError(error);\n                });\n            }\n        };\n        utils.assignDeep(this.options, options);\n    }\n    init(slot) {\n        this.slot = slot;\n        this.contentDiv = domel('div', this.slot)\n            .addClass(`${this.cssPrefix}-content`)\n            .toDOM();\n        this.displayMessageDiv = domel('div', this.slot).hide().toDOM();\n    }\n    showSettingsDialog() {\n        return new Promise((resolve) => {\n            const ds = this.getDialogService();\n            const content = this.renderDialogContent();\n            const dlg = ds.open({\n                title: this.dialogTitle,\n                body: content,\n                cancelable: true,\n                closable: false,\n                onSubmit: () => {\n                    const submited = this.submitSettingsDialog();\n                    if (submited) {\n                        resolve(true);\n                    }\n                    return submited;\n                },\n                onCancel: () => {\n                    resolve(false);\n                }\n            });\n            this.afterDialogOpened(dlg);\n        });\n    }\n    afterDialogOpened(dlg) {\n    }\n    renderDialogContent() {\n        let fieldsContainer;\n        let b = domel('div')\n            .addClass('kfrm-form')\n            .addChild('div', b => fieldsContainer = b\n            .addClass(`${browserUtils.isIE()\n            ? 'kfrm-fields-ie col-ie-1-4 label-align-right'\n            : 'kfrm-fields col-a-1 label-align-right'}`)\n            .toDOM());\n        this.renderFormFields(b.toDOM(), fieldsContainer);\n        return b.toDOM();\n    }\n    renderFormFields(form, fieldsContainer) {\n        let cont = fieldsContainer;\n        if (browserUtils.isIE()) {\n            cont = domel('div', fieldsContainer)\n                .addClass('kfrm-field-ie')\n                .toDOM();\n        }\n        domel(cont)\n            .addChild('label', b => b\n            .attr('for', 'tab_name')\n            .addText(i18n.getText('Facets', 'TabNameLabel')))\n            .addChild('input', b => b\n            .id('facetTabName')\n            .name('tab_name')\n            .type('text')\n            .attr('value', this.title));\n    }\n    submitSettingsDialog() {\n        const tabNameInput = document.querySelector('#facetTabName');\n        if (tabNameInput.value.length == 0)\n            return false;\n        this.title = tabNameInput.value;\n        return true;\n    }\n    getDialogService() {\n        return this.getContext()\n            .getServices()\n            .getService('DialogService');\n    }\n    canDisplay() {\n        const context = this.getContext();\n        const resultTable = context.resultTable;\n        return (resultTable.getCachedCount() == resultTable.getTotal());\n    }\n    showErrorMessage(message) {\n        this.displayMessageDiv.innerHTML = message;\n        this.displayMessageDiv.classList.add(`${this.cssPrefix}-error-message`);\n        domel(this.displayMessageDiv).show();\n    }\n    showUnableDisplayMessage(message) {\n        const context = this.getContext();\n        const resultTable = context.resultTable;\n        this.displayMessageDiv.innerHTML = message || i18n.getText('Facets', 'ErrNotEnoughData')\n            .replace('{totalRecs}', `${resultTable.getTotal()}`)\n            .replace('{cachedRecs}', `${resultTable.getCachedCount()}`)\n            .replace(/\\[(.*)\\]/g, `<a href='javascript:void(0)' class=\"${this.cssPrefix}-download-all-link\">$1</a>`);\n        const link = this.displayMessageDiv.querySelector(`a.${this.cssPrefix}-download-all-link`);\n        if (link) {\n            link.addEventListener('click', this.downloadAllClickHandler);\n        }\n        domel(this.contentDiv).hide();\n        domel(this.displayMessageDiv).show();\n    }\n    hideUnableDisplayMessage() {\n        domel(this.displayMessageDiv).hide();\n        domel(this.contentDiv).show();\n    }\n    getContext() {\n        return this.container.getContext();\n    }\n    getQuery() {\n        return this.getContext().getQuery();\n    }\n    saveToData() {\n        return { title: this.title, type: this.getType() };\n    }\n    loadFromData(data) {\n        if (data) {\n            this.title = data.title;\n        }\n    }\n    refresh() {\n        this.hideUnableDisplayMessage();\n        if (this.canDisplay()) {\n            this.refreshCore();\n        }\n        else {\n            this.showUnableDisplayMessage();\n        }\n    }\n    loadElasticChunk() {\n        return __awaiter(this, void 0, void 0, function* () {\n            const resultTable = this.getContext().resultTable;\n            const nextChunkStart = resultTable.getCachedRows().length;\n            //next chunk\n            return resultTable.getRows({ offset: nextChunkStart, limit: resultTable.chunkSize })\n                .then(_ => {\n                return resultTable.totalIsKnown()\n                    ? Promise.resolve()\n                    : this.loadElasticChunk();\n            });\n        });\n    }\n    onResize() {\n    }\n}\n\n/** Represents chart types. */\nvar ChartType;\n(function (ChartType) {\n    ChartType[ChartType[\"Column\"] = 3] = \"Column\";\n    ChartType[ChartType[\"Histogram\"] = 4] = \"Histogram\";\n    ChartType[ChartType[\"Bar\"] = 5] = \"Bar\";\n    ChartType[ChartType[\"Combo\"] = 6] = \"Combo\";\n    ChartType[ChartType[\"Area\"] = 7] = \"Area\";\n    ChartType[ChartType[\"Line\"] = 9] = \"Line\";\n    ChartType[ChartType[\"Pie\"] = 10] = \"Pie\";\n    ChartType[ChartType[\"Polar\"] = 11] = \"Polar\";\n    ChartType[ChartType[\"Doughnut\"] = 12] = \"Doughnut\";\n    ChartType[ChartType[\"Radar\"] = 13] = \"Radar\";\n    ChartType[ChartType[\"SteppedLine\"] = 14] = \"SteppedLine\";\n})(ChartType || (ChartType = {}));\n\nclass ChartWidget extends Widget {\n    get cssPrefix() {\n        return 'eqjs-chart';\n    }\n    /**\n     Initializes a new instance of the `ChartWidget` class\n     * @param slotElement - an HTML element we should place our widget in.\n     */\n    constructor(slotElement) {\n        super(slotElement);\n        this.chartType = ChartType.Pie;\n        this.supportedChartTypes = [];\n        this.dataTable = null;\n        this.potentialLabelColumns = [];\n        this.potentialDataColumns = [];\n        this.labelColumn = -1;\n        this.dataColumns = [];\n        this.options = {\n            chartType: ChartType.Pie,\n            showOnPaging: false,\n            hideSettings: false,\n            legend: {\n                show: false,\n                position: 'right'\n            }\n        };\n        this.element = slotElement;\n        this.group = WidgetGroup.Result;\n    }\n    /**\n     * Initialize widget.\n     * @param context The context.\n     * @param options The options.\n     */\n    init(context, options) {\n        super.init(context, options);\n        this.dataTable = context.resultTable;\n        this.setOptions(options);\n    }\n    /**\n     * Checks, if widget has data.\n     * @returns `true` if has data, otherwise - `false`.\n     */\n    hasData() {\n        let result = this.dataTable != null;\n        if (result) {\n            result = this.dataTable.getCachedCount() > 0;\n        }\n        return result;\n    }\n    /**\n     * Checks, if there ara colums for chart\n     * @returns `true` if there are columns, otherwise - `false`.\n     */\n    hasColumnsForChart() {\n        return this.potentialLabelColumns.length > 0 && this.potentialDataColumns.length > 0;\n    }\n    /**\n     * Refresh widget implementation\n     */\n    refreshCore() {\n        this.prepareChartData();\n        this.render();\n    }\n    setOptions(options) {\n        utils.assignDeep(this.options, options);\n        this.supportedChartTypes = this.getSupportedChartTypes();\n        if (this.supportedChartTypes.length == 0) {\n            throw Error(\"Chart widget should support at least one chart type\");\n        }\n        if (options.chartType && this.supportedChartTypes.indexOf(options.chartType) >= 0) {\n            this.chartType = options.chartType;\n        }\n        else {\n            this.chartType = this.supportedChartTypes[0];\n        }\n    }\n    getOptions() {\n        return this.options;\n    }\n    getChartTypeName(ct) {\n        switch (ct) {\n            case ChartType.Area:\n                return i18n.getText('ChartType', 'Area');\n            case ChartType.Bar:\n                return i18n.getText('ChartType', 'Bar');\n            case ChartType.Column:\n                return i18n.getText('ChartType', 'Column');\n            case ChartType.Combo:\n                return i18n.getText('ChartType', 'Combo');\n            case ChartType.Doughnut:\n                return i18n.getText('ChartType', 'Doughnut');\n            case ChartType.Polar:\n                return i18n.getText('ChartType', 'Polar');\n            case ChartType.Radar:\n                return i18n.getText('ChartType', 'Radar');\n            case ChartType.Histogram:\n                return i18n.getText('ChartType', 'Histogram');\n            case ChartType.Line:\n                return i18n.getText('ChartType', 'Line');\n            case ChartType.SteppedLine:\n                return i18n.getText('ChartType', 'SteppedLine');\n            default:\n                return i18n.getText('ChartType', 'Pie');\n        }\n    }\n    updateSettings(settings, updateColumns = true) {\n        if (typeof settings.showLegend !== 'undefined') {\n            this.options.legend = this.options.legend || {};\n            this.options.legend.show = settings.showLegend;\n        }\n        this.chartType = settings.type;\n        this.labelColumn = settings.labelColumn;\n        this.dataColumns[0] = settings.dataColumn;\n        if (updateColumns)\n            this.updateChartColumns();\n    }\n    /**\n     * Prepares data for chart.\n     */\n    prepareChartData() {\n        if (this.dataTable) {\n            this.potentialLabelColumns = [];\n            this.potentialDataColumns = [];\n            let colNum = this.dataTable.columns.count;\n            for (let i = 0; i < colNum; i++) {\n                const column = this.dataTable.columns.get(i);\n                let colType = column.type;\n                let colLabel = column.label;\n                this.potentialLabelColumns.push({ idx: i, label: colLabel });\n                if (utils.isNumericType(colType)) {\n                    this.potentialDataColumns.push({ idx: i, label: colLabel });\n                }\n            }\n            if (this.labelColumn != -1) {\n                if (!this.potentialLabelColumns\n                    .filter(c => c.idx == this.labelColumn)\n                    .length) {\n                    this.labelColumn = -1;\n                }\n            }\n            else {\n                this.labelColumn = (this.potentialLabelColumns.length > 0)\n                    ? this.potentialLabelColumns[0].idx : -1;\n            }\n            if (this.dataColumns.length) {\n                const ids = this.potentialDataColumns.map(d => d.idx);\n                this.dataColumns = this.dataColumns.filter(v => ids.indexOf(v) >= 0);\n                if (!this.dataColumns.length) {\n                    this.dataColumns = (this.potentialDataColumns.length > 0)\n                        ? [].concat(this.potentialDataColumns[0].idx)\n                        : [];\n                }\n            }\n            else {\n                this.dataColumns = (this.potentialDataColumns.length > 0)\n                    ? [].concat(this.potentialDataColumns[0].idx)\n                    : [];\n            }\n            this.initChart();\n        }\n    }\n    getSupportedChartTypes() {\n        const chartTypes = this.options.supportedChartTypes\n            ? this.options.supportedChartTypes\n            : Object.keys(ChartType).map(key => ChartType[key]);\n        return chartTypes.filter(type => this.hasChartTypes.indexOf(type) >= 0);\n    }\n    getCurrentChartType() {\n        return this.chartType;\n    }\n    render() {\n        this.clear();\n        if (this.hasData() && this.hasColumnsForChart()\n            && (this.context.resultTable.getTotal()\n                == this.context.resultTable.getCachedCount())) {\n            let headerDiv = document.createElement('div');\n            addCssClass(headerDiv, `${this.cssPrefix}-header`);\n            let mainDiv = document.createElement('div');\n            addCssClass(mainDiv, `${this.cssPrefix}-main`);\n            if (this.canDraw()) {\n                let chartTypeSelector = document.createElement('select');\n                for (let ct of this.supportedChartTypes) {\n                    let sopt = document.createElement('option');\n                    sopt.value = ct.toString();\n                    sopt.text = this.getChartTypeName(ct);\n                    chartTypeSelector.appendChild(sopt);\n                }\n                chartTypeSelector.value = this.chartType.toString();\n                headerDiv.appendChild(chartTypeSelector);\n                chartTypeSelector.addEventListener('change', (ev) => {\n                    let ctkey = ev.target.value;\n                    this.chartType = parseInt(ctkey);\n                    this.refresh();\n                });\n                this.settingsDiv = document.createElement('div');\n                addCssClass(this.settingsDiv, `${this.cssPrefix}-settings`);\n                hideElement(this.settingsDiv);\n                mainDiv.appendChild(this.settingsDiv);\n                this.chartDiv = document.createElement('div');\n                addCssClass(this.chartDiv, `${this.cssPrefix}-content`);\n                hideElement(this.chartDiv);\n                mainDiv.appendChild(this.chartDiv);\n                this.initSettingsDiv();\n                let chartSettingsBtn = document.createElement('div');\n                addCssClass(chartSettingsBtn, `${this.cssPrefix}-settings-icon`);\n                chartSettingsBtn.title = \"Settings\";\n                headerDiv.appendChild(chartSettingsBtn);\n                chartSettingsBtn.addEventListener('click', (ev) => {\n                    this.toggleSettings();\n                });\n                this.drawChart(100);\n            }\n            else {\n                this.addContentDiv(mainDiv, 'Unable to render  the chart. None of the supported chart libraries (ChartJS, Google Charts, etc) is found.');\n            }\n            if (!this.options.hideSettings) {\n                this.element.appendChild(headerDiv);\n            }\n            this.element.appendChild(mainDiv);\n            this.element.style.display = \"\";\n        }\n        else {\n            this.element.style.display = \"none\";\n        }\n    }\n    addContentDiv(mainDiv, text) {\n        let contentDiv = document.createElement('div');\n        addCssClass(contentDiv, `${this.cssPrefix}-no-data`);\n        contentDiv.innerText = text;\n        mainDiv.appendChild(contentDiv);\n    }\n    /**\n     * Clears the chart.\n     */\n    clear() {\n        this.element.innerHTML = '';\n    }\n    /**\n     * Draws chart with a delay.\n     * @param delay The delay.\n     */\n    drawChart(delay) {\n        showElement(this.chartDiv);\n        if (delay > 0) {\n            setTimeout(() => this.drawCore(), delay);\n        }\n        else {\n            this.drawCore();\n        }\n    }\n    /**\n     * Inititializes the settings div.\n     */\n    initSettingsDiv() {\n        let settingsHeader = document.createElement('div');\n        settingsHeader.textContent = 'SETTINGS';\n        addCssClass(settingsHeader, `${this.cssPrefix}-settings-header`);\n        this.settingsDiv.appendChild(settingsHeader);\n        // Label column\n        let labelDiv = document.createElement('div');\n        addCssClass(labelDiv, `${this.cssPrefix}-settings-single`);\n        this.settingsDiv.appendChild(labelDiv);\n        let labelColumnSelectorCaption = document.createElement('span');\n        showElement(labelColumnSelectorCaption);\n        labelColumnSelectorCaption.textContent = 'Label column';\n        labelDiv.appendChild(labelColumnSelectorCaption);\n        let labelColumnSelector = document.createElement('select');\n        showElement(labelColumnSelector);\n        labelDiv.appendChild(labelColumnSelector);\n        for (let col of this.potentialLabelColumns) {\n            let sopt = document.createElement('option');\n            sopt.value = col.idx.toString();\n            sopt.text = col.label;\n            labelColumnSelector.appendChild(sopt);\n        }\n        if (this.labelColumn >= 0) {\n            labelColumnSelector.value = this.labelColumn.toString();\n        }\n        labelColumnSelector.addEventListener('change', (ev) => {\n            this.labelColumn = parseInt(ev.target.value);\n            this.updateChartColumns();\n            this.toggleSettings(() => {\n                this.drawChart(100);\n            });\n        });\n        // Data column\n        let dataDiv = document.createElement('div');\n        addCssClass(dataDiv, `${this.cssPrefix}-settings-single`);\n        this.settingsDiv.appendChild(dataDiv);\n        let dataColumnSelectorCaption = document.createElement('span');\n        showElement(dataColumnSelectorCaption);\n        dataColumnSelectorCaption.textContent = 'Data column';\n        dataDiv.appendChild(dataColumnSelectorCaption);\n        let dataColumnSelector = document.createElement('select');\n        showElement(dataColumnSelector);\n        dataDiv.appendChild(dataColumnSelector);\n        for (let col of this.potentialDataColumns) {\n            let sopt = document.createElement('option');\n            sopt.value = col.idx.toString();\n            sopt.text = col.label;\n            dataColumnSelector.appendChild(sopt);\n        }\n        if (this.dataColumns.length > 0 && this.dataColumns[0] >= 0) {\n            dataColumnSelector.value = this.dataColumns[0].toString();\n        }\n        dataColumnSelector.addEventListener('change', (ev) => {\n            this.dataColumns[0] = parseInt(ev.target.value);\n            this.updateChartColumns();\n            this.toggleSettings(() => {\n                this.drawChart(100);\n            });\n        });\n    }\n    getPotentialLabelColumns() {\n        return this.potentialLabelColumns;\n    }\n    getPotentialDataColumns() {\n        return this.potentialDataColumns;\n    }\n    getLabelColumnIndex() {\n        return this.labelColumn;\n    }\n    getDataColumnIndex() {\n        return this.dataColumns[0];\n    }\n    /**\n     * Toggles settings.\n     * @param callback The callback.\n     */\n    toggleSettings(callback) {\n        let first;\n        let second;\n        if (isVisible(this.chartDiv)) {\n            first = this.chartDiv;\n            second = this.settingsDiv;\n        }\n        else {\n            first = this.settingsDiv;\n            second = this.chartDiv;\n        }\n        toggleVisibility(first, second, {\n            complete: callback\n        });\n    }\n}\n\nclass ChartJsWidget extends ChartWidget {\n    /**\n     Initializes a new instance of the `ChartJsWidget` class\n     * @param slotElement - an HTML element we should place our widget in.\n     */\n    constructor(slotElement) {\n        super(slotElement);\n        this.colors = [\n            '#4dc9f6',\n            '#f67019',\n            '#f53794',\n            '#537bc4',\n            '#acc236',\n            '#166a8f',\n            '#00a950',\n            '#58595b',\n            '#8549ba'\n        ];\n        this.chartLabels = [];\n        this.chartColumns = [];\n        this.hasChartTypes = [\n            ChartType.Column,\n            ChartType.Bar,\n            ChartType.Area,\n            ChartType.Line,\n            ChartType.SteppedLine,\n            ChartType.Doughnut,\n            ChartType.Polar,\n            ChartType.Radar,\n            ChartType.Pie\n            // ChartType.Bubble,\n            // ChartType.Scatter\n        ];\n        this.options.legend = {\n            show: false,\n            position: 'bottom'\n        };\n    }\n    getWidgetType() {\n        return 'chartChartJs';\n    }\n    static hasChartJs() {\n        return typeof Chart !== 'undefined';\n    }\n    canDraw() {\n        return ChartJsWidget.hasChartJs();\n    }\n    initChart() {\n        if (ChartJsWidget.hasChartJs() && this.labelColumn >= 0\n            && this.dataColumns && this.dataColumns.length > 0) {\n            this.updateChartColumns();\n        }\n    }\n    drawCore() {\n        if (ChartJsWidget.hasChartJs() && this.dataTable\n            && this.dataTable.getCachedCount() > 0) {\n            let config = this.generateConfig();\n            let chartCanvas = this.getChartCanvas(this.chartDiv);\n            let chartContext = chartCanvas.getContext('2d');\n            new Chart(chartContext, config);\n        }\n    }\n    updateChartColumns() {\n        if (this.dataTable) {\n            this.chartLabels = [];\n            this.chartColumns = [];\n            const rows = this.dataTable.getCachedRows();\n            for (let i = 0; i < rows.length; i++) {\n                this.chartLabels.push(rows[i].getValue(this.labelColumn));\n                this.chartColumns.push(rows[i].getValue(this.dataColumns[0]));\n            }\n        }\n    }\n    getChartCanvas(slot) {\n        let result;\n        //find canvas element\n        let canvases = slot.getElementsByTagName('canvas');\n        if (canvases && canvases.length > 0) {\n            result = canvases[0];\n        }\n        else {\n            result = addElement(slot, 'canvas');\n        }\n        return result;\n    }\n    generateConfig() {\n        let dataColors = [];\n        let datasetName = this.dataTable.columns.get(this.dataColumns[0]).label;\n        let fillValue = true;\n        let borderColor;\n        if (this.chartType == ChartType.Pie\n            || this.chartType == ChartType.Doughnut\n            || this.chartType == ChartType.Polar\n            || this.chartType == ChartType.Bar\n            || this.chartType == ChartType.Column) {\n            for (let i = 0; i < this.chartLabels.length; i++) {\n                dataColors.push(this.colors[i % this.colors.length]);\n            }\n        }\n        else {\n            dataColors = [this.colors[3]];\n        }\n        if (this.chartType == ChartType.Line\n            || this.chartType == ChartType.SteppedLine) {\n            fillValue = false;\n            borderColor = this.colors[3];\n        }\n        this.options.legend = this.options.legend || {};\n        const dataset1 = {\n            data: this.chartColumns,\n            backgroundColor: dataColors,\n            borderColor: borderColor,\n            label: datasetName,\n            fill: fillValue\n        };\n        if (this.chartType == ChartType.SteppedLine) {\n            dataset1.stepped = this.chartType === ChartType.SteppedLine, // >= 3.0.0\n                dataset1.steppedLine = this.chartType === ChartType.SteppedLine; // <= 3.0.0\n        }\n        const displayLegend = this.options.legend.show && (this.chartType == ChartType.Pie\n            || this.chartType == ChartType.Radar || this.chartType == ChartType.Polar\n            || this.chartType == ChartType.Doughnut);\n        return {\n            type: this.getChartType(),\n            data: {\n                datasets: [dataset1],\n                labels: this.chartLabels\n            },\n            options: {\n                legend: {\n                    display: displayLegend,\n                    position: this.options.legend.position || 'bottom'\n                },\n                title: {\n                    display: true,\n                    text: datasetName\n                }\n            }\n        };\n    }\n    getChartType() {\n        switch (this.chartType) {\n            case ChartType.Column:\n                return \"bar\";\n            case ChartType.Bar:\n                return \"horizontalBar\";\n            case ChartType.Area:\n            case ChartType.SteppedLine:\n            case ChartType.Line:\n                return \"line\";\n            case ChartType.Doughnut:\n                return \"doughnut\";\n            case ChartType.Polar:\n                return \"polarArea\";\n            case ChartType.Radar:\n                return \"radar\";\n            case ChartType.Pie:\n                return \"pie\";\n            default:\n                return \"pie\";\n        }\n    }\n}\n\nclass GoogleChartWidget extends ChartWidget {\n    /**\n     Initializes a new instance of the `GoogleChartWidget` class\n     * @param slotElement - an HTML element we should place our widget in.\n     */\n    constructor(slotElement) {\n        super(slotElement);\n        this.hasChartTypes = [\n            ChartType.Column,\n            ChartType.Bar,\n            ChartType.Histogram,\n            ChartType.Combo,\n            ChartType.Area,\n            ChartType.Line,\n            ChartType.SteppedLine,\n            ChartType.Pie,\n            ChartType.Doughnut\n        ];\n        this.options.legend = {\n            show: true,\n            position: 'right'\n        };\n    }\n    getWidgetType() {\n        return 'chartGoogle';\n    }\n    canDraw() {\n        return GoogleChartWidget.hasGoogleCharts();\n    }\n    static hasGoogleCharts() {\n        return typeof google !== 'undefined' && typeof google.charts !== 'undefined';\n    }\n    initChart() {\n        if (GoogleChartWidget.hasGoogleCharts() && this.labelColumn >= 0\n            && this.dataColumns && this.dataColumns.length > 0) {\n            this.googleDataView =\n                new google.visualization.DataView(this.convertToGoogleFormat());\n            this.updateChartColumns();\n        }\n    }\n    convertToGoogleType(type) {\n        switch (type) {\n            case DataType.Date:\n                return \"date\";\n            case DataType.DateTime:\n                return \"datetime\";\n            case DataType.Time:\n                return \"timeofday\";\n            case DataType.Byte:\n            case DataType.Word:\n            case DataType.Int32:\n            case DataType.Int64:\n            case DataType.Currency:\n            case DataType.Float:\n                return \"number\";\n            default:\n                return \"string\";\n        }\n    }\n    convertToGoogleValue(value, type) {\n        switch (type) {\n            case DataType.Bool:\n                return value ? value.toString() : null;\n            default:\n                return value;\n        }\n    }\n    convertToGoogleFormat() {\n        const googleTable = new google.visualization.DataTable();\n        const columns = this.dataTable.columns;\n        for (let i = 0; i < columns.count; i++) {\n            const column = columns.get(i);\n            googleTable.addColumn(this.convertToGoogleType(column.type), column.label, column.id);\n        }\n        const rows = this.dataTable.getCachedRows();\n        googleTable.addRows(rows.length);\n        for (let i = 0; i < rows.length; i++) {\n            const row = rows[i];\n            for (let j = 0; j < columns.count; j++) {\n                googleTable.setCell(i, j, this.convertToGoogleValue(row.getValue(j), columns.get(j).type));\n            }\n        }\n        return googleTable;\n    }\n    drawCore() {\n        if (this.googleDataView != null) {\n            this.options.legend = this.options.legend || {};\n            let chartOptions = {\n                width: \"100%\",\n                height: \"100%\",\n                chartArea: { width: this.getChartAreaWidth }\n            };\n            if (this.chartType == ChartType.Doughnut) {\n                chartOptions.pieHole = 0.4;\n            }\n            if (!this.options.legend.show) {\n                chartOptions.legend = 'none';\n            }\n            else {\n                chartOptions.legend = { position: this.options.legend.position };\n            }\n            let chart = this.createChart(this.chartDiv);\n            chart.draw(this.googleDataView, chartOptions);\n        }\n    }\n    getChartAreaWidth(chartType) {\n        if (chartType == ChartType.Pie) {\n            return \"100%\";\n        }\n        else {\n            return \"50%\";\n        }\n    }\n    updateChartColumns() {\n        if (this.googleDataView) {\n            this.googleDataView.setColumns([].concat(this.labelColumn).concat(this.dataColumns));\n        }\n    }\n    createChart(slot) {\n        switch (this.chartType) {\n            case ChartType.Column:\n                return new google.visualization.ColumnChart(slot);\n            case ChartType.Histogram:\n                return new google.visualization.Histogram(slot);\n            case ChartType.Bar:\n                return new google.visualization.BarChart(slot);\n            case ChartType.Combo:\n                return new google.visualization.ComboChart(slot);\n            case ChartType.Area:\n                return new google.visualization.AreaChart(slot);\n            case ChartType.Line:\n                return new google.visualization.LineChart(slot);\n            case ChartType.SteppedLine:\n                return new google.visualization.SteppedAreaChart(slot);\n            case ChartType.Pie:\n            case ChartType.Doughnut:\n                return new google.visualization.PieChart(slot);\n            default:\n                return new google.visualization.PieChart(slot);\n        }\n    }\n}\n\nclass ChartFacet extends ResultFacet {\n    constructor() {\n        super(...arguments);\n        this.title = i18n.getText('Facets', 'Chart', 'FacetTitle');\n        this.dialogTitle = i18n.getText('Facets', 'Chart', 'DlgTitle');\n    }\n    init(slot) {\n        super.init(slot);\n        if (GoogleChartWidget.hasGoogleCharts()) {\n            this.chart = new GoogleChartWidget(this.contentDiv);\n        }\n        else {\n            this.chart = new ChartJsWidget(this.contentDiv);\n        }\n        const supportedChartTypes = this.container.options\n            ? this.container.options.supportedChartTypes\n            : null;\n        this.chart.init(this.getContext(), {\n            legend: {\n                show: false\n            },\n            showOnPaging: true,\n            hideSettings: true,\n            supportedChartTypes: supportedChartTypes\n        });\n        //prevent showing chart tab\n        domel(this.slot).hide();\n    }\n    destroy() {\n        if (this.chart) {\n            this.chart.destroy();\n        }\n    }\n    getType() {\n        return FacetType.Chart;\n    }\n    renderFormFields(form, fieldsContainer) {\n        super.renderFormFields(form, fieldsContainer);\n        const isIE = browserUtils.isIE();\n        const horizClass = isIE ? 'kfrm-fields-ie is-horizontal' : 'kfrm-fields is-horizontal';\n        // Chart type\n        let chartTypeSelector = document.createElement('select');\n        chartTypeSelector.id = 'chart_type_selector';\n        chartTypeSelector.name = 'chart_type_selector';\n        for (let ct of this.chart.getSupportedChartTypes()) {\n            let sopt = document.createElement('option');\n            sopt.value = ct.toString();\n            sopt.text = this.chart.getChartTypeName(ct);\n            chartTypeSelector.appendChild(sopt);\n        }\n        chartTypeSelector.value = this.chart.getCurrentChartType().toString();\n        if (!this.settings) {\n            this.chart.prepareChartData();\n            this.settings = {\n                type: this.chart.getCurrentChartType().toString(),\n                labelColumn: `${this.chart.getLabelColumnIndex() >= 0 ? this.chart.getLabelColumnIndex() : ''}`,\n                dataColumn: `${this.chart.getDataColumnIndex() >= 0 ? this.chart.getDataColumnIndex() : ''}`,\n                showLegend: false\n            };\n        }\n        // Label column\n        const labelColumnSelector = document.createElement('select');\n        labelColumnSelector.name = 'label_column_selector';\n        labelColumnSelector.id = 'label_column_selector';\n        for (const col of this.chart.getPotentialLabelColumns()) {\n            const sopt = document.createElement('option');\n            sopt.value = col.idx.toString();\n            sopt.text = col.label;\n            labelColumnSelector.appendChild(sopt);\n        }\n        labelColumnSelector.value = this.settings.labelColumn;\n        // Data column\n        const dataColumnSelector = document.createElement('select');\n        dataColumnSelector.id = 'data_column_selector';\n        dataColumnSelector.name = 'data_column_selector';\n        for (const col of this.chart.getPotentialDataColumns()) {\n            const sopt = document.createElement('option');\n            sopt.value = col.idx.toString();\n            sopt.text = col.label;\n            dataColumnSelector.appendChild(sopt);\n        }\n        dataColumnSelector.value = this.settings.dataColumn.toString();\n        let current = fieldsContainer;\n        const getCurrent = () => {\n            if (isIE) {\n                return domel('div', fieldsContainer)\n                    .addClass('kfrm-field-ie')\n                    .toDOM();\n            }\n            else {\n                return fieldsContainer;\n            }\n        };\n        if (isIE) {\n            domel(form)\n                .addChildElement(getCurrent());\n        }\n        else {\n            domel(fieldsContainer)\n                .addChild('div')\n                .addChild('div');\n        }\n        current = getCurrent();\n        domel(current)\n            .addChild('label', b => b\n            .attr('for', 'chart_type_selector')\n            .text(i18n.getText('Facets', 'Chart', 'ChartTypeSelectorLabel')))\n            .addChild('div', b => b\n            .addClass('kfrm-select')\n            .addChildElement(chartTypeSelector));\n        current = getCurrent();\n        domel(current)\n            .addChild('label', b => b\n            .attr('for', 'label_column_selector')\n            .text(i18n.getText('Facets', 'Chart', 'LabelColumnSelectorLabel')))\n            .addChild('div', b => b\n            .addClass('kfrm-select')\n            .addChildElement(labelColumnSelector));\n        current = getCurrent();\n        domel(current)\n            .addChild('label', b => b\n            .attr('for', 'data_column_selector')\n            .text(i18n.getText('Facets', 'Chart', 'DataColumnSelectorLabel')))\n            .addChild('div', b => b\n            .addClass('kfrm-select')\n            .addChildElement(dataColumnSelector));\n        current = getCurrent();\n        domel(current)\n            .addChild('div')\n            .addChild('div', b => b\n            .addClass(horizClass)\n            .addChild('label', b => b\n            .addClass('checkbox')\n            .addChild('input', b => {\n            b\n                .id('show_legend')\n                .type('checkbox');\n            if (this.settings.showLegend)\n                b.attr('checked', '');\n        })\n            .addText(' ' + i18n.getText('Facets', 'Chart', 'ShowLegendLabel'))));\n    }\n    afterDialogOpened(dlg) {\n        if (this.getContext().resultTable.columns.getItems().filter(col => utils.isNumericType(col.type)).length <= 0) {\n            dlg.showAlert('The dataset should contain at least one numeric column to build a chart', 'error');\n            dlg.getSubmitButtonElement().disabled = true;\n        }\n    }\n    submitSettingsDialog() {\n        const result = super.submitSettingsDialog();\n        const chartTypeSelector = document.getElementById('chart_type_selector');\n        const ct = parseInt(chartTypeSelector.value);\n        const labelColumnSelector = document.getElementById('label_column_selector');\n        const labelColumn = parseInt(labelColumnSelector.value);\n        const dataColumnSelector = document.getElementById('data_column_selector');\n        const dataColumn = parseInt(dataColumnSelector.value);\n        const showLegendInput = document.getElementById('show_legend');\n        const showLegend = showLegendInput.checked;\n        if (result) {\n            this.settings = {\n                type: ct,\n                labelColumn: labelColumn,\n                dataColumn: dataColumn,\n                showLegend: showLegend\n            };\n            if (this.canDisplay()) {\n                this.refresh();\n            }\n        }\n        return result;\n    }\n    getSettings() {\n        return this.settings;\n    }\n    saveToData() {\n        const data = super.saveToData();\n        if (this.settings) {\n            data.chartType = this.settings.type;\n            data.labelCol = this.settings.labelColumn;\n            data.dataCol = this.settings.dataColumn;\n            data.showLeg = this.settings.showLegend;\n        }\n        return data;\n    }\n    loadFromData(data) {\n        super.loadFromData(data);\n        if (data) {\n            this.settings = {\n                type: data.chartType,\n                dataColumn: data.dataCol,\n                labelColumn: data.labelCol,\n                showLegend: data.showLeg\n            };\n        }\n    }\n    refreshCore() {\n        if (this.chart) {\n            if (this.settings) {\n                this.chart.updateSettings(this.settings);\n            }\n            this.chart.prepareChartData();\n            this.chart.refresh();\n        }\n    }\n    onResize() {\n        this.refresh();\n    }\n}\n\nvar AggrFunc;\n(function (AggrFunc) {\n    AggrFunc[\"Sum\"] = \"SUM\";\n    AggrFunc[\"Average\"] = \"AVG\";\n    AggrFunc[\"Min\"] = \"MIN\";\n    AggrFunc[\"Max\"] = \"MAX\";\n    AggrFunc[\"Count\"] = \"COUNT\";\n})(AggrFunc || (AggrFunc = {}));\nvar FormFieldType;\n(function (FormFieldType) {\n    FormFieldType[FormFieldType[\"ColumnField\"] = 0] = \"ColumnField\";\n    FormFieldType[FormFieldType[\"RowField\"] = 1] = \"RowField\";\n    FormFieldType[FormFieldType[\"CellData\"] = 2] = \"CellData\";\n})(FormFieldType || (FormFieldType = {}));\nconst DFMT_REGEX = /{0:(.*?)}/g;\nclass PivotTableFacet extends ResultFacet {\n    constructor() {\n        super(...arguments);\n        this.title = i18n.getText('Facets', 'Pivot', 'FacetTitle');\n        this.dialogTitle = i18n.getText('Facets', 'Pivot', 'DlgTitle');\n        this.pivotTable = new EasyDataTable();\n        this.settings = {};\n    }\n    init(slot) {\n        super.init(slot);\n        this.options.maxRowCount = this.options.maxRowCount || 500;\n        this.options.viewportRowsCount = this.options.viewportRowsCount || 50;\n        this.grid = new EasyGrid({\n            slot: this.contentDiv,\n            dataTable: this.pivotTable,\n            paging: {\n                enabled: false,\n                pageSize: this.options.maxRowCount\n            },\n            viewportRowsCount: this.options.viewportRowsCount,\n            useRowNumeration: false,\n            showPlusButton: false,\n            allowDragDrop: false,\n            onGetCellRenderer: (column, defaultRenderer) => {\n                if (column.dataColumn) {\n                    if (column.dataColumn.id == \"total\") {\n                        return (value, column, cell, rowEl) => {\n                            defaultRenderer(value, column, cell, rowEl);\n                            cell.classList.add('pivot-cell-total');\n                        };\n                    }\n                    if (this.settings.totalsRow) {\n                        const colIndex = this.pivotTable.columns.getIndex(column.dataColumn.id);\n                        const isFirst = colIndex === 0;\n                        if (isFirst) {\n                            return (value, column, cell, rowEl) => {\n                                const idx = Number.parseInt(rowEl.getAttribute('data-row-idx'));\n                                const isLast = idx === this.pivotTable.getCachedCount() - 1;\n                                if (isLast) {\n                                    value = i18n.getText('Facets', 'Pivot', 'TotalGridLabel');\n                                }\n                                defaultRenderer(value, column, cell, rowEl);\n                            };\n                        }\n                    }\n                }\n            }\n        });\n    }\n    getType() {\n        return FacetType.PivotTable;\n    }\n    destroy() {\n        if (this.grid) {\n            this.grid.destroy();\n        }\n    }\n    createAggrFuncSelectBuilder(aggrFunc) {\n        const model = this.getContext().getModel();\n        const csb = domel('select');\n        const aggrfuncs = Object.keys(AggrFunc).map(k => AggrFunc[k]);\n        for (const aggrfunc of aggrfuncs) {\n            csb.addChild('option', b => {\n                b\n                    .attr('value', aggrfunc)\n                    .text(model.getAggrFunctionCaption(aggrfunc));\n            });\n        }\n        const options = csb.toDOM().querySelectorAll('option');\n        if (aggrFunc != undefined) {\n            options.forEach(option => {\n                if (option.value == aggrFunc) {\n                    option.selected = true;\n                }\n            });\n        }\n        else {\n            options[0].selected = true;\n        }\n        return csb;\n    }\n    createColumnsSelectBuilder(allowedTypes, colName, formFieldType) {\n        const dataTable = this.getContextDataTable();\n        const csb = domel('select');\n        let firstNumericColIndex = null;\n        let optionIndex = 0;\n        for (let i = 0; i < dataTable.columns.count; i++) {\n            const column = dataTable.columns.get(i);\n            const colLabel = column.label;\n            const colType = column.type;\n            const colId = column.id;\n            if (allowedTypes && allowedTypes.indexOf(colType) < 0)\n                continue;\n            if (firstNumericColIndex === null && utils.isNumericType(colType)) {\n                firstNumericColIndex = optionIndex;\n            }\n            csb.addChild('option', b => {\n                b\n                    .attr('value', colId)\n                    .text(colLabel);\n            });\n            optionIndex++;\n        }\n        const options = Array.from(csb.toDOM().querySelectorAll('option'));\n        if (options.length > 0) {\n            if (colName != undefined) {\n                for (const option of options) {\n                    if (option.value == colName) {\n                        csb.toDOM().value = option.value;\n                        break;\n                    }\n                }\n            }\n            else {\n                switch (formFieldType) {\n                    case FormFieldType.ColumnField: {\n                        csb.toDOM().value = options[0].value;\n                        break;\n                    }\n                    case FormFieldType.RowField: {\n                        csb.toDOM().value = options.length > 1 ? options[1].value : options[0].value;\n                        break;\n                    }\n                    case FormFieldType.CellData: {\n                        csb.toDOM().value = firstNumericColIndex === null ? options[0].value : options[firstNumericColIndex].value;\n                        break;\n                    }\n                }\n            }\n        }\n        return csb;\n    }\n    renderFormFields(form, fieldsContainer) {\n        super.renderFormFields(form, fieldsContainer);\n        const settings = this.settings || { totalsRow: true, totalsCol: true };\n        const colTypes = [DataType.String, DataType.Date, DataType.DateTime, DataType.Int32,\n            DataType.Int64, DataType.Word, DataType.Byte];\n        const fieldTypes = [DataType.String, DataType.Float, DataType.Int32,\n            DataType.Int64, DataType.Word, DataType.Byte, DataType.Currency];\n        const isIE = browserUtils.isIE();\n        let current = fieldsContainer;\n        const horizClass = isIE ? 'kfrm-fields-ie is-horizontal' : 'kfrm-fields is-horizontal';\n        const getCurrent = () => {\n            if (isIE) {\n                return domel('div', fieldsContainer)\n                    .addClass('kfrm-field-ie')\n                    .toDOM();\n            }\n            else {\n                return fieldsContainer;\n            }\n        };\n        if (isIE) {\n            domel(fieldsContainer)\n                .addChildElement(getCurrent());\n        }\n        else {\n            domel(fieldsContainer)\n                .addChild('div')\n                .addChild('div');\n        }\n        current = getCurrent();\n        domel(current)\n            .addChild('label', b => b\n            .attr('for', 'column_field')\n            .text(i18n.getText('Facets', 'Pivot', 'ColumnFieldSelectorLabel')))\n            .addChild('div', b => b\n            .addClass(horizClass)\n            .addChild('div', b => b\n            .addClass('kfrm-select')\n            .attr('name', 'column_field')\n            .addChildElement(this.createColumnsSelectBuilder(colTypes, settings.colName, FormFieldType.ColumnField)\n            .id('pivotTableColFieldSelector')\n            .toDOM()))\n            .addChild('button', b => b\n            .addClass('kfrm-button')\n            .addClass('eqjs-facets-button-swap')\n            .attr('title', i18n.getText('Facets', 'Pivot', 'SwapBtnTitle'))\n            .on('click', () => {\n            const colSelect = document.getElementById('pivotTableColFieldSelector');\n            const rowSelect = document.getElementById('pivotTableRowFieldSelector');\n            const tmp = colSelect.value;\n            colSelect.value = rowSelect.value;\n            rowSelect.value = tmp;\n        })));\n        current = getCurrent();\n        domel(current)\n            .addChild('label', b => b\n            .attr('for', 'row_field')\n            .text(i18n.getText('Facets', 'Pivot', 'RowFieldSelectorLabel')))\n            .addChild('div', b => b\n            .addClass('kfrm-select')\n            .attr('name', 'row_field')\n            .addChildElement(this.createColumnsSelectBuilder(colTypes, settings.rowName, FormFieldType.RowField)\n            .id('pivotTableRowFieldSelector')\n            .toDOM()));\n        current = getCurrent();\n        domel(current)\n            .addChild('label', b => b\n            .attr('for', 'data_function')\n            .text(i18n.getText('Facets', 'Pivot', 'CellDataSelectorLabel')))\n            .addChild('div', b => b\n            .addClass(horizClass)\n            .addChild('div', b => b\n            .addClass('kfrm-select')\n            .attr('name', 'data_function')\n            .addChildElement(this.createAggrFuncSelectBuilder(settings.aggrFunc)\n            .id('pivotTableAggrFuncSelector')\n            .toDOM()))\n            .addChild('label', b => b.addText('of  '))\n            .addChild('div', b => b\n            .addClass('kfrm-select')\n            .attr('name', 'data_column')\n            .addChildElement(this.createColumnsSelectBuilder(fieldTypes, settings.fieldName, FormFieldType.CellData)\n            .on('change', (ev) => {\n            const colId = ev.target.value;\n            this.validateSelectedField(colId);\n        })\n            .id('pivotTableCellFieldSelector')\n            .toDOM())));\n        current = getCurrent();\n        domel(current)\n            .addChild('div')\n            .addChild('div', b => b\n            .addClass(horizClass)\n            .addChild('label', b => b\n            .addClass('checkbox')\n            .addChild('input', b => {\n            b\n                .id('pivotTableHasTotalsRow')\n                .type('checkbox');\n            if (settings.totalsRow)\n                b.attr('checked', '');\n        })\n            .addText(' ' + i18n.getText('Facets', 'Pivot', 'TotalsRowLabel')))\n            .addChild('label', b => b\n            .addClass('checkbox')\n            .addChild('input', b => {\n            b\n                .id('pivotTableHasTotalsCol')\n                .type('checkbox');\n            if (settings.totalsCol)\n                b.attr('checked', '');\n        })\n            .addText(' ' + i18n.getText('Facets', 'Pivot', 'TotalsColLabel'))));\n    }\n    afterDialogOpened(dlg) {\n        const colId = document.getElementById('pivotTableCellFieldSelector').value;\n        if (colId) {\n            this.validateSelectedField(colId);\n        }\n        if (this.getQuery().getColumns().length <= 2) {\n            dlg.showAlert('The dataset should contain at least three columns to build a pivot table', 'error');\n            dlg.getSubmitButtonElement().disabled = true;\n        }\n    }\n    validateSelectedField(colId) {\n        const dataTable = this.getContextDataTable();\n        const colIndex = dataTable.columns.getIndex(colId);\n        const col = dataTable.columns.get(colIndex);\n        const aggrSelector = document.getElementById('pivotTableAggrFuncSelector');\n        if (col.type == DataType.String) {\n            aggrSelector.disabled = true;\n            aggrSelector.value = AggrFunc.Count;\n        }\n        else {\n            aggrSelector.disabled = false;\n        }\n    }\n    submitSettingsDialog() {\n        const result = super.submitSettingsDialog();\n        if (result) {\n            this.settings = {\n                colName: document.getElementById('pivotTableColFieldSelector').value,\n                rowName: document.getElementById('pivotTableRowFieldSelector').value,\n                aggrFunc: document.getElementById('pivotTableAggrFuncSelector').value,\n                fieldName: document.getElementById('pivotTableCellFieldSelector').value,\n                totalsRow: document.getElementById('pivotTableHasTotalsRow').checked,\n                totalsCol: document.getElementById('pivotTableHasTotalsCol').checked\n            };\n        }\n        return result;\n    }\n    saveToData() {\n        const data = super.saveToData();\n        if (this.settings) {\n            utils.assign(data, this.settings);\n        }\n        return data;\n    }\n    loadFromData(data) {\n        super.loadFromData(data);\n        if (data) {\n            this.settings = utils.assign(this.settings, data);\n            if (this.settings.aggrFunc == 'AVERAGE') {\n                this.settings.aggrFunc = AggrFunc.Average;\n            }\n        }\n    }\n    refreshCore() {\n        this.updatePivotData();\n        if (this.grid) {\n            const dataSize = this.pivotTable.getTotal();\n            const maxRow = this.grid.options.paging.pageSize;\n            if (dataSize > maxRow) {\n                this.contentDiv.classList.remove('pivot-grid-with-totals');\n                this.showErrorMessage(i18n.getText('Facets', 'ErrTooMuchData'));\n            }\n            if (this.options.viewportRowsCount > dataSize) {\n                this.grid.options.viewportRowsCount = dataSize;\n            }\n            else {\n                this.grid.options.viewportRowsCount = this.options.viewportRowsCount;\n            }\n            this.grid.refresh();\n        }\n    }\n    getContextDataTable() {\n        const context = this.getContext();\n        return context.resultTable;\n    }\n    updatePivotData() {\n        this.pivotTable.clear();\n        const dataTable = this.getContextDataTable();\n        if (!dataTable || dataTable.getTotal() == 0) {\n            return;\n        }\n        if (!this.settings) {\n            return;\n        }\n        const colName = this.settings.colName;\n        const rowName = this.settings.rowName;\n        const fieldName = this.settings.fieldName;\n        const colIdx = dataTable.columns.getIndex(colName);\n        const rowIdx = dataTable.columns.getIndex(rowName);\n        const fieldIdx = dataTable.columns.getIndex(fieldName);\n        if (colIdx == undefined || rowIdx == undefined || fieldIdx == undefined) {\n            this.showUnableDisplayMessage(i18n.getText('Facets', 'ErrQueryChanged'));\n            return;\n        }\n        const columnField = dataTable.columns.get(fieldIdx);\n        const columnCol = dataTable.columns.get(colIdx);\n        const columnRow = dataTable.columns.get(rowIdx);\n        const rowLabel = columnRow.label;\n        const rowType = columnRow.type;\n        const colLabel = columnCol.label;\n        const colValues = [];\n        const rowValues = [];\n        const rows = dataTable.getCachedRows();\n        for (let i = 0; i < rows.length; i++) {\n            const colValue = rows[i].getValue(colIdx);\n            if (colValues.indexOf(colValue) < 0) {\n                colValues.push(colValue);\n            }\n            const rowValue = rows[i].getValue(rowIdx);\n            if (rowValues.indexOf(rowValue) < 0) {\n                rowValues.push(rowValue);\n            }\n        }\n        this.pivotTable.columns.add({\n            id: rowLabel + '\\\\' + colLabel,\n            label: rowLabel + '\\\\' + colLabel,\n            description: '',\n            type: rowType,\n            dfmt: columnRow.displayFormat,\n            style: columnRow.style\n        });\n        const null_columns = [];\n        let colFieldFormatter = null;\n        if (utils.isNumericType(columnCol.type)) {\n            colFieldFormatter = this.formatNumber;\n        }\n        else if (utils.getDateDataTypes().indexOf(columnCol.type) >= 0) {\n            colFieldFormatter = this.formatDate;\n        }\n        for (let i = 0; i < colValues.length; i++) {\n            const colValue = colValues[i];\n            if (!colValue) {\n                null_columns.push(i);\n            }\n            else {\n                const label = colFieldFormatter\n                    ? colFieldFormatter(columnCol, colValue)\n                    : colValue;\n                this.pivotTable.columns.add({\n                    id: colValue,\n                    label: label,\n                    description: '',\n                    dfmt: columnField.displayFormat,\n                    type: this.settings.aggrFunc !== AggrFunc.Count\n                        ? columnField.type : DataType.Int64,\n                    style: columnField.style\n                });\n            }\n        }\n        let new_rows = [];\n        for (let i = 0; i < rowValues.length; i++) {\n            new_rows.push([]);\n            new_rows[i].push(rowValues[i]);\n        }\n        for (let i = 0; i < rowValues.length; i++) {\n            for (let j = 0; j < colValues.length; j++) {\n                if (null_columns.indexOf(j) >= 0)\n                    continue;\n                new_rows[i].push(this.calcAggrFunc(this.settings.aggrFunc, {\n                    colName: this.settings.colName,\n                    rowName: this.settings.rowName,\n                    fieldName: this.settings.fieldName,\n                    rowValue: rowValues[i],\n                    colValue: colValues[j]\n                }));\n            }\n        }\n        if (this.settings.totalsCol) {\n            this.pivotTable.columns.add({\n                id: \"total\",\n                label: i18n.getText('Facets', 'Pivot', 'TotalGridLabel'),\n                description: '',\n                dfmt: columnField.displayFormat,\n                type: this.settings.aggrFunc !== AggrFunc.Count\n                    ? columnField.type : DataType.Int64\n            });\n            for (let i = 0; i < new_rows.length; i++) {\n                const row = new_rows[i];\n                let totalByRow = 0;\n                if (this.settings.aggrFunc == AggrFunc.Min\n                    || this.settings.aggrFunc == AggrFunc.Max) {\n                    totalByRow = row[1];\n                }\n                for (let j = 1; j < row.length; j++) {\n                    const value = row[j];\n                    if (value !== null) {\n                        if (this.settings.aggrFunc === AggrFunc.Min) {\n                            if (value < totalByRow)\n                                totalByRow = value;\n                        }\n                        else if (this.settings.aggrFunc === AggrFunc.Max) {\n                            if (value > totalByRow)\n                                totalByRow = value;\n                        }\n                        else {\n                            totalByRow += value;\n                        }\n                    }\n                }\n                if (this.settings.aggrFunc === AggrFunc.Average) {\n                    totalByRow /= row.length - 1;\n                }\n                row.push(totalByRow);\n            }\n        }\n        for (const row of new_rows) {\n            this.pivotTable.addRow(row);\n        }\n        if (this.settings.totalsRow) {\n            let total_row = [];\n            // to be able to create date value\n            total_row.push(null);\n            for (let i = 1; i < this.pivotTable.columns.count; i++) {\n                const rows = this.pivotTable.getCachedRows();\n                let totalByCol = 0;\n                if (this.settings.aggrFunc == AggrFunc.Min\n                    || this.settings.aggrFunc == AggrFunc.Max) {\n                    totalByCol = rows[0].getValue(i);\n                }\n                for (let j = 0; j < rows.length; j++) {\n                    const value = rows[j].getValue(i);\n                    if (value !== null) {\n                        if (this.settings.aggrFunc === AggrFunc.Min) {\n                            if (value < totalByCol)\n                                totalByCol = value;\n                        }\n                        else if (this.settings.aggrFunc === AggrFunc.Max) {\n                            if (value > totalByCol)\n                                totalByCol = value;\n                        }\n                        else {\n                            totalByCol += value;\n                        }\n                    }\n                }\n                if (this.settings.aggrFunc === AggrFunc.Average) {\n                    totalByCol /= rows.length;\n                }\n                total_row.push(totalByCol);\n            }\n            this.pivotTable.addRow(total_row);\n            this.contentDiv.classList.add('pivot-grid-with-totals');\n        }\n        else {\n            this.contentDiv.classList.remove('pivot-grid-with-totals');\n        }\n    }\n    calcAggrFunc(func, options) {\n        switch (func) {\n            case AggrFunc.Sum:\n                return this.sum(options);\n            case AggrFunc.Average:\n                return this.average(options);\n            case AggrFunc.Min:\n                return this.min(options);\n            case AggrFunc.Max:\n                return this.max(options);\n            case AggrFunc.Count:\n                return this.count(options);\n            default:\n                return 0;\n        }\n    }\n    getSettings() {\n        return this.settings;\n    }\n    formatDate(column, value) {\n        const isDate = Object.prototype.toString.call(value) === '[object Date]';\n        let strValue = (value || '').toString();\n        if (isDate) {\n            if (column && column.displayFormat\n                && DFMT_REGEX.test(column.displayFormat)) {\n                strValue = column.displayFormat.replace(DFMT_REGEX, (_, $1) => {\n                    return i18n.dateTimeToStrEx(value, column.type, $1);\n                });\n            }\n            else {\n                const locale = i18n.getCurrentLocale();\n                const timeOptions = { hour: 'numeric', minute: 'numeric', second: 'numeric' };\n                switch (column.type) {\n                    case DataType.Date:\n                        strValue = value.toLocaleDateString(locale);\n                        break;\n                    case DataType.Time:\n                        strValue = value.toLocaleTimeString(locale, timeOptions);\n                        break;\n                    case DataType.DateTime:\n                        strValue = `${value.toLocaleDateString(locale)} ${value.toLocaleTimeString(locale, timeOptions)}`;\n                        break;\n                }\n            }\n        }\n        return strValue;\n    }\n    formatNumber(column, value) {\n        let strValue = (value || '').toString();\n        if (typeof value == 'number') {\n            if (column && column.displayFormat\n                && DFMT_REGEX.test(column.displayFormat)) {\n                strValue = column.displayFormat.replace(DFMT_REGEX, (_, $1) => {\n                    return i18n.numberToStr(value, $1);\n                });\n            }\n            else {\n                strValue = value.toLocaleString();\n            }\n        }\n        return strValue;\n    }\n    sum(options) {\n        let result = 0;\n        const dataTable = this.getContextDataTable();\n        const rows = dataTable.getCachedRows();\n        for (let i = 0; i < rows.length; i++) {\n            const rowValue = rows[i].getValue(options.rowName);\n            const colValue = rows[i].getValue(options.colName);\n            if (rowValue !== options.rowValue\n                || colValue !== options.colValue) {\n                continue;\n            }\n            const fieldValue = rows[i].getValue(options.fieldName);\n            result += fieldValue;\n        }\n        return result;\n    }\n    average(options) {\n        let result = 0;\n        let count = 0;\n        const dataTable = this.getContextDataTable();\n        const rows = dataTable.getCachedRows();\n        for (let i = 0; i < rows.length; i++) {\n            const rowValue = rows[i].getValue(options.rowName);\n            const colValue = rows[i].getValue(options.colName);\n            if (rowValue !== options.rowValue\n                || colValue !== options.colValue) {\n                continue;\n            }\n            const fieldValue = rows[i].getValue(options.fieldName);\n            result += fieldValue;\n            count++;\n        }\n        if (count != 0)\n            result = result / count;\n        return result;\n    }\n    min(options) {\n        let min = Number.MAX_SAFE_INTEGER;\n        const dataTable = this.getContextDataTable();\n        const rows = dataTable.getCachedRows();\n        for (let i = 0; i < rows.length; i++) {\n            const rowValue = rows[i].getValue(options.rowName);\n            const colValue = rows[i].getValue(options.colName);\n            if (rowValue !== options.rowValue\n                || colValue !== options.colValue) {\n                continue;\n            }\n            const fieldValue = rows[i].getValue(options.fieldName);\n            if (fieldValue < min) {\n                min = fieldValue;\n            }\n        }\n        if (min == Number.MAX_SAFE_INTEGER)\n            return null;\n        return min;\n    }\n    max(options) {\n        let max = Number.MIN_SAFE_INTEGER;\n        const dataTable = this.getContextDataTable();\n        const rows = dataTable.getCachedRows();\n        for (let i = 0; i < rows.length; i++) {\n            const rowValue = rows[i].getValue(options.rowName);\n            const colValue = rows[i].getValue(options.colName);\n            if (rowValue !== options.rowValue\n                || colValue !== options.colValue) {\n                continue;\n            }\n            const fieldValue = rows[i].getValue(options.fieldName);\n            if (fieldValue > max) {\n                max = fieldValue;\n            }\n        }\n        if (max == Number.MIN_SAFE_INTEGER)\n            return null;\n        return max;\n    }\n    count(options) {\n        const dataTable = this.getContextDataTable();\n        let count = 0;\n        const rows = dataTable.getCachedRows();\n        for (let i = 0; i < rows.length; i++) {\n            const rowValue = rows[i].getValue(options.rowName);\n            const colValue = rows[i].getValue(options.colName);\n            if (rowValue !== options.rowValue\n                || colValue !== options.colValue) {\n                continue;\n            }\n            count++;\n        }\n        return count;\n    }\n}\n\nclass DataTableFacet extends ResultFacet {\n    constructor() {\n        super(...arguments);\n        this.grid = null;\n        this.title = i18n$1.getText('Facets', 'DataTable', 'FacetTitle');\n        this.dialogTitle = i18n$1.getText('Facets', 'DataTable', 'DlgTitle');\n    }\n    init(slot) {\n        super.init(slot);\n        this.reinitGrid();\n    }\n    getSettings() {\n        return this.settings;\n    }\n    reinitGrid() {\n        if (this.grid)\n            this.grid.destroy();\n        const options = this.container.options || {};\n        if (options.gridResolver) {\n            this.grid = options.gridResolver(this.contentDiv, this.getType());\n        }\n        if (this.grid == null) {\n            this.grid = new EasyGridWidget(this.contentDiv);\n        }\n        options.grid = options.grid || {};\n        options.grid.autoRefresh = false;\n        options.grid.addColumns = false;\n        const context = this.getContext();\n        options.grid.totals = this.settings;\n        this.grid.init(context, options.grid);\n    }\n    getType() {\n        return FacetType.DataGrid;\n    }\n    canDisplay() {\n        return true;\n    }\n    refreshCore() {\n        if (!this.grid)\n            return;\n        this.grid.refresh();\n    }\n    destroy() {\n        if (this.grid) {\n            this.grid.destroy();\n        }\n    }\n}\n\nclass FacetContainer extends Widget {\n    constructor(slot) {\n        super(slot);\n        this.facets = [];\n        this.options = {};\n        this.group = WidgetGroup.Result;\n    }\n    destroyCore() {\n        for (const facet of this.facets) {\n            facet.destroy();\n        }\n        this.clear();\n    }\n    createFacetTab(type) {\n        const options = this.options[type];\n        switch (type) {\n            case FacetType.Chart:\n                return new ChartFacet(this, options);\n            case FacetType.PivotTable:\n                return new PivotTableFacet(this, options);\n            default:\n                return new DataTableFacet(this, options);\n        }\n    }\n    getQuery() {\n        return this.getContext().getQuery();\n    }\n}\n\nclass ExportDialog {\n    constructor(context) {\n        this.context = context;\n        this.promise = null;\n    }\n    show(defFormat = null) {\n        if (!this.promise) {\n            const formats = this.context.getExportFormats();\n            if (formats.length == 0)\n                throw Error(\"No exporter has been registered.\");\n            defFormat = defFormat || formats[0];\n            this.promise = new Promise((resolve, reject) => {\n                const ds = this.context.getServices().getService('DialogService');\n                const body = domel('div')\n                    .addClass('kdlg-form-section')\n                    .addChild('div', b => b\n                    .addClass('kfrm-form')\n                    .addChild('div', b => b\n                    .addClass('kfrm-fields col-a-1 label-align-right')\n                    .addChild('label', b => b\n                    .addClass('kdlg-form-label', 'kflex-20')\n                    .attr('for', 'export_format')\n                    .addText(i18n$1.getText('ExportDlgFmtLabel')))\n                    .addChild('div', b => b\n                    .addClass('kfrm-select')\n                    .addChild('select', b => {\n                    b\n                        .attr('name', 'export_format')\n                        .id('exportFormat');\n                    for (const format of this.context.getExportFormats()) {\n                        b.addOption({\n                            value: format,\n                            title: i18n$1.getText(format) || format,\n                            selected: defFormat == format\n                        });\n                    }\n                }))))\n                    .toDOM();\n                ds.open({\n                    title: i18n$1.getText('ExportDlgTitle'),\n                    body: body,\n                    onSubmit: () => {\n                        const format = body.querySelector('#exportFormat').value;\n                        this.context.exportResult({\n                            format: format,\n                            success: resolve,\n                            error: reject\n                        });\n                        return true;\n                    }\n                });\n            });\n        }\n        return this.promise.finally(() => this.promise = null);\n    }\n}\n\nclass ResultFacetsPanel extends FacetContainer {\n    constructor(slot) {\n        super(slot);\n        this.activeFacetIndex = -1;\n        this.firstRender = true;\n        this.options = {\n            showExportButton: true,\n            showRefreshButton: true,\n            showMaximizeButton: true,\n            maximize2Window: false,\n            showProcessIndicator: true,\n            facetTypes: [FacetType.DataGrid, FacetType.Chart, FacetType.PivotTable]\n        };\n        this.menuItems = [\n            { id: FacetType.DataGrid, text: i18n.getText('Facets', 'AddMenuItems', 'DataTable') },\n            { id: FacetType.Chart, text: i18n.getText('Facets', 'AddMenuItems', 'Chart') },\n            { id: FacetType.PivotTable, text: i18n.getText('Facets', 'AddMenuItems', 'Pivot') }\n        ];\n        this.menuItemsFilter = (item) => {\n            if (this.options.facetTypes.indexOf(item.id) < 0)\n                return false;\n            if (item.id === FacetType.DataGrid) {\n                return this.facets.filter(facet => facet.getType() == FacetType.DataGrid).length === 0;\n            }\n            return true;\n        };\n        if (!this.slot.classList.contains(`${this.cssPrefix}-panel`)) {\n            this.slot.classList.add(`${this.cssPrefix}-panel`);\n        }\n        this.renderProcessBlock();\n    }\n    get cssPrefix() {\n        return 'eqjs-facets';\n    }\n    getWidgetType() {\n        return 'facetsPanel';\n    }\n    /**\n     * Initialize widget.\n     * @param context The context.\n     * @param options The options.\n     */\n    init(context, options) {\n        super.init(context, options);\n        this.setOptions(options);\n        this.destroyCore();\n        this.attachQueryObserver();\n        this.loadFacets();\n    }\n    attachQueryObserver() {\n        const query = this.getQuery();\n        if (this.queryEventCallbackId) {\n            query.removeChangedCallback(this.queryEventCallbackId);\n        }\n        this.queryEventCallbackId = query.addChangedCallback(event => {\n            //if something has changed, and that change is related to columns\n            const edata = event.data;\n            if (edata.part != QueryChangePart.All) {\n                return;\n            }\n            if (edata.source == this) {\n                return;\n            }\n            this.reloadFacets();\n            this.refreshCore(true);\n        });\n    }\n    refreshCore(force = false) {\n        if (this.firstRender || force) {\n            this.clear();\n            this.createAddMenu();\n            this.render();\n        }\n        this.validateAddFacetButton();\n        this.renderActiveFacet();\n        this.updateTotalRecords();\n    }\n    createAddMenu() {\n        this.addMenu = new PopupMenu({\n            items: this.menuItems,\n            id: \"FacetType-List\"\n        });\n    }\n    updateTotalRecords() {\n        const context = this.getContext();\n        const total = context.resultTable.getTotal();\n        this.recordsDiv.innerHTML = i18n.getText('Facets', 'TotalRecordsLabel') + ' ' + total;\n        if (total == 0) {\n            domel(this.exportDiv).hide();\n        }\n        else {\n            domel(this.exportDiv).show();\n        }\n    }\n    renderProcessBlock() {\n        const html = '<div class=\"wBall\" id=\"wBall_1\"><div class=\"wInnerBall\"></div></div><div class=\"wBall\" id=\"wBall_2\"><div class=\"wInnerBall\"></div></div><div class=\"wBall\" id=\"wBall_3\"><div class=\"wInnerBall\"></div></div><div class=\"wBall\" id=\"wBall_4\"><div class=\"wInnerBall\"></div></div><div class=\"wBall\" id=\"wBall_5\"><div class=\"wInnerBall\"></div></div>';\n        this._processBlock = domel('div')\n            .addClass(`${this.cssPrefix}-spinner`)\n            .addChild('div', b => b\n            .addClass(`${eqCssPrefix}-progress-win8`, getMobileCssClass())\n            .addHtml(html))\n            .toDOM();\n    }\n    onProcessStartCore() {\n        if (this.options.showProcessIndicator) {\n            // FacetsPanel might be not rendered yet, so \n            // it has no body\n            if (!this._processBlock.parentNode && this.bodyDiv) {\n                this.bodyDiv.childNodes.forEach(el => {\n                    domel(el).hide();\n                });\n                this.bodyDiv.appendChild(this._processBlock);\n            }\n        }\n    }\n    onProcessEndCore() {\n        if (this.options.showProcessIndicator) {\n            if (this._processBlock.parentNode) {\n                try {\n                    this._processBlock.parentNode\n                        .removeChild(this._processBlock);\n                }\n                catch (e) {\n                }\n                finally {\n                    this.renderActiveFacet(false);\n                }\n            }\n        }\n    }\n    render() {\n        this.firstRender = false;\n        this.headerDiv = domel('div', this.slot)\n            .addClass(`${this.cssPrefix}-header`)\n            .toDOM();\n        this.tabsDiv =\n            domel('div', this.headerDiv)\n                .addClass(`${this.cssPrefix}-tabs`)\n                .toDOM();\n        this.tabsUl = domel('ul', this.tabsDiv)\n            .addClass(`${this.cssPrefix}-nav-tabs`)\n            .toDOM();\n        this.bodyDiv =\n            domel('div', this.slot)\n                .addClass(`${this.cssPrefix}-body`)\n                .toDOM();\n        for (const facet of this.facets) {\n            this.renderFacet(facet);\n        }\n        domel(this.tabsDiv)\n            .addChild('div', b => this.addFacetButton = b\n            .addClass(`${this.cssPrefix}-add-button`)\n            .title(i18n.getText('Facets', 'NewFacetTitle'))\n            .addChild('a', b => b\n            .attr('href', 'javascript:void(0)'))\n            .on('click', (e) => this.addClickHandler(e))\n            .toDOM());\n        const manageDiv = domel('div', this.headerDiv)\n            .addClass(`${this.cssPrefix}-manage`)\n            .toDOM();\n        this.recordsDiv = domel('div', manageDiv)\n            .addClass(`${this.cssPrefix}-total-recs`)\n            .toDOM();\n        if (this.options.showRefreshButton || this.options.showExportButton || this.options.showMaximizeButton) {\n            const bdb = domel('div', manageDiv)\n                .addClass(`${this.cssPrefix}-total-buttons`)\n                .toDOM();\n            if (this.options.showExportButton) {\n                this.exportDiv = domel('button', bdb)\n                    .on('click', () => this.exportHandler())\n                    .addClass(`${this.cssPrefix}-button`)\n                    .addClass(`${this.cssPrefix}-button-export`)\n                    .title(i18n.getText('Facets', 'ExportBtnTitle'))\n                    .toDOM();\n            }\n            if (this.options.showRefreshButton) {\n                domel('button', bdb)\n                    .on('click', () => this.refreshHandler())\n                    .addClass(`${this.cssPrefix}-button`)\n                    .addClass(`${this.cssPrefix}-button-refresh`)\n                    .title(i18n.getText('Facets', 'RefreshBtnTitle'));\n            }\n            if (this.options.showMaximizeButton) {\n                this.maximizeButton = domel('button', bdb)\n                    .on('click', () => this.options.maximize2Window ? this.maximizeHandler(true) : this.maximizeHandler())\n                    .addClass(`${this.cssPrefix}-button`)\n                    .addClass(`${this.cssPrefix}-button-maximize`)\n                    .title(i18n.getText('Facets', 'MaximizeBtnTitle'))\n                    .toDOM();\n            }\n        }\n    }\n    refreshHandler() {\n        const context = this.getContext();\n        context.fetchData({\n            success: () => {\n                // possibly we should move this logic to context\n                context.refreshWidgets(WidgetGroup.Result);\n            }\n        });\n    }\n    exportHandler() {\n        const context = this.getContext();\n        new ExportDialog(context)\n            .show();\n    }\n    maximizeHandler(toWindow) {\n        let b = domel(this.slot);\n        if (toWindow) {\n            b.toggleClass(`${eqCssPrefix}-maximized-2window`);\n            if (this.slot.classList.contains(`${eqCssPrefix}-maximized-2window`)) {\n                this.maximizeButton.title = i18n.getText('Facets', 'RestoreBtnTitle');\n                this.maximizeButton.classList.toggle(`${this.cssPrefix}-button-maximize`, false);\n                this.maximizeButton.classList.toggle(`${this.cssPrefix}-button-restore`, true);\n            }\n            else {\n                this.maximizeButton.title = i18n.getText('Facets', 'MaximizeBtnTitle');\n                this.maximizeButton.classList.toggle(`${this.cssPrefix}-button-restore`, false);\n                this.maximizeButton.classList.toggle(`${this.cssPrefix}-button-maximize`, true);\n            }\n        }\n        else {\n            const isMaximized = !this.slot.hasAttribute('data-is-maximized');\n            if (isMaximized) {\n                this.slot.setAttribute('data-is-maximized', '');\n                this.maximizeButton.title = i18n.getText('Facets', 'RestoreBtnTitle');\n                this.maximizeButton.classList.toggle(`${this.cssPrefix}-button-maximize`, false);\n                this.maximizeButton.classList.toggle(`${this.cssPrefix}-button-restore`, true);\n            }\n            else {\n                this.slot.removeAttribute('data-is-maximized');\n                this.maximizeButton.title = i18n.getText('Facets', 'MaximizeBtnTitle');\n                this.maximizeButton.classList.toggle(`${this.cssPrefix}-button-restore`, false);\n                this.maximizeButton.classList.toggle(`${this.cssPrefix}-button-maximize`, true);\n            }\n            const arrToHide = document.querySelectorAll('[data-hide-on-max]');\n            arrToHide.forEach(el => {\n                if (isMaximized) {\n                    el.setAttribute('style', 'display: none;');\n                }\n                else {\n                    el.removeAttribute('style');\n                }\n            });\n        }\n        this.facets.forEach(facetTab => facetTab.onResize());\n    }\n    renderActiveFacet(refresh = true) {\n        this.tabsUl.querySelectorAll('li') //`.${this.cssPrefix}-header-item.${this.cssPrefix}-facet`)\n            .forEach((el, index) => {\n            if (el.classList.contains('active')) {\n                el.classList.remove('active');\n            }\n            if (this.activeFacetIndex === index) {\n                el.classList.add('active');\n            }\n        });\n        this.bodyDiv.querySelectorAll(`.${eqCssPrefix}-facet`)\n            .forEach((el, index) => {\n            domel(el).hide();\n            if (this.activeFacetIndex === index) {\n                domel(el).show();\n                if (refresh) {\n                    this.facets[index].refresh();\n                }\n            }\n        });\n    }\n    renderFacet(facet) {\n        this.renderFacetTab(facet);\n        const body = this.renderFacetSlot(facet);\n        facet.init(body);\n    }\n    renderFacetTab(facet) {\n        return domel('li', this.tabsUl)\n            //.addClass(`${this.cssPrefix}-header-item`, `${this.cssPrefix}-facet`)\n            //facet settings button\n            .addChild('span', b => b\n            .addClass(`${eqCssPrefix}-facet-settings`)\n            .on('click', (e) => {\n            e.stopPropagation();\n            this.settingsClickHandler(facet);\n        }))\n            .addChild('a', b => b\n            .addText(facet.title)\n            .attr('href', 'javascript:void(0)'))\n            //facet close button\n            .addChild('span', b => b\n            .addClass(`${eqCssPrefix}-facet-close`)\n            .on('click', (e) => {\n            e.stopPropagation();\n            this.closeClickHandler(facet);\n        }))\n            .on('click', (e) => this.selectClickHandler(facet))\n            .toDOM();\n    }\n    renderFacetSlot(facet) {\n        let element = domel('div', this.bodyDiv)\n            .addClass(`${eqCssPrefix}-facet`)\n            .hide()\n            .toDOM();\n        return element;\n    }\n    refreshFacetTabs() {\n        this.tabsUl.querySelectorAll('li') //`.${this.cssPrefix}-header-item.${this.cssPrefix}-facet`)\n            .forEach((item) => {\n            this.tabsUl.removeChild(item);\n        });\n        for (const facet of this.facets) {\n            this.renderFacetTab(facet);\n        }\n    }\n    removeFacet(facet) {\n        const index = this.facets.indexOf(facet);\n        if (index >= 0) {\n            this.facets.splice(index, 1);\n            const header = this.tabsUl.childNodes[index];\n            this.tabsUl.removeChild(header);\n            const body = this.bodyDiv.childNodes[index];\n            this.bodyDiv.removeChild(body);\n            if (this.facets.length > 0) {\n                this.activeFacetIndex =\n                    index < this.facets.length\n                        ? index\n                        : this.facets.length - 1;\n            }\n            else {\n                this.activeFacetIndex = -1;\n            }\n            this.renderActiveFacet();\n            this.validateAddFacetButton();\n        }\n    }\n    addClickHandler(ev) {\n        this.addMenu.showMenu({\n            anchor: ev.target,\n            itemFilterCallback: this.menuItemsFilter,\n            itemSelectedCallback: (data) => {\n                const facet = this.createFacetTab(data.id);\n                const facetSlot = this.renderFacetSlot(facet);\n                facet.init(facetSlot);\n                facet.showSettingsDialog()\n                    .then(submited => {\n                    if (submited) {\n                        this.facets.push(facet);\n                        this.activeFacetIndex = this.facets.length - 1;\n                        this.renderFacetTab(facet);\n                        this.renderActiveFacet();\n                        this.saveFacets();\n                    }\n                    else {\n                        this.bodyDiv.removeChild(facetSlot);\n                    }\n                    //this.validateAddFacetButton();\n                })\n                    .catch(error => console.error(error));\n            }\n        });\n    }\n    selectClickHandler(facet) {\n        const index = this.facets.indexOf(facet);\n        this.setActiveFacet(index);\n    }\n    settingsClickHandler(facet) {\n        facet.showSettingsDialog()\n            .then(submited => {\n            if (submited) {\n                this.refreshFacetTabs();\n                this.renderActiveFacet();\n                this.saveFacets();\n            }\n        })\n            .catch(error => console.error(error));\n    }\n    closeClickHandler(facet) {\n        const ds = this.getDialogService();\n        ds.openConfirm(i18n.getText('Facets', 'RemoveFacetDlgTitle'), i18n.getText('Facets', 'RemoveFacetDlgContent')\n            .replace('{facetTitle}', facet.title))\n            .then(confirmed => {\n            if (confirmed) {\n                this.removeFacet(facet);\n                this.saveFacets();\n            }\n        })\n            .catch(error => console.error(error));\n    }\n    clear() {\n        this.firstRender = true;\n        this.slot.innerHTML = \"\";\n    }\n    createDefaultFacetIfNotExist() {\n        if (this.facets.length === 0) {\n            const facet = this.createFacetTab(FacetType.DataGrid);\n            this.facets.push(facet);\n            this.activeFacetIndex = 0;\n        }\n    }\n    validateAddFacetButton() {\n        this.addFacetButton.hidden = this.addMenu.getItems()\n            .filter(this.menuItemsFilter).length == 0;\n    }\n    setActiveFacet(index) {\n        if (this.activeFacetIndex != index) {\n            this.activeFacetIndex = index;\n            this.renderActiveFacet();\n            this.saveFacets(true);\n        }\n    }\n    setOptions(options) {\n        utils.assignDeep(this.options, options);\n    }\n    getDialogService() {\n        return this.getContext()\n            .getServices()\n            .getService('DialogService');\n    }\n    saveFacets(isActivate = false) {\n        const query = this.getQuery();\n        query.innerData = query.innerData || {};\n        query.innerData.facets = {\n            active: this.activeFacetIndex,\n            items: this.facets.map(f => f.saveToData())\n        };\n        query.fireChangedEvent({\n            part: QueryChangePart.Facets,\n            action: isActivate ? QueryChangeAction.Activate : QueryChangeAction.All,\n            source: this\n        });\n    }\n    reloadFacets() {\n        for (const facet of this.facets) {\n            facet.destroy();\n        }\n        this.loadFacets();\n    }\n    loadFacets() {\n        const query = this.getQuery();\n        this.facets = [];\n        if (query.innerData && query.innerData.facets) {\n            const items = query.innerData.facets.items;\n            for (const fd of items) {\n                const facet = this.createFacetTab(fd.type);\n                facet.loadFromData(fd);\n                this.facets.push(facet);\n            }\n            const active = query.innerData.facets.active;\n            this.activeFacetIndex = (active >= 0)\n                ? active\n                : this.facets.length - 1;\n        }\n        else {\n            this.createDefaultFacetIfNotExist();\n        }\n    }\n}\n\nclass ExportWidget extends Widget {\n    getWidgetType() {\n        return 'exportWidget';\n    }\n    constructor(slot) {\n        super(slot);\n        this.options = {\n            defFormat: 'csv',\n            enableExport: true\n        };\n        this.clickHandler = (ev) => {\n            if (!this.slot.hasAttribute('disabled'))\n                new ExportDialog(this.context).show(this.options.defFormat);\n        };\n        this.group = WidgetGroup.All;\n    }\n    init(context, options) {\n        super.init(context, options);\n        this.options = utils.assignDeep(this.options, options);\n        this.slot.addEventListener('click', this.clickHandler);\n    }\n    refreshCore() {\n        if (this.options.enableExport && this.context.resultTable\n            && this.context.resultTable.getCachedCount() > 0) {\n            this.slot.removeAttribute('disabled');\n        }\n        else {\n            this.slot.setAttribute('disabled', '');\n        }\n    }\n    destroyCore() {\n        this.slot.removeAttribute('disabled');\n        this.slot.removeEventListener('click', this.clickHandler);\n    }\n}\n\nclass AggrSettingsRenderer {\n    get cssPrefix() {\n        return 'eqjs-as';\n    }\n    constructor(options) {\n        this.selectState = {\n            columns: []\n        };\n        this.funcMap = {};\n        if (!options || !options.slot)\n            throw new Error('slot is required');\n        if (!options || !options.query)\n            throw new Error('query is required');\n        this.slot = options.slot;\n        this.query = options.query;\n        this.onChanged = options.onChanged;\n        this.dropSelectState();\n        this.dropState();\n    }\n    render() {\n        this.createFunctionMenu();\n        this.setInitialState();\n        this.changed();\n    }\n    setInitialState() {\n        const aggrSettings = this.query.getAggregationSettings();\n        const groups = aggrSettings.getInternalGroups();\n        const aggrs = aggrSettings.getAggregates();\n        for (const group of groups) {\n            this.state.groups.push({\n                columns: group.columns\n            });\n        }\n        for (const aggr of aggrs) {\n            this.state.aggregates.push({\n                colId: aggr.colId,\n                funcId: aggr.funcId\n            });\n        }\n        this.state.grandTotals = aggrSettings.hasGrandTotals();\n        this.state.recordCount = aggrSettings.hasRecordCount();\n    }\n    getAvailableColumns() {\n        return this.query.getColumns().filter(c => c.enabled);\n    }\n    renderCore() {\n        this.slot.innerHTML = '';\n        const cols = this.getAvailableColumns();\n        const slotb = domel(this.slot);\n        let currentGroup = null;\n        let groupBlockColumns = null;\n        let selectedBlockColumns = null;\n        const aggregates = this.state.aggregates;\n        let groupCounter = -1;\n        for (const col of cols) {\n            if (currentGroup) {\n                if (currentGroup.columns.indexOf(col.id) >= 0) {\n                    // render to current group div\n                    this.renderColumn(groupBlockColumns, col, true);\n                    continue;\n                }\n            }\n            currentGroup = this.getGroupForColumn(col.id);\n            if (currentGroup != null) {\n                groupCounter++;\n                // create groupDiv\n                const groupBlock = domel('div', this.slot)\n                    .addClass(`${this.cssPrefix}-group`)\n                    .data('gindex', `${groupCounter}`);\n                groupBlockColumns = domel('div', groupBlock.toDOM())\n                    .addClass(`${this.cssPrefix}-columns`);\n                this.renderColumn(groupBlockColumns, col, true);\n                continue;\n            }\n            const aggr = aggregates.filter(a => a.colId == col.id)[0];\n            if (aggr) {\n                const aggrBlock = domel('div', this.slot)\n                    .addClass(`${this.cssPrefix}-aggr`);\n                this.renderColumn(aggrBlock, col, true, aggr.funcId);\n                aggrBlock\n                    .addChild('div', b => b\n                    .addClass(`${this.cssPrefix}-buttons`)\n                    .addChild('button', b => b\n                    .addClass(`${this.cssPrefix}-unaggr-btn`)\n                    .title(i18n$1.getText('AggrSettings', 'UnaggrBtn'))\n                    .on('click', this.removeAggrBtnClickHandler.bind(this))));\n                continue;\n            }\n            if (this.selectState.columns.indexOf(col.id) >= 0) {\n                // create selectedDiv\n                if (selectedBlockColumns == null) {\n                    const selectedBlock = domel('div', this.slot)\n                        .addClass(`${this.cssPrefix}-selected`);\n                    selectedBlockColumns = domel('div', selectedBlock.toDOM())\n                        .addClass(`${this.cssPrefix}-columns`);\n                }\n                this.renderColumn(selectedBlockColumns, col, false);\n                continue;\n            }\n            // render column as is\n            this.renderColumn(slotb, col, false);\n        }\n        if (selectedBlockColumns) {\n            const buttonsContainer = domel('div', selectedBlockColumns.toDOM().parentElement)\n                .addClass(`${this.cssPrefix}-buttons`);\n            buttonsContainer.addChild('button', b => b\n                .addClass(`${this.cssPrefix}-group-btn`)\n                .title(i18n$1.getText('AggrSettings', 'GroupBtn'))\n                .on('click', this.groupBtnClickHandler.bind(this)));\n            if (this.selectState.columns.length == 1) {\n                buttonsContainer.addChild('button', b => b\n                    .addClass(`${this.cssPrefix}-aggr-btn`)\n                    .title(i18n$1.getText('AggrSettings', 'AggrBtn'))\n                    .on('click', this.aggrBtnClickHandler.bind(this)));\n            }\n        }\n        domel(this.slot)\n            .addChild('div', b => b\n            .addClass(`${this.cssPrefix}-counts`)\n            .addChild('label', b => b\n            .addClass('eqjs-ctrl-switch')\n            .addChild('input', b => {\n            b.attr('type', 'checkbox');\n            if (this.state.recordCount) {\n                b.attr('checked', '');\n            }\n            b.on('change', this.countsCheckboxChangeHandler.bind(this));\n        })\n            .addChild('span', b => b\n            .addClass('slider round'))\n            .addChild('span', b => b\n            .addClass('switch-text')\n            .addText(i18n$1.getText('AggrSettings', 'GroupCountsLabel')))))\n            .addChild('div', b => b\n            .addClass(`${this.cssPrefix}-grandtotals`)\n            .addChild('label', b => b\n            .addClass('eqjs-ctrl-switch')\n            .addChild('input', b => {\n            b.attr('type', 'checkbox');\n            if (this.state.grandTotals) {\n                b.attr('checked', '');\n            }\n            b.on('change', this.grandCheckboxChangeHandler.bind(this));\n        })\n            .addChild('span', b => b\n            .addClass('slider round'))\n            .addChild('span', b => b\n            .addClass('switch-text')\n            .addText(i18n$1.getText('AggrSettings', 'GrandTotalsLabel')))));\n        const groups = this.slot.querySelectorAll(`.${this.cssPrefix}-group`);\n        groups.forEach(el => {\n            domel(el)\n                .addChild('div', b => b\n                .addClass(`${this.cssPrefix}-buttons`)\n                .addChild('button', b => b\n                .addClass(`${this.cssPrefix}-ungroup-btn`)\n                .title(i18n$1.getText('AggrSettings', 'UngroupBtn'))\n                .on('click', this.removeGroupBtnClickHandler.bind(this))));\n        });\n        this.validateCheckboxes();\n    }\n    validateCheckboxes() {\n        if (this.selectState.columns.length === 0)\n            return;\n        let prevElement, prevInputEl, nextInputEl = null;\n        for (let i = 0; i < this.slot.childNodes.length; i++) {\n            const el = this.slot.childNodes[i];\n            if (el.classList.contains(`${this.cssPrefix}-selected`)) {\n                if (prevElement && prevElement.classList.contains(`${this.cssPrefix}-column`)) {\n                    prevInputEl = prevElement;\n                }\n            }\n            else if (el.classList.contains(`${this.cssPrefix}-column`)) {\n                if (prevElement && prevElement.classList.contains(`${this.cssPrefix}-selected`)) {\n                    nextInputEl = el;\n                }\n            }\n            prevElement = el;\n        }\n        for (let i = 0; i < this.slot.childNodes.length; i++) {\n            const el = this.slot.childNodes[i];\n            if (el.classList.contains(`${this.cssPrefix}-column`) && el != prevInputEl && el != nextInputEl) {\n                el.firstElementChild.firstElementChild.setAttribute('disabled', '');\n            }\n        }\n        const selector = `.${this.cssPrefix}-selected>.${this.cssPrefix}-columns>.${this.cssPrefix}-column`;\n        const selectedCols = this.slot.querySelectorAll(selector);\n        for (let i = 1; i < selectedCols.length - 1; i++) {\n            const el = selectedCols[i];\n            el.firstElementChild.firstElementChild.setAttribute('disabled', '');\n        }\n    }\n    isValid() {\n        const hasSelected = this.selectState.columns.length;\n        const hasAggrs = this.state.aggregates.length > 0;\n        const hasGroups = this.state.groups.length > 0;\n        const hasTotals = this.state.grandTotals;\n        const hasCounts = this.state.recordCount;\n        if (hasSelected)\n            return false;\n        if (hasGroups) {\n            return hasAggrs || hasCounts;\n        }\n        if (hasAggrs) {\n            return hasGroups || hasTotals;\n        }\n        return false;\n    }\n    getValidationMessage() {\n        const hasSelected = this.selectState.columns.length;\n        const hasAggrs = this.state.aggregates.length > 0;\n        const hasGroups = this.state.groups.length > 0;\n        const hasTotals = this.state.grandTotals;\n        const hasRecCount = this.state.recordCount;\n        if (hasSelected)\n            return `${i18n$1.getText('AggrSettings', 'SelectedError')} `;\n        if (hasGroups && !hasAggrs && !hasRecCount)\n            return `${i18n$1.getText('AggrSettings', 'NoAggrOrCountError')} `;\n        if (hasAggrs && !hasGroups && !hasTotals)\n            return `${i18n$1.getText('AggrSettings', 'NoGroupsOrGrandError')} `;\n        return `${i18n$1.getText('AggrSettings', 'NoGroupsOrAggrError')} `;\n    }\n    getSettings() {\n        const settings = new AggregationSettings(this.query);\n        for (const group of this.state.groups) {\n            settings.addGroup({ columns: group.columns });\n        }\n        for (const aggr of this.state.aggregates) {\n            settings.addAggregateColumn(aggr.colId, aggr.funcId);\n        }\n        if (this.state.grandTotals) {\n            settings.addGrandTotals();\n        }\n        if (this.state.recordCount) {\n            settings.addCounts();\n        }\n        return settings;\n    }\n    renderColumn(b, col, isTaken, funcId = null) {\n        b.addChild('div', b => {\n            b.data('colid', col.id);\n            const caption = funcId\n                ? `${col.caption} (${this.funcMap[funcId].caption})`\n                : col.caption;\n            if (!isTaken) {\n                b\n                    .addClass(`${this.cssPrefix}-column`)\n                    .addChild('label', b => b\n                    .addClass('checkbox')\n                    .addChild('input', b => {\n                    b.attr('type', 'checkbox');\n                    if (this.selectState.columns.indexOf(col.id) >= 0) {\n                        b.attr('checked', '');\n                    }\n                    b.on('change', this.colCheckboxChangeHandler.bind(this));\n                })\n                    .addText(caption));\n            }\n            else {\n                b\n                    .addClass(`${this.cssPrefix}-column-used`)\n                    .addText(caption);\n            }\n        });\n    }\n    getGroupForColumn(colId) {\n        const index = this.getGroupIndexForColumn(colId);\n        if (index >= 0)\n            return this.state.groups[index];\n        return null;\n    }\n    getGroupIndexForColumn(colId) {\n        for (var i = 0; i < this.state.groups.length; i++) {\n            const group = this.state.groups[i];\n            if (group.columns.indexOf(colId) >= 0)\n                return i;\n        }\n        return -1;\n    }\n    grandCheckboxChangeHandler(ev) {\n        this.state.grandTotals = !this.state.grandTotals;\n        this.onChanged && this.onChanged();\n    }\n    countsCheckboxChangeHandler(ev) {\n        this.state.recordCount = !this.state.recordCount;\n        this.onChanged && this.onChanged();\n    }\n    colCheckboxChangeHandler(ev) {\n        const input = ev.target;\n        const colId = input.parentElement.parentElement.getAttribute('data-colid');\n        // toggle column to track state\n        const index = this.selectState.columns.indexOf(colId);\n        if (index >= 0) {\n            this.selectState.columns.splice(index, 1);\n        }\n        else {\n            this.selectState.columns.push(colId);\n            const cols = this.getAvailableColumns();\n            this.selectState.columns = this.selectState.columns.sort((col1, col2) => {\n                const index1 = cols.findIndex(c => c.id == col1);\n                const index2 = cols.findIndex(c => c.id == col2);\n                return index1 - index2;\n            });\n        }\n        this.changed();\n    }\n    groupBtnClickHandler() {\n        this.state.groups.push({ columns: this.selectState.columns });\n        const cols = this.getAvailableColumns();\n        this.state.groups = this.state.groups.sort((g1, g2) => {\n            const g1Index = cols.findIndex(c => c.id == g1.columns[0]);\n            const g2Index = cols.findIndex(c => c.id == g2.columns[0]);\n            return g1Index - g2Index;\n        });\n        this.dropSelectState();\n        this.changed();\n    }\n    removeGroupBtnClickHandler(ev) {\n        const btn = ev.target;\n        const index = Number.parseInt(btn.parentElement.parentElement.getAttribute('data-gindex'));\n        this.state.groups.splice(index, 1);\n        this.changed();\n    }\n    removeAggrBtnClickHandler(ev) {\n        const btn = ev.target;\n        const colId = btn.parentElement.parentElement.querySelector(`.${this.cssPrefix}-column-used`)\n            .getAttribute('data-colid');\n        const index = this.state.aggregates.findIndex(a => a.colId == colId);\n        if (index >= 0) {\n            this.state.aggregates.splice(index, 1);\n            this.changed();\n        }\n    }\n    aggrBtnClickHandler(ev) {\n        this.query.getModel();\n        const colId = this.selectState.columns[0];\n        const col = this.getAvailableColumns().filter(c => c.id == colId)[0];\n        this.functionMenu.showMenu({\n            anchor: ev.target,\n            itemFilterCallback: (item) => {\n                return this.funcMap[item.id].appliedTypes.indexOf(col.expr.dataType) >= 0;\n            },\n            itemSelectedCallback: (data) => {\n                this.state.aggregates.push({\n                    colId: colId,\n                    funcId: data.id\n                });\n                this.dropSelectState();\n                this.changed();\n            }\n        });\n    }\n    clear() {\n        this.dropSelectState();\n        this.dropState();\n        this.changed();\n    }\n    dropSelectState() {\n        this.selectState = {\n            columns: []\n        };\n    }\n    dropState() {\n        this.state = {\n            groups: [],\n            aggregates: [],\n            recordCount: true,\n            grandTotals: false\n        };\n    }\n    changed() {\n        this.onChanged && this.onChanged();\n        this.renderCore();\n    }\n    createFunctionMenu() {\n        const model = this.query.getModel();\n        const funcs = this.query.getModel().getAggrFunctions();\n        const items = [];\n        for (const func of funcs) {\n            //add all functions except those we don't process\n            if (!func || func.id == 'MIN' || func.id == 'MAX' || func.id == 'CNTDST')\n                continue;\n            this.funcMap[func.id] = func;\n            const funcCaption = model\n                .getAggrFunctionCaption(func.id);\n            const item = {\n                id: func.id,\n                text: funcCaption\n            };\n            items.push(item);\n        }\n        let menuId = this.slot.id;\n        if (menuId) {\n            menuId += '-FunctionsMenu';\n        }\n        const menuOptions = {\n            items: items,\n            id: menuId,\n            searchBoxAlwaysShown: false,\n            domWriteItemsId: true\n        };\n        this.functionMenu = new PopupMenu(menuOptions);\n    }\n}\n\nclass AggrSettingsDialog {\n    constructor(context) {\n        this.context = context;\n        this.promise = null;\n    }\n    show(query) {\n        const initQuery = query || this.context.getQuery();\n        // copy query to prevent changes\n        this.query = this.context.createQuery();\n        this.query.loadFromData(initQuery.toJSONData());\n        // to rewrite with returning new aggrsettigns\n        // structure instead of apply on submit\n        if (!this.promise) {\n            this.promise = new Promise((resolve, reject) => {\n                const ds = this.context.getServices().getService('DialogService');\n                this.body = this.renderBody();\n                var dlg = ds.open({\n                    title: i18n$1.getText('AggrSettings', 'AggrDialogTitle'),\n                    body: this.body,\n                    onSubmit: () => {\n                        if (this.query.enableAggregation && !this.renderer.isValid())\n                            return false;\n                        initQuery.enableAggregation = this.query.enableAggregation;\n                        if (initQuery.enableAggregation) {\n                            initQuery.useAggregation(settings => {\n                                const s = this.renderer.getSettings();\n                                settings.loadFromData(s.saveToData());\n                            });\n                        }\n                        initQuery.fireChangedEvent({\n                            part: QueryChangePart.Aggregation,\n                            wasModified: false\n                        });\n                        resolve();\n                        return true;\n                    },\n                    onCancel: () => {\n                        resolve();\n                    }\n                });\n                this.renderer = new AggrSettingsRenderer({\n                    slot: this.body.querySelector('#AggrSettingsComponent'),\n                    query: this.query,\n                    onChanged: () => {\n                        dlg.clearAlert();\n                        const isValid = this.renderer.isValid();\n                        if (!isValid) {\n                            const error = this.renderer.getValidationMessage();\n                            dlg.showAlert(error, 'warning');\n                        }\n                        const btn = dlg.getRootElement()\n                            .querySelector('.kfrm-button.is-info');\n                        btn.disabled = !isValid && this.query.enableAggregation;\n                    }\n                });\n                if (this.query.enableAggregation) {\n                    this.renderer.render();\n                }\n            });\n        }\n        return this.promise.catch(e => console.error(e))\n            .finally(() => this.promise = null);\n    }\n    renderBody() {\n        const b = domel('div')\n            .addChild('div', b => b\n            .addClass(`eqjs-as-enableaggr`)\n            .addChild('label', b => b\n            .addClass('eqjs-ctrl-switch')\n            .addChild('input', b => {\n            b.attr('type', 'checkbox');\n            if (this.query.enableAggregation) {\n                b.attr('checked', '');\n            }\n            b.on('change', this.enableAggrCheckBoxChangeHandler.bind(this));\n        })\n            .addChild('span', b => b\n            .addClass('slider round'))\n            .addChild('span', b => b\n            .addClass('switch-text')\n            .addText(i18n$1.getText('AggrSettings', 'EnableAggrLabel')))))\n            .addChild('div', b => b\n            .id('AggrSettingsComponent'));\n        return b.toDOM();\n    }\n    enableAggrCheckBoxChangeHandler(e) {\n        this.query.enableAggregation = !this.query.enableAggregation;\n        this.body.querySelector('#AggrSettingsComponent').innerHTML = '';\n        if (this.query.enableAggregation) {\n            this.renderer.render();\n        }\n        else {\n            const btn = this.body ? this.body.closest('.kdlg-modal').querySelector('footer .kfrm-button.is-info') : null;\n            if (btn) {\n                btn.disabled = false;\n            }\n        }\n    }\n}\n\n/**\n * The widget responsed for rendering the name of the current query.\n */\nclass AggregationBar extends Widget {\n    /**\n     * The default constructor.\n     * @param slot The HTML element where our widget should be placed.\n     * @param customQuery The custom query\n     */\n    constructor(slot, customQuery) {\n        super(slot);\n        this.linkClickCallback = () => {\n            new AggrSettingsDialog(this.context).show(this.getQuery());\n        };\n        this.queryEventCallbackId = null;\n        this.customQuery = customQuery;\n        this.group = WidgetGroup.Query | WidgetGroup.QueryStatus;\n    }\n    init(context, options) {\n        super.init(context, options);\n        this.destroyCore();\n        this.attachQueryObserver();\n    }\n    get cssPrefix() {\n        return 'eqjs-aggrb';\n    }\n    getWidgetType() {\n        return 'aggregationBar';\n    }\n    /**\n     * Refresh widget implementation\n     */\n    refreshCore() {\n        this.render();\n    }\n    getLinkText() {\n        const query = this.getQuery();\n        if (query.enableAggregation) {\n            const aggrSettings = query.getAggregationSettings();\n            const groups = aggrSettings.getInternalGroups();\n            const aggrs = aggrSettings.getAggregates();\n            let groupArr = [];\n            const cols = query.getColumns();\n            for (const group of groups) {\n                const colNames = group.columns.map(value => {\n                    const col = cols.find(c => c.id == value);\n                    if (col) {\n                        return col.caption;\n                    }\n                    else {\n                        return '';\n                    }\n                });\n                groupArr.push(`[${colNames.join(', ')}]`);\n            }\n            const groupString = groupArr.join(', ');\n            let aggrArr = [];\n            const funcs = query.getModel().getAggrFunctions();\n            for (const aggr of aggrs) {\n                const col = cols.find(c => c.id == aggr.colId);\n                const func = funcs.find(f => f.id == aggr.funcId);\n                if (col && func) {\n                    aggrArr.push(`${col.caption} (${func.caption})`);\n                }\n            }\n            const aggrString = aggrArr.join(', ');\n            return `${groupString || i18n$1.getText('AggrSettings', 'NoGroupsLabel')} ::: ${aggrString ? `<${aggrString}>` : i18n$1.getText('AggrSettings', 'NoAggrsLabel')}`;\n        }\n        else {\n            return i18n$1.getText('AggrSettings', 'EmptySettingsLabel');\n        }\n    }\n    render() {\n        this.slot.classList.add(`${this.cssPrefix}-panel`);\n        const mobClass = getMobileCssClass();\n        if (mobClass) {\n            this.slot.classList.add(mobClass);\n        }\n        if (!this.dialogLink) {\n            this.dialogLink = document.createElement('a');\n            this.dialogLink.setAttribute('href', 'javascript:void(0)');\n            this.slot.appendChild(this.dialogLink);\n        }\n        // Update\n        this.dialogLink.textContent = this.getLinkText();\n        this.dialogLink.removeEventListener('click', this.linkClickCallback);\n        this.dialogLink.addEventListener('click', this.linkClickCallback);\n    }\n    clear() {\n        this.slot.innerHTML = \"\";\n        this.dialogLink = null;\n    }\n    attachQueryObserver() {\n        const query = this.getQuery();\n        this.queryEventCallbackId = query.addChangedCallback(event => {\n            this.refreshCore();\n        });\n    }\n    detachQueryObserver() {\n        if (this.queryEventCallbackId) {\n            const query = this.getQuery();\n            query.removeChangedCallback(this.queryEventCallbackId);\n        }\n    }\n    destroyCore() {\n        this.clear();\n        this.detachQueryObserver();\n    }\n    getQuery() {\n        return this.customQuery || this.context.getQuery();\n    }\n}\n\nclass LocaleWidget extends Widget {\n    /**\n    * The default constructor.\n    * @param slot The html element.\n    */\n    constructor(slot) {\n        super(slot);\n        this.changeLocale = () => {\n            const newLocale = this.selectEl.value;\n            i18n.setCurrentLocale(newLocale);\n            this.context.refreshWidgets(WidgetGroup.All);\n        };\n        this.group = WidgetGroup.None;\n    }\n    init(context, options) {\n        super.init(context, options);\n        this.clear();\n        this.render();\n    }\n    getWidgetType() {\n        return 'changeLocale';\n    }\n    render() {\n        const locales = i18n.getLocales();\n        if (locales.length > 1) {\n            this.selectEl = document.createElement('select');\n            for (let locale of locales) {\n                let optionEl = document.createElement('option');\n                optionEl.value = locale.locale;\n                optionEl.innerHTML = this.displayLocaleName(locale);\n                this.selectEl.appendChild(optionEl);\n            }\n            this.selectEl.value = i18n.getCurrentLocale();\n            this.selectEl.classList.add('eqv-select');\n            this.selectEl.addEventListener('change', this.changeLocale);\n            this.slot.appendChild(this.selectEl);\n        }\n    }\n    displayLocaleName(locale) {\n        if (locale.englishName && locale.displayName) {\n            return `${locale.englishName} - ${locale.displayName}`;\n        }\n        else if (locale.englishName) {\n            return locale.englishName;\n        }\n        else if (locale.displayName) {\n            return locale.displayName;\n        }\n        return locale.locale;\n    }\n    clear() {\n        this.slot.innerHTML = \"\";\n    }\n    destroyCore() {\n        this.clear();\n    }\n}\n\n/**\n * The widget responsed for rendering the name of the current query.\n */\nclass QueryNameWidget extends Widget {\n    /**\n     * The default constructor.\n     * @param slot The HTML element where our widget should be placed.\n     */\n    constructor(slot) {\n        super(slot);\n        this.queryEventCallbackId = null;\n        this.group = WidgetGroup.Query | WidgetGroup.QueryStatus;\n        this.nameTemplate = '{name}';\n    }\n    init(context, options) {\n        super.init(context, options);\n        if (options && options.nameTemplate) {\n            this.nameTemplate = options.nameTemplate;\n        }\n        this.destroyCore();\n        this.attachQueryObserver();\n    }\n    get cssPrefix() {\n        return 'eqjs-query-name';\n    }\n    getWidgetType() {\n        return 'queryName';\n    }\n    /**\n     * Refresh widget implementation\n     */\n    refreshCore() {\n        this.render();\n    }\n    render() {\n        this.slot.classList.add(`${this.cssPrefix}`);\n        const mobClass = getMobileCssClass();\n        if (mobClass) {\n            this.slot.classList.add(mobClass);\n        }\n        if (!this.nameSlot) {\n            this.nameSlot = document.createElement('div');\n            this.nameSlot.classList.add(`${this.cssPrefix}-text`);\n            this.nameSlot.classList.add(`${this.cssPrefix}-theme`);\n            this.slot.appendChild(this.nameSlot);\n        }\n        if (!this.asteriskSlot) {\n            this.asteriskSlot = document.createElement('span');\n            this.asteriskSlot.innerHTML = \"*\";\n            this.asteriskSlot.classList.add(`${this.cssPrefix}-asterisk`);\n            this.slot.appendChild(this.asteriskSlot);\n        }\n        if (!this.tooltipSlot) {\n            this.tooltipSlot = document.createElement('span');\n            this.tooltipSlot.classList.add(`${this.cssPrefix}-tooltip`);\n            this.tooltipSlot.classList.add(`${this.cssPrefix}-theme`);\n            this.slot.appendChild(this.tooltipSlot);\n        }\n        // Update\n        const query = this.context.getQuery();\n        const queryName = query.getName();\n        const queryDescription = query.getDescription() || '';\n        const text = this.nameTemplate\n            .replace('{name}', queryName)\n            .replace('{description}', queryDescription);\n        this.nameSlot.textContent = text;\n        this.tooltipSlot.textContent = text;\n        this.asteriskSlot.style.visibility = query.isModified() ? \"visible\" : \"hidden\";\n    }\n    clear() {\n        this.slot.innerHTML = \"\";\n        this.nameSlot = null;\n        this.tooltipSlot = null;\n        this.asteriskSlot = null;\n    }\n    attachQueryObserver() {\n        const query = this.context.getQuery();\n        this.queryEventCallbackId = query.addChangedCallback(event => {\n            this.refreshCore();\n        });\n    }\n    detachQueryObserver() {\n        if (this.queryEventCallbackId) {\n            const query = this.context.getQuery();\n            query.removeChangedCallback(this.queryEventCallbackId);\n        }\n    }\n    destroyCore() {\n        this.clear();\n        this.detachQueryObserver();\n    }\n}\n\nclass View {\n    // Widgets END\n    constructor() {\n        this.domRoots = [document];\n        this.defaultViewOptions = {\n            enableExport: true,\n            disableConfirmationOnQueryChange: false,\n            queryFileExtensions: 'text/xml,application/json',\n            result: {\n                clearResultOnQueryChange: true,\n                showChart: true,\n                showProcessIndicator: true\n            },\n            widgets: {\n                resultGrid: {\n                    addColumns: false\n                }\n            },\n            handlers: {}\n        };\n        this.viewOptions = {};\n        this.resultOptions = {};\n        this.enableExport = false;\n        this.services = EqServiceProvider.getInstance();\n        this.resetContext();\n        this.renderSpinner();\n    }\n    resetContext() {\n        this.context = createEqContext();\n    }\n    getDialogService() {\n        return this.services.getService('DialogService');\n    }\n    init(options) {\n        try {\n            this.context.initStart();\n            // to support shadow DOM rendering\n            if (options && options.shadowRoots)\n                this.domRoots = this.domRoots.concat(options.shadowRoots);\n            this.viewOptions = this.initOptions(options);\n            this.resultOptions = utils.assignDeep(this.defaultViewOptions.result, this.viewOptions.result);\n            this.createWidgets(this.viewOptions);\n            this.context.init(this.viewOptions);\n            this.initDone();\n        }\n        catch (err) {\n            this.context.throwError({ action: 'Init', sourceError: err });\n        }\n    }\n    initOptions(options) {\n        options = utils.assignDeep(this.defaultViewOptions, options);\n        // support old format\n        if (!options.widgets.easyGrid) {\n            options.widgets.easyGrid = options.widgets.resultGrid || {};\n        }\n        // map columnTitleFormat option to widgets that have similar option\n        if (options.columnTitleFormat) {\n            this.context.options.columnTitleFormat = options.columnTitleFormat;\n        }\n        //to support old paging options (should be removed in the next versions)\n        options.widgets.easyGrid.paging =\n            utils.assignDeep({}, options.result.paging, options.widgets.easyGrid.paging);\n        this.enableExport = options.enableExport || false;\n        if (!options.widgets.exportWidget) {\n            options.widgets.exportWidget = {};\n        }\n        options.widgets.exportWidget.enableExport = this.enableExport;\n        return options;\n    }\n    createWidgets(options) {\n        let queryPanel = \"QueryPanel\";\n        let columnsPanel = \"ColumnsPanel\";\n        let entitiesPanel = \"EntitiesPanel\";\n        let resultPanel = \"ResultPanel\";\n        let columnsBar = \"ColumnsBar\";\n        let sortingBar = \"SortingBar\";\n        let filterBar = \"FilterBar\";\n        let processBar = \"ProcessBar\";\n        let statementPanel = \"StatementPanel\";\n        let changeLocale = \"ChangeLocale\";\n        let queryNameLabel = \"QueryNameLabel\";\n        let facetsPanel = \"ResultFacetsPanel\";\n        let resultCount = \"ResultCount\";\n        let exportButton = \"ExportButton\";\n        let aggregationBar = \"AggregationBar\";\n        if (options.slots) {\n            queryNameLabel = options.slots.queryNameLabel || queryNameLabel;\n            queryPanel = options.slots.queryPanel || queryPanel;\n            columnsPanel = options.slots.columnsPanel || columnsPanel;\n            columnsBar = options.slots.columnsBar || columnsBar;\n            entitiesPanel = options.slots.entitiesPanel || entitiesPanel;\n            resultPanel = options.slots.resultPanel || resultPanel;\n            statementPanel = options.slots.statementPanel || statementPanel;\n            processBar = options.slots.processBar || processBar;\n            changeLocale = options.slots.changeLocale || changeLocale;\n            facetsPanel = options.slots.facetsPanel || facetsPanel;\n            resultCount = options.slots.resultCountSpan || resultCount;\n            filterBar = options.slots.filterBar || filterBar;\n            exportButton = options.slots.exportButtons || exportButton;\n            aggregationBar = options.slots.aggregationBar || aggregationBar;\n        }\n        const epElement = this.resolveElement(entitiesPanel);\n        if (epElement && !this.entitiesPanelWidget) {\n            this.entitiesPanelWidget = this.createEntitiesPanelWidget(epElement);\n            this.context.addWidget(this.entitiesPanelWidget);\n        }\n        const cpElement = this.resolveElement(columnsPanel);\n        if (cpElement && !this.columnsPanelWidget) {\n            this.columnsPanelWidget = this.createColumnsPanelWidget(cpElement);\n            this.context.addWidget(this.columnsPanelWidget);\n        }\n        const cbElement = this.resolveElement(columnsBar);\n        if (cbElement && !this.columnsBarWidget) {\n            this.columnsBarWidget = this.createColumnsBarWidget(cbElement);\n            this.context.addWidget(this.columnsBarWidget);\n        }\n        const qpElement = this.resolveElement(queryPanel);\n        if (qpElement && !this.queryPanelWidget) {\n            this.queryPanelWidget = this.createQueryPanelWidget(qpElement);\n            this.context.addWidget(this.queryPanelWidget);\n        }\n        this.resultPanelSlot = this.resolveElement(resultPanel);\n        if (this.resultPanelSlot) {\n            if (!this.resultGridWidget) {\n                let gridPanel = addElement(this.resultPanelSlot, 'div', { cssClass: 'eqv-result-grid' });\n                this.resultGridWidget = this.createResultGridWidget(gridPanel);\n                this.context.addWidget(this.resultGridWidget);\n            }\n            if (this.resultOptions.showChart && !this.chartWidget) {\n                let chartPanel = addElement(this.resultPanelSlot, 'div', { cssClass: 'eqv-chart-panel' });\n                chartPanel.style.display = 'none';\n                this.chartWidget = this.createChartWidget(chartPanel);\n                this.context.addWidget(this.chartWidget);\n            }\n        }\n        const qnElement = this.resolveElement(queryNameLabel);\n        if (qnElement && !this.queryNameWidget) {\n            this.queryNameWidget = this.createQueryNameWidget(qnElement);\n            this.context.addWidget(this.queryNameWidget);\n        }\n        const fbElement = this.resolveElement(filterBar);\n        if (fbElement && !this.filterBarWidget) {\n            this.filterBarWidget = this.createFilterBarWidget(fbElement);\n            this.context.addWidget(this.filterBarWidget);\n        }\n        const sbElement = this.resolveElement(sortingBar);\n        if (sbElement && !this.sortingBarWidget) {\n            this.sortingBarWidget = this.createSortingBarWidget(sbElement);\n            this.context.addWidget(this.sortingBarWidget);\n        }\n        const pbElement = this.resolveElement(processBar);\n        if (pbElement && !this.processWidget) {\n            this.processWidget = this.createProcessWidget(pbElement);\n            this.context.addWidget(this.processWidget);\n        }\n        const stElement = this.resolveElement(statementPanel);\n        if (stElement && !this.statementPanelWidget) {\n            this.statementPanelWidget = this.createStatementPanelWidget(stElement);\n            this.context.addWidget(this.statementPanelWidget);\n        }\n        const clElement = this.resolveElement(changeLocale);\n        if (clElement) {\n            const widget = this.createLocaleWidget(clElement);\n            this.context.addWidget(widget);\n        }\n        const fpElement = this.resolveElement(facetsPanel);\n        if (fpElement && !this.resultFacetPanelWidget) {\n            this.resultFacetPanelWidget = this.createResultFacetsPanel(fpElement);\n            this.context.addWidget(this.resultFacetPanelWidget);\n        }\n        const ewElement = this.resolveElement(exportButton);\n        if (ewElement && !this.exportWidget) {\n            this.exportWidget = this.createExportWidget(ewElement);\n            this.context.addWidget(this.exportWidget);\n        }\n        this.resultCountSlot = this.resolveElement(resultCount);\n        const aggrbElement = this.resolveElement(aggregationBar);\n        if (aggrbElement && !this.aggregationBarWidget) {\n            this.aggregationBarWidget = this.createAggregationBarWidget(aggrbElement);\n            this.context.addWidget(this.aggregationBarWidget);\n        }\n    }\n    initDone() { }\n    resolveElement(elementOrId) {\n        if (typeof elementOrId === 'string') {\n            for (const domRoot of this.domRoots) {\n                const el = domRoot.getElementById(elementOrId);\n                if (el)\n                    return el;\n            }\n            return null;\n        }\n        return elementOrId;\n    }\n    resolveElementsByClassName(className) {\n        let result = [];\n        for (const domRoot of this.domRoots) {\n            const elemList = domRoot.querySelectorAll('.' + className);\n            for (let i = 0; i < elemList.length; i++) {\n                result.push(elemList[i]);\n            }\n        }\n        return result;\n    }\n    /**\n    * Shows records count.\n    * @param count The value to show.\n    */\n    displayRecordsCount(count) {\n        if (this.resultCountSlot && (typeof count !== 'undefined')) {\n            this.resultCountSlot.style.display = \"inline\";\n            this.resultCountSlot.innerHTML = i18n.getText(\"MsgResultCount\").replace(\"{0}\", count.toString());\n        }\n    }\n    getContext() {\n        return this.context;\n    }\n    /**\n     * Sets dialog service for the view\n     * @param dialogService The dialog service.\n     */\n    setDialogService(dialogService) {\n        this.context.getServices().registerService('DialogService', () => dialogService);\n    }\n    /** @deprecated `executeQuery` is deprecated. Use `fetchData` instead*/\n    executeQuery(options) {\n        console.warn('`executeQuery` is deprecated. Use `fetchData` instead');\n        this.fetchData(options);\n    }\n    /**\n    * Fetches the data according to the query and other options defined in the context.\n    * @param options The options.\n    */\n    fetchData(options) {\n        options = options || { refresh: true };\n        this.context.clearResult();\n        //don't run fetch if the query is empty\n        if (this.context.getQuery().isEmpty() && !this.resultOptions.fetchEmptyQueries)\n            return;\n        this.showResultSpinner();\n        this.context.fetchData(Object.assign(Object.assign({}, options), { elasticPaging: options.elasticPaging, success: (result) => {\n                this.hideResultSpinner();\n                this.toggleExportButtons();\n                this.displayRecordsCount(this.context.resultTable.getTotal());\n                if (options.refresh === true) {\n                    this.context.refreshWidgets(WidgetGroup.Result);\n                }\n                if (options.callback) {\n                    options.callback();\n                }\n                if (options.success) {\n                    options.success(result);\n                }\n            }, error: () => {\n                this.hideResultSpinner();\n            } }));\n    }\n    toggleExportButtons() {\n        if (this.enableExport && this.context.resultTable\n            && this.context.resultTable.getCachedCount() > 0) {\n            this.enableExportButtons();\n        }\n        else {\n            this.disableExportButtons();\n        }\n    }\n    enableExportButtons() {\n        // Nothing to do\n    }\n    disableExportButtons() {\n        // Nothing to do\n    }\n    renderSpinner() {\n        const html = '<div class=\"wBall\" id=\"wBall_1\"><div class=\"wInnerBall\"></div></div><div class=\"wBall\" id=\"wBall_2\"><div class=\"wInnerBall\"></div></div><div class=\"wBall\" id=\"wBall_3\"><div class=\"wInnerBall\"></div></div><div class=\"wBall\" id=\"wBall_4\"><div class=\"wInnerBall\"></div></div><div class=\"wBall\" id=\"wBall_5\"><div class=\"wInnerBall\"></div></div>';\n        this._spinnerDiv = domel('div')\n            .addClass(`eqjs-result-spinner`)\n            .addChild('div', b => b\n            .addClass(`${eqCssPrefix}-progress-win8`, getMobileCssClass())\n            .addHtml(html))\n            .toDOM();\n    }\n    showResultSpinner() {\n        if (this.resultOptions.showProcessIndicator && this.resultPanelSlot) {\n            if (!this._spinnerDiv.parentNode) {\n                for (let i = 0; i < this.resultPanelSlot.children.length; i++) {\n                    const el = this.resultPanelSlot.children[i];\n                    domel(el).hide();\n                }\n                this.resultPanelSlot.appendChild(this._spinnerDiv);\n            }\n        }\n    }\n    hideResultSpinner() {\n        if (this.resultOptions.showProcessIndicator && this.resultPanelSlot) {\n            if (this._spinnerDiv.parentNode) {\n                this._spinnerDiv.parentNode.removeChild(this._spinnerDiv);\n                for (let i = 0; i < this.resultPanelSlot.children.length; i++) {\n                    const el = this.resultPanelSlot.children[i];\n                    domel(el).show();\n                }\n            }\n        }\n    }\n    /**\n    * Creates the widget that represents Chart Widget.\n    * @param slotElement The HTMLElement to place the created widget in.\n    * @returns the created Widget object.\n    */\n    createChartWidget(slotElement) {\n        if (this.resultOptions.chartWidgetResolver) {\n            return this.resultOptions.chartWidgetResolver(slotElement);\n        }\n        else {\n            return new ChartJsWidget(slotElement);\n        }\n    }\n    /**\n    * Creates the widget that represents Result Grid.\n    * @param slotElement The HTMLElement to place the created widget in.\n    * @returns the created Widget object.\n    */\n    createResultGridWidget(slotElement) {\n        if (this.resultOptions.resultGridResolver) {\n            return this.resultOptions.resultGridResolver(slotElement);\n        }\n        else {\n            return new EasyGridWidget(slotElement);\n        }\n    }\n    /**\n    * Creates the widget that represents Entity Panel.\n    * @param slot The HTMLElement to place the created widget in.\n    * @returns the created Widget object.\n    */\n    createEntitiesPanelWidget(slot) {\n        return new EntitiesPanel(slot);\n    }\n    /**\n    * Creates the widget that represents Columns Panel.\n    * @param slot The HTMLElement to place the created widget in.\n    * @returns the created Widget object.\n    */\n    createColumnsPanelWidget(slot) {\n        return new ColumnsPanel(slot);\n    }\n    /**\n    * Creates the widget that represents Query Panel.\n    * @param slot The HTMLElement to place the created widget in.\n    * @returns the created Widget object.\n    */\n    createQueryPanelWidget(slot) {\n        return new QueryPanel(slot);\n    }\n    /**\n    * Creates the widget that represents Locale Widget.\n    * @param slot The HTMLElement to place the created widget in.\n    * @returns the created Widget object.\n    */\n    createLocaleWidget(slot) {\n        return new LocaleWidget(slot);\n    }\n    /**\n    * Creates the widget that represents Process Widget.\n    * @param slot The HTMLElement to place the created widget in.\n    * @returns the created Widget object.\n    */\n    createProcessWidget(slot) {\n        return new ProcessWidget(slot);\n    }\n    /**\n    * Creates the widget that represents Columns Bar.\n    * @param slot The HTMLElement to place the created widget in.\n    * @returns the created Widget object.\n    */\n    createColumnsBarWidget(slot) {\n        return new ColumnsBar(slot);\n    }\n    /**\n    * Creates the widget that represents Filter Bar.\n    * @param slot The HTMLElement to place the created widget in.\n    * @returns the created Widget object.\n    */\n    createFilterBarWidget(slot) {\n        return new FilterBar(slot);\n    }\n    /**\n    * Creates the widget that represents Sorting Bar.\n    * @param slot The HTMLElement to place the created widget in.\n    * @returns the created Widget object.\n    */\n    createSortingBarWidget(slot) {\n        return new SortingBar(slot);\n    }\n    /**\n    * Creates the widget that represents Query Name Widget.\n    * @param slot The HTMLElement to place the created widget in.\n    * @returns the created Widget object.\n    */\n    createQueryNameWidget(slot) {\n        return new QueryNameWidget(slot);\n    }\n    /**\n     * Creates the widget that represents Statement Panel Widget.\n     * @param slot\n     */\n    createStatementPanelWidget(slot) {\n        return new StatementPanel(slot);\n    }\n    /**\n    * Creates the widget that represents Result Facets Panel Widget.\n    * @param slot\n    */\n    createResultFacetsPanel(slot) {\n        return new ResultFacetsPanel(slot);\n    }\n    /**\n     * Creates the widget that represents Export funcionality.\n     * @param slot\n     */\n    createExportWidget(slot) {\n        return new ExportWidget(slot);\n    }\n    /**\n     * Creates the widget that represents Aggregation Bar Widget.\n     * @param slot\n     */\n    createAggregationBarWidget(slot) {\n        return new AggregationBar(slot);\n    }\n    detach() {\n        if (this.entitiesPanelWidget) {\n            this.entitiesPanelWidget.destroy();\n            this.entitiesPanelWidget = null;\n        }\n        if (this.columnsPanelWidget) {\n            this.columnsPanelWidget.destroy();\n            this.columnsPanelWidget = null;\n        }\n        if (this.queryPanelWidget) {\n            this.queryPanelWidget.destroy();\n            this.queryPanelWidget = null;\n        }\n        if (this.columnsBarWidget) {\n            this.columnsBarWidget.destroy();\n            this.columnsBarWidget = null;\n        }\n        if (this.resultGridWidget) {\n            this.resultGridWidget.destroy();\n            this.resultGridWidget = null;\n        }\n        if (this.chartWidget) {\n            this.chartWidget.destroy();\n            this.chartWidget = null;\n        }\n        if (this.queryNameWidget) {\n            this.queryNameWidget.destroy();\n            this.queryNameWidget = null;\n        }\n        if (this.processWidget) {\n            this.processWidget.destroy();\n            this.processWidget = null;\n        }\n        if (this.localeWidget) {\n            this.localeWidget.destroy();\n            this.localeWidget = null;\n        }\n        if (this.statementPanelWidget) {\n            this.statementPanelWidget.destroy();\n            this.statementPanelWidget = null;\n        }\n        if (this.filterBarWidget) {\n            this.filterBarWidget.destroy();\n            this.filterBarWidget = null;\n        }\n        if (this.sortingBarWidget) {\n            this.sortingBarWidget.destroy();\n            this.sortingBarWidget = null;\n        }\n        if (this.statementWidget) {\n            this.statementWidget.destroy();\n            this.statementWidget = null;\n        }\n        if (this.exportWidget) {\n            this.exportWidget.destroy();\n            this.exportWidget = null;\n        }\n        if (this.resultFacetPanelWidget) {\n            this.resultFacetPanelWidget.destroy();\n            this.resultFacetPanelWidget = null;\n        }\n        if (this.resultCountSlot) {\n            this.resultCountSlot.innerHTML = '';\n            this.resultCountSlot = null;\n        }\n        if (this.resultPanelSlot) {\n            this.resultPanelSlot.innerHTML = '';\n            this.resultPanelSlot = null;\n        }\n        this.domRoots = [document];\n        this.resetContext();\n    }\n    refreshWidgets(groups) {\n        this.context.refreshWidgets(groups);\n    }\n}\n\n/**\n * The EasyQuery client-side view that represents the UI for advanced search page\n */\nclass AdvancedSearchView extends View {\n    constructor() {\n        super();\n        this.exportButtons = [];\n        // Name of the class to add to disabled elements.\n        this.disabledClass = \"eqjs-disabled\";\n        this.dropdownContainerClass = \"eqv-dropdown-container\";\n        this.dropdownButtonClass = \"eqv-drop-button\";\n        this.dropdownContentClass = \"eqv-dropdown-content\";\n        this.dropdownShowClass = \"eqv-dropdown-show\";\n        this._querySaveTemplate = `<div id=\"kdlg-dialog-form\" class=\"kfrm-form\">\r\n            <div class=\"kfrm-fields label-above\">\r\n                <label for=\"kdlg-dialog-form-input\" id=\"kdlg-dialog-form-content\"></label>\r\n                <input type=\"text\" name=\"kdlg-dialog-form-input\" id=\"kdlg-dialog-form-input\" />\r\n            </div>\r\n        </div>`;\n        this.queryListMenu = null;\n        this.fetchDataButtonClickHandler = this.fetchDataButtonClick.bind(this);\n        this.clearQueryButtonClickHandler = this.clearQueryButtonClick.bind(this);\n        this.newQueryButtonClickHandler = this.newQueryButtonClick.bind(this);\n        this.loadQueryButtonClickHandler = this.loadQueryButtonClick.bind(this);\n        this.saveQueryButtonClickHandler = this.saveQueryButtonClick.bind(this);\n        this.copyQueryButtonClickHandler = this.copyQueryButtonClick.bind(this);\n        this.removeQueryButtonClickHandler = this.removeQueryButtonClick.bind(this);\n        this.storageButtonClickHandler = this.storageDropButtonClick.bind(this);\n        this.saveQueryToFileButtonClickHandler = this.saveQueryToFileButtonClick.bind(this);\n        this.loadQueryFromFileButtonClickHandler = this.loadQueryFromFileButtonClick.bind(this);\n        const self = this;\n        this.exportButtonClickHandler = function (e) {\n            if (!this.classList.contains(self.disabledClass)) {\n                const format = this.getAttribute(\"data-format\");\n                self.getContext().exportResult({ format: format });\n            }\n        };\n        this.queryChangedHandler = (ev) => {\n            const eventData = ev.data;\n            if (this.resultOptions.clearResultOnQueryChange) {\n                this.context.clearResult();\n                this.context.refreshWidgets(WidgetGroup.Result);\n            }\n            this.disableExportButtons();\n            if (this.resultCountSlot) {\n                this.resultCountSlot.style.display = \"none\";\n            }\n            if (this.viewOptions.syncQueryOnChange) {\n                this.syncQuery();\n            }\n            if (this.viewOptions.fetchDataOnChange) {\n                if (!eventData || (eventData.part != QueryChangePart.ExtraData\n                    && eventData.part != QueryChangePart.Facets)) {\n                    this.fetchData();\n                }\n            }\n        };\n        this.outsideClickHandler = (event) => {\n            let currentContent = null;\n            if (event.target.matches(`.${this.dropdownButtonClass}`)) {\n                currentContent = event.target.parentElement.querySelector(`.${this.dropdownContentClass}`);\n            }\n            else if (event.target.matches(`.${this.dropdownButtonClass} > span`)) {\n                currentContent = event.target.parentElement.parentElement.querySelector(`.${this.dropdownContentClass}`);\n            }\n            var dropdowns = this.resolveElementsByClassName(this.dropdownContentClass);\n            for (let i = 0; i < dropdowns.length; i++) {\n                var openDropdown = dropdowns[i];\n                if (currentContent != openDropdown) {\n                    if (openDropdown.classList.contains(this.dropdownShowClass)) {\n                        openDropdown.classList.remove(this.dropdownShowClass);\n                    }\n                }\n            }\n        };\n    }\n    refreshQueryList() {\n        if (this.queryListPanel) {\n            this.queryListPanel.innerHTML = '';\n            this.context.loadQueryList({\n                success: (data) => {\n                    const b = domel('ul', this.queryListPanel)\n                        .addClass('list-group list-group-flush');\n                    data.map(item => {\n                        b.addChild('li', b => {\n                            b.addClass('list-group-item')\n                                .setStyle('cursor', 'pointer')\n                                .data('id', item.id)\n                                .text(item.name)\n                                .on('click', () => {\n                                this.checkIfQueryModified(() => this.loadQuery(item.id));\n                            });\n                        });\n                    });\n                }\n            });\n        }\n    }\n    initOptions(options) {\n        options = super.initOptions(options);\n        if (typeof (options.syncQueryOnChange) == 'undefined') {\n            options.syncQueryOnChange = true;\n        }\n        return options;\n    }\n    createWidgets(options) {\n        super.createWidgets(options);\n        let exportClass = \"eqjs-export\";\n        let queryContentInputId = \"QueryContentJson\";\n        let clearQueryButtonId = \"ClearQueryButton\";\n        let newQueryButtonId = \"NewQueryButton\";\n        let loadQueryButtonId = \"LoadQueryButton\";\n        let saveQueryButtonId = \"SaveQueryButton\";\n        let copyQueryButtonId = \"CopyQueryButton\";\n        let removeQueryButtonId = \"RemoveQueryButton\";\n        let storageButtonId = \"StorageDropButton\";\n        let fetchDataButtonId = \"FetchDataButton\";\n        let loadQueryFromFileButtonId = \"LoadQueryFromFileButton\";\n        let saveQueryToFileButtonId = \"SaveQueryToFileButton\";\n        let queryListPanelId = \"QueryListPanel\";\n        if (options.slots) {\n            queryContentInputId = options.slots.queryContentInput || queryContentInputId;\n            fetchDataButtonId = options.slots.fetchDataButton || fetchDataButtonId;\n            clearQueryButtonId = options.slots.clearQueryButton || clearQueryButtonId;\n            newQueryButtonId = options.slots.newQueryButton || newQueryButtonId;\n            loadQueryButtonId = options.slots.loadQueryButton || loadQueryButtonId;\n            saveQueryButtonId = options.slots.saveQueryButton || saveQueryButtonId;\n            copyQueryButtonId = options.slots.copyQueryButton || copyQueryButtonId;\n            removeQueryButtonId = options.slots.removeQueryButton || removeQueryButtonId;\n            storageButtonId = options.slots.storageButton || storageButtonId;\n            exportClass = options.slots.exportClass || exportClass;\n            loadQueryFromFileButtonId = options.slots.loadQueryFromFileButton || loadQueryFromFileButtonId;\n            saveQueryToFileButtonId = options.slots.saveQueryToFileButton || saveQueryToFileButtonId;\n            queryListPanelId = options.slots.queryListPanel || queryListPanelId;\n        }\n        this.exportButtons = this.domRoots.reduce((elems, root) => elems.concat(Array.from(root.querySelectorAll(`.${exportClass}`))), []);\n        if (!options.enableExport) {\n            this.hideExportButtons();\n        }\n        this.disableExportButtons();\n        this.exportButtons.forEach((button) => {\n            button.addEventListener('click', this.exportButtonClickHandler);\n        });\n        if (!this.fetchDataButton) {\n            this.fetchDataButton = this.resolveElement(fetchDataButtonId);\n            if (!this.fetchDataButton) {\n                this.fetchDataButton = this.resolveElement('ExecuteQueryButton'); //deprecated, should be removed on the next major update\n            }\n            if (this.fetchDataButton) {\n                this.fetchDataButton.addEventListener('click', this.fetchDataButtonClickHandler);\n            }\n        }\n        if (!this.clearQueryButton) {\n            this.clearQueryButton = this.resolveElement(clearQueryButtonId);\n            if (this.clearQueryButton) {\n                this.clearQueryButton.addEventListener('click', this.clearQueryButtonClickHandler);\n            }\n        }\n        if (!this.newQueryButton) {\n            this.newQueryButton = this.resolveElement(newQueryButtonId);\n            if (this.newQueryButton) {\n                this.newQueryButton.addEventListener('click', this.newQueryButtonClickHandler);\n            }\n        }\n        if (!this.loadQueryButton) {\n            this.loadQueryButton = this.resolveElement(loadQueryButtonId);\n            if (this.loadQueryButton) {\n                this.loadQueryButton.addEventListener('click', this.loadQueryButtonClickHandler);\n            }\n        }\n        if (!this.saveQueryButton) {\n            this.saveQueryButton = this.resolveElement(saveQueryButtonId);\n            if (this.saveQueryButton) {\n                this.saveQueryButton.addEventListener('click', this.saveQueryButtonClickHandler);\n            }\n        }\n        if (!this.copyQueryButton) {\n            this.copyQueryButton = this.resolveElement(copyQueryButtonId);\n            if (this.copyQueryButton) {\n                this.copyQueryButton.addEventListener('click', this.copyQueryButtonClickHandler);\n            }\n        }\n        if (!this.removeQueryButton) {\n            this.removeQueryButton = this.resolveElement(removeQueryButtonId);\n            if (this.removeQueryButton) {\n                this.removeQueryButton.addEventListener('click', this.removeQueryButtonClickHandler);\n            }\n        }\n        if (!this.storageDropButton) {\n            this.storageDropButton = this.resolveElement(storageButtonId);\n            if (this.storageDropButton) {\n                this.storageDropButton.addEventListener('click', this.storageButtonClickHandler);\n            }\n        }\n        if (!this.saveQueryToFileButton) {\n            this.saveQueryToFileButton = this.resolveElement(saveQueryToFileButtonId);\n            if (this.saveQueryToFileButton) {\n                this.saveQueryToFileButton.addEventListener('click', this.saveQueryToFileButtonClickHandler);\n            }\n        }\n        if (!this.queryListPanel) {\n            this.queryListPanel = this.resolveElement(queryListPanelId);\n            //For backward compatibility. Remove on the next update\n            if (!this.queryListPanel) {\n                this.queryListPanel = this.resolveElement('QueryListSlot');\n            }\n            if (this.queryListPanel) {\n                this.context.addEventListener('ready', () => {\n                    this.refreshQueryList();\n                });\n            }\n        }\n        if (!this.loadQueryFromFileButton) {\n            this.loadQueryFromFileButton = this.resolveElement(loadQueryFromFileButtonId);\n            if (this.loadQueryFromFileButton) {\n                this.loadQueryFromFileInput = document.createElement('input');\n                this.loadQueryFromFileInput.type = 'file';\n                this.loadQueryFromFileInput.accept = options.queryFileExtensions;\n                this.loadQueryFromFileInput.style.display = 'none';\n                document.body.appendChild(this.loadQueryFromFileInput);\n                this.loadQueryFromFileInput.addEventListener('change', this.loadQueryFromFileInputSelect.bind(this));\n                this.loadQueryFromFileButton.addEventListener('click', this.loadQueryFromFileButtonClickHandler);\n            }\n        }\n        // hide any dropdown menu when user clicks somewhere\n        window.addEventListener('click', this.outsideClickHandler);\n    }\n    initDone() {\n        super.initDone();\n        const query = this.context.getQuery();\n        query.addChangedCallback(this.queryChangedHandler);\n    }\n    /**\n    * Sends current query to the backend.\n    */\n    syncQuery() {\n        this.context.syncQuery({\n            success: (responseData) => {\n                if (responseData.statement) {\n                    this.context.refreshWidgets(WidgetGroup.Statement);\n                }\n            }\n        });\n    }\n    /**\n    * Disables export buttons.\n    */\n    disableExportButtons() {\n        this.exportButtons.forEach((button) => {\n            button.disabled = true;\n            if (!button.classList.contains(this.disabledClass)) {\n                button.classList.add(this.disabledClass);\n            }\n        });\n    }\n    /**\n    * Enables export buttons.\n    */\n    enableExportButtons() {\n        this.exportButtons.forEach((button) => {\n            button.disabled = false;\n            if (button.classList.contains(this.disabledClass)) {\n                button.classList.remove(this.disabledClass);\n            }\n        });\n    }\n    /**\n    * Hides export buttons.\n    */\n    hideExportButtons() {\n        this.exportButtons.forEach((button) => {\n            button.style.display = \"none\";\n        });\n    }\n    clearQueryButtonClick() {\n        this.showQueryClearDialog((result) => {\n            if (result) {\n                this.context.clearQuery();\n                this.context.refreshWidgets(WidgetGroup.Statement);\n            }\n        });\n    }\n    createNewQuery(options) {\n        return this.context.newQuery(options);\n    }\n    loadQuery(queryId) {\n        if (!queryId)\n            return;\n        this.context.loadQuery({\n            queryId: queryId,\n            silent: false\n        });\n    }\n    saveQuery(success, error) {\n        this.context.saveQuery({\n            success: () => {\n                if (success)\n                    success();\n                this.context.getQuery().fireChangedEvent({\n                    part: QueryChangePart.Properties,\n                    wasModified: false\n                });\n                this.refreshQueryList();\n            },\n            error: error\n        });\n    }\n    saveCurrentQuery(copyQuery = false, callback) {\n        const query = this.context.getQuery();\n        if (query.isNewbie || copyQuery) {\n            this.showSaveQueryDialog((newQueryName) => new Promise(resolve => {\n                if (!newQueryName)\n                    return;\n                this.checkSaveQueryName(newQueryName)\n                    .then(() => {\n                    query.regenerateId();\n                    query.setName(newQueryName);\n                    query.fireChangedEvent({\n                        part: QueryChangePart.Properties,\n                        wasModified: true\n                    });\n                    this.saveQuery(() => { resolve({ success: true }); }, (error) => resolve({ success: false, message: error }));\n                }, (message) => resolve({ success: false, message }));\n            }));\n        }\n        else {\n            this.saveQuery(callback);\n        }\n    }\n    checkSaveQueryName(name) {\n        return new Promise((resolve, reject) => {\n            this.context.loadQueryList({\n                success: (queryList) => {\n                    const found = queryList.filter(item => item.name.toLowerCase() == name.toLowerCase());\n                    if (found.length == 0) {\n                        resolve();\n                    }\n                    else {\n                        reject(\"Can't save the query. A query with this name already exists.\");\n                    }\n                },\n                error: (message) => {\n                    reject(message);\n                }\n            });\n        });\n    }\n    checkIfQueryModified(callback) {\n        if (this.context.getQuery().isModified()\n            && !this.viewOptions.disableConfirmationOnQueryChange) {\n            this.showQueryChangedDialog((result) => {\n                if (result) {\n                    this.saveCurrentQuery(false, callback);\n                }\n                else {\n                    callback();\n                }\n            });\n        }\n        else {\n            callback();\n        }\n    }\n    removeCurrentQuery() {\n        this.context.removeQuery({\n            success: () => {\n                this.createNewQuery({\n                    useStorage: false\n                });\n                if (this.resultCountSlot) {\n                    this.resultCountSlot.style.display = \"none\";\n                }\n                this.context.clearResult();\n                this.refreshQueryList();\n            }\n        });\n    }\n    applyQueryNamePattern(input) {\n        const allowedPattern = /[a-zA-Z0-9\\s_\\[\\]()\\@\\$\\#\\&\\-\\.]/;\n        input.addEventListener('keydown', (e) => {\n            if (e.key.length === 1 && !allowedPattern.test(e.key) && !['Backspace', 'Delete', 'ArrowLeft', 'ArrowRight', 'Tab', 'Enter'].includes(e.key)) {\n                e.preventDefault();\n            }\n        });\n    }\n    // ------------------ Dialog wrappers ---------------------\n    showNewQueryDialog(callback) {\n        const ds = this.context.getServices().getService('DialogService');\n        const defVal = i18n.getText('NewQueryDefName');\n        const dlg = ds.open({\n            title: i18n.getText('NewQueryTitle'),\n            body: this._querySaveTemplate,\n            submitable: true,\n            closable: true,\n            cancelable: true,\n            submitOnEnter: true,\n            arrangeParents: false,\n            beforeOpen: () => {\n                const input = document.getElementById(`kdlg-dialog-form-input`);\n                this.applyQueryNamePattern(input);\n                if (defVal) {\n                    input.value = defVal;\n                }\n                const content = document.getElementById('kdlg-dialog-form-content');\n                content.innerHTML = i18n.getText('NewQueryContent');\n                input.focus();\n            },\n            onSubmit: () => {\n                const input = document.getElementById(`kdlg-dialog-form-input`);\n                const value = input.value;\n                if (value && value.replace(/\\s/g, '').length > 0) {\n                    if (!callback)\n                        return true;\n                    dlg.disableButtons();\n                    const header = dlg.getRootElement().querySelector('header');\n                    const processEl = domel('div', header)\n                        .addClass('eqjs-process-bar local')\n                        .toDOM();\n                    callback(value)\n                        .then(result => {\n                        header.removeChild(processEl);\n                        dlg.enableButtons();\n                        if (result.success) {\n                            dlg.close();\n                        }\n                        else {\n                            dlg.showAlert(result.message, 'error');\n                        }\n                    });\n                }\n                return false;\n            }\n        });\n    }\n    showQueryClearDialog(callback) {\n        const ds = this.getDialogService();\n        ds.openConfirm(i18n.getText('QueryChangedTitle'), i18n.getText('QueryClearContent'), callback);\n    }\n    showQueryChangedDialog(callback) {\n        const ds = this.getDialogService();\n        ds.openConfirm(i18n.getText('QueryChangedTitle'), i18n.getText('QueryChangedContent'), callback);\n    }\n    showSaveQueryDialog(callback) {\n        const ds = this.getDialogService();\n        const query = this.context.getQuery();\n        const newQueryName = query.isNewbie\n            ? query.getName()\n            : i18n.getText('SaveQueryDefName').replace('{queryName}', query.getName());\n        const dlg = ds.open({\n            title: i18n.getText('SaveQueryTitle'),\n            body: this._querySaveTemplate,\n            submitable: true,\n            closable: true,\n            cancelable: true,\n            submitOnEnter: true,\n            arrangeParents: false,\n            beforeOpen: () => {\n                const input = document.getElementById(`kdlg-dialog-form-input`);\n                this.applyQueryNamePattern(input);\n                input.value = newQueryName;\n                const content = document.getElementById('kdlg-dialog-form-content');\n                content.innerHTML = i18n.getText('SaveQueryContent');\n                input.focus();\n            },\n            onSubmit: () => {\n                const input = document.getElementById(`kdlg-dialog-form-input`);\n                const value = input.value;\n                if (value && value.replace(/\\s/g, '').length > 0) {\n                    if (!callback)\n                        return true;\n                    dlg.disableButtons();\n                    const header = dlg.getRootElement().querySelector('header');\n                    const processEl = domel('div', header)\n                        .addClass('eqjs-process-bar local')\n                        .toDOM();\n                    callback(value)\n                        .then(result => {\n                        dlg.enableButtons();\n                        header.removeChild(processEl);\n                        if (result.success) {\n                            dlg.close();\n                        }\n                        else {\n                            dlg.showAlert(result.message, 'error');\n                        }\n                    });\n                }\n                return false;\n            }\n        });\n    }\n    showRemoveQueryDialog(callback) {\n        const ds = this.getDialogService();\n        const query = this.context.getQuery();\n        ds.openConfirm(i18n.getText('RemoveQueryTitle'), i18n.getText('RemoveQueryContent').replace('{queryName}', query.getName()), callback);\n    }\n    showSaveQueryToFileDialog(callback) {\n        const ds = this.getDialogService();\n        const query = this.context.getQuery();\n        const body = this.renderSaveToFileDialogBody(query.getName());\n        const dlg = ds.open({\n            title: i18n.getText('SaveQueryToFileDlgTitle'),\n            body: body,\n            beforeOpen: () => {\n                const fileNameInput = body.querySelector('#kdlgFileNameInput');\n                this.applyQueryNamePattern(fileNameInput);\n            },\n            onSubmit: () => {\n                const fileNameInput = body.querySelector('#kdlgFileNameInput');\n                const fileName = fileNameInput ? fileNameInput.value : \"Query\";\n                const formatSelector = body.querySelector('#kdlgFileFormatSelector');\n                const format = formatSelector ? formatSelector.value : 'json';\n                if (callback) {\n                    dlg.disableButtons();\n                    const header = dlg.getRootElement().querySelector('header');\n                    const processEl = domel('div', header)\n                        .addClass('eqjs-process-bar local')\n                        .toDOM();\n                    callback(fileName, format)\n                        .then(result => {\n                        dlg.enableButtons();\n                        header.removeChild(processEl);\n                        if (result.success) {\n                            dlg.close();\n                        }\n                        else {\n                            dlg.showAlert(result.message, 'error');\n                        }\n                    });\n                    return false;\n                }\n                return true;\n            }\n        });\n    }\n    renderSaveToFileDialogBody(name, format = \"json\") {\n        const isIE = browserUtils.isIE();\n        const fieldsClass = isIE\n            ? 'kfrm-fields-ie col-ie-1-4 label-align-right'\n            : 'kfrm-fields col-a-1 label-align-right';\n        const horizClass = isIE\n            ? 'kfrm-fields-ie is-horizontal'\n            : 'kfrm-fields is-horizontal';\n        return domel('div')\n            .addClass('kfrm-form')\n            .addChild('div', b => {\n            b.addClass(fieldsClass)\n                .addChild('label', b => b\n                .attr('for', 'file_name')\n                .addText(i18n.getText('FileNameLabel')))\n                .addChild('div', b => b\n                .addClass(horizClass)\n                .addChild('input', b => b\n                .id('kdlgFileNameInput')\n                .name('file_name')\n                .type('text')\n                .attr('value', name))\n                .addChild('label', b => b\n                .addText('.'))\n                .addChild('div', b => b\n                .addClass('kfrm-select')\n                .addChild('select', b => b\n                .id('kdlgFileFormatSelector')\n                .addClass('kdlg-form-control')\n                .addOption({\n                value: 'xml',\n                selected: 'xml' === format\n            })\n                .addOption({\n                value: 'json',\n                selected: 'json' === format\n            }))));\n        })\n            .toDOM();\n    }\n    // ------------------ Query management buttons handler ---------------------\n    newQueryButtonClick() {\n        this.checkIfQueryModified(() => {\n            this.createNewQuery();\n        });\n    }\n    saveQueryToFileButtonClick() {\n        this.showSaveQueryToFileDialog((fileName, format) => new Promise((resolve) => {\n            this.context.getQueryFile({\n                fileName: fileName,\n                format: format,\n                success: () => resolve({ success: true }),\n                error: (error) => resolve({ success: false, message: error })\n            });\n        }));\n    }\n    loadQueryFromFileButtonClick() {\n        this.checkIfQueryModified(() => {\n            this.showLoadQueryFromFileDialog();\n        });\n    }\n    showLoadQueryFromFileDialog() {\n        this.loadQueryFromFileInput.click();\n    }\n    loadQueryFromFileInputSelect() {\n        const files = this.loadQueryFromFileInput.files;\n        const file = files.item(0);\n        const data = new FormData();\n        data.append(file.name, file);\n        this.loadQueryFromFileInput.value = \"\";\n        this.context.uploadQueryFile({\n            data: data,\n            success: () => {\n                this.syncQuery();\n                this.refreshQueryList();\n            }\n        });\n    }\n    loadQueryButtonClick() {\n        this.context.loadQueryList({\n            success: (data) => {\n                this.fillLoadQueryButtonMenu(data);\n                this.queryListMenu.showMenu({\n                    anchor: this.loadQueryButton,\n                    adjustHeight: false,\n                    itemSelectedCallback: (data) => {\n                        this.checkIfQueryModified(() => this.loadQuery(data.id));\n                    }\n                });\n            }\n        });\n    }\n    fillLoadQueryButtonMenu(queryList) {\n        const query = this.getContext().getQuery();\n        this.queryListMenu = new PopupMenu({\n            items: queryList.map(item => ({ id: item.id, text: item.name })),\n            selectedIds: query.getId()\n        });\n    }\n    saveQueryButtonClick() {\n        this.saveCurrentQuery();\n    }\n    copyQueryButtonClick() {\n        this.saveCurrentQuery(true);\n    }\n    removeQueryButtonClick() {\n        this.showRemoveQueryDialog((result) => {\n            if (result) {\n                this.removeCurrentQuery();\n            }\n        });\n    }\n    storageDropButtonClick() {\n        let container = this.storageDropButton.parentElement;\n        let content = container.querySelector(`.${this.dropdownContentClass}`);\n        if (content) {\n            window.setTimeout(() => content.classList.toggle(this.dropdownShowClass), 100);\n        }\n    }\n    fetchDataButtonClick() {\n        this.fetchData();\n    }\n    detach() {\n        this.enableExportButtons();\n        this.exportButtons.forEach((button) => {\n            button.removeEventListener('click', this.exportButtonClickHandler);\n        });\n        this.exportButtons = [];\n        if (this.fetchDataButton) {\n            this.fetchDataButton.removeEventListener('click', this.fetchDataButtonClickHandler);\n            this.fetchDataButton = null;\n        }\n        if (this.clearQueryButton) {\n            this.clearQueryButton.removeEventListener('click', this.clearQueryButtonClickHandler);\n            this.clearQueryButton = null;\n        }\n        if (this.newQueryButton) {\n            this.newQueryButton.removeEventListener('click', this.newQueryButtonClickHandler);\n            this.newQueryButton = null;\n        }\n        if (this.loadQueryButton) {\n            this.loadQueryButton.removeEventListener('click', this.loadQueryButtonClickHandler);\n            this.loadQueryButton = null;\n        }\n        if (this.saveQueryButton) {\n            this.saveQueryButton.removeEventListener('click', this.saveQueryButtonClickHandler);\n            this.saveQueryButton = null;\n        }\n        if (this.copyQueryButton) {\n            this.copyQueryButton.removeEventListener('click', this.copyQueryButtonClickHandler);\n            this.copyQueryButton = null;\n        }\n        if (this.removeQueryButton) {\n            this.removeQueryButton.removeEventListener('click', this.removeQueryButtonClickHandler);\n            this.removeQueryButton = null;\n        }\n        if (this.storageDropButton) {\n            this.storageDropButton.removeEventListener('click', this.storageButtonClickHandler);\n            this.storageDropButton = null;\n        }\n        if (this.saveQueryToFileButton) {\n            this.saveQueryToFileButton.removeEventListener('click', this.saveQueryToFileButtonClickHandler);\n            this.saveQueryToFileButton = null;\n        }\n        if (this.queryListPanel) {\n            this.queryListPanel = null;\n        }\n        if (this.loadQueryFromFileButton) {\n            if (this.loadQueryFromFileInput) {\n                document.body.removeChild(this.loadQueryFromFileInput);\n            }\n            this.loadQueryFromFileButton.removeEventListener('click', this.loadQueryFromFileButtonClickHandler);\n            this.loadQueryFromFileButton = null;\n        }\n        super.detach();\n    }\n}\n\n/**\n * The view that represents a data-filtering scenario (a text search for one entity/table)\n */\nclass DataFilterView extends View {\n    constructor() {\n        super();\n    }\n    initOptions(options) {\n        options = super.initOptions(options);\n        options.result.fetchEmptyQueries = true;\n        const query = this.context.getQuery();\n        query.addChangedCallback(() => {\n            if (this.resultOptions.clearResultOnQueryChange) {\n                this.context.clearResult();\n            }\n            if (options.syncQueryOnChange) {\n                this.context.syncQuery();\n            }\n        });\n        this.context.addEventListener('ready', this.fetchData.bind(this));\n        return options;\n    }\n    createWidgets(options) {\n        super.createWidgets(options);\n        if (this.sortingBarWidget) {\n            this.context.getQuery().addChangedCallback((ev) => {\n                const edata = ev.data;\n                if (!edata || (edata.part != QueryChangePart.SortingColumns\n                    && edata.part != QueryChangePart.Columns && edata.part != QueryChangePart.All)) {\n                    return;\n                }\n                this.fetchData();\n            });\n        }\n        if (this.filterBarWidget) {\n            const widgetType = this.filterBarWidget.getWidgetType();\n            options.widgets[widgetType] = options.widgets[widgetType] || {};\n            if (!options.widgets[widgetType].applyFilterCallback) {\n                options.widgets[widgetType].applyFilterCallback = () => {\n                    this.fetchData();\n                };\n            }\n        }\n    }\n    /**\n     * Obsolete. Left for backward compatibility.\n     * Use fetchData() instead\n     * @deprecated Use `fetchData()`\n     */\n    applyQueryFilter() {\n        console.warn('applyQueryFilter is obsolete. Use fetchData instead');\n        this.fetchData();\n    }\n    fetchData() {\n        super.fetchData({ refresh: true });\n    }\n}\n\n/**\n * The EasyQuery client-side view that represents the UI for data filtering page\n */\nclass HtmlDataFilterView extends DataFilterView {\n    constructor() {\n        super();\n    }\n    /**\n    * Creates the widget that represents Result Grid.\n    * @param slotElement The HTMLElement to place the created widget in.\n    * @returns the created Widget object.\n    */\n    createResultGridWidget(slotElement) {\n        return new EqHtmlGrid(slotElement);\n    }\n    /**\n     * Obsolete. Left for backward compatibility.\n     * Use fetchData() instead\n     */\n    applyQueryFilter() {\n        console.warn('applyQueryFilter is obsolete. Use fetchData instead');\n        this.fetchData();\n    }\n}\n\n/**\n * The view that represents the \"ad-hoc reporting\" scenario\n */\nclass ReportView extends View {\n    constructor() {\n        super();\n        this.reports = [];\n        this.reportCache = [];\n        this.exportButtons = [];\n        this.exportClass = \"eqjs-export\";\n        this.disabledClass = \"eqjs-disabled\";\n        this.enableExport = false;\n        this.useReportCache = true;\n        this.syncReportOnChange = true;\n        this._reportSaveTemplate = `<div id=\"kdlg-dialog-form\" class=\"kfrm-form\">\r\n            <div class=\"kfrm-fields label-above\">\r\n                <label for=\"kdlg-dialog-form-input\" id=\"kdlg-dialog-form-name-label\"></label>\r\n                <input type=\"text\" name=\"kdlg-dialog-form-input\" id=\"kdlg-dialog-form-input\" />\r\n                <label for=\"kdlg-dialog-form-textarea\" id=\"kdlg-dialog-form-desc-label\"></label>\r\n                <textarea type=\"text\" name=\"kdlg-dialog-form-textarea\" id=\"kdlg-dialog-form-textarea\"></textarea>\r\n            </div>\r\n        </div>`;\n        this.context.useStoredQueryOnFetch = true;\n        this.exportButtonClickHandler = (srcElement, e) => {\n            if (!srcElement.classList.contains(this.disabledClass)) {\n                const format = srcElement.getAttribute(\"data-format\");\n                this.context.exportResult({ format: format });\n            }\n        };\n        this.clearReportButtonClickHandler = this.clearReportButtonClick.bind(this);\n        this.newReportButtonClickHandler = this.newReportButtonClick.bind(this);\n        this.loadReportButtonClickHandler = this.loadReportButtonClick.bind(this);\n        this.saveReportButtonClickHandler = this.saveReportButtonClick.bind(this);\n        this.removeReportButtonClickHandler = this.removeReportButtonClick.bind(this);\n        this.reloadReportDataButtonClickHandler = this.reloadReportDataButtonClick.bind(this);\n        browserUtils.onMobileModeChanged(_ => {\n            document.location.reload();\n        });\n    }\n    initOptions(options) {\n        options = super.initOptions(options);\n        if (typeof (options.syncQueryOnChange) !== \"undefined\") {\n            this.syncReportOnChange = options.syncQueryOnChange;\n        }\n        if (typeof (options.syncReportOnChange) !== \"undefined\") {\n            this.syncReportOnChange = options.syncReportOnChange;\n        }\n        options.syncQueryOnChange = this.syncReportOnChange;\n        if (typeof (options.useReportCache) !== \"undefined\") {\n            this.useReportCache = options.useReportCache;\n        }\n        this.defaultReportId = options.defaultReportId;\n        return options;\n    }\n    initDone() {\n        super.initDone();\n        const query = this.context.getQuery();\n        query.addChangedCallback((event) => {\n            const eventData = event.data;\n            if (eventData) {\n                if (eventData.changeType == \"query.switched\") {\n                    this.context.clearResult();\n                    this.context.refreshWidgets(WidgetGroup.Result);\n                    this.context.refreshWidgets(WidgetGroup.Query);\n                }\n                else {\n                    this.disableExportButtons();\n                    if (this.resultCountSlot) {\n                        this.resultCountSlot.style.display = \"none\";\n                    }\n                }\n            }\n            //true if we just switched the report or changed facets (query was not changed)\n            let isLiteUpdate = !eventData\n                || eventData.changeType == \"query.switched\"\n                || eventData.part == QueryChangePart.ExtraData\n                || eventData.part == QueryChangePart.Facets;\n            let syncStarted = false;\n            if (this.syncReportOnChange) {\n                const needSync = eventData && eventData.changeType != \"query.switched\" && !eventData.noSync;\n                if (needSync) {\n                    syncStarted = true;\n                    this.syncReport({\n                        success: () => {\n                            // fetch data on query change\n                            if (!isLiteUpdate && this.viewOptions.fetchDataOnChange) {\n                                this.fetchData();\n                            }\n                        }\n                    });\n                }\n            }\n            // clear dataset result on query change\n            if (!isLiteUpdate && this.resultOptions.clearResultOnQueryChange) {\n                this.context.clearResult();\n                this.context.refreshWidgets(WidgetGroup.Result);\n            }\n            if (!isLiteUpdate && !syncStarted && this.viewOptions.fetchDataOnChange) {\n                this.fetchData();\n            }\n        });\n        window.setTimeout(() => {\n            this.context.loadQueryList({\n                success: (data) => {\n                    if (Array.isArray(data)) {\n                        this.reports = data;\n                        const exists = this.reports.filter(r => r.id == this.defaultReportId).length > 0;\n                        if (exists) {\n                            this.renderReportList({ reportId: this.defaultReportId });\n                        }\n                        else {\n                            this.renderReportList();\n                        }\n                    }\n                }\n            });\n        }, 100);\n    }\n    createWidgets(options) {\n        super.createWidgets(options);\n        let clearReportButton = \"ClearReportButton\";\n        let newReportButton = \"NewReportButton\";\n        let loadReportButton = \"LoadReportButton\";\n        let saveReportButton = \"SaveReportButton\";\n        let removeReportButton = \"RemoveReportButton\";\n        let reloadReportDataButton = \"ReloadReportDataButton\";\n        let resultCountSpan = \"ResultCount\";\n        let exportButtons = \"ResultExportButtons\";\n        let exportClass = this.exportClass;\n        if (options.slots) {\n            resultCountSpan = options.slots.resultCountSpan || resultCountSpan;\n            exportButtons = options.slots.exportButtons || exportButtons;\n            clearReportButton = options.slots.clearReportButton || clearReportButton;\n            newReportButton = options.slots.newReportButton || newReportButton;\n            loadReportButton = options.slots.loadReportButton || loadReportButton;\n            saveReportButton = options.slots.saveReportButton || saveReportButton;\n            removeReportButton = options.slots.removeReportButton || removeReportButton;\n            reloadReportDataButton = options.slots.reloadReportDataButton || reloadReportDataButton;\n            exportClass = options.slots.exportClass || exportClass;\n        }\n        this.exportButtons = this.domRoots.reduce((elems, root) => elems.concat(Array.from(root.querySelectorAll(`.${exportClass}`))), []);\n        this.enableExport = options.enableExport;\n        if (this.enableExport) {\n            //Add event listener for export buttons\n            this.exportButtons.forEach((button) => {\n                button.addEventListener('click', this.exportButtonClickHandler);\n            });\n        }\n        else {\n            this.hideExportButtons();\n        }\n        this.exportButtonsContainer = this.resolveElement(exportButtons);\n        if (!this.clearReportButton) {\n            this.clearReportButton = this.resolveElement(clearReportButton);\n            if (this.clearReportButton) {\n                this.clearReportButton.addEventListener('click', this.clearReportButtonClickHandler);\n            }\n        }\n        if (!this.newReportButton) {\n            this.newReportButton = this.resolveElement(newReportButton);\n            if (this.newReportButton) {\n                this.newReportButton.addEventListener('click', this.newReportButtonClickHandler);\n            }\n        }\n        if (!this.loadReportButton) {\n            this.loadReportButton = this.resolveElement(loadReportButton);\n            if (this.loadReportButton) {\n                this.loadReportButton.addEventListener('click', this.loadReportButtonClickHandler);\n            }\n        }\n        if (!this.saveReportButton) {\n            this.saveReportButton = this.resolveElement(saveReportButton);\n            if (this.saveReportButton) {\n                this.saveReportButton.addEventListener('click', this.saveReportButtonClickHandler);\n            }\n        }\n        if (!this.removeReportButton) {\n            this.removeReportButton = this.resolveElement(removeReportButton);\n            if (this.removeReportButton) {\n                this.removeReportButton.addEventListener('click', this.removeReportButtonClickHandler);\n            }\n        }\n        if (!this.reloadReportDataButton) {\n            this.reloadReportDataButton = this.resolveElement(reloadReportDataButton);\n            //OBSOLETE: remove the next 3 lines. We just support the old default button ID here\n            if (!this.reloadReportDataButton) {\n                this.reloadReportDataButton = this.resolveElement('UpdateReportButton');\n            }\n            if (this.reloadReportDataButton) {\n                this.reloadReportDataButton.addEventListener('click', this.reloadReportDataButtonClickHandler);\n            }\n        }\n        this.reportListSlot = document.getElementById('ReportList');\n        this.resultCountSlot = this.resolveElement(resultCountSpan);\n    }\n    applyReportNamePattern(input) {\n        const allowedPattern = /[a-zA-Z0-9\\s_\\[\\]()\\@\\$\\#\\&\\-\\.]/;\n        input.addEventListener('keydown', (e) => {\n            if (e.key.length === 1 && !allowedPattern.test(e.key) && !['Backspace', 'Delete', 'ArrowLeft', 'ArrowRight', 'Tab', 'Enter'].includes(e.key)) {\n                e.preventDefault();\n            }\n        });\n    }\n    /**\n    * Creates a new report.\n    */\n    newReport() {\n        const ds = this.getDialogService();\n        const dlg = ds.open({\n            title: i18n.getText('NewReportDlgTitle'),\n            body: this._reportSaveTemplate,\n            submitable: true,\n            closable: true,\n            cancelable: true,\n            submitOnEnter: true,\n            arrangeParents: false,\n            beforeOpen: () => {\n                const nameInput = document.getElementById(`kdlg-dialog-form-input`);\n                this.applyReportNamePattern(nameInput);\n                nameInput.value = i18n.getText('NewReportDefName');\n                const nameLabel = document.getElementById('kdlg-dialog-form-name-label');\n                nameLabel.innerHTML = i18n.getText('SaveReportDlgLabel');\n                const descLabel = document.getElementById('kdlg-dialog-form-desc-label');\n                descLabel.innerHTML = i18n.getText('ReportDescLabel');\n                nameInput.focus();\n            },\n            onSubmit: () => {\n                const nameInput = document.getElementById(`kdlg-dialog-form-input`);\n                const queryName = nameInput.value;\n                if (queryName && queryName.replace(/\\s/g, '').length > 0) {\n                    dlg.clearAlert();\n                    dlg.disableButtons();\n                    const header = dlg.getRootElement().querySelector('header');\n                    const processEl = domel('div', header)\n                        .addClass('eqjs-process-bar local')\n                        .toDOM();\n                    const descInput = document.getElementById(`kdlg-dialog-form-textarea`);\n                    const queryDesc = descInput.value;\n                    this.context.newQuery({\n                        name: queryName,\n                        description: queryDesc,\n                        success: () => {\n                            dlg.close();\n                            const query = this.context.getQuery();\n                            const reportId = query.getId();\n                            this.insertIntoReportList({ id: reportId, name: query.getName(), description: query.getDescription() });\n                            this.renderReportList({ reportId: reportId });\n                        },\n                        error: (error) => {\n                            header.removeChild(processEl);\n                            dlg.enableButtons();\n                            dlg.showAlert(error, 'error');\n                        }\n                    });\n                }\n                return false;\n            }\n        });\n    }\n    /**\n    * Loads report by ID.\n    * @param reportId The ID of the report to load.\n    */\n    loadReport(reportId) {\n        if (!reportId) {\n            throw 'Empty report ID!';\n        }\n        let reportToLoad = this.findReportById(reportId);\n        if (!reportToLoad)\n            return;\n        const self = this;\n        const query = self.context.getQuery();\n        const reportLoaded = () => {\n            this.renderReportProps();\n            this.context.resultTable.clear();\n            query.fireChangedEvent({\n                part: QueryChangePart.All,\n                noSync: true,\n                changeType: 'query.switched'\n            });\n            this.fetchData();\n        };\n        let reportContent = this.useReportCache ? this.getReportContentFromCache(reportToLoad) : null;\n        if (reportContent) {\n            query.clear();\n            query.loadFromJson(reportContent, { validate: false });\n            reportLoaded();\n        }\n        else {\n            this.context.loadQuery({\n                queryId: reportId,\n                silent: true,\n                success: () => {\n                    this.saveReportContentInCache(reportToLoad, query.toJSON());\n                    reportLoaded();\n                }\n            });\n        }\n        this.setActiveReport(reportId);\n    }\n    /**\n    * Shows the dialog to save the report with new name.\n    */\n    saveCurrentReportAs() {\n        const query = this.context.getQuery();\n        const ds = this.getDialogService();\n        const dlg = ds.open({\n            title: i18n.getText('SaveReportDlgTitle'),\n            body: this._reportSaveTemplate,\n            submitable: true,\n            closable: true,\n            cancelable: true,\n            submitOnEnter: true,\n            arrangeParents: false,\n            beforeOpen: () => {\n                const input = document.getElementById(`kdlg-dialog-form-input`);\n                this.applyReportNamePattern(input);\n                input.value = query.getName();\n                const content = document.getElementById('kdlg-dialog-form-name-label');\n                content.innerHTML = i18n.getText('SaveReportDlgLabel');\n                const label = document.getElementById('kdlg-dialog-form-desc-label');\n                label.innerHTML = i18n.getText('ReportDescLabel');\n                const text = document.getElementById(`kdlg-dialog-form-textarea`);\n                text.innerText = query.getDescription();\n                input.focus();\n            },\n            onSubmit: () => {\n                const input = document.getElementById(`kdlg-dialog-form-input`);\n                const value = input.value;\n                if (value && value.replace(/\\s/g, '').length > 0) {\n                    query.setId(utils.generateId(value.replace(/\\s/g, '')));\n                    dlg.clearAlert();\n                    dlg.disableButtons();\n                    const header = dlg.getRootElement().querySelector('header');\n                    const processEl = domel('div', header)\n                        .addClass('eqjs-process-bar local')\n                        .toDOM();\n                    const text = document.getElementById(`kdlg-dialog-form-textarea`);\n                    const desc = text.value;\n                    query.setDescription(desc);\n                    this.context.newQuery({\n                        clearQuery: false,\n                        name: value,\n                        success: () => {\n                            dlg.close();\n                            this.context.refreshWidgets(WidgetGroup.Query);\n                            const savedQuery = this.context.getQuery();\n                            const reportId = savedQuery.getId();\n                            this.fetchData();\n                            this.insertIntoReportList({ id: reportId, name: query.getName(), description: query.getDescription() });\n                            this.renderReportList({ reportId: reportId });\n                            this.setActiveReport(reportId);\n                            this.renderReportProps();\n                        },\n                        error: (error) => {\n                            header.removeChild(processEl);\n                            dlg.enableButtons();\n                            dlg.showAlert(error, 'error');\n                        }\n                    });\n                }\n                return false;\n            }\n        });\n    }\n    /**\n    * Removes current report.\n    */\n    removeCurrentReport() {\n        const report = this.context.getQuery();\n        const ds = this.getDialogService();\n        ds.openConfirm(i18n.getText('RemoveReportDlgTitle'), i18n.getText('RemoveReportContent').replace('{reportName}', report.getName()))\n            .then(result => {\n            if (result) {\n                const reportId = report.getId();\n                this.context.removeQuery({\n                    queryId: reportId,\n                    success: () => {\n                        const index = this.removeFromReportList(reportId);\n                        this.renderReportList({ reportIndex: index });\n                    }\n                });\n            }\n        });\n    }\n    /**\n    * Sends current report's query to back-end.\n    */\n    syncReport(options) {\n        if (this.useReportCache) {\n            const query = this.context.getQuery();\n            const currentReport = this.findReportById(query.getId());\n            if (currentReport) {\n                currentReport.lastUpdated = Date.now();\n                this.saveReportContentInCache(currentReport, query.toJSON());\n            }\n        }\n        this.context.syncQuery({\n            success: (responseData) => {\n                if (responseData.query) {\n                    this.context.refreshWidgets(WidgetGroup.Query);\n                }\n                if (responseData.statement) {\n                    this.context.refreshWidgets(WidgetGroup.Statement);\n                }\n                if (options && options.success) {\n                    options.success(responseData);\n                }\n            }\n        });\n    }\n    /**\n    * Sets active report.\n    * @param reportId The ID of the report to make active.\n    */\n    setActiveReport(reportId) {\n        let rlItems = this.reportListSlot.querySelectorAll('li');\n        for (let i = 0; i < rlItems.length; i++) {\n            const item = rlItems[i];\n            item.classList.remove('active');\n            const rid = item.getAttribute('data-rid');\n            if (rid === reportId) {\n                item.classList.add('active');\n            }\n        }\n    }\n    /**\n    * Renders current report.\n    */\n    renderReportProps() {\n        let query = this.context.getQuery();\n        let titleElem = document.getElementById('ReportTitle');\n        titleElem.innerHTML = query.getName();\n        const columnsPanel = document.querySelector('.columns-bar');\n        if (columnsPanel) {\n            columnsPanel.innerHTML = '<strong>Columns:</strong>';\n            let columns = query.getColumns();\n            for (let column of columns) {\n                columnsPanel.innerHTML += '<span class=\"label label-default\">' + column.caption + '</span> ';\n            }\n        }\n    }\n    /**\n    * Renders the list of reports.\n    * @param options The options. In particular, `options.reportIndex` defines which report should be active.\n    */\n    renderReportList(options) {\n        this.renderReportPanels();\n        if (!this.reportListSlot.matches('li')) {\n            this.reportListSlot.innerHTML = \"\";\n            options = options || { reportId: (this.reports.length > 0 ? this.reports[0].id : null) };\n            var ul = document.createElement('ul');\n            ul.className = 'list-group list-group-flush';\n            this.reportListSlot.appendChild(ul);\n            for (let report of this.reports) {\n                this.renderReportItemInList(report, ul);\n            }\n            if (options.reportId) {\n                this.loadReport(options.reportId);\n            }\n            if (typeof (options.reportIndex) !== \"undefined\") {\n                let idx = options.reportIndex;\n                if (idx >= this.reports.length)\n                    idx = this.reports.length - 1;\n                if (idx < 0 && this.reports.length > 0)\n                    idx = 0;\n                if (idx >= 0)\n                    this.loadReport(this.reports[idx].id);\n            }\n        }\n    }\n    detach() {\n        if (this.exportButtonsContainer) {\n            this.showExportButtons();\n            this.exportButtons.forEach((button) => {\n                button.removeEventListener('click', this.exportButtonClickHandler);\n            });\n            this.exportButtons = [];\n            this.exportButtonsContainer = null;\n        }\n        if (this.clearReportButton) {\n            this.clearReportButton.removeEventListener('click', this.clearReportButtonClickHandler);\n            this.clearReportButton = null;\n        }\n        if (this.newReportButton) {\n            this.newReportButton.removeEventListener('click', this.newReportButtonClickHandler);\n            this.newReportButton = null;\n        }\n        if (this.loadReportButton) {\n            this.loadReportButton.removeEventListener('click', this.loadReportButtonClickHandler);\n            this.loadReportButton = null;\n        }\n        if (this.saveReportButton) {\n            this.saveReportButton.removeEventListener('click', this.saveReportButtonClickHandler);\n            this.saveReportButton = null;\n        }\n        if (this.removeReportButton) {\n            this.removeReportButton.removeEventListener('click', this.removeReportButtonClickHandler);\n            this.removeReportButton = null;\n        }\n        if (this.reloadReportDataButton) {\n            this.reloadReportDataButton.removeEventListener('click', this.reloadReportDataButtonClickHandler);\n            this.removeReportButton = null;\n        }\n        if (this.reportListSlot) {\n            this.reportListSlot.innerHTML = '';\n            this.reportListSlot = null;\n        }\n        if (this.resultCountSlot) {\n            this.resultCountSlot.innerHTML = '';\n            this.resultCountSlot = null;\n        }\n        super.detach();\n    }\n    /**\n    * Renders a single item in the list of reports.\n    * @param report The [[Report]] object to render.\n    * @param ul The [[HTMLUListElement]] to add the item to.\n    */\n    renderReportItemInList(report, ul) {\n        if (!ul) {\n            ul = this.reportListSlot.querySelector(\"ul\");\n        }\n        let reportName = report.name || report.description || \"\";\n        let li = document.createElement('li');\n        li.className = \"list-group-item\";\n        li.style.cursor = 'pointer';\n        li.setAttribute('data-rid', report.id);\n        li.innerText = reportName;\n        if (report.description) {\n            li.title = report.description;\n        }\n        li.addEventListener('click', (e) => {\n            const target = e.target;\n            const rid = target.getAttribute('data-rid');\n            this.loadReport(rid);\n        });\n        ul.appendChild(li);\n    }\n    /**\n    * Renders report panels.\n    */\n    renderReportPanels() {\n        const reportsContainer = document.getElementById(\"ReportsContainer\");\n        const noReportPanel = document.getElementById(\"NoReportPanel\");\n        if (this.reports.length > 0) {\n            this.hideElement(noReportPanel);\n            this.showElement(reportsContainer);\n        }\n        else {\n            this.hideElement(reportsContainer);\n            this.showElement(noReportPanel);\n        }\n    }\n    //TODO: Move these two functions to @easydata/ui\n    hideElement(element) {\n        if (element) {\n            element.style.visibility = 'hidden';\n        }\n    }\n    showElement(element) {\n        if (element) {\n            element.style.removeProperty('visibility');\n        }\n    }\n    /**\n    * Inserts the report to the list of reports.\n    * @param report The [[Report]] object to be inserted.\n    */\n    insertIntoReportList(report) {\n        this.reports.push(report);\n    }\n    /**\n    * Removes the report from the list of reports.\n    * @param reportId The ID of the report to be removed.\n    * @returns the index of removed report.\n    */\n    removeFromReportList(reportId) {\n        let index = this.indexOfReportById(reportId);\n        if (index >= 0)\n            this.reports.splice(index, 1);\n        return index;\n    }\n    indexOfReportById(reportId) {\n        for (let i = 0; i < this.reports.length; i++) {\n            if (this.reports[i].id === reportId)\n                return i;\n        }\n        return -1;\n    }\n    /**\n    * The handler of the \"Clear\" button click.\n    */\n    clearReportButtonClick() {\n        this.clearErrors();\n        this.context.clearQuery();\n    }\n    /**\n    * The handler of the \"Update\" button click.\n    */\n    reloadReportDataButtonClick() {\n        this.fetchData();\n    }\n    /**\n    * The handler of the \"Save\" button click.\n    */\n    saveReportButtonClick() {\n        this.saveCurrentReportAs();\n    }\n    /**\n    * The handler of the \"Load\" button click.\n    */\n    loadReportButtonClick() {\n        this.loadReport(\"LastQuery\");\n    }\n    /**\n    * The handler of the \"Remove\" button click.\n    */\n    removeReportButtonClick() {\n        this.removeCurrentReport();\n    }\n    /**\n    * The handler of the \"New\" button click.\n    */\n    newReportButtonClick() {\n        this.newReport();\n    }\n    /**\n    * The handler of errors.\n    * @param error The error object.\n    */\n    errorHandler(error) {\n    }\n    /**\n    * Clears the errors.\n    */\n    clearErrors() {\n    }\n    /**\n    * Disables export buttons.\n    */\n    disableExportButtons() {\n        this.hideExportButtons();\n    }\n    /**\n    * Enables export buttons.\n    */\n    enableExportButtons() {\n        this.showExportButtons();\n    }\n    /**\n    * Hides export buttons.\n    */\n    hideExportButtons() {\n        if (this.exportButtonsContainer) {\n            this.exportButtonsContainer.style.display = \"none\";\n        }\n    }\n    /**\n    * Shows export buttons.\n    */\n    showExportButtons() {\n        if (this.exportButtonsContainer) {\n            this.exportButtonsContainer.style.display = \"initial\";\n        }\n    }\n    /**\n     * Saves reports content to the cache.\n     * @param report  The report.\n     * @param content The content (Query serialized into JSON).\n     */\n    saveReportContentInCache(report, content) {\n        let item = this.findReportCacheItem(report.id);\n        if (!item) {\n            item = { id: report.id };\n            this.reportCache.push(item);\n        }\n        item.lastUpdated = report.lastUpdated;\n        item.content = content;\n    }\n    /**\n     * Gets the report content from cache.\n     * @param report The report.\n     * @returns Content of the report (Query in JSOn string)\n     */\n    getReportContentFromCache(report) {\n        let item = this.findReportCacheItem(report.id);\n        if (item && item.lastUpdated === report.lastUpdated) {\n            return item.content;\n        }\n        return null;\n    }\n    findReportById(id) {\n        for (let item of this.reports) {\n            if (item.id === id) {\n                return item;\n            }\n        }\n        return null;\n    }\n    findReportCacheItem(id) {\n        for (let item of this.reportCache) {\n            if (item.id === id) {\n                return item;\n            }\n        }\n        return null;\n    }\n}\n\nfunction addOldEasyQueryUIMapper() {\n    i18n.addMapper((info) => {\n        if (!info && !info.texts)\n            return;\n        for (let prop in info.texts) {\n            switch (prop) {\n                case 'PredicateTitle':\n                    info.texts['ConditionGroupTitle'] = info.texts[prop];\n                    break;\n                case 'RootPredicateTitle':\n                    info.texts['RootConditionGroupTitle'] = info.texts[prop];\n                    break;\n                case 'ErrIncorrectPredicateTitleFormat':\n                    info.texts['ErrIncorrectGroupTitleFormat'] = info.texts[prop];\n                    break;\n                case 'ButtonAddPredicate':\n                    info.texts['ButtonAddGroup'] = info.texts[prop];\n                    break;\n                case 'ButtonDelete':\n                    info.texts['CmdDelete'] = info.texts[prop];\n                    break;\n                case 'ButtonClear':\n                    info.texts['CmdClear'] = info.texts[prop];\n                    break;\n                case 'ButtonEnable':\n                    info.texts['CmdToggleEnable'] = info.texts[prop];\n                    break;\n                case 'ButtonAddCondition':\n                    info.texts['CmdAddCondition'] = info.texts[prop];\n                    break;\n                case 'ButtonAddGroup':\n                    info.texts['CmdAddCondGroup'] = info.texts[prop];\n                    break;\n            }\n        }\n    });\n}\nfunction addEasyQueryUITexts() {\n    i18n.updateDefaultTexts({\n        AltMenuAttribute: 'Attribute',\n        AltMenuConstantExpression: 'Constant expression',\n        ButtonApply: 'Apply',\n        ButtonCancel: 'Cancel',\n        ButtonClose: 'Close',\n        ButtonNext: 'Next',\n        ButtonPrev: 'Prev',\n        ButtonNow: 'Now',\n        ButtonOK: 'OK',\n        MenuEnable: 'Enabled',\n        MenuParameterization: 'Parameterized',\n        MenuJoinCond: 'Use in JOIN',\n        CmdClear: 'Clear',\n        CmdDelete: 'Delete',\n        CmdToggleEnable: 'Toggle enable',\n        CmdToggleEnableCustom: 'Custom Expression columns are not supported',\n        CmdAddCondition: 'Add condition',\n        CmdAddCondGroup: 'Add group of conditions',\n        ButtonSelectAll: 'Select all',\n        ButtonDeselectAll: 'Clear selection',\n        ButtonAddColumns: 'Add column(s)',\n        ButtonAddConditions: 'Add condition(s)',\n        CmdClickToAddCondition: '[Add new condition]',\n        CmdDeleteRow: 'Delete this row',\n        ErrIncorrectGroupTitleFormat: 'Incorrect condition group title format',\n        ErrNotNumber: ' is not a number',\n        ErrIncorrectInteger: 'Incorrect integer value',\n        ErrIncorrectNumberList: 'Incorrect list format',\n        False: 'False',\n        LinkTypeAll: 'all',\n        LinkTypeAny: 'any',\n        LinkTypeNone: 'none',\n        LinkTypeNotAll: 'not all',\n        ConjAll: 'and',\n        ConjAny: 'or',\n        ConjNotAll: 'and',\n        ConjNone: 'or',\n        MsgApplySelection: '[Apply selection]',\n        MsgAs: 'as',\n        MsgEmptyList: '(empty list)',\n        MsgEmptyListValue: '[select value]',\n        MsgEmptyScalarValue: '[enter value]',\n        MsgSubQueryValue: '[edit sub-query]',\n        MsgEmptyAttrValue: '[select attribute]',\n        MsgEmptyOperator: '[Unrecognized operator]',\n        MsgEmptyCustomSql: '[enter SQL expression]',\n        MsgCustomSql: '[Custom SQL]',\n        MsgNoResult: 'No result',\n        MsgResultCount: '{0} records found',\n        MsgOf: 'of',\n        ConditionGroupTitle: '{lt} of the following apply',\n        RootConditionGroupTitle: 'Select records where {lt} of the following apply',\n        StrAddConditions: 'Add conditions',\n        SubQueryDialogTitle: 'Edit sub-query',\n        SubQueryColumnTitle: 'Column:',\n        SubQueryEmptyColumn: '[select column]',\n        SubQueryQueryPanelCaption: 'Conditions',\n        True: 'True',\n        ButtonSorting: 'Sorting',\n        ButtonToAggr: 'Change to aggregate column',\n        ButtonToSimple: 'Change to simple column',\n        ButtonFormat: 'Display format',\n        CmdAscending: 'Ascending',\n        CmdClickToAddColumn: '[Add new column]',\n        CmdDeleteColumn: 'Delete column',\n        CmdDeleteSorting: 'Delete sorting',\n        CmdDescending: 'Descending',\n        CmdGroupAppearance: 'Appearance',\n        CmdGroupSort: 'Sorting',\n        CmdGroupFormat: 'Display format',\n        CmdNotSorted: 'Not sorted',\n        ColTypeAggrFunc: 'Aggregate function',\n        ColTypeCompound: 'Calculated',\n        ColTypeGroup: 'Column type',\n        ColTypeSimple: 'Simple column',\n        HeaderExpression: 'Expression',\n        HeaderSorting: 'Sorting',\n        HeaderTitle: 'Title',\n        SortHeaderColumn: 'Column',\n        SortHeaderSorting: 'Sorting',\n        StrAddColumns: 'Add columns',\n        CustomExpression: 'Custom Expression',\n        AddAllForEntityText: '[Add all attributes]',\n        CmdMoveToStart: 'Move to start',\n        CmdMoveRight: 'Move right',\n        CmdMoveLeft: 'Move left',\n        CmdMoveToEnd: 'Move to the end',\n        CmdMoveUp: 'Move up',\n        CmdMoveDown: 'Move down',\n        ButtonMenu: 'Show menu',\n        CmdToSimple: 'Not aggregated',\n        CmdMoveToFirst: 'Move to the first',\n        CmdMoveToPrev: 'Move to the previous',\n        CmdMoveToNext: 'Move to the next',\n        CmdMoveToLast: 'Move to the last',\n        CmdHiddenColumn: 'Hidden',\n        RowButtonTitle: 'Click to see the available options',\n        EntityToggle: 'Toggle entity',\n        //FilterBar\n        StrNoFilterDefined: 'No filter defined',\n        StrNoFilterClickToAdd: 'No filter defined. Click to add a new condition',\n        //Time picker\n        HintHours: 'Hours',\n        HintMinutes: 'Minutes',\n        //advanced search view texts\n        RemoveQueryTitle: 'Confirmation',\n        RemoveQueryContent: 'Remove query [{queryName}]?',\n        NewQueryTitle: 'New query',\n        NewQueryContent: 'New query name: ',\n        NewQueryDefName: 'New query',\n        SaveQueryTitle: 'Save query',\n        SaveQueryContent: 'Query name: ',\n        SaveQueryDefName: '{queryName} copy',\n        QueryChangedTitle: 'Confirmation',\n        QueryChangedContent: 'The query was changed. Do you want to save it first?',\n        QueryClearContent: 'The query will cleared. Do you want to continue?',\n        UpdateQuerySelector: '[click here to load the query]',\n        FileNameLabel: 'File name: ',\n        SaveQueryToFileDlgTitle: 'Save query to file',\n        //report view texts\n        NewReportDefName: 'New report',\n        NewReportDlgTitle: 'New report',\n        SaveReportDlgTitle: 'Save report',\n        SaveReportDlgLabel: 'Report name:',\n        ReportDescLabel: 'Description: ',\n        RemoveReportDlgTitle: 'Remove report',\n        RemoveReportContent: 'Are you sure you want to remove \\'{reportName}\\'?',\n        //facets\n        Facets: {\n            TotalRecordsLabel: 'Total records:',\n            AddMenuItems: {\n                Chart: 'Chart',\n                Pivot: 'Pivot table',\n                DataTable: 'Data table'\n            },\n            LoadDataDlgTitle: 'Downloading data',\n            LoadDataDlgContent: 'Records loaded: {loadedRecs}/{totalRecs}',\n            RefreshBtnTitle: 'Refresh',\n            ExportBtnTitle: 'Export',\n            MaximizeBtnTitle: 'Maximize',\n            RestoreBtnTitle: 'Restore Down',\n            RemoveFacetDlgTitle: 'Remove facet',\n            RemoveFacetDlgContent: `Are you sure, that you want to delete {facetTitle} tab?`,\n            DefaultDlgTitle: 'Setup facet',\n            DefaultFacetTitle: '',\n            NewFacetTitle: 'New Facet',\n            TabNameLabel: 'Tab name',\n            ErrQueryChanged: 'FAILED TO DISPLAY. QUERY WAS CHANGED',\n            ErrNotEnoughData: `We can't display the graph because not all data for this query is loaded. \r\n        The total number of records: {totalRecs}, currently loaded: {cachedRecs}. \r\n        You can [download the result]. Please note: this may take some time and consume a lot of memory.`,\n            ErrTooMuchData: 'Too much data. The grid is not able to display it',\n            Chart: {\n                FacetTitle: 'Chart',\n                DlgTitle: 'Chart settings',\n                DataColumnSelectorLabel: 'Data column',\n                LabelColumnSelectorLabel: 'Label column',\n                ChartTypeSelectorLabel: 'Chart type',\n                ShowLegendLabel: 'Show legend (if available)'\n            },\n            Pivot: {\n                FacetTitle: 'Pivot table',\n                DlgTitle: 'Pivot settings',\n                SwapBtnTitle: 'Swap column and row fields',\n                ColumnFieldSelectorLabel: 'Column field',\n                RowFieldSelectorLabel: 'Row field',\n                CellDataSelectorLabel: 'Cell data',\n                TotalsRowLabel: 'Totals row',\n                TotalsColLabel: 'Totals column',\n                TotalGridLabel: 'Total'\n            },\n            DataTable: {\n                FacetTitle: 'Result table',\n                DlgTitle: 'Table facet settings'\n            }\n        },\n        TotalsDlgLabel: 'Totals',\n        GrandTotalsLabel: 'Grand totals',\n        TotalsDlgTitle: 'Select totals',\n        //formats\n        ExportDlgTitle: 'Export result',\n        ExportDlgFmtLabel: 'Format',\n        'csv': 'CSV',\n        'excel': 'Excel',\n        'pdf': 'PDF',\n        'excel-html': 'HTML (Excel-compatible)',\n        // Aggregation settings\n        AggrSettings: {\n            GroupBtn: 'Group selected column(s)',\n            UngroupBtn: 'Ungroup columns',\n            AggrBtn: 'Aggregate selected column',\n            UnaggrBtn: 'Remove column aggregation',\n            GrandTotalsLabel: 'Show grand totals',\n            GroupCountsLabel: 'Show record count for groups',\n            AggrDialogTitle: 'Aggregation/grouping',\n            EnableAggrLabel: 'Enable aggregation',\n            SelectedError: 'Complete the action with selected column(s)',\n            NoGroupsOrAggrError: 'Add at least one group or aggregation',\n            NoGroupsOrGrandError: 'Add at least one group, or enable grand totals',\n            NoAggrOrCountError: 'Add at least one aggregation, or enable records count',\n            NoGroupsLabel: 'No groups',\n            NoAggrsLabel: 'No aggregations',\n            EmptySettingsLabel: '[ Click to setup ]'\n        },\n        ChartType: {\n            Area: 'Area chart',\n            Bar: 'Bar chart',\n            Column: 'Column chart',\n            Combo: 'Combo chart',\n            Doughnut: 'Doughnut chart',\n            Polar: 'Polar chart',\n            Radar: 'Radar chart',\n            Histogram: 'Histogram chart',\n            Line: 'Line chart',\n            SteppedLine: 'Stepped line chart',\n            Pie: 'Pie chart'\n        }\n    });\n}\naddOldEasyQueryUIMapper();\naddEasyQueryUITexts();\n\nconst services = EqServiceProvider.getInstance();\nservices.registerService('DialogService', () => new DefaultDialogService());\n\nif (!Element.prototype.matches) {\n    Element.prototype.matches =\n        Element.prototype.msMatchesSelector\n            || Element.prototype.webkitMatchesSelector;\n}\n// support NodeList forEach in IE11\nif (window['NodeList'] && !window['NodeList'].prototype.forEach) {\n    window['NodeList'].prototype.forEach = Array.prototype.forEach;\n}\n//find index in IE11\nif (!Array.prototype.findIndex) {\n    Array.prototype.findIndex = function (predicate) {\n        if (this == null) {\n            throw new TypeError('Array.prototype.findIndex called on null or undefined');\n        }\n        if (typeof predicate !== 'function') {\n            throw new TypeError('predicate must be a function');\n        }\n        var list = Object(this);\n        var length = list.length >>> 0;\n        var thisArg = arguments[1];\n        var value;\n        for (var i = 0; i < length; i++) {\n            value = list[i];\n            if (predicate.call(thisArg, value, i, list)) {\n                return i;\n            }\n        }\n        return -1;\n    };\n}\n\nexport { AddRowRenderer, AdvancedSearchView, AggrFuncColumnRendererCB, AggrFuncColumnRendererCP, AggrSettingsDialog, AggrSettingsRenderer, AggregationBar, AttrColumnRendererCB, AttrColumnRendererCP, AttributeExpressionRenderer, BaseElementRenderer, ChartFacet, ChartJsWidget, ChartType, ChartWidget, ColumnAction, ColumnRendererCB, ColumnRendererCP, ColumnsBar, ColumnsEditMode, ColumnsPanel, ConditionAction, ConditionGroupRenderer, ConditionGroupRowRenderer, ConditionRenderer, ConditionsEditMode, ConstColumnRendererCP, CustomListExpressionRenderer, CustomSqlColumnRendererCP, DataFilterView, DataTableFacet, DateTimeExpressionRenderer, DomDropDownElementBuilder, DropDownRenderer, EasyGridWidget, EntitiesPanel, EqHtmlGrid, ExportDialog, ExportWidget, ExpressionRenderer, FacetContainer, FacetType, FilterBar, GoogleChartWidget, Grid, HtmlContentWidget, HtmlDataFilterView, InputExpressionRenderer, ListExpressionRenderer, ManageDrillDownWidget, OperatorRenderer, PivotTableFacet, PopupMenu, ProcessWidget, QPEditablePart, QueryPanel, ReportView, ResultFacet, ResultFacetsPanel, SimpleConditionRenderer, SortingBar, SqlListExpressionRenderer, StatementPanel, SubQueryExpressionRenderer, TextRenderer, View, dropdown };\n","import { Condition, CondTag, QueryColumn, Query, LinkType, Tree, DataModel, EqAggregatesContainer, equtils, registerEqContextResolver, EqContext, ExprTag, Expression } from '@easyquery/core';\nimport { HttpClient, EasyDataTable } from '@easydata/core';\nimport { DefaultDialogService, domel } from '@easydata/ui';\n\nconst majVer = 7;\nconst minVer = 4;\nconst magics = [45, 128, 231];\nMath.trunc = Math.trunc || function (x) {\n    if (isNaN(x)) {\n        return NaN;\n    }\n    if (x > 0) {\n        return Math.floor(x);\n    }\n    return Math.ceil(x);\n};\nconst lcv = {\n    __kt: 0,\n    versionNum: '' + majVer + '.' + minVer,\n    ck: function (key) {\n        if (!key || !key.length) {\n            this.__kt = -3;\n            return;\n        }\n        try {\n            var part1 = key.slice(0, key.length - 12);\n            var infoBytes = _bs(part1);\n            var part2 = key.slice(key.length - 12);\n            let ism = false;\n            for (const magic of magics) {\n                var edc = t36(magic);\n                if (part2[0] === edc[0] && part2[2] === edc[1]) {\n                    ism = true;\n                    break;\n                }\n            }\n            if (!ism) {\n                lcv.__kt = -1;\n            }\n            var idx = minVer % 4;\n            var shift = majVer + minVer;\n            if (part2[6 + idx] != encChar(shift, 19)) {\n                lcv.__kt = -2;\n                return;\n            }\n            if (part2[1] != encChar(infoBytes[3])) {\n                return;\n            }\n            lcv.__kt = part2[3] != encChar(infoBytes[5]) ? 2 : 3;\n            if (lcv.__kt === 2) {\n                var eds = `${f36(part2.substring(4, 6) + part2.substring(10))}`;\n                var ed = new Date(2000 + Number.parseInt(eds.substring(0, 2)), Number.parseInt(eds.substring(2, 4)) - 1, Number.parseInt(eds.substring(4)), 0, 0, 0, 0);\n                if (Date.now() > ed.getTime()) {\n                    lcv.__kt = 1;\n                }\n            }\n        }\n        catch (error) {\n        }\n    }\n};\nfunction encChar(x, b = 20) {\n    return String.fromCharCode(65 + x % b);\n}\nfunction _bs(str) {\n    var binary_string = urlatob(str);\n    var len = binary_string.length;\n    var bytes = new Uint8Array(len);\n    for (var i = 0; i < len; i++) {\n        bytes[i] = binary_string.charCodeAt(i);\n    }\n    return bytes;\n}\nfunction urlatob(str) {\n    var s = str;\n    s = s.replace(/-/g, '+');\n    s = s.replace(/_/g, '/');\n    switch (s.length % 4) {\n        case 0:\n            break;\n        case 2:\n            s += \"==\";\n            break;\n        case 3:\n            s += \"=\";\n            break;\n    }\n    return window.atob(s);\n}\nconst tokens = \"ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789\";\nfunction t36(val) {\n    var result = \"\";\n    while (val > 0) {\n        result = tokens[val % tokens.length] + result;\n        val /= tokens.length;\n    }\n    return result;\n}\nfunction f36(val) {\n    var d = 0;\n    for (var i = 0; i < val.length; ++i)\n        d += tokens.indexOf(val[i]) * Math.pow(tokens.length, val.length - i - 1);\n    return d;\n}\n\nclass ConditionEx extends Condition {\n    constructor() {\n        super(...arguments);\n        this.readOnly = false;\n        this.parameterized = false;\n        this.inJoin = false;\n    }\n    isReadOnly() {\n        return this.readOnly || (this.getParent() && this.getParent().isReadOnly());\n    }\n    setReadOnly(value) {\n        this.readOnly = value || (this.getParent() && this.getParent().isReadOnly());\n        this.conditions && this.conditions.forEach((cond) => {\n            cond.setReadOnly(value);\n        });\n    }\n    isParameterized() {\n        return this.parameterized;\n    }\n    setParameterized(value) {\n        this.parameterized = value;\n    }\n    isInJoin() {\n        return this.inJoin;\n    }\n    setInJoin(value) {\n        this.inJoin = value;\n    }\n    loadFromData(model, data) {\n        super.loadFromData(model, data);\n        if (lcv.__kt <= 1)\n            return;\n        if (typeof data.readOnly !== 'undefined') {\n            this.setReadOnly(data.readOnly);\n        }\n        if (typeof data.inJoin !== 'undefined') {\n            this.setInJoin(data.inJoin);\n        }\n        if (typeof data.parameterized !== 'undefined') {\n            this.setParameterized(data.parameterized);\n        }\n        //if condition group\n        //this.linkType = data.linking;\n        if (data.conds) {\n            for (let i = 0; i < data.conds.length; i++) {\n                let newCond = this.query.createCondition();\n                newCond.loadFromData(model, data.conds[i]);\n                this.conditions.push(newCond);\n                newCond.setParent(this);\n            }\n        }\n    }\n    saveToData() {\n        let obj = super.saveToData();\n        if (lcv.__kt <= 1)\n            return obj;\n        if (this.isReadOnly()) {\n            obj.readOnly = this.isReadOnly();\n        }\n        if (this.isParameterized()) {\n            obj.parameterized = this.isParameterized();\n        }\n        if (this.isInJoin()) {\n            obj.inJoin = this.isInJoin();\n        }\n        if (this.tag == CondTag.Group) {\n            //if condition group\n            //obj.linking = this.linkType;\n            obj.conds = [];\n            for (let i = 0; i < this.conditions.length; i++) {\n                obj.conds.push(this.conditions[i].saveToData());\n            }\n        }\n        return obj;\n    }\n}\n\nclass QueryColumnEx extends QueryColumn {\n    constructor() {\n        super(...arguments);\n        this.readOnly = false;\n    }\n    isReadOnly() {\n        return this.readOnly;\n    }\n    setReadOnly(value) {\n        this.readOnly = value;\n    }\n    /**\n     * Loads column from its JSON representation object.\n     * @param model The Data Model.\n     * @param colData The JSON representation object.\n     */\n    loadFromData(model, colData) {\n        super.loadFromData(model, colData);\n        if (lcv.__kt <= 2)\n            return;\n        if (colData) {\n            if (typeof colData.readOnly != 'undefined') {\n                this.readOnly = colData.readOnly;\n            }\n        }\n    }\n    saveToData() {\n        let colData = super.saveToData();\n        if (lcv.__kt <= 2)\n            return colData;\n        if (this.isReadOnly()) {\n            colData.readOnly = this.isReadOnly();\n        }\n        return colData;\n    }\n}\n\nclass QueryEx extends Query {\n    constructor(model, options) {\n        super(model, null, options);\n    }\n    isEx() {\n        return lcv.__kt > 1;\n    }\n    createSubQuery() {\n        return new QueryEx(this.model, { context: this.context });\n    }\n    createCondition(tag = CondTag.Simple) {\n        if (lcv.__kt <= 1)\n            return super.createCondition(tag);\n        return new ConditionEx(this, tag);\n    }\n    createColumn(justsorted = false) {\n        if (lcv.__kt <= 1)\n            return super.createColumn(justsorted);\n        return new QueryColumnEx(this, justsorted);\n    }\n    /**\n     * Adds a condition group - a group of simple conditions (predicates) linked by AND or OR\n     * @param descriptor The descriptor of the new condition group.\n     * @returns The new search condition.\n     */\n    addConditionGroup(descriptor, addChildCondition = true) {\n        if (lcv.__kt <= 1)\n            return super.addConditionGroup(descriptor, addChildCondition);\n        let parent = descriptor.parent || this.getRootCondition();\n        let lType = descriptor.linking || (parent.linkType === LinkType.All ? LinkType.Any : LinkType.All);\n        let group = this.createCondition(CondTag.Group);\n        group.linkType = lType;\n        if (addChildCondition) {\n            let model = this.getModel();\n            let attr = model.getFirstUICAttr();\n            if (attr) {\n                let op = model.getDefaultOperatorForAttr(attr);\n                let cond = this.createSimpleConditionObject(attr, op, \"\");\n                group.addCondition(cond);\n            }\n        }\n        parent.addCondition(group);\n        return group;\n    }\n    addExtraConditionGroup(descriptor, addChildCondition = true) {\n        descriptor.parent = descriptor.parent || this.extraConditions;\n        if (lcv.__kt <= 1)\n            return super.addExtraConditionGroup(descriptor, addChildCondition);\n        return this.addConditionGroup(descriptor);\n    }\n    buildQueryPath() {\n        const model = this.getModel();\n        if (lcv.__kt <= 1)\n            return this.buildQueryPath();\n        if (model.getMainEntity())\n            return this.buildQueryPath();\n        const entities = this.getEntitiesInQuery();\n        if (entities.length == 0) {\n            throw Error(\"Cannon build path. Path is empty\");\n        }\n        let tree = new Tree(entities[0]);\n        for (let i = 1; i < entities.length; i++) {\n            const entity = entities[i];\n            if (tree.contains(entity)) {\n                continue;\n            }\n            let path = this.findPath(tree.value, entity);\n            if (path != null) {\n                //Add path to tree\n                tree = this.addPathToTree(tree, (path[0] === tree.value) ? path.slice(1) : path);\n            }\n            else {\n                throw Error(\"Unable to build query. Cannot build path.\");\n            }\n        }\n        tree.setParents();\n        return tree;\n    }\n    addPathToTree(tree, path) {\n        if (path.length == 0) {\n            return;\n        }\n        let pathAdded = false;\n        for (let child of tree.childs) {\n            if (child.value === path[0]) {\n                pathAdded = true;\n                if (path.length > 1)\n                    child = this.addPathToTree(child, path.slice(1));\n                break;\n            }\n        }\n        if (!pathAdded) {\n            let link = this.getModel().findLink(tree.value, path[0]);\n            if (link) {\n                let newNode = new Tree(path[0]);\n                tree.addChild(newNode);\n                if (path.length > 1)\n                    newNode = this.addPathToTree(newNode, path.slice(1));\n            }\n            else if (!tree.parent) {\n                let node = new Tree(tree);\n                tree = new Tree(path[0]);\n                tree.addChild(node);\n                if (path.length > 1)\n                    tree = this.addPathToTree(tree, path.slice(1));\n            }\n            else {\n                throw Error(\"Unable to build query. Cannot build path.\");\n            }\n        }\n        return tree;\n    }\n    findPath(entityFrom, entityTo) {\n        let curPath = [];\n        let curStep = [];\n        let nextStep = [];\n        let passedEntities = [];\n        let pathFound = false;\n        curPath.push(entityFrom);\n        curStep.push(curPath);\n        passedEntities.push(entityFrom);\n        while (!pathFound) {\n            nextStep = [];\n            for (let path of curStep) {\n                pathFound = this.checkPath(path, entityTo, nextStep, passedEntities);\n                if (pathFound) {\n                    path.push(entityTo);\n                    curPath = path;\n                    break;\n                }\n            }\n            curStep = [];\n            if (!pathFound) {\n                if (nextStep.length == 0)\n                    return null;\n                //copy nextStep to curStep\n                for (let path of nextStep)\n                    curStep.push(path);\n            }\n        }\n        return curPath;\n    }\n    checkPath(path, entityTo, nextStep, passedEntities) {\n        const endPoint = path[path.length - 1];\n        const entityLinks = this.getModel().getLinksByEntity(endPoint);\n        for (let link of entityLinks) {\n            let entity2 = null;\n            if (link.entityFrom == endPoint) {\n                entity2 = link.entityTo;\n            }\n            else {\n                entity2 = link.entityFrom;\n            }\n            if (entity2 == entityTo) { //if reach the destination\n                nextStep = [];\n                return true;\n            }\n            //if destination is not reached yet we add current node (entity2) to the path and proceed\n            if (path.indexOf(entity2) < 0 && passedEntities.indexOf(entity2) < 0) { //to prevent cycling\n                passedEntities.push(entity2);\n                let newPath = new Array();\n                newPath = newPath.concat(path);\n                newPath.push(entity2);\n                nextStep.push(newPath);\n            }\n        }\n        return false;\n    }\n}\n\nclass EqServerQueryStorage {\n    constructor(context) {\n        this.context = context;\n    }\n    init() {\n    }\n    newQuery(options) {\n        options = options || {};\n        const query = options.query || this.context.getQuery();\n        const model = this.context.getModel();\n        const modelId = options.modelId || (model ? model.getId() : \"\");\n        if (options.queryId) {\n            query.setId(options.queryId);\n        }\n        if (options.name) {\n            query.setName(options.name);\n        }\n        if (options.description) {\n            query.setDescription(options.description);\n        }\n        let requestData = {\n            'query': query.toJSONData()\n        };\n        if (options.data) {\n            requestData['data'] = options.data;\n        }\n        const url = this.context.resolveEndpoint('NewQuery', { modelId: modelId });\n        const http = this.context.getServices().getHttpClient();\n        return http.post(url, requestData)\n            .then((responseData) => {\n            return responseData.query;\n        });\n    }\n    getQueryList(options) {\n        options = options || {};\n        const modelId = options.modelId || this.context.getModel().getId();\n        const url = this.context.resolveEndpoint('GetQueryList', { modelId: modelId });\n        const http = this.context.getServices().getHttpClient();\n        return http.get(url)\n            .then((responseData) => {\n            if (!responseData.queries) {\n                return Promise.reject({\n                    message: 'Wrong response format'\n                });\n            }\n            return responseData.queries;\n        });\n    }\n    loadQuery(options) {\n        options = options || {};\n        const model = this.context.getModel();\n        const query = this.context.getQuery();\n        const modelId = options.modelId || model.getId();\n        const queryId = options.queryId || query.getId();\n        const url = this.context.resolveEndpoint('GetQuery', { modelId: modelId, queryId: queryId });\n        const http = this.context.getServices().getHttpClient();\n        return http.get(url)\n            .then((responseData) => {\n            return responseData.query;\n        });\n    }\n    saveQuery(options) {\n        options = options || {};\n        const query = options.query || this.context.getQuery();\n        const queryId = options.queryId || query.getId();\n        if (options.queryId) {\n            query.setId(options.queryId);\n        }\n        const modelId = options.modelId || query.getModel().getId();\n        if (options.queryId) {\n            query.setId(options.queryId);\n        }\n        let requestData = {\n            'query': query.toJSONData()\n        };\n        if (options.data) {\n            requestData['data'] = options.data;\n        }\n        const url = this.context.resolveEndpoint('SaveQuery', { modelId: modelId, queryId: queryId });\n        const http = this.context.getServices().getHttpClient();\n        return http.put(url, requestData)\n            .then((responseData) => {\n            return responseData.query;\n        });\n    }\n    removeQuery(options) {\n        options = options || {};\n        const context = this.context;\n        const query = context.getQuery();\n        const modelId = options.modelId || query.getModel().getId();\n        const queryId = options.queryId || query.getId();\n        let requestData = {\n            'modelId': modelId,\n            'queryId': queryId\n        };\n        if (options.data) {\n            requestData['data'] = options.data;\n        }\n        const url = this.context.resolveEndpoint('RemoveQuery', { modelId: modelId, queryId: queryId });\n        const http = this.context.getServices().getHttpClient();\n        return http.delete(url, requestData).getPromise();\n    }\n}\n\nclass DataModelEx extends DataModel {\n}\n\nclass DataTableAggregatesCalculator {\n    constructor(context) {\n        this.context = context;\n        //stores current totals by level (group) number\n        this.levelsTotals = [];\n        this.prevRow = null;\n        this.aggrContainer = new EqAggregatesContainer(context);\n    }\n    getAggrContainer() {\n        return this.aggrContainer;\n    }\n    initObjects() {\n        this.aggrSettings = this.context.getQuery().getAggregationSettings();\n        this.groups = this.aggrSettings.getGroups();\n        this.aggregates = this.aggrSettings.getAggregates();\n        this.aggrColIds = this.aggrSettings.getAggregates().map(a => a.colId);\n        this.aggrCols = this.context.resultTable.columns.getItems()\n            .filter(col => this.aggrColIds.indexOf(col.id) >= 0);\n        this.levelsTotals = [];\n        this.prevRow = null;\n    }\n    createColumnAggregatesObject() {\n        return {\n            sum: 0,\n            min: Number.MAX_VALUE,\n            max: Number.MIN_VALUE\n        };\n    }\n    calculate(options) {\n        this.initObjects();\n        this.aggrContainer.clear();\n        options = options || {};\n        options.maxLevel = options.maxLevel >= 0\n            ? options.maxLevel : 0;\n        var levelNumber = this.groups.length + 1; //number of groups plus grand totals\n        for (let levelIndex = 0; levelIndex < levelNumber; levelIndex++) {\n            let levelTotals = { count: 0, columns: {} };\n            this.resetLevelTotals(levelTotals);\n            this.levelsTotals.push(levelTotals);\n        }\n        const allRows = this.context.resultTable.getCachedRows();\n        if (allRows.length > 0) {\n            for (const row of allRows) {\n                this.processDataRow(row);\n            }\n            //flusing the totals for all group levels\n            for (let levelIndex = 1; levelIndex < levelNumber; levelIndex++) {\n                this.flushLevelTotals(levelIndex);\n            }\n            //flusing the grand totals (if they are turned on)\n            if (this.aggrSettings.hasGrandTotals()) {\n                this.flushLevelTotals(0);\n            }\n        }\n        return Promise.resolve();\n    }\n    resetLevelTotals(rowTotals) {\n        for (const aggrCol of this.aggrCols) {\n            rowTotals.columns[aggrCol.id] = this.createColumnAggregatesObject();\n        }\n        rowTotals.count = 0;\n    }\n    processDataRow(row) {\n        const levelIndexChanged = this.checkLevelChange(row);\n        if (levelIndexChanged >= 0) {\n            for (let levelIndex = levelIndexChanged; levelIndex < this.levelsTotals.length; levelIndex++) {\n                this.flushLevelTotals(levelIndex);\n            }\n        }\n        if (this.aggrSettings.hasGrandTotals()) {\n            this.updateLevelTotals(0, row);\n        }\n        let levelIndex = 1;\n        for (const group of this.groups) {\n            this.updateLevelTotals(levelIndex, row);\n            levelIndex++;\n        }\n        this.prevRow = row;\n    }\n    /** Checks if the values in group columns were changed\n        and return the level number they were */\n    checkLevelChange(row) {\n        if (this.prevRow == null)\n            return -1;\n        for (let groupIndex = 0; groupIndex < this.groups.length; groupIndex++) {\n            var group = this.groups[groupIndex];\n            for (const colId of group.columns) {\n                const value = row.getValue(colId);\n                const prevValue = this.prevRow.getValue(colId);\n                if (!this.aggrSettings.compareValues(prevValue, value)) {\n                    return groupIndex + 1;\n                }\n            }\n        }\n        return -1;\n    }\n    /** Saves the current values in levelData for the specified level to AggregateContainer\n        and then reset the data row for that level\n    */\n    flushLevelTotals(levelIndex) {\n        let levelTotals = this.levelsTotals[levelIndex];\n        const group = levelIndex > 0 ? this.groups[levelIndex - 1] : null;\n        let groupKey = this.aggrSettings.buildGroupKey(group, this.prevRow);\n        var groupTotals = {};\n        for (const aggr of this.aggregates) {\n            const columnTotals = levelTotals.columns[aggr.colId];\n            groupTotals[aggr.colId] = this.applyAggrFunc(aggr.funcId, columnTotals, levelTotals);\n        }\n        if (this.aggrSettings.hasRecordCount()) {\n            groupTotals[this.aggrSettings.COUNT_FIELD_NAME] = levelTotals.count;\n        }\n        this.aggrContainer.updateAggregateData(levelIndex, groupKey, groupTotals);\n        this.resetLevelTotals(levelTotals);\n    }\n    applyAggrFunc(funcId, columnTotals, levelTotals) {\n        switch (funcId) {\n            case \"SUM\":\n                return columnTotals.sum;\n            case \"AVG\":\n                return columnTotals.sum / levelTotals.count;\n            case \"COUNT\":\n            case \"CNTDST\":\n                return levelTotals.count;\n            case \"MIN\":\n                return columnTotals.min;\n            case \"MAX\":\n                return columnTotals.max;\n        }\n    }\n    /** Updates the totals by values in the current DataRow\n     * and according to the specified aggregate\n    */\n    updateLevelTotals(levelIndex, row) {\n        const levelTotals = this.levelsTotals[levelIndex];\n        levelTotals.count += 1;\n        for (const aggr of this.aggregates) {\n            const value = row.getValue(aggr.colId);\n            const columnTotals = levelTotals.columns[aggr.colId];\n            columnTotals.sum += value;\n            if (value < columnTotals.min) {\n                columnTotals.min = value;\n            }\n            if (value > columnTotals.max) {\n                columnTotals.max = value;\n            }\n        }\n    }\n    needRecalculation() {\n        return true;\n    }\n    reset() {\n    }\n}\n\nfunction strIsEmpty(str) {\n    if (str) {\n        return str.trim() === '';\n    }\n    else\n        return true;\n}\nconst baseLicApiUrl = 'https://account.korzh.com/api/license';\nconst eqVersion = lcv.versionNum;\nclass LCDialog {\n    constructor(context) {\n        this.http = new HttpClient();\n        this.context = context;\n    }\n    show() {\n        const dialogService = new DefaultDialogService();\n        this.dialogSet = dialogService.createSet([\n            {\n                closable: false,\n                cancelable: false,\n                submitOnEnter: true,\n                title: 'No license key for EasyQuery',\n                body: this.buildStartPage(),\n                submitButtonText: 'Submit',\n                onInput: this.validateForm.bind(this),\n                onSubmit: this.startPageOnSubmit.bind(this)\n            },\n            {\n                closable: false,\n                cancelable: false,\n                submitOnEnter: true,\n                title: 'Please check your inbox',\n                body: this.buildCodePage(),\n                submitButtonText: 'Get License Key',\n                onInput: this.validateForm.bind(this),\n                onSubmit: this.codePageOnSubmit.bind(this)\n            },\n            {\n                closable: false,\n                cancelable: false,\n                submitable: false,\n                title: 'Success',\n                body: this.buildSuccessPage()\n            },\n            {\n                closable: false,\n                cancelable: false,\n                submitable: false,\n                title: 'Failure',\n                body: this.buildFailurePage()\n            },\n        ]);\n        const dialog1 = this.dialogSet.open(0);\n        setTimeout(() => {\n            this.validateForm(dialog1);\n            const emailInput = document.getElementById('eqAuthEmail');\n            if (emailInput) {\n                emailInput.focus();\n            }\n        }, 200);\n    }\n    isValidForm(form) {\n        const emailInput = form.querySelector('#eqAuthEmail'); //form.querySelector('[name=\"email\"]') as HTMLInputElement;       \n        if (emailInput) {\n            return !strIsEmpty(emailInput.value) &&\n                emailInput.value\n                    .toLowerCase()\n                    .match(/^(([^<>()[\\]\\\\.,;:\\s@\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/);\n        }\n        const codeInput = form.querySelector('#eqAuthCode'); //form.querySelector('[name=\"code\"]') as HTMLInputElement;\n        if (codeInput) {\n            return !strIsEmpty(codeInput.value) &&\n                !isNaN(+codeInput.value) &&\n                codeInput.value == codeInput.value.trim() &&\n                codeInput.value.length === 6;\n        }\n        return true;\n    }\n    validateForm(dialog) {\n        const submitButton = dialog.getSubmitButtonElement();\n        submitButton.disabled = !this.isValidForm(dialog.getRootElement());\n    }\n    addInputField(parentBuilder, inputOptions) {\n        parentBuilder\n            .addChild('label', b => b\n            .attr('for', inputOptions.id)\n            .addHtml(`${inputOptions.label} ${inputOptions.required ? '<sup style=\"color: red\">*</sup>' : ''}: `))\n            .addChild('input', b => {\n            b.id(inputOptions.id);\n            b.name(inputOptions.name || inputOptions.id);\n            b.type(inputOptions.type || 'text');\n            if (typeof (inputOptions.value) !== 'undefined') {\n                b.value(inputOptions.value);\n            }\n            if (inputOptions.onInput) {\n                b.on('input', inputOptions.onInput);\n            }\n        });\n    }\n    buildStartPage() {\n        let form;\n        let controlsPanelBuilder;\n        const formBuilder = domel('div');\n        formBuilder.addChild('div', b => b\n            .html('<div style=\"font-size:1.2em\">The EasyQuery license key is either absent, invalid or was issued for a different version of the library.</div>' +\n            '<div style=\"font-size:1.2em\">Please fill out the form to obtain a valid trial license key.</div>'));\n        formBuilder\n            .addClass('kfrm-form')\n            .addChild('div', b => {\n            controlsPanelBuilder = b;\n            b.addClass('kfrm-fields label-above');\n            b.addClass('kfrm-break-20');\n        });\n        this.addInputField(controlsPanelBuilder, {\n            id: 'eqAuthEmail',\n            name: 'email',\n            label: 'Email',\n            required: true\n        });\n        this.addInputField(controlsPanelBuilder, {\n            id: 'eqAuthName',\n            name: 'contactName',\n            label: 'Name (optional)',\n            required: false\n        });\n        formBuilder.addChild('div', b => b\n            .html('<div style=\"margin-top:20px;font-size:0.9em\">* By clicking Submit, you agree with Korzh.com <a href=\"https://korzh.com/terms-of-use\">Terms of use</a>' +\n            ' and <a href=\"https://korzh.com/privacy\">Privacy policy</a>.</div>' +\n            '<div style=\"font-size:0.9em\">You also agree to receive email messages from Korzh.com. This consent may be revoked at any time.</div>'));\n        form = formBuilder.toDOM();\n        return form;\n    }\n    buildCodePage() {\n        let form;\n        let controlsPanelBuilder;\n        const formBuilder = domel('div');\n        formBuilder.addChild('div', b => b\n            .html('<div style=\"font-size:1.2em\">We sent a confirmation code to <strong>{{email}}</strong>.</div>' +\n            '<div style=\"font-size:1.2em\">Please find it in the email and enter to the text box below</div>'));\n        formBuilder\n            .addClass('kfrm-form')\n            .addChild('div', b => {\n            controlsPanelBuilder = b;\n            b.addClass('kfrm-fields label-above');\n            b.addClass('kfrm-break-20');\n        });\n        this.addInputField(controlsPanelBuilder, {\n            id: 'eqAuthCode',\n            name: 'code',\n            label: 'Confirmation code',\n            required: true\n        });\n        formBuilder.addChild('div', b => b\n            .html('<div style=\"margin-top:20px;font-size:0.9em\">NB: Don\\'t forget to check your SPAM folder ' +\n            'if the message does not arrive within the next 5 minutes, and mark it as \"Not Spam\" if it\\'s found there.</div>'));\n        form = formBuilder.toDOM();\n        return form.outerHTML;\n    }\n    buildSuccessPage() {\n        let form;\n        const formBuilder = domel('div');\n        formBuilder.addChild('div', b => b\n            .html('<div style=\"font-size:1.2em\">You have successfully completed the registration.</div>' + '{{message}}'));\n        form = formBuilder.toDOM();\n        return form.outerHTML;\n    }\n    buildFailurePage() {\n        let form;\n        const formBuilder = domel('div');\n        formBuilder.addChild('div', b => b\n            .html('{{message}}'));\n        form = formBuilder.toDOM();\n        return form.outerHTML;\n    }\n    startPageOnSubmit(dlg) {\n        const emailInput = document.getElementById('eqAuthEmail');\n        const nameInput = document.getElementById('eqAuthName');\n        this.authEmail = emailInput.value;\n        this.authName = nameInput.value;\n        dlg.disableButtons();\n        this.http.post(equtils.combinePath(baseLicApiUrl, 'get-code'), {\n            email: this.authEmail,\n            name: this.authName,\n            data: {\n                ptag: this.context.backendInfo.type,\n                apptype: this.context.backendInfo.subType,\n            }\n        }, { dataType: 'json' })\n            .then(result => {\n            if (result.status !== 0) {\n                throw new Error(result.message);\n            }\n            const dlg = this.dialogSet.openNext({ email: this.authEmail });\n            setTimeout(() => {\n                this.validateForm(dlg);\n                const codeInput = document.getElementById('eqAuthCode');\n                if (codeInput) {\n                    codeInput.focus();\n                }\n            }, 200);\n        })\n            .catch(error => {\n            dlg.showAlert('Error: ' + error.message, \"error\", true);\n            dlg.enableButtons();\n        });\n        return false;\n    }\n    codePageOnSubmit(dlg) {\n        const codeInput = document.getElementById('eqAuthCode');\n        const authCode = codeInput.value;\n        dlg.disableButtons();\n        this.http.post(equtils.combinePath(baseLicApiUrl, 'get-key'), {\n            token: authCode,\n            email: this.authEmail,\n            ptag: this.context.backendInfo.type,\n            version: eqVersion\n        }, { dataType: 'json' })\n            .then(result => {\n            switch (result.status) {\n                case 0:\n                    const url = equtils.combinePath(this.context.getBaseEndpoint(), 'lck');\n                    this.http.post(url, {\n                        version: eqVersion,\n                        key: result.key\n                    }, { dataType: 'json' })\n                        .then(_ => this.dialogSet.open(2, {\n                        message: '<div style=\"font-size:1.2em\">Please restart your web application to get the key applied.</div>'\n                    }), _ => this.dialogSet.open(2, {\n                        message: '<div style=\"font-size:1.2em\">' +\n                            'Please visit <a href=\"https://account.korzh.com\">your account page on Korzh.com</a> to get the key ' +\n                            'and then add it to the <i>appsettings.json</i> file (in the <i>EasyQuery/LicenseKey</i> option).</div>'\n                    }));\n                    break;\n                case 2:\n                    this.dialogSet.open(3, {\n                        message: '<div style=\"font-size:1.2em\">Your trial license for EasyQuery has expired.</div>' +\n                            '<div style=\"font-size:1.2em\">Please <a href=\"https://korzh.com/support\">contact us</a> if you want to extend the trial period.</div>'\n                    });\n                    break;\n                case 3:\n                    this.dialogSet.open(3, {\n                        message: '<div style=\"font-size:1.2em\">The maintenance subscription for your EasyQuery license has expired.</div>' +\n                            '<div style=\"font-size:1.2em\">You need to <a href=\"https://account.korzh.com\">renew the subscription</a> to get a valid license.</div>'\n                    });\n                    break;\n                default:\n                    throw new Error(result.message);\n            }\n        })\n            .catch(error => {\n            //quick fix for 7.2.5 (must be removed after fixing of HttpResponseError in EasyData)\n            if (!error.message) {\n                error.message = 'Invalid or expired code. Please re-submit your request.';\n            }\n            dlg.showAlert('Error: ' + error.message, \"error\", true);\n            dlg.enableButtons();\n        });\n        return false;\n    }\n}\nfunction showNoLicenseAlert(context) {\n    if (lcv.__kt == -3) {\n        const lcd = new LCDialog(context);\n        lcd.show();\n    }\n    else {\n        let title, body, buttonTitle, buttonUrl;\n        switch (lcv.__kt) {\n            case 1:\n                title = 'EasyQuery trial has expired';\n                body = `Your trial period for EasyQuery has expired. \n        You can <a href=\"https://korzh.com/support\">submit a request to extend your trial</a> or <a href=\"https://korzh.com/easyquery#licensing\">buy a license</a> to get rid of all limitations.`;\n                buttonTitle = 'Buy a license';\n                buttonUrl = '#licensing';\n                break;\n            default:\n                title = `Invalid key for EasyQuery!`;\n                body = `The EasyQuery product key is either invalid or was issued for a different version of the library.\n        The version you are using now is ${eqVersion},\n        so please <a href=\"https://account.korzh.com\">login to your account</a> to get a proper key for version ${eqVersion}`;\n                buttonTitle = 'Get key';\n                buttonUrl = 'https://account.korzh.com';\n                break;\n        }\n        const ds = new DefaultDialogService();\n        const dlg = ds.open({\n            closable: false,\n            cancelable: false,\n            submitable: false,\n            title: title,\n            body: body\n        });\n        const footer = dlg.getRootElement().querySelector('footer');\n        domel(footer)\n            .removeClass('align-right')\n            .setStyle('justify-content', 'center')\n            .addChild('button', b => b\n            .addClass('kfrm-button', 'is-info')\n            .addText(buttonTitle)\n            .on('click', (e) => {\n            window.location.href = buttonUrl;\n        }));\n        if (lcv.__kt == 1) {\n            domel(footer)\n                .addChild('button', b => b\n                .addClass('kfrm-button')\n                .addText('Extend trial')\n                .on('click', (e) => {\n                window.location.href = 'https://account.korzh.com';\n            }));\n        }\n    }\n}\n\nclass EnterpriseEqContext extends EqContext {\n    useEnterprise(keyOrInitCallback) {\n        const func = (key) => {\n            lcv.ck(key);\n            if (lcv.__kt > 1) {\n                const services = this.getServices();\n                services.registerDataModelResolver(context => new DataModelEx());\n                services.registerQueryResolver(context => new QueryEx(context.getModel(), { context: context }));\n                services.registerQueryStorageResolver(context => new EqServerQueryStorage(context));\n                services.registerAggregatesCalculator(context => new DataTableAggregatesCalculator(context));\n                if (lcv.__kt === 2) {\n                    console.warn('EasyQuery.JS is working in the TRIAL MODE!\\n'\n                        + 'Please order a license (https://korzh.com/easyquery) to get a proper product key.');\n                    this.createTrialWM();\n                    setTimeout(() => {\n                        this.showTrialWM();\n                        setTimeout(() => { this.hideTrialWM(); }, 6000);\n                    }, 3000);\n                }\n            }\n            else {\n                showNoLicenseAlert(this);\n            }\n        };\n        if (typeof (keyOrInitCallback) === \"string\") {\n            func(keyOrInitCallback);\n        }\n        else if (typeof (keyOrInitCallback) === \"function\") {\n            const http = this.getServices().getHttpClient();\n            let url = equtils.combinePath(this.getBaseEndpoint(), 'lck2');\n            http.get(url)\n                .then(result => {\n                func(result.key.split(\"\").reverse().join(\"\"));\n                this.useBackend({\n                    type: result.backendType,\n                    subType: result.appType\n                });\n                keyOrInitCallback();\n            })\n                .catch(error => {\n                if (error.status == 401) {\n                    //if the stutus is Not Autorized\n                    func('');\n                }\n                else {\n                    //otherwise try the old way\n                    url = equtils.combinePath(this.getBaseEndpoint(), 'lck');\n                    http.get(url)\n                        .then(result => {\n                        func(result.split(\"\").reverse().join(\"\"));\n                        keyOrInitCallback();\n                    })\n                        .catch(error => this.throwError({\n                        action: \"LCK\",\n                        sourceError: error\n                    }));\n                }\n            });\n        }\n        else {\n            throw new Error(\"Wrong type of 'keyOrInitCallback' parameter. It must be a string with a license key or a callback function.\");\n        }\n    }\n    createTrialWM() {\n        // we can rewrite it using shadow dom\n        // to make it impossible to hide using JS :)\n        let trialDiv = document.createElement(\"div\");\n        trialDiv.style.position = \"fixed\";\n        trialDiv.style.bottom = \"0\";\n        trialDiv.style.right = \"-400px\";\n        trialDiv.style.width = \"400px\";\n        trialDiv.style.height = \"100px\";\n        trialDiv.style.color = \"grey\";\n        trialDiv.style.textAlign = \"center\";\n        trialDiv.style.opacity = \"0.7\";\n        trialDiv.style.font = \"bold 1em Trebuchet MS, Tahoma, Verdana, Geneva, Arial, Helvetica, sans-serif\";\n        trialDiv.style.transition = \"right 3s ease-out\";\n        const header = document.createElement(\"div\");\n        const eq = document.createElement(\"span\");\n        eq.innerText = \"EasyQuery\";\n        eq.style.color = \"#3A94D4\";\n        eq.style.lineHeight = \"50px\";\n        header.appendChild(eq);\n        const korzh = document.createElement(\"span\");\n        korzh.innerText = \"by Korzh.com\";\n        korzh.style.marginLeft = \"10px\";\n        header.appendChild(korzh);\n        trialDiv.appendChild(header);\n        const trialOnly = document.createElement(\"div\");\n        trialOnly.innerText = \"FOR TRIAL USE ONLY\";\n        trialOnly.style.fontSize = \"1.2em\";\n        trialOnly.style.fontWeight = \"1000\";\n        trialDiv.appendChild(trialOnly);\n        document.body.appendChild(trialDiv);\n        this.trialDivElement = trialDiv;\n    }\n    showTrialWM() {\n        if (this.trialDivElement) {\n            this.trialDivElement.style.right = \"0\";\n        }\n    }\n    hideTrialWM() {\n        if (this.trialDivElement) {\n            this.trialDivElement.style.right = \"-400px\";\n            setTimeout(() => {\n                this.trialDivElement.parentNode.removeChild(this.trialDivElement);\n            }, 5000);\n        }\n    }\n}\nregisterEqContextResolver(() => new EnterpriseEqContext());\n\nclass EqServerAggregatesCalculator {\n    constructor(context) {\n        this.context = context;\n        this._needRecalculation = true;\n        this.aggrContainer = new EqAggregatesContainer(context);\n    }\n    getAggrContainer() {\n        return this.aggrContainer;\n    }\n    calculate(options) {\n        this._needRecalculation = false;\n        this.aggrContainer.clear();\n        options = options || {};\n        options.maxLevel = options.maxLevel >= 0\n            ? options.maxLevel : 0;\n        const levelPromises = [];\n        const query = this.context.createQuery();\n        query.loadFromData(this.context.getQuery().toJSONData());\n        const settings = this.context.getQuery().getAggregationSettings();\n        const aggregates = settings.getAggregates();\n        const aggrColIds = settings.getAggregates().map(a => a.colId);\n        const aggrCols = query.getColumns()\n            .filter(col => aggrColIds.indexOf(col.id) >= 0);\n        for (const col of aggrCols) {\n            query.changeColumnType(col, ExprTag.AggregateFunction, { funcId: aggregates.filter(a => a.colId == col.id)[0].funcId });\n        }\n        //get all non-aggregate columns\n        const queryCols = query.getColumns()\n            .filter(c => c.expr.tag !== ExprTag.AggregateFunction);\n        for (const col of queryCols) {\n            col.setHidden(true);\n        }\n        if (settings.hasRecordCount()) {\n            const col = query.createColumn();\n            col.caption = settings.COUNT_FIELD_NAME;\n            col['_id'] = settings.COUNT_FIELD_NAME;\n            const sqlText = 'COUNT(*)';\n            const customSqlExpr = new Expression(col);\n            customSqlExpr.tag = ExprTag.CustomSql;\n            customSqlExpr.sql = sqlText;\n            customSqlExpr.baseAttrId = null;\n            col.expr = customSqlExpr;\n            query.getColumns().push(col);\n        }\n        if (settings.hasGrandTotals()) {\n            levelPromises.push(this.processLevel({\n                query: query,\n                level: 0,\n                groupName: 'Grand Totals',\n                resultObtainedCallback: options.resultObtained,\n                errorOccurredCallback: options.errorOccurred\n            }));\n        }\n        const groups = settings.getGroups();\n        for (let level = 1; level <= groups.length; level++) {\n            const group = groups[level - 1];\n            for (const col of queryCols) {\n                col.setHidden(group.columns.indexOf(col.id) < 0);\n            }\n            levelPromises.push(this.processLevel({\n                query: query,\n                level: level,\n                groupName: group.name,\n                resultObtainedCallback: options.resultObtained,\n                errorOccurredCallback: options.errorOccurred\n            }));\n        }\n        return Promise.all(levelPromises)\n            .then(() => {\n            return;\n        })\n            .catch((error) => console.error(error));\n    }\n    processLevel(options) {\n        const fetcher = this.context.getDataFetcher();\n        let fetchOptions = {\n            aux: true,\n            query: options.query\n        };\n        if (this.context.debugMode) {\n            fetchOptions.debug = `Fetching group data. Group: '${options.groupName}', level: ${options.level}`;\n        }\n        const resultPromise = fetcher.fetchData(fetchOptions)\n            .then((result) => {\n            const dataTable = new EasyDataTable({\n                elasticChunks: true\n            });\n            const resultSet = result.resultSet;\n            for (const col of resultSet.cols) {\n                dataTable.columns.add(col);\n            }\n            for (const row of resultSet.rows) {\n                dataTable.addRow(row);\n            }\n            const levelData = this.buildLevelData(options.level, dataTable);\n            this.aggrContainer.setAggregateData(options.level, levelData);\n            if (options.resultObtainedCallback) {\n                options.resultObtainedCallback(result, options.level);\n            }\n        })\n            .catch((error) => {\n            if (options.errorOccurredCallback) {\n                options.errorOccurredCallback(Object.assign(Object.assign({}, error), { level: options.level }));\n            }\n        });\n        return resultPromise;\n    }\n    buildLevelData(level, dataTable) {\n        const aggrSettings = this.context.getQuery().getAggregationSettings();\n        const keyColumns = level > 0\n            ? aggrSettings.getGroups()[level - 1].columns\n            : [];\n        const valueColumns = aggrSettings.getAggregates().map(a => a.colId);\n        if (aggrSettings.hasRecordCount()) {\n            valueColumns.push(aggrSettings.COUNT_FIELD_NAME);\n        }\n        const data = new Map();\n        for (const row of dataTable.getCachedRows()) {\n            const key = {};\n            const value = {};\n            for (const keyCol of keyColumns) {\n                const colIdx = dataTable.columns.getIndex(keyCol);\n                if (colIdx >= 0) {\n                    let keyVal = row.getValue(keyCol);\n                    if (!aggrSettings.caseSensitiveGroups && typeof (keyVal) === 'string') {\n                        keyVal = keyVal.toLowerCase();\n                    }\n                    key[keyCol] = keyVal;\n                }\n            }\n            for (const valueCol of valueColumns) {\n                value[valueCol] = row.getValue(valueCol);\n            }\n            data.set(JSON.stringify(key), value);\n        }\n        return data;\n    }\n    needRecalculation() {\n        return this._needRecalculation;\n    }\n    reset() {\n        this._needRecalculation = true;\n    }\n}\n\nexport { ConditionEx, DataModelEx, EqServerAggregatesCalculator, EqServerQueryStorage, QueryColumnEx, QueryEx };\n",null],"names":["DataType","EntityAttrKind","EditorTag","Unknown","Edit","DateTime","List","CustomList","File","HttpMethod","utils","i18n","ColumnAlignment","liquid","LinkType","equtils","DataKind","HttpRequest","constructor","xhr","descriptor","this","method","url","headers","queryParams","data","setHeader","name","value","setQueryParam","getXMLHttpRequest","getResponseHeaders","readyState","HEADERS_RECEIVED","arr","getAllResponseHeaders","trim","split","headerMap","line","parts","header","shift","join","open","UNSENT","Object","keys","length","encodeURI","map","param","setRequestHeader","abort","getAllDataTypes","values","filter","item","getDateDataTypes","Time","Date","getStringDataTypes","String","Memo","FixedChar","_numericTypes","Byte","Word","Int32","Int64","Float","Currency","Autoinc","getNumericDataTypes","_intTypes","assignDeepCore","hashSet","target","sources","source","hasOwnProperty","key","sourceVal","endsWith","HTMLElement","has","get","Array","isArray","createArrayFrom","set","create","getPrototypeOf","collection","result","push","assign","args","i","assignDeep","WeakMap","getIfDefined","defaultValue","IsDefinedAndNotNull","copyArrayTo","collection1","collection2","len1","len2","findItemById","array","id","arrLength","idx","findItemIndexById","indexOfArrayItem","indexOf","len","moveArrayItem","index1","index2","splice","removeArrayItem","index","insertArrayItem","fillArray","start","end","relativeStart","k","Math","max","min","relativeEnd","undefined","final","shiftToFitWindow","absLeft","width","body","document","getElementsByTagName","winWidth","window","innerWidth","documentElement","clientWidth","absRight","isObject","val","isNumericType","dtype","isIntType","isNumeric","isNaN","parseFloat","isFinite","areCompatibleDataTypes","type1","type2","isPropSet","obj","propName","toLowerCase","toUpperCase","symbols","squeeze","str","maxlen","step","ch","nextIndex","getRandomInt","floor","random","safeParseInt","res","parseInt","generateId","prefix","prfx","squeezeMoniker","pml","ptt","randCharPart","randInt","intToNumBase","targetBase","buffer","rest","getNowTicks","getTime","strToDateTime","format","normalizedValue","replace","formatItems","dateItems","monthIndex","dayIndex","yearIndex","hourIndex","minutesIndex","secondsIndex","today","year","getFullYear","month","getMonth","day","getDate","getDaysInMonth","hour","minute","second","_a","strToTime","timeItems","HttpActionResult","request","promise","getPromise","getRequest","then","onfulfilled","onrejected","catch","onfinally","finally","HttpResponseError","Error","status","message","super","setPrototypeOf","prototype","HttpClient","responseBody","_responseBody","defaultHeaders","customPayload","options","send","Get","post","Post","put","Put","Delete","dataType","contentType","XMLHttpRequest","desc","beforeEachRequest","console","warn","onRequest","dataToSend","JSON","stringify","Promise","resolve","reject","responseType","onerror","error","responseText","onreadystatechange","responseContentType","getResponseHeader","responseObj","response","parse","onResponse","decodeArrayBuffer","uintArray","reader","FileReader","onloadend","DONE","readAsText","Blob","currentLocale","englishUSLocaleSettings","shortDateFormat","longDateFormat","editDateFormat","shortTimeFormat","editTimeFormat","longTimeFormat","shortMonthNames","longMonthNames","shortWeekDayNames","longWeekDayNames","decimalSeparator","currency","defaultLocale","localeId","englishName","displayName","texts","ButtonOK","ButtonCancel","Yes","No","True","False","settings","allLocales","mappers","mapInfo","info","mapper","getCurrentLocale","setCurrentLocale","newLocale","getLocaleSettings","updateLocaleSettings","settingsToUpdate","updateLocaleInfo","localeInfo","localeInfoToUpdate","loadBrowserLocaleSettings","determineSettingsByLocale","now","dateStr","toLocaleDateString","timeStr","toLocaleTimeString","dateFormat","timeFormat","navigator","language","addMapper","getLocales","locale","sort","a","b","setLocale","l","getText","textsObj","resText","argLength","getOneLocaleSetting","getShortMonthName","monthNum","getLongMonthName","getShortWeekDayName","dayNum","toString","getLongWeekDayName","updateLocaleTexts","updateDefaultTexts","addLocale","resetLocales","DT_FORMAT_RGEX","dateTimeToStr","date","yearStr","getHours","getMinutes","getSeconds","hour12","isPm","matches","yyyy","yy","substring","MMMM","MMM","MM","M","dd","d","HH","H","hh","h","tt","mm","ss","match","$1","buildShortDateTimeFormat","localeSettings","buildLongDateTimeFormat","dateTimeToStrEx","dateTime","buildUniversalDateTimeFormat","numberToStr","num","type","charAt","formatWithSequence","number","cachedSequenceFormats","v","Number","forEach","slice","toLocaleString","getNumberFormatOptions","digits","style","useGrouping","minimumIntegerDigits","minimumFractionDigits","maximumFractionDigits","convertWithMask","mask","reverse","trunc","booleanToStr","bool","MetaEntity","parent","isEditable","caption","description","attributes","subEntities","loadFromData","model","dto","captionPlural","namePlur","ied","ents","newEntity","createEntity","attrs","newAttr","createEntityAttr","scan","processAttribute","processEntity","opts","stop","internalProcessEntity","entity","attrCount","attr","subEntityCount","getFirstPrimaryAttr","getPrimaryAttrs","isPrimaryKey","MetaEntityAttr","size","isForeignKey","isNullable","showOnView","showOnCreate","showOnEdit","showInLookup","lookupAttr","expr","kind","Data","cptn","ipk","ifk","lattr","lookupEntity","lent","dataAttr","dattr","lookupDataAttr","ldattr","isDataType","defVal","nul","ivis","sov","soc","soe","sil","displayFormat","dfmt","udata","userData","edtr","defaultEditor","getEditorById","createValueEditor","ValueEditor","tag","resType","defValue","defval","rtype","accept","multiline","subType","getValueText","text","MetaData","mainEntity","rootEntity","displayFormats","Map","getMainEntity","loadFromJSON","stringJson","version","vers","editors","newEditor","entroot","dtypeStr","formats","getDisplayFormats","getDisplayFormatsForType","getDefaultFormat","f","isdef","setData","isEmpty","getId","getName","getRootEntity","editorId","editor","getAttributeById","attrId","getEntityAttrById","checkAttrProperty","attribute","listByEntityWithFilter","filterFunc","ent","entIdx","newEnt","items","isEntity","attrIdx","listByEntity","resultEntities","resultAttributes","newOpts","includeRootData","sortCheck","sortEntities","attrPlacement","concat","clear","addDefaultValueEditors","ve","addOrUpdateValueEditor","getEntitiesTree","getEntitiesTreeWithFilter","getFullEntityPathByAttr","sep","getEntityPathByAttr","root","entityCaption","entityText","getAttributeText","attrText","entityPath","RegExp","runThroughEntities","getFirstAttributeByFilter","AggregationSettings","colStore","aggregates","groups","useGrandTotals","useRecordCount","_caseSensitiveGroups","COUNT_FIELD_NAME","caseSensitiveGroups","updateCompareProc","compareValues","strictCompare","caseInsensitiveCompare","addGroup","cols","columns","getColumnIds","from","to","validateColumns","hasColumnsInUse","addAggregateColumn","colIndexOrId","funcId","colId","validateAggregate","addGrandTotals","addCounts","getGroups","grp","getInternalGroups","lastGroup","getAggregates","hasAggregates","hasGroups","hasGrandTotals","hasRecordCount","isValid","drop","group","c","aggr","needAggrCalculation","saveToData","ugt","urc","csg","buildGroupKey","row","caseInsensitive","keyVal","getValue","value1","value2","DataColumn","label","originAttrId","isAggr","groupFooterColumnTemplate","gfct","calculatedWidth","DataColumnList","_dateColumnIdx","count","add","colOrDesc","col","updateDateColumnIdx","getItems","move","newIndex","oldIndex","getIndex","getDateColumnIndexes","removeAt","removeDate","DataRow","toArray","colIdOrIndex","RangeError","setValue","EasyDataTable","_chunkSize","_elasticChunks","cachedRows","total","loader","needTotal","isInMemory","chunkSize","elasticChunks","inMemory","_columns","onUpdate","colDesc","rows","rowData","createRow","addRow","getRows","params","fromIndex","pageSize","page","offset","limit","endIndex","loadChunk","apply","table","getCachedRows","getCachedCount","fireUpdated","getRow","getTotal","setTotal","dataOrRow","dateIdx","column","mapDate","rowOrValues","newRow","cachedTotal","totalIsKnown","EasyGuid","newGuid","r","EventEmitter","silentMode","events","subscribe","eventType","callback","event","getEventRecByType","eventCallback","eventCallbacks","unsubscribe","callbackId","fire","postpone","force","eventRec","eqevent","emitAllFunc","setTimeout","enterSilentMode","exitSilentMode","isSilent","renderLiquidTemplate","template","vars","liquidVarRegexp","x","NaN","ceil","FormatParser","formatStr","pos","exprNum","tokenText","skipSpaces","next","npos","token","npos1","npos2","getToken","combinePath","path1","path2","strToLinkType","All","NotAll","Any","None","linkTypeToStr","parseOperatorFormat","operator","convertValue","fromDataType","toDataType","resInt","resFloat","downloadFile","filename","blob","createElement","appendChild","display","href","URL","createObjectURL","download","click","revokeObjectURL","removeChild","AggrFunction","sqlExpr","appliedTypes","aggrFunction","fmt","dtypes","getAppliedTypesOrDefault","BCD","EqValueEditor","sql","statement","extraParams","Operator","constValueFormat","isRange","caseIns","paramCount","defaultOperand","Operand","operands","pcnt","defOperand","newOperand","Scalar","operand","defText","txt","copyFrom","src","Entity","useInConditions","useInResult","useInSorting","uic","uir","uis","EntityAttr","defaultOperator","operators","defOperator","ops","EqEditorTag","SqlList","SubQuery","BindToParentColumn","DataModel","nullAttribute","nullOperator","aggrFunctions","dateMacros","timeMacros","links","newOperators","newOperator","aggrfuncs","newAggrFunc","getObject","getAttributeByIdSafe","_listByEntityWithFilter","_listByEntity","addUIC","addUIR","addUIS","addOrUpdateOperator","op","removeOperator","soft","getOperatorIdsByDataType","Guid","Bool","findAggrFunctionById","func","findLink","entityFrom","entityTo","link","getLinksByEntity","getFirstUICAttr","getFirstUICAttrInEntity","findOperatorById","operatorId","opCount","getOperatorById","getDefaultOperatorIdForAttr","getAggrFunctionCaption","funcTexts","funcCaption","getAggrFunctionFormat","funcFormat","getDefaultOperatorForAttr","getOperand","Query","getAggrFunctions","isDateMacro","macroExpr","macroProcessor","macroId","isTimeMacro","getDateMacroValue","setDate","setMonth","getDay","setFullYear","getDateOrMacroValue","getTimeMacroValue","setMinutes","setHours","getTimeOrMacroValue","time","t","getAllDateMacros","getAllTimeMacros","ExprTag","QueryChangePart","QueryChangeAction","SortDirection","CondTag","ConditionPart","WidgetGroup","Expression","Constant","_value","distinct","_isDefaultValue","getParent","getModel","getQuery","Attribute","EntityAttribute","ParentEntityAttribute","query","subQuery","createSubQuery","loadFromDataOrJson","arg","baseAttrId","toJSONData","getExpressionIndex","silent","setContent","oldValue","expressionChanged","hasText","tryCopyValueFrom","QueryColumn","_id","sorting","getColumnSorting","_sorting","direction","setColumnSorting","sortIndex","getColumnSortIndex","_sortIndex","setColumnSortIndex","justsorted","enabled","_isHidden","blockId","isReadOnly","isJustSorted","setReadOnly","isHidden","setHidden","getDataType","colData","srt","srtidx","groupFooterColumnTemlate","hidden","fireChangedEvent","part","SortingColumns","Columns","action","Modify","changee","Condition","_enabled","conditions","cond","linkType","justAdded","expressions","setParent","getConditions","isGroup","Group","getLevel","isParameterized","setParameterized","isInJoin","setInJoin","clearConditions","addCondition","removeConditionAt","Simple","disabled","exprs","newExpr","linking","condPart","Conditions","tuneOperatorForAttr","getOperatorId","setOperatorId","newOperatorId","oldOperatorId","tuneValueExpressions","oldAttrId","exprCount","oldOperator","oldOperand","valExpr","createValueExpr","oldExpr","areCompitableEditors","oldEditor","addExpressionByOperand","valueNotDefined","defAttr","Tree","childs","addChild","contains","child","findNode","setParents","InvalidQueryError","isModified","_isModified","resetModified","enableAggregation","_enableAggregation","processQueryForAggregation","AggregateFunction","aggrSettings","extraData","innerData","isNewbie","parentQuery","drillDowns","syncSortOrderWithColumnsOrder","context","eventEmitter","extraConditions","sortedColumns","regenerateId","setDefaultName","attributeExprTag","attrTag","clientListRequestHandler","serverListRequestHandler","timezoneOffset","getTimezoneOffset","addChangedCallback","ev","aggregation","updateAggregationSettings","Aggregation","hasChanged","getAggregationSettings","j","find","useAggregation","settingsTuner","useDefaultAggregation","aggrCols","colsToGroup","aggrsToAdd","changeColumnType","wasModified","colToAggr","getColumns","colToGroup","groupColIds","groupedCols","sortedCols","Ascending","colIds","enabledColIds","prevIndex","isEx","reset","clearQuery","hasEnabledAggrColumns","setName","validate","entityAttrNotExistError","validateConditionGroup","getAggregatedColumns","tryValidate","e","curCond","condition","checkExpressions","parsedVal","loadFromJson","json","changeStatus","noErrors","clearDrillDowns","conds","condData","createCondition","justsortcols","newCol","createColumn","addColumnToSorted","col1","col2","fixupSortingIndices","dds","addDrillDown","createQuery","getDrillDowns","getParentQuery","findColumnById","setModel","loadModelData","toJSON","modelId","modelName","rootCondToData","condGroup","extraConds","isEmptyConditions","isEmptyColumns","clearColumns","clearExtraConditions","setId","validateName","getDescription","setDescription","getUsedInTotalsColumns","pop","colJson","isUnique","scol","getJustSortedColumns","getSortedColumns","colIdx","adjustColumnsSorting","getColumnById","addColumn","newColumn","attributeId","constValue","customSql","checkedOption","aggrFuncId","constType","CustomSql","allowCustomExpressions","getDefaultColumnCaption","readonly","fireColumnsChangedEvent","Add","addColumnObj","author","sqlText","customSqlExpr","moveColumn","removeColumn","addConditionGroup","addChildCondition","addExtraConditionGroup","safeStringify","seen","WeakSet","addSimpleCondition","getRootCondition","createSimpleConditionObject","addSimpleExtraCondition","inputValues","attrExpr","valCount","valLength","removeColumns","columnsToRemove","justSortedColumns","removeFromArray","arrToRemove","ctrLen","fireProcessEvent","eventData","fireConditionsChangedEvent","runThroughConditions","processCondition","processGroup","predicate","getOneValueForAttr","opid","addProcessCallback","removeProcessCallback","removeChangedCallback","getConditionsText","getConditionGroupText","condText","conjKey","conjText","opId","plen","pi","macroText","getConditionsTextAsHtml","quoteExprText","getEntitiesInQuery","entities","addEntityByExpression","rootCond","fillEntitiesByCondtionGroup","buildQueryPath","tree","createTreeNodeFromEntity","subEnentity","BrowserQueryStorage","init","keyPrefix","queryListKey","queryKeyPrefix","getQueryList","itemsString","localStorage","getItem","err","newQuery","queryId","_saveQuery","loadQuery","queryItem","saveQuery","queryList","setItem","removeQuery","removeItem","EqModelLoader","modelPromise","getContext","createModelLoadingPromise","modelLoadingResolveFunc","modelLoadingRejectFunc","getModelPromise","startModelLoading","sendLoadModelRequest","EqServerModelLoader","http","getServices","getHttpClient","resolveEndpoint","responseData","EqServerDataFetcher","fetchData","fetchOptions","requestData","debug","chunk","aux","EqServerQuerySynchronizer","syncQuery","EqServerValueListResolver","loadValueList","listId","EqQueryFileLoader","getQueryFile","actionResult","dispositionHeader","fileName","lastIndexOf","uploadQueryFile","EqAggregatesContainer","levels","getAggregateData","level","groupKey","processFunc","keyStr","groupKeyToStr","getLevelDesc","receivedCallbacks","setAggregateData","updateAggregateData","createIfNotExists","DefaultAggregatesCalculator","aggrs","getAggrContainer","calculate","maxLevel","aggrColId","resultObtained","needRecalculation","EqServiceProvider","getInstance","_instance","services","httpClient","modelResolver","_","modelStorageResolver","queryResolver","modelLoaderResolver","queryStorageResolver","querySynchronizerResolver","vllResolver","dataFetcherResolver","queryFileLoaderResolver","aggrCalculatoResolver","createDataModel","registerDataModelResolver","resolver","getDataModelResolver","registerQueryResolver","getQueryResolver","registerModelLoaderResolver","getModelLoaderResolver","registerModelStorageResolver","getModelStorageResolver","registerQueryStorageResolver","getQueryStorageResolver","registerDataFetcherResolver","getDataFetcherResolver","registerQuerySyncronizerResolver","getQuerySynchronizerResolver","registerValueListLoaderResolver","getValueListLoaderResolver","registerQueryFileLoaderResolver","getQueryFileLoaderResolver","registerAggregatesCalculator","getAggregatesCalculatorResolver","registerService","serviceId","serviceResolver","getService","EqActionResult","EqAction","EmptyChunk","EqServerExporter","setFormat","exportOptions","EasyQueryDataLoader","dataLoadPromise","success","dataTable","dataLoader","resultTable","resultSet","meta","totalRecords","hasNext","debugMode","fetchDataChunk","EqContext","attributeFormat","columnTitleFormat","servicesInitialized","modelLoader","queryStorage","querySynchronizer","dataFetcher","valueListLoader","queryFileLoader","aggrCalculator","internalListCache","loadModelOnStart","loadQueryOnStart","useStoredQueryOnFetch","_backendInfo","endpointVarsRegex","elasticPaging","_predefinedListRequestHandlers","_DSDE","onResult","_DSTE","_listRequestHandler","listName","editorParams","reqParams","attrPattern","prop","paramValue","requestParams","list","getListFromCache","processed","predefinedHandler","addListToCache","baseEndpoint","eqServices","widgets","exporters","endpoints","onResultTableUpdate","bind","errorHandlerId","addEventListener","msgTitle","msgText","sourceError","getModelLoader","getModelStorage","modelStorage","getQueryStorage","getQuerySynchronizer","getDataFetcher","getValueListLoader","getQueryFileLoader","getAggregatesCalculator","aggrCalculatorResolver","useEnterprise","keyOrInitCallback","registerExporter","registerServerExporter","exporter","getExporter","getExportFormats","addDefaultExporters","endpointKey","opt","optVal","setEndpoint","setEndpointIfNotExist","setDefaultEndpoints","endpointBase","initStart","setOptions","listCache","setExternalListCache","endpoint","handlers","onInit","afterLoadModel","afterLoadQuery","afterSyncQuery","afterFetchData","afterExportResult","onProcessStart","onProcessEnd","onError","removeEventListener","onListRequest","beforeLoadModel","beforeLoadQuery","beforeSyncQuery","beforeFetchData","beforeExportResult","initialQuery","defaultQueryId","defaultModelId","useDefaultExporters","serverExporters","widget","widgetOptions","getWidgetType","loadDefaultModel","fireEvent","backendInfo","useEndpoint","useBackend","addWidget","getAllWidgetsByType","widgetType","getWidgetByType","refreshWidgets","belongsToGroup","refresh","addQueryChangedCallback","removeQueryChangedCallback","dataModel","loadModelFromData","modelPlainData","setDefaultModelId","startProcess","endProcess","throwError","loadModel","Model","throwReady","clearResult","resultStatement","resultContent","cache","externalListCache","getListCacheKey","resetListCache","getListRequestHandler","handler","handlerId","getBaseEndpoint","GetValueList","Result","Success","errorMessage","LoadModel","callWhenModelLoaded","callFunc","LoadQuery","limitCustomSqlColumns","Properties","loadQueryList","startQueryListLoading","LoadQueryList","queries","useStorage","onNewQuery","NewQuery","queryData","SaveQuery","RemoveQuery","SyncQuery","Statement","querySaved","q","QueryStatus","groupFetchSuccess","afterGroupFetch","GetQueryFile","UploadQueryFile","FetchData","calculator","errorOccurred","fetchDrillDownData","exportResult","ExportResult","export","exportStart","startExportStatusCheck","exportId","interval","checkStatus","clearInterval","downloadResponseData","setInterval","getAttributeTitle","getColumnTitle","ParentColumn","eqContextResolver","registerEqContextResolver","eqconsts","browserUtils","constLists","ConstLists","SpecDateValues","isDefault","SpecTimeValues","BooleanValues","predicateLinkTypeList","Widget","slot","refreshCore","onProcessStartCore","onProcessEndCore","destroy","destroyCore","addElement","element","cssClass","className","addCssClass","hideElement","showElement","createBrowserEvent","eventName","Event","createEvent","initEvent","getViewportSize","height","clientHeight","innerHeight","getScrollPos","docElem","top","pageYOffset","scrollTop","left","pageXOffset","scrollLeft","getElementAbsolutePos","y","position","defaultBoundingClientRect","right","bottom","box","getBoundingClientRect","scollPos","clientTop","clientLeft","round","getWinSize","addEasyQueryCoreTexts","NewQueryName","Today","Yesterday","Tomorrow","FirstDayOfMonth","LastDayOfMonth","FirstDayOfWeek","FirstDayOfYear","FirstDayOfNextWeek","FirstDayOfNextMonth","FirstDayOfNextYear","Now","HourStart","Midnight","Noon","Entities","Attributes","Operators","AggregateFunctions","mobileModeChangeHandler","_isFirefox","isIE","ua","userAgent","includes","isEdge","isFirefox","_isMobileMode","_detectedIsMobileMode","detectIsMobileMode","isMobileMode","matchMedia","newValue","setIsMobileMode","onMobileModeChanged","eqCssPrefix","DomElementBuilder","parentElement","childBuilder","builder","domel","addChildElement","attrValue","setAttribute","focus","title","dataId","dataValue","removeAttribute","show","removeStyle","hide","toHide","setStyle","visible","isVisible","offsetWidth","offsetHeight","getClientRects","addClass","classNames","fullList","classList","removeClass","remove","toggleClass","toggle","on","listener","eventTypes","off","styleId","styleValue","setProperty","removeProperty","innerText","html","innerHTML","oldElem","tagName","replaceWith","addText","textEl","createTextNode","addHtml","toDOM","appendTo","DomTextAreaElementBuilder","DomInputElementBuilder","valueAsDate","valueAsNumber","maskPattern","input","inputHandler","mskd","startSelection","selectionStart","el","test","selectionEnd","keyCode","preventDefault","selection","onlyLodash","dispatchEvent","char","fromCharCode","charCode","DomSelectElementBuilder","addOption","option","selected","HTMLDivElement","HTMLSpanElement","HTMLAnchorElement","HTMLButtonElement","HTMLImageElement","HTMLInputElement","HTMLTextAreaElement","HTMLSelectElement","touchEventIsDefined","TouchEvent","DropEffect","EqDragEvent","dragImage","sourceEvent","dropEffect","Allow","pageX","pageY","MouseEvent","touches","Position","eqDragManager","DragManager","delta","draggableItem","finishedSuccessfully","mouseDownPosition","containerDescriptors","containerDescriptorIndex","classPrefix","DRAG_DISABLED_ATTR","registerDraggableItem","ondragstart","detectDragging","hasAttribute","stopPropagation","cursorPosition","abs","startDragging","mouseMoveEventListener","mouseMoveDragListener","beforeDragStart","cloneNode","renderer","updateCusror","updateImageClass","scope","updateDragItemPosition","onDragStart","mouseDownListener","mouseUpListener","endDraggind","dropContDesc","container","scopes","onDrop","onDragLeave","onDragEnd","registerDropContainer","removeDropContainer","descriptorOrSlot","descs","detectDragEnterEvent","dragEnterEvent","detectDragLeaveEvent","dragLeaveEvent","onDragOver","setCursorStyle","Forbid","cursor","children","onDragEnter","containerPos","AutoResizeColumns","GridColumnAlign","GridColumn","grid","isRowNum","_label","_description","align","NONE","dataColumn","widthOptions","columnWidths","alignment","MapAlignment","Left","LEFT","Center","CENTER","Right","RIGHT","default","rowNumColumn","GridColumnList","columnList","sync","hasRowNumCol","rowNumCol","onSyncGridColumn","cssPrefix$1","DFMT_REGEX","CellRendererType","StringCellRendererDefault","cellValueElement","rowElement","NumberCellRendererDefault","strValue","DateTimeCellRendererDefault","isDate","call","timeOptions","BoolCellRendererDefault","GridCellRendererStore","renderers","defaultRenderers","registerRenderer","setDefaultRenderer","STRING","NUMBER","DATETIME","BOOL","getDefaultRenderer","columnType","cellType","getCellType","getDefaultRendererByType","rendererType","getRenderer","EasyGrid","cssPrefix","pagination","paginationOptions","maxButtonCount","useBootstrap","defaultDataGridOptions","fixHeightOnFirstRender","syncGridColumns","useRowNumeration","allowDragDrop","calculatorRef","paging","pageSizeItems","autoResize","Always","stringColumns","numberColumns","boolColumns","dateColumns","otherColumns","showPlusButton","viewportRowsCount","showActiveRow","rowsOnPagePromise","containerInitialHeight","firstRender","prevRowTotals","landingIndex","landingSlot","_activeRowIndex","mergeOptions","processColumnWidthsOptions","cellRendererStore","setSlot","aggrOptions","colWidthOptions","pagingOptions","knownTypes","getElementById","getElementsByClassName","onRowClick","onRowDbClick","onPlusButtonClick","onColumnChanged","onColumnDeleted","onColumnMoved","onPageChanged","onActiveRowChanged","activeRowIndex","showLandingSlot","hideLandingSlot","columnId","getData","clearDOM","render","hasData","rootDiv","renderHeader","headerDiv","renderBody","bodyDiv","renderFooter","footerDiv","gridContainer","needAutoResize","Never","updateHeight","resizeColumns","firstRow","bodyCellContainerDiv","firstElementChild","viewportHeight","bodyViewportDiv","sbHeight","getContainerWidth","reduce","sum","current","headerViewportDiv","headerCellContainerDiv","headerRowDiv","hd","renderColumnHeader","renderHeaderButtons","containerWidth","colBuilder","colDiv","attrLabel","showAggrs","canShowAggregates","showProgress","getRowsToRender","hideProgress","rowsToRender","updateTotalsState","tr","renderRow","showGrandTotalsOnEachPage","isLastPage","onViewportKeydown","isLast","changeLevel","renderTotalsRow","applyGroupColumnTemplate","colIndex","renderCell","aggrContainer","isLastGroupColumn","groupColIndex","aggrColIndex","groupFooterTemplate","firstChild","cellDiv","rowCount","querySelectorAll","ensureRowVisibility","rowOrIndex","getDataRow","rowRect","viewportRect","rowTop","rowBottom","windowHeight","footerPaginateDiv","renderPageNavigator","pageInfoBlock","renderPageInfoBlock","pageInfoDiv","fistPageRecordNum","lastPageRecordNum","totalStr","getLocalIndexByGlobal","getGlobalIndexByLocal","indexGlobal","rowBuilder","rowIndex","colindex","cellElement","valueCell","cellRenderer","getCellRenderer","onGetCellRenderer","setPage","paginateDiv","totalRows","totalPages","buttonClickHandler","getAttribute","renderPaginationItem","pageIndex","content","extreme","active","li","newA","ul","userSelect","cell","allowPageSizeChange","selectChangeHandler","pageSizes","selectSize","sel","selOptions","selSet","Set","labelDiv","plusButtonTitle","colElems","rowElem","landingPos","newLandingIndex","colPos","insertBefore","updateActiveRow","activeRow","getActiveRow","visibility","sumWidth","headerCells","headerIdx","cellValues","maxWidth","whiteSpace","maxOption","minOption","Calendar","yearRange","minDate","maxDate","selectedDate","dateChanged","onDateChanged","dateLikeToDate","DateTimePicker","calendar","timePicker","defaultDate","setDateTime","currentDateTime","setTime","getDateTime","showCalendar","createCalendar","showDateTimeInput","timePickerIsUsed","showTimePicker","oneClickDateSelection","dateTimeChanged","createTimePicker","onTimeChanged","anchor","beforeShow","onApply","cancel","onCancel","onDateTimeChanged","DefaultCalendar","daysOfWeek","months","calendarBody","isManualInputChanging","selectedMonth","selectedYear","renderManualDateInput","headerTextElem","renderCalendarButtons","rerenderMonth","getInputDateFormat","newDate","manualInputElem","jump","updateDisplayedDateValue","prev","selectMonthElem","selectYearElem","rerenderSelectYear","exec","minusYear","plusYear","firstDay","daysInMonth","dateNum","dayOfWeek","onDrawDay","cellsDrawnInLastRow","cellsToDraw","TimePicker","currentTime","timeChanged","DefaultTimePicker","updateDisplayedTime","hoursInput","minutesInput","timeText","slidersBuilder","timeToDraw","DefaultDateTimePicker","sb","zIndex","renderButtons","globalMouseDownHandler","srcElement","nowButton","submitButton","calendarSlot","timePickerSlot","anchorPos","parentPos","DialogFooterAlignment","DefaultDialogService","openConfirm","closable","submitable","cancelable","onSubmit","openPrompt","submitOnEnter","arrangeParents","beforeOpen","processInput","dialog","DefaultDialog","onDestroy","dlg","untrack","track","createSet","DefaultDialogSet","openDialogs","openProgress","DefaultProgressDialog","getAllDialogs","closeAllDialogs","close","submitHandler","cancelHandler","keydownHandler","isActiveDialog","dialogId","windowElement","headerElement","alertElement","bodyElement","alignClass","footerAlignment","footerElement","bb","submitButtonText","recaptchaSiteKey","grecaptcha","ready","execute","cancelButtonText","getRootElement","getSubmitButtonElement","getCancelButtonElement","windowDiv","querySelector","clearAlert","onInput","onShow","submit","disableButtons","button","enableButtons","showAlert","reason","alert","windowDivs","turnOn","contentElement","progressElement","determinated","updateContent","updateProgress","progress","in01","dialogService","currentDialog","currentIndex","getCurrent","openNext","openPrev","dlgOptions","PRE_SELECT","JUMP_TO","safeFocus","addEasyDataUITexts","GridPageInfo","GridItemsPerPage","ButtonApply","ButtonNow","LblTotal","eqCssMobile","getMobileCssClass","EntitiesPanel","queryChangedCallbackId","panel","renderProgressBlock","syncWithColumns","refreshCheckedStateByColumns","showIndicatorOnLoad","progressBlock","parentNode","showToolbar","showSelectAllButton","showClearSelectionButton","showAddColumnButton","showAddConditionButton","showCheckboxes","showTooltips","draggableAttributes","showAttributes","showFilterBox","filterBoxMode","autoClearSelection","entityRenderedCallback","attributeRenderedCallback","edata","rootEntityBlock","entTree","entityTreeBlock","renderEntity","createFilterBox","createToolPanel","block","entityBlock","entityNode","entityChildren","nodeLabel","nodeInput","attrNode","attrInput","nodeToggleButton","currentOffset","isAttributeInTree","divElem","itemsLength","checkbox","currentTarget","checked","checkboxes","attrList","attrElems","elem","filterBoxBlock","filterBoxInput","checkFilterAttribute","displayAttrCount","collapseAll","expandAll","defClass","toolPanelBlock","toolSelectAll","toolDeselectAll","toolAddColumns","toolAddCond","toolLeftBlock","toolRightBlock","selectAll","deselectAll","attrElements","self","attrElement","attrCaption","textContent","checkFilterText","filterText","exprColumns","entChildren","entElem","childNodes","nodeButtons","inputs","ColumnsEditMode","ConditionsEditMode","ColumnAction","QPEditablePart","ConditionAction","FacetType","ChartType","AggrFunc","FormFieldType","MenuLevel","applyItem","_applyItem","isFilteringMode","showSelected","parentMenu","menu","parentLevel","levelIndex","levelDiv","domWriteItemsId","menuId","itemRenderedCallback","itemDiv","activeItem","selectedItem","initialized","updated","renderContent","setItems","itemBgColor","colors","bgON","itemFgColor","fgON","bgOVER","itemFontFamily","itemStyle","fontFamily","itemFontSize","fontSize","multiselect","isSubQuery","baseDivBuilder","useDefaultStyles","border","baseDiv","hideButtons","applyDiv","applyBtn","borderBottom","padding","marginBottom","applyTextNode","buttons","cancelBtn","marginLeft","cancelText","hideMenu","searchBoxAlwaysShown","showSearchBoxAfter","searchDivBuilder","searchEditBoxBuilder","deactivateItem","renderItems","searchBox","moveActiveItemUp","moveActiveItemDown","openSubLevel","searchDiv","scrollDiv","tabIndex","overflowX","overflowY","which","getRootLevel","closeDiv","filteredItems","activateItem","menuItem","showSubLevel","subLevel","focusScrollDiv","turnCheckboxes","itemCheckbox","isItemSelected","setItemSelected","submitItems","selectedItems","allSubitemsAreFiltered","filterCallback","isItemDiv","isLevelDiv","getMenuItem","renderItemsWithoutFilter","activateOnMouseOver","itemFilterCallback","getItemFilterCallback","color","paddingLeft","paddingRight","cb","defaultChecked","margin","verticalAlign","itemText","showItemIds","itemTextNode","arrowSpan","arrowText","itemClickHandler","itemSelected","refreshCheckboxes","isCursorInside","renderItemsWithFilter","filterSections","pureFilterTexts","section","filterItems","renderItemWithFilter","matchesFilter","regexp","resultItems","restFilterSections","filterRegexp","groupItem","groupItemMatches","filterTexts","levelFilterText","highlightText","lowerText","lowerContent","insertValue1","insertValue2","indexInMas","itemOverBgColor","itemOverFgColor","fgOVER","itemClass","itemClassOver","backgroundColor","levelId","scroll","winSize","leftSpace","rightSpace","offsetParent","showAt","adjustTopPos","levelBottom","initLevelDiv","levelStyle","maxHeight","useMaxSpace","anchorRect","anchorHeight","upperSpace","scrollY","lowerSpace","minOffset","levelDivRect","outsideBottom","outsideTop","scrollDivRect","minItemWidth","maxItemWidth","searchBoxAutoFocus","submitMenu","update","newItems","refreshItems","findItem","searchedText","PopupMenu","mouseIsOverBlock","mouseIsOverLink","toId","ancorFocused","adjustHeight","submitOnBlur","lastMenuID","updateProps","rootLevel","menuKeyUpHandler","stopImmediatePropagation","o","isOutside","menuLevel","shadow","commandTemplate","clearItemsMenuProps","clearItemMenuProps","setSelectedItems","selectedIds","showMenu","activeElement","itemSelectedCallback","menuClosedCallback","onMenuItemSelected","srcPos","anchorWidth","findHighestZIndex","highest","zindex","defaultView","getComputedStyle","getPropertyValue","numZIndex","knockMenuStyle","DisplayFormatParser","s","getTokenText","ColumnRendererCP","functionMenu","formatsMenu","buttonMenu","isMouseOverBlock","keepShowingButtons","columnEnabled","getButtonsToShow","sortingButton","renderSoringButton","replaceChild","createFunctionMenu","createFormatsMenu","createButtonMenu","isFullMode","editMode","Full","isReadOnlyMode","ReadOnly","getClassesToAdd","renderCheckbox","renderExpressionBlock","showColumnTitles","renderCaptionBlock","buttonsIndex","buttonsList","buttonsToShow","renderEnabledButton","renderColumnTypeButton","renderColumnFormatButton","renderDeleteButton","renderMenuButton","onMouseEnter","onMouseLeave","accentActiveColumn","onMouseClick","alwaysShowButtons","showButtons","activate","toggleColumnPicked","adjustButtonsVisibility","fireColumnChanged","inputEl","minWidth","isEndEvent","save","KeyboardEvent","FocusEvent","aEl","sortButtonCssClass","sortButtonDirectionCssClass","Descending","i18n$1","getUIS","sortMenu","moveMenu","getButtonMenuSelectedItems","Hidden","MoveTop","MoveDown","MoveUp","MoveBottom","SortingNone","SortingAsc","SortingDesc","buttonMenuHandler","leaveButtonBlock","evt","Menu","allowAggrColumns","changeTypeHandler","getFormatsMenuItems","allowDisplayFormatChange","changeFormatHandler","Enable","itemId","enterButtonBlock","isColumnActive","funcs","funcAllowed","colDataType","toInclude","areCustomExpressionsAllowed","menuOptions","FixedList","curQuery","colMenu","processFormatsButtonMenuItems","processExtraButtonMenuItems","Appearance","allowHiddenColumns","sortItems","allowSorting","getSortMenuList","getMoveMenuList","extra","getExtraButtonMenuItems","arrSelected","formatId","AttrColumnRendererCP","renderBaseExpression","baseAttr","showEntitiesMenu","baseExpressionItemSelectedCallback","attrid","updateBaseAttr","changeTypeToCustomSql","newElement","changeTypeToAggr","AggrFuncColumnRendererCP","arguments","displayFormatParser","exprBlockBuilder","arrFormat","parseDisplayFormat","functionLink","changeTypeToSimple","parser","EditableColumnRendererCP","dataTypeMenu","exprBlock","getColumnValue","colVal","setColumnValue","createDataTypeMenu","dataTypeLink","typeItem","CustomSqlColumnRendererCP","getDefaultValue","ConstColumnRendererCP","ColumnsPanel","activeColumn","showAddRow","showHeader","allowDuplicates","attrElementFormat","titleElementFormat","columnRenderedCallback","customExpressionText","showAddAllForEntity","detachQueryObserver","attachQueryObserver","moveColumnCore","addNewColumn","renderBaseElements","minusHeight","headerBuilder","columnsBlock","addRowElement","ids","queryEventCallbackId","focusedBefore","isFocusInside","modifyColumn","colEl","getColumnRenderer","newEl","focusElem","agjustHeaderVisibility","addColumnElement","deleteColumn","nextSibling","previousSibling","focusCond","rowElems","rowHeight","absPos","scrollIntoView","behavior","createEntitiesMenu","createColumnMenus","renderColumn","isActive","newColBlock","scrollToBottom","scrollHeight","checkColumnsArray","checkColumn","getColumnsBlock","addAllColumnsToEntitiesList","attrIds","unshift","entitiesList","adjustEntitiesMenuHeight","entitiesMenu","createSortMenu","createMoveMenu","colToMove","ColumnRendererCB","tapedTwice","bar","isDraggable","renderSortingImage","renderButtonsBlock","showDelete","showType","renderSortingButton","tapHandler","isFocused","ctrlKey","metaKey","clickEvent","buttonSortingClickHandler","buttonDeleteClickHandler","buttonTypeClickHandler","changeColumnTypeHandler","buttonFormatClickHandler","formatButtonIsShown","onHideButtonsMobile","onShowButtonsMobile","AttrColumnRendererCB","AggrFuncColumnRendererCB","EditableColumnRendererCB","CustomSqlColumnRendererCB","ConstColumnRendererCB","ColumnsBar","customQuery","sortMenuList","moveMenuList","addRowButton","elements","columnSlots","colSlot","colWidth","colHeight","paddingWidth","paddingHeight","renderAddRowButton","renderColumnButtonsBlockMobile","columnButtonsBlockMobileArrow","columnButtonsBlockMobile","buttonsBlockSortingButton","currentColumnRenderer","hideColumnButtonsMobile","buttonsBlockTypeButton","buttonsBlockFormatButton","buttonsBlockDeleteButton","showColumnButtonsMobile","columnRenderer","columnElement","currentActiveColumn","rect","offsetTop","offsetLeft","columnSlot","globalCounter","ColumnRendererSB","getArrow","sd","SortingBar","TextRenderer","ConditionRenderer","autoAppear","coreRender","onConditionRendered","isFixed","SimpleConditionRenderer","renderConjunction","mayAppear","minLength","getOperatorRenderer","toAppear","exprRenderer","getExpressionRenderer","adjustWidth","accentActiveCondition","toggleConditionPicked","buttonsBlock","setConditionParameterized","setConditionInJoin","getConditionMenu","isFirstConditionInGroup","showConjunctions","linkTypeStr","conjuctionText","isConditionActive","alwaysShowButtonsInConditions","conditionMenuHandler","AddCondition","entMenu","getEntitiesMenu","descr","AddGroup","condMenu","getConditionMenuSelectedItems","Parameterized","InJoin","editableParts","Removal","Addition","onButtonMouseEnter","onButtonMouseLeave","DomDropDownElementBuilder","appear","onGetMenu","_onGetMenu","onItemSelected","_onItemSelected","ConditionGroupRenderer","isRoot","renderGroupRow","renderConditions","showRootRow","ConditionGroupRowRenderer","getConditionRenderer","buildGroupElements","getGroupTitle","groupTitle","curType","dropdown","getLinkTypeMenu","getConditionGroupMenu","alwaysShowButtonsInGroups","BaseElementRenderer","isEditMode","labelElement","renderLabelElement","renderEditor","showEditor","displayedText","getLabelText","getEmptyText","ExpressionRenderer","expression","valueEditor","onExpressionRendered","emptyTextValue","Value","validateInput","showValidationError","isEmptyValue","InputExpressionRenderer","inputBuilder","dontProcessBlur","validationResult","inputElement","closeEditor","MIN_WIDTH","inputValue","validateListInput","validateScalarInput","ListExpressionRenderer","menuItemsList","showWhenReady","adjustNewValue","emptyTextList","getListName","fillMenuItemsList","renderMenuBlock","showLoader","hideLoader","getValuesAsArray","selLength","multiSelect","queryPanel","menuContainer","showIdsForListItems","onComplete","takeDefaultValue","itemLen","CustomListExpressionRenderer","isLoading","onClickTemp","loaderElement","listRequestHandler","SqlListExpressionRenderer","AttributeExpressionRenderer","attrObj","attrFormat","emptyTextAttribute","DropDownRenderer","getMenu","AddRowRenderer","OperatorRenderer","operId","related","isRelatedToSubQuery","emptyTextOperator","DateTimeExpressionRenderer","dtp","internalDateFormat","internalTimeFormat","pickerOptions","convertToInternalFormat","dateTimePickerResolver","dt","convertFromInternalFormat","dateTimeStr","defautValue","SubQueryExpressionRenderer","dialogBlockBody","renderColumnBlock","renderQueryPanelBlock","exprType","colEntitiesList","colEntitiesMenu","columnBlock","setResultAttributeId","parentEl","subQueryPanelBlock","qpId","parentPanel","subOptions","entitiesListFilter","listItems","listOptions","subQueryPanelListOptions","subQueryPanel","clonePanel","rootCondEl","minHeight","subQueryDialogWidth","BindToParentColumnExpressionRenderer","attrDataType","QueryPanel","activeCondition","entitiesPopupHandler","allowParameterization","allowInJoinConditions","showPoweredBy","activateRootOnStart","subQueryDialogHeight","dialogZIndex","numberListSeparators","autoEditNewCondition","onGetConditionRenderer","onGetExpressionRenderer","onGetOperatorRenderer","onOperatorRendered","onGetAddRowRenderer","defaultQuery","Default","convertEditModelToEditableParts","hideLangindSlot","FixedConditionList","checkEntitiesMenu","conditionMenu","linkTypeMenu","rootGroupMenu","groupMenu","modifyCondition","autoEdit","newCondContainer","lastChild","deleteCondition","dateFormatValue","dateFormatDisplay","createConditionMenus","createLinkTypeMenu","rootContainer","addrowRenderer","getAddRowRenderer","attributeMenu","FilterBar","applyOnClose","showApplyButton","showClearButton","headerClickListener","headerClickHandler","qpElement","applyBtnClick","applyFilter","clearBtnClick","clearFilter","showQueryPanel","slideDown","duration","overflow","paddingTop","paddingBottom","marginTop","boxSizing","transitionProperty","transitionDuration","qpBlock","updateHeader","hideQueryPanel","slideUp","headerTextElement","headerLinkElement","headerArrowBlock","headerArrowElement","textResize","headerIconElement","headerTextBlock","applyFilterCallback","Grid","useCustomLocaleSettings","beforeTableRendering","applyDisplayFormats","EasyGridWidget","hasCustomTotalsSettings","autoRefresh","_b","gridOptions","resultGrid","easyGrid","addColumnClickHandler","columnMovedHandler","updateTotalsSettings","StatementPanel","statementText","ProcessWidget","__awaiter","thisArg","_arguments","P","generator","fulfilled","rejected","done","adopt","SuppressedError","ResultFacet","dialogTitle","canDisplayFlag","downloadAllClickHandler","getDialogService","loadElasticChunk","nextChunkStart","recordsToLoad","loadedRecords","contentDiv","displayMessageDiv","showSettingsDialog","ds","renderDialogContent","submited","submitSettingsDialog","afterDialogOpened","fieldsContainer","renderFormFields","form","cont","tabNameInput","canDisplay","showErrorMessage","showUnableDisplayMessage","hideUnableDisplayMessage","getType","onResize","ChartWidget","slotElement","chartType","Pie","supportedChartTypes","potentialLabelColumns","potentialDataColumns","labelColumn","dataColumns","showOnPaging","hideSettings","legend","hasColumnsForChart","prepareChartData","getSupportedChartTypes","getOptions","getChartTypeName","ct","Area","Bar","Column","Combo","Doughnut","Polar","Radar","Histogram","Line","SteppedLine","updateSettings","updateColumns","showLegend","updateChartColumns","colNum","colType","colLabel","initChart","hasChartTypes","getCurrentChartType","mainDiv","canDraw","chartTypeSelector","sopt","ctkey","settingsDiv","chartDiv","initSettingsDiv","chartSettingsBtn","toggleSettings","drawChart","addContentDiv","delay","drawCore","settingsHeader","labelColumnSelectorCaption","labelColumnSelector","dataDiv","dataColumnSelectorCaption","dataColumnSelector","getPotentialLabelColumns","getPotentialDataColumns","getLabelColumnIndex","getDataColumnIndex","first","toggleVisibility","complete","ChartJsWidget","chartLabels","chartColumns","hasChartJs","Chart","config","generateConfig","chartContext","getChartCanvas","canvases","borderColor","dataColors","datasetName","fillValue","dataset1","fill","stepped","steppedLine","displayLegend","getChartType","datasets","labels","GoogleChartWidget","hasGoogleCharts","google","charts","googleDataView","visualization","DataView","convertToGoogleFormat","convertToGoogleType","convertToGoogleValue","googleTable","DataTable","addRows","setCell","chartOptions","chartArea","getChartAreaWidth","pieHole","createChart","draw","setColumns","ColumnChart","BarChart","ComboChart","AreaChart","LineChart","SteppedAreaChart","PieChart","ChartFacet","chart","horizClass","getSettings","labelCol","dataCol","showLeg","PivotTableFacet","pivotTable","maxRowCount","defaultRenderer","rowEl","totalsRow","PivotTable","createAggrFuncSelectBuilder","aggrFunc","csb","aggrfunc","createColumnsSelectBuilder","allowedTypes","colName","formFieldType","getContextDataTable","firstNumericColIndex","optionIndex","ColumnField","RowField","CellData","totalsCol","colTypes","fieldTypes","colSelect","rowSelect","tmp","rowName","fieldName","validateSelectedField","aggrSelector","Count","Average","updatePivotData","dataSize","rowIdx","fieldIdx","columnField","columnCol","columnRow","rowLabel","rowType","colValues","rowValues","colValue","rowValue","null_columns","colFieldFormatter","formatNumber","formatDate","new_rows","calcAggrFunc","totalByRow","Min","Max","total_row","totalByCol","Sum","average","MAX_SAFE_INTEGER","fieldValue","MIN_SAFE_INTEGER","DataTableFacet","reinitGrid","gridResolver","addColumns","totals","DataGrid","FacetContainer","facets","facet","createFacetTab","ExportDialog","defFormat","ResultFacetsPanel","activeFacetIndex","showExportButton","showRefreshButton","showMaximizeButton","maximize2Window","showProcessIndicator","facetTypes","menuItems","menuItemsFilter","renderProcessBlock","loadFacets","reloadFacets","createAddMenu","validateAddFacetButton","renderActiveFacet","updateTotalRecords","addMenu","recordsDiv","exportDiv","_processBlock","tabsDiv","tabsUl","renderFacet","addFacetButton","addClickHandler","manageDiv","bdb","exportHandler","refreshHandler","maximizeButton","maximizeHandler","toWindow","isMaximized","facetTab","renderFacetTab","renderFacetSlot","settingsClickHandler","closeClickHandler","selectClickHandler","refreshFacetTabs","removeFacet","facetSlot","saveFacets","setActiveFacet","confirmed","createDefaultFacetIfNotExist","isActivate","Facets","Activate","fd","ExportWidget","enableExport","clickHandler","AggrSettingsRenderer","selectState","funcMap","onChanged","dropSelectState","dropState","setInitialState","changed","state","grandTotals","recordCount","getAvailableColumns","renderCore","slotb","currentGroup","groupBlockColumns","selectedBlockColumns","groupCounter","getGroupForColumn","groupBlock","aggrBlock","removeAggrBtnClickHandler","selectedBlock","buttonsContainer","groupBtnClickHandler","aggrBtnClickHandler","countsCheckboxChangeHandler","grandCheckboxChangeHandler","removeGroupBtnClickHandler","validateCheckboxes","prevElement","prevInputEl","nextInputEl","selector","selectedCols","hasSelected","hasAggrs","hasTotals","hasCounts","getValidationMessage","hasRecCount","isTaken","colCheckboxChangeHandler","getGroupIndexForColumn","findIndex","g1","g2","btn","AggrSettingsDialog","initQuery","enableAggrCheckBoxChangeHandler","closest","AggregationBar","linkClickCallback","getLinkText","groupArr","colNames","groupString","aggrArr","aggrString","mobClass","dialogLink","LocaleWidget","changeLocale","selectEl","locales","optionEl","displayLocaleName","QueryNameWidget","nameTemplate","nameSlot","asteriskSlot","tooltipSlot","queryName","queryDescription","View","domRoots","defaultViewOptions","disableConfirmationOnQueryChange","queryFileExtensions","clearResultOnQueryChange","showChart","viewOptions","resultOptions","resetContext","renderSpinner","createEqContext","shadowRoots","initOptions","createWidgets","initDone","exportWidget","columnsPanel","entitiesPanel","resultPanel","columnsBar","filterBar","processBar","statementPanel","queryNameLabel","facetsPanel","resultCount","exportButton","aggregationBar","slots","resultCountSpan","exportButtons","epElement","resolveElement","entitiesPanelWidget","createEntitiesPanelWidget","cpElement","columnsPanelWidget","createColumnsPanelWidget","cbElement","columnsBarWidget","createColumnsBarWidget","queryPanelWidget","createQueryPanelWidget","resultPanelSlot","resultGridWidget","gridPanel","createResultGridWidget","chartWidget","chartPanel","createChartWidget","qnElement","queryNameWidget","createQueryNameWidget","fbElement","filterBarWidget","createFilterBarWidget","sbElement","sortingBarWidget","createSortingBarWidget","pbElement","processWidget","createProcessWidget","stElement","statementPanelWidget","createStatementPanelWidget","clElement","createLocaleWidget","fpElement","resultFacetPanelWidget","createResultFacetsPanel","ewElement","createExportWidget","resultCountSlot","aggrbElement","aggregationBarWidget","createAggregationBarWidget","elementOrId","domRoot","resolveElementsByClassName","elemList","displayRecordsCount","setDialogService","executeQuery","fetchEmptyQueries","showResultSpinner","hideResultSpinner","toggleExportButtons","enableExportButtons","disableExportButtons","_spinnerDiv","chartWidgetResolver","resultGridResolver","detach","localeWidget","statementWidget","ReportView","reports","reportCache","exportClass","disabledClass","useReportCache","syncReportOnChange","_reportSaveTemplate","exportButtonClickHandler","clearReportButtonClickHandler","clearReportButtonClick","newReportButtonClickHandler","newReportButtonClick","loadReportButtonClickHandler","loadReportButtonClick","saveReportButtonClickHandler","saveReportButtonClick","removeReportButtonClickHandler","removeReportButtonClick","reloadReportDataButtonClickHandler","reloadReportDataButtonClick","location","reload","syncQueryOnChange","defaultReportId","changeType","isLiteUpdate","ExtraData","syncStarted","noSync","syncReport","fetchDataOnChange","renderReportList","reportId","clearReportButton","newReportButton","loadReportButton","saveReportButton","removeReportButton","reloadReportDataButton","elems","hideExportButtons","exportButtonsContainer","reportListSlot","applyReportNamePattern","allowedPattern","newReport","nameInput","processEl","queryDesc","insertIntoReportList","loadReport","reportToLoad","findReportById","reportLoaded","renderReportProps","reportContent","getReportContentFromCache","saveReportContentInCache","setActiveReport","saveCurrentReportAs","removeCurrentReport","report","removeFromReportList","reportIndex","currentReport","lastUpdated","rlItems","renderReportPanels","renderReportItemInList","showExportButtons","reportName","rid","reportsContainer","noReportPanel","indexOfReportById","clearErrors","errorHandler","findReportCacheItem","addOldEasyQueryUIMapper","addEasyQueryUITexts","AltMenuAttribute","AltMenuConstantExpression","ButtonClose","ButtonNext","ButtonPrev","MenuEnable","MenuParameterization","MenuJoinCond","CmdClear","CmdDelete","CmdToggleEnable","CmdToggleEnableCustom","CmdAddCondition","CmdAddCondGroup","ButtonSelectAll","ButtonDeselectAll","ButtonAddColumns","ButtonAddConditions","CmdClickToAddCondition","CmdDeleteRow","ErrIncorrectGroupTitleFormat","ErrNotNumber","ErrIncorrectInteger","ErrIncorrectNumberList","LinkTypeAll","LinkTypeAny","LinkTypeNone","LinkTypeNotAll","ConjAll","ConjAny","ConjNotAll","ConjNone","MsgApplySelection","MsgAs","MsgEmptyList","MsgEmptyListValue","MsgEmptyScalarValue","MsgSubQueryValue","MsgEmptyAttrValue","MsgEmptyOperator","MsgEmptyCustomSql","MsgCustomSql","MsgNoResult","MsgResultCount","MsgOf","ConditionGroupTitle","RootConditionGroupTitle","StrAddConditions","SubQueryDialogTitle","SubQueryColumnTitle","SubQueryEmptyColumn","SubQueryQueryPanelCaption","ButtonSorting","ButtonToAggr","ButtonToSimple","ButtonFormat","CmdAscending","CmdClickToAddColumn","CmdDeleteColumn","CmdDeleteSorting","CmdDescending","CmdGroupAppearance","CmdGroupSort","CmdGroupFormat","CmdNotSorted","ColTypeAggrFunc","ColTypeCompound","ColTypeGroup","ColTypeSimple","HeaderExpression","HeaderSorting","HeaderTitle","SortHeaderColumn","SortHeaderSorting","StrAddColumns","CustomExpression","AddAllForEntityText","CmdMoveToStart","CmdMoveRight","CmdMoveLeft","CmdMoveToEnd","CmdMoveUp","CmdMoveDown","ButtonMenu","CmdToSimple","CmdMoveToFirst","CmdMoveToPrev","CmdMoveToNext","CmdMoveToLast","CmdHiddenColumn","RowButtonTitle","EntityToggle","StrNoFilterDefined","StrNoFilterClickToAdd","HintHours","HintMinutes","RemoveQueryTitle","RemoveQueryContent","NewQueryTitle","NewQueryContent","NewQueryDefName","SaveQueryTitle","SaveQueryContent","SaveQueryDefName","QueryChangedTitle","QueryChangedContent","QueryClearContent","UpdateQuerySelector","FileNameLabel","SaveQueryToFileDlgTitle","NewReportDefName","NewReportDlgTitle","SaveReportDlgTitle","SaveReportDlgLabel","ReportDescLabel","RemoveReportDlgTitle","RemoveReportContent","TotalRecordsLabel","AddMenuItems","Pivot","LoadDataDlgTitle","LoadDataDlgContent","RefreshBtnTitle","ExportBtnTitle","MaximizeBtnTitle","RestoreBtnTitle","RemoveFacetDlgTitle","RemoveFacetDlgContent","DefaultDlgTitle","DefaultFacetTitle","NewFacetTitle","TabNameLabel","ErrQueryChanged","ErrNotEnoughData","ErrTooMuchData","FacetTitle","DlgTitle","DataColumnSelectorLabel","LabelColumnSelectorLabel","ChartTypeSelectorLabel","ShowLegendLabel","SwapBtnTitle","ColumnFieldSelectorLabel","RowFieldSelectorLabel","CellDataSelectorLabel","TotalsRowLabel","TotalsColLabel","TotalGridLabel","TotalsDlgLabel","GrandTotalsLabel","TotalsDlgTitle","ExportDlgTitle","ExportDlgFmtLabel","csv","excel","pdf","AggrSettings","GroupBtn","UngroupBtn","AggrBtn","UnaggrBtn","GroupCountsLabel","AggrDialogTitle","EnableAggrLabel","SelectedError","NoGroupsOrAggrError","NoGroupsOrGrandError","NoAggrOrCountError","NoGroupsLabel","NoAggrsLabel","EmptySettingsLabel","Element","msMatchesSelector","webkitMatchesSelector","TypeError","magics","lcv","__kt","versionNum","ck","infoBytes","_bs","binary_string","urlatob","atob","bytes","Uint8Array","charCodeAt","part2","ism","magic","edc","t36","encChar","majVer","eds","f36","tokens","pow","ed","ConditionEx","readOnly","parameterized","inJoin","newCond","QueryColumnEx","QueryEx","lType","path","findPath","addPathToTree","pathAdded","newNode","node","curPath","curStep","nextStep","passedEntities","pathFound","checkPath","endPoint","entityLinks","entity2","newPath","EqServerQueryStorage","delete","DataModelEx","DataTableAggregatesCalculator","levelsTotals","prevRow","initObjects","aggrColIds","createColumnAggregatesObject","MAX_VALUE","MIN_VALUE","levelNumber","levelTotals","resetLevelTotals","allRows","processDataRow","flushLevelTotals","rowTotals","aggrCol","levelIndexChanged","checkLevelChange","updateLevelTotals","groupIndex","prevValue","groupTotals","columnTotals","applyAggrFunc","strIsEmpty","baseLicApiUrl","eqVersion","LCDialog","dialogSet","buildStartPage","validateForm","startPageOnSubmit","buildCodePage","codePageOnSubmit","buildSuccessPage","buildFailurePage","dialog1","emailInput","isValidForm","codeInput","addInputField","parentBuilder","inputOptions","required","controlsPanelBuilder","formBuilder","outerHTML","authEmail","authName","email","ptag","apptype","authCode","EnterpriseEqContext","createTrialWM","showTrialWM","hideTrialWM","showNoLicenseAlert","buttonTitle","buttonUrl","footer","backendType","appType","trialDiv","textAlign","opacity","font","transition","eq","lineHeight","korzh","trialOnly","fontWeight","trialDivElement","calcTotals","reportView"],"mappings":"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","x_google_ignoreList":[0,1,2,3,4]}